import{e as nh,m as Bo,V as Gy}from"./vue.8f4f67e3.js";import{n as Er}from"./index.d104a5f7.js";import{d as Hy,K as Uy,r as jf,L as Vy,q as Wy,b as Zf}from"./vuetify.a2251fa2.js";/* empty css                            *//**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Go="145",jy=0,Xf=1,Zy=2,sm=1,Xy=2,ho=3,bs=0,_i=1,On=2,zn=0,ps=1,$f=2,qf=3,Jf=4,$y=5,rs=100,qy=101,Jy=102,Yf=103,Qf=104,Yy=200,Qy=201,Ky=202,t0=203,om=204,am=205,e0=206,i0=207,n0=208,r0=209,s0=210,o0=0,a0=1,h0=2,qc=3,l0=4,c0=5,u0=6,f0=7,Ou=0,d0=1,p0=2,rn=0,g0=1,m0=2,v0=3,_0=4,y0=5,hm=300,Ss=301,Cs=302,Jc=303,Yc=304,Fh=306,Qc=1e3,Pi=1001,Kc=1002,ii=1003,Kf=1004,td=1005,pi=1006,x0=1007,Nh=1008,yr=1009,w0=1010,M0=1011,lm=1012,b0=1013,lr=1014,cr=1015,xo=1016,S0=1017,C0=1018,gs=1020,T0=1021,P0=1022,ki=1023,E0=1024,A0=1025,dr=1026,Ts=1027,L0=1028,R0=1029,O0=1030,D0=1031,I0=1033,pl=33776,gl=33777,ml=33778,vl=33779,ed=35840,id=35841,nd=35842,rd=35843,k0=36196,sd=37492,od=37496,ad=37808,hd=37809,ld=37810,cd=37811,ud=37812,fd=37813,dd=37814,pd=37815,gd=37816,md=37817,vd=37818,_d=37819,yd=37820,xd=37821,wd=36492,xr=3e3,Se=3001,z0=3200,F0=3201,cm=0,N0=1,tn="srgb",ur="srgb-linear",_l=7680,B0=519,tu=35044,Md="300 es",eu=1035;class Ls{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(i)===-1&&n[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const e=this._listeners[t];if(e!==void 0){const r=e.indexOf(i);r!==-1&&e.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const n=this._listeners[t.type];if(n!==void 0){t.target=this;const e=n.slice(0);for(let r=0,s=e.length;r<s;r++)e[r].call(this,t);t.target=null}}}const Ze=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],yl=Math.PI/180,bd=180/Math.PI;function sn(){const o=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ze[o&255]+Ze[o>>8&255]+Ze[o>>16&255]+Ze[o>>24&255]+"-"+Ze[t&255]+Ze[t>>8&255]+"-"+Ze[t>>16&15|64]+Ze[t>>24&255]+"-"+Ze[i&63|128]+Ze[i>>8&255]+"-"+Ze[i>>16&255]+Ze[i>>24&255]+Ze[n&255]+Ze[n>>8&255]+Ze[n>>16&255]+Ze[n>>24&255]).toLowerCase()}function ti(o,t,i){return Math.max(t,Math.min(i,o))}function G0(o,t){return(o%t+t)%t}function xl(o,t,i){return(1-i)*o+i*t}function Sd(o){return(o&o-1)===0&&o!==0}function iu(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function Dn(o,t){switch(t.constructor){case Float32Array:return o;case Uint16Array:return o/65535;case Uint8Array:return o/255;case Int16Array:return Math.max(o/32767,-1);case Int8Array:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}function ue(o,t){switch(t.constructor){case Float32Array:return o;case Uint16Array:return Math.round(o*65535);case Uint8Array:return Math.round(o*255);case Int16Array:return Math.round(o*32767);case Int8Array:return Math.round(o*127);default:throw new Error("Invalid component type.")}}class bt{constructor(t=0,i=0){bt.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,n=this.y,e=t.elements;return this.x=e[0]*i+e[3]*n+e[6],this.y=e[1]*i+e[4]*n+e[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,n=this.y-t.y;return i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const n=Math.cos(i),e=Math.sin(i),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*e+t.x,this.y=r*e+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class mi{constructor(){mi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,i,n,e,r,s,a,h,l){const c=this.elements;return c[0]=t,c[1]=e,c[2]=a,c[3]=i,c[4]=r,c[5]=h,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,n=t.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(t,i,n){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const n=t.elements,e=i.elements,r=this.elements,s=n[0],a=n[3],h=n[6],l=n[1],c=n[4],u=n[7],f=n[2],d=n[5],p=n[8],g=e[0],m=e[3],v=e[6],x=e[1],_=e[4],y=e[7],b=e[2],M=e[5],C=e[8];return r[0]=s*g+a*x+h*b,r[3]=s*m+a*_+h*M,r[6]=s*v+a*y+h*C,r[1]=l*g+c*x+u*b,r[4]=l*m+c*_+u*M,r[7]=l*v+c*y+u*C,r[2]=f*g+d*x+p*b,r[5]=f*m+d*_+p*M,r[8]=f*v+d*y+p*C,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],a=t[5],h=t[6],l=t[7],c=t[8];return i*s*c-i*a*l-n*r*c+n*a*h+e*r*l-e*s*h}invert(){const t=this.elements,i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],a=t[5],h=t[6],l=t[7],c=t[8],u=c*s-a*l,f=a*h-c*r,d=l*r-s*h,p=i*u+n*f+e*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return t[0]=u*g,t[1]=(e*l-c*n)*g,t[2]=(a*n-e*s)*g,t[3]=f*g,t[4]=(c*i-e*h)*g,t[5]=(e*r-a*i)*g,t[6]=d*g,t[7]=(n*h-l*i)*g,t[8]=(s*i-n*r)*g,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,n,e,r,s,a){const h=Math.cos(r),l=Math.sin(r);return this.set(n*h,n*l,-n*(h*s+l*a)+s+t,-e*l,e*h,-e*(-l*s+h*a)+a+i,0,0,1),this}scale(t,i){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=i,n[4]*=i,n[7]*=i,this}rotate(t){const i=Math.cos(t),n=Math.sin(t),e=this.elements,r=e[0],s=e[3],a=e[6],h=e[1],l=e[4],c=e[7];return e[0]=i*r+n*h,e[3]=i*s+n*l,e[6]=i*a+n*c,e[1]=-n*r+i*h,e[4]=-n*s+i*l,e[7]=-n*a+i*c,this}translate(t,i){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=i*n[2],n[4]+=i*n[5],n[7]+=i*n[8],this}equals(t){const i=this.elements,n=t.elements;for(let e=0;e<9;e++)if(i[e]!==n[e])return!1;return!0}fromArray(t,i=0){for(let n=0;n<9;n++)this.elements[n]=t[n+i];return this}toArray(t=[],i=0){const n=this.elements;return t[i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}function um(o){for(let t=o.length-1;t>=0;--t)if(o[t]>=65535)return!0;return!1}function wo(o){return document.createElementNS("http://www.w3.org/1999/xhtml",o)}function pr(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function rh(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}const wl={[tn]:{[ur]:pr},[ur]:{[tn]:rh}},Mi={legacyMode:!0,get workingColorSpace(){return ur},set workingColorSpace(o){},convert:function(o,t,i){if(this.legacyMode||t===i||!t||!i)return o;if(wl[t]&&wl[t][i]!==void 0){const n=wl[t][i];return o.r=n(o.r),o.g=n(o.g),o.b=n(o.b),o}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(o,t){return this.convert(o,this.workingColorSpace,t)},toWorkingColorSpace:function(o,t){return this.convert(o,t,this.workingColorSpace)}},fm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ke={r:0,g:0,b:0},bi={h:0,s:0,l:0},ea={h:0,s:0,l:0};function Ml(o,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?o+(t-o)*6*i:i<1/2?t:i<2/3?o+(t-o)*6*(2/3-i):o}function ia(o,t){return t.r=o.r,t.g=o.g,t.b=o.b,t}class qt{constructor(t,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&n===void 0?this.set(t):this.setRGB(t,i,n)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=tn){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Mi.toWorkingColorSpace(this,i),this}setRGB(t,i,n,e=ur){return this.r=t,this.g=i,this.b=n,Mi.toWorkingColorSpace(this,e),this}setHSL(t,i,n,e=ur){if(t=G0(t,1),i=ti(i,0,1),n=ti(n,0,1),i===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+i):n+i-n*i,s=2*n-r;this.r=Ml(s,r,t+1/3),this.g=Ml(s,r,t),this.b=Ml(s,r,t-1/3)}return Mi.toWorkingColorSpace(this,e),this}setStyle(t,i=tn){function n(r){r!==void 0&&parseFloat(r)<1}let e;if(e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let r;const s=e[1],a=e[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,Mi.toWorkingColorSpace(this,i),n(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,Mi.toWorkingColorSpace(this,i),n(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const h=parseFloat(r[1])/360,l=parseFloat(r[2])/100,c=parseFloat(r[3])/100;return n(r[4]),this.setHSL(h,l,c,i)}break}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=e[1],s=r.length;if(s===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,Mi.toWorkingColorSpace(this,i),this;if(s===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,Mi.toWorkingColorSpace(this,i),this}return t&&t.length>0?this.setColorName(t,i):this}setColorName(t,i=tn){const n=fm[t.toLowerCase()];return n!==void 0&&this.setHex(n,i),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=pr(t.r),this.g=pr(t.g),this.b=pr(t.b),this}copyLinearToSRGB(t){return this.r=rh(t.r),this.g=rh(t.g),this.b=rh(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=tn){return Mi.fromWorkingColorSpace(ia(this,ke),t),ti(ke.r*255,0,255)<<16^ti(ke.g*255,0,255)<<8^ti(ke.b*255,0,255)<<0}getHexString(t=tn){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=ur){Mi.fromWorkingColorSpace(ia(this,ke),i);const n=ke.r,e=ke.g,r=ke.b,s=Math.max(n,e,r),a=Math.min(n,e,r);let h,l;const c=(a+s)/2;if(a===s)h=0,l=0;else{const u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case n:h=(e-r)/u+(e<r?6:0);break;case e:h=(r-n)/u+2;break;case r:h=(n-e)/u+4;break}h/=6}return t.h=h,t.s=l,t.l=c,t}getRGB(t,i=ur){return Mi.fromWorkingColorSpace(ia(this,ke),i),t.r=ke.r,t.g=ke.g,t.b=ke.b,t}getStyle(t=tn){return Mi.fromWorkingColorSpace(ia(this,ke),t),t!==tn?`color(${t} ${ke.r} ${ke.g} ${ke.b})`:`rgb(${ke.r*255|0},${ke.g*255|0},${ke.b*255|0})`}offsetHSL(t,i,n){return this.getHSL(bi),bi.h+=t,bi.s+=i,bi.l+=n,this.setHSL(bi.h,bi.s,bi.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,n){return this.r=t.r+(i.r-t.r)*n,this.g=t.g+(i.g-t.g)*n,this.b=t.b+(i.b-t.b)*n,this}lerpHSL(t,i){this.getHSL(bi),t.getHSL(ea);const n=xl(bi.h,ea.h,i),e=xl(bi.s,ea.s,i),r=xl(bi.l,ea.l,i);return this.setHSL(n,e,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}qt.NAMES=fm;let Fr;class dm{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{Fr===void 0&&(Fr=wo("canvas")),Fr.width=t.width,Fr.height=t.height;const n=Fr.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),i=Fr}return i.width>2048||i.height>2048?i.toDataURL("image/jpeg",.6):i.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=wo("canvas");i.width=t.width,i.height=t.height;const n=i.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const e=n.getImageData(0,0,t.width,t.height),r=e.data;for(let s=0;s<r.length;s++)r[s]=pr(r[s]/255)*255;return n.putImageData(e,0,0),i}else if(t.data){const i=t.data.slice(0);for(let n=0;n<i.length;n++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[n]=Math.floor(pr(i[n]/255)*255):i[n]=pr(i[n]);return{data:i,width:t.width,height:t.height}}else return t}}class pm{constructor(t=null){this.isSource=!0,this.uuid=sn(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},e=this.data;if(e!==null){let r;if(Array.isArray(e)){r=[];for(let s=0,a=e.length;s<a;s++)e[s].isDataTexture?r.push(bl(e[s].image)):r.push(bl(e[s]))}else r=bl(e);n.url=r}return i||(t.images[this.uuid]=n),n}}function bl(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?dm.getDataURL(o):o.data?{data:Array.from(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:{}}let H0=0;class xi extends Ls{constructor(t=xi.DEFAULT_IMAGE,i=xi.DEFAULT_MAPPING,n=Pi,e=Pi,r=pi,s=Nh,a=ki,h=yr,l=1,c=xr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:H0++}),this.uuid=sn(),this.name="",this.source=new pm(t),this.mipmaps=[],this.mapping=i,this.wrapS=n,this.wrapT=e,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=h,this.offset=new bt(0,0),this.repeat=new bt(1,1),this.center=new bt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new mi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),i||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==hm)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Qc:t.x=t.x-Math.floor(t.x);break;case Pi:t.x=t.x<0?0:1;break;case Kc:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Qc:t.y=t.y-Math.floor(t.y);break;case Pi:t.y=t.y<0?0:1;break;case Kc:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}xi.DEFAULT_IMAGE=null;xi.DEFAULT_MAPPING=hm;class Ve{constructor(t=0,i=0,n=0,e=1){Ve.prototype.isVector4=!0,this.x=t,this.y=i,this.z=n,this.w=e}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=e,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,n=this.y,e=this.z,r=this.w,s=t.elements;return this.x=s[0]*i+s[4]*n+s[8]*e+s[12]*r,this.y=s[1]*i+s[5]*n+s[9]*e+s[13]*r,this.z=s[2]*i+s[6]*n+s[10]*e+s[14]*r,this.w=s[3]*i+s[7]*n+s[11]*e+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,n,e,r;const h=t.elements,l=h[0],c=h[4],u=h[8],f=h[1],d=h[5],p=h[9],g=h[2],m=h[6],v=h[10];if(Math.abs(c-f)<.01&&Math.abs(u-g)<.01&&Math.abs(p-m)<.01){if(Math.abs(c+f)<.1&&Math.abs(u+g)<.1&&Math.abs(p+m)<.1&&Math.abs(l+d+v-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(l+1)/2,y=(d+1)/2,b=(v+1)/2,M=(c+f)/4,C=(u+g)/4,w=(p+m)/4;return _>y&&_>b?_<.01?(n=0,e=.707106781,r=.707106781):(n=Math.sqrt(_),e=M/n,r=C/n):y>b?y<.01?(n=.707106781,e=0,r=.707106781):(e=Math.sqrt(y),n=M/e,r=w/e):b<.01?(n=.707106781,e=.707106781,r=0):(r=Math.sqrt(b),n=C/r,e=w/r),this.set(n,e,r,i),this}let x=Math.sqrt((m-p)*(m-p)+(u-g)*(u-g)+(f-c)*(f-c));return Math.abs(x)<.001&&(x=1),this.x=(m-p)/x,this.y=(u-g)/x,this.z=(f-c)/x,this.w=Math.acos((l+d+v-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this.z=t.z+(i.z-t.z)*n,this.w=t.w+(i.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class an extends Ls{constructor(t,i,n={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new Ve(0,0,t,i),this.scissorTest=!1,this.viewport=new Ve(0,0,t,i);const e={width:t,height:i,depth:1};this.texture=new xi(e,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:pi,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(t,i,n=1){(this.width!==t||this.height!==i||this.depth!==n)&&(this.width=t,this.height=i,this.depth=n,this.texture.image.width=t,this.texture.image.height=i,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const i=Object.assign({},t.texture.image);return this.texture.source=new pm(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class gm extends xi{constructor(t=null,i=1,n=1,e=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:n,depth:e},this.magFilter=ii,this.minFilter=ii,this.wrapR=Pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class U0 extends xi{constructor(t=null,i=1,n=1,e=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:n,depth:e},this.magFilter=ii,this.minFilter=ii,this.wrapR=Pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ho{constructor(t=0,i=0,n=0,e=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=n,this._w=e}static slerpFlat(t,i,n,e,r,s,a){let h=n[e+0],l=n[e+1],c=n[e+2],u=n[e+3];const f=r[s+0],d=r[s+1],p=r[s+2],g=r[s+3];if(a===0){t[i+0]=h,t[i+1]=l,t[i+2]=c,t[i+3]=u;return}if(a===1){t[i+0]=f,t[i+1]=d,t[i+2]=p,t[i+3]=g;return}if(u!==g||h!==f||l!==d||c!==p){let m=1-a;const v=h*f+l*d+c*p+u*g,x=v>=0?1:-1,_=1-v*v;if(_>Number.EPSILON){const b=Math.sqrt(_),M=Math.atan2(b,v*x);m=Math.sin(m*M)/b,a=Math.sin(a*M)/b}const y=a*x;if(h=h*m+f*y,l=l*m+d*y,c=c*m+p*y,u=u*m+g*y,m===1-a){const b=1/Math.sqrt(h*h+l*l+c*c+u*u);h*=b,l*=b,c*=b,u*=b}}t[i]=h,t[i+1]=l,t[i+2]=c,t[i+3]=u}static multiplyQuaternionsFlat(t,i,n,e,r,s){const a=n[e],h=n[e+1],l=n[e+2],c=n[e+3],u=r[s],f=r[s+1],d=r[s+2],p=r[s+3];return t[i]=a*p+c*u+h*d-l*f,t[i+1]=h*p+c*f+l*u-a*d,t[i+2]=l*p+c*d+a*f-h*u,t[i+3]=c*p-a*u-h*f-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,n,e){return this._x=t,this._y=i,this._z=n,this._w=e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i){const n=t._x,e=t._y,r=t._z,s=t._order,a=Math.cos,h=Math.sin,l=a(n/2),c=a(e/2),u=a(r/2),f=h(n/2),d=h(e/2),p=h(r/2);switch(s){case"XYZ":this._x=f*c*u+l*d*p,this._y=l*d*u-f*c*p,this._z=l*c*p+f*d*u,this._w=l*c*u-f*d*p;break;case"YXZ":this._x=f*c*u+l*d*p,this._y=l*d*u-f*c*p,this._z=l*c*p-f*d*u,this._w=l*c*u+f*d*p;break;case"ZXY":this._x=f*c*u-l*d*p,this._y=l*d*u+f*c*p,this._z=l*c*p+f*d*u,this._w=l*c*u-f*d*p;break;case"ZYX":this._x=f*c*u-l*d*p,this._y=l*d*u+f*c*p,this._z=l*c*p-f*d*u,this._w=l*c*u+f*d*p;break;case"YZX":this._x=f*c*u+l*d*p,this._y=l*d*u+f*c*p,this._z=l*c*p-f*d*u,this._w=l*c*u-f*d*p;break;case"XZY":this._x=f*c*u-l*d*p,this._y=l*d*u-f*c*p,this._z=l*c*p+f*d*u,this._w=l*c*u+f*d*p;break;default:}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const n=i/2,e=Math.sin(n);return this._x=t.x*e,this._y=t.y*e,this._z=t.z*e,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,n=i[0],e=i[4],r=i[8],s=i[1],a=i[5],h=i[9],l=i[2],c=i[6],u=i[10],f=n+a+u;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(c-h)*d,this._y=(r-l)*d,this._z=(s-e)*d}else if(n>a&&n>u){const d=2*Math.sqrt(1+n-a-u);this._w=(c-h)/d,this._x=.25*d,this._y=(e+s)/d,this._z=(r+l)/d}else if(a>u){const d=2*Math.sqrt(1+a-n-u);this._w=(r-l)/d,this._x=(e+s)/d,this._y=.25*d,this._z=(h+c)/d}else{const d=2*Math.sqrt(1+u-n-a);this._w=(s-e)/d,this._x=(r+l)/d,this._y=(h+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let n=t.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ti(this.dot(t),-1,1)))}rotateTowards(t,i){const n=this.angleTo(t);if(n===0)return this;const e=Math.min(1,i/n);return this.slerp(t,e),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const n=t._x,e=t._y,r=t._z,s=t._w,a=i._x,h=i._y,l=i._z,c=i._w;return this._x=n*c+s*a+e*l-r*h,this._y=e*c+s*h+r*a-n*l,this._z=r*c+s*l+n*h-e*a,this._w=s*c-n*a-e*h-r*l,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const n=this._x,e=this._y,r=this._z,s=this._w;let a=s*t._w+n*t._x+e*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=n,this._y=e,this._z=r,this;const h=1-a*a;if(h<=Number.EPSILON){const d=1-i;return this._w=d*s+i*this._w,this._x=d*n+i*this._x,this._y=d*e+i*this._y,this._z=d*r+i*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(h),c=Math.atan2(l,a),u=Math.sin((1-i)*c)/l,f=Math.sin(i*c)/l;return this._w=s*u+this._w*f,this._x=n*u+this._x*f,this._y=e*u+this._y*f,this._z=r*u+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,i,n){return this.copy(t).slerp(i,n)}random(){const t=Math.random(),i=Math.sqrt(1-t),n=Math.sqrt(t),e=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(i*Math.cos(e),n*Math.sin(r),n*Math.cos(r),i*Math.sin(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class G{constructor(t=0,i=0,n=0){G.prototype.isVector3=!0,this.x=t,this.y=i,this.z=n}set(t,i,n){return n===void 0&&(n=this.z),this.x=t,this.y=i,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(Cd.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(Cd.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,n=this.y,e=this.z,r=t.elements;return this.x=r[0]*i+r[3]*n+r[6]*e,this.y=r[1]*i+r[4]*n+r[7]*e,this.z=r[2]*i+r[5]*n+r[8]*e,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,n=this.y,e=this.z,r=t.elements,s=1/(r[3]*i+r[7]*n+r[11]*e+r[15]);return this.x=(r[0]*i+r[4]*n+r[8]*e+r[12])*s,this.y=(r[1]*i+r[5]*n+r[9]*e+r[13])*s,this.z=(r[2]*i+r[6]*n+r[10]*e+r[14])*s,this}applyQuaternion(t){const i=this.x,n=this.y,e=this.z,r=t.x,s=t.y,a=t.z,h=t.w,l=h*i+s*e-a*n,c=h*n+a*i-r*e,u=h*e+r*n-s*i,f=-r*i-s*n-a*e;return this.x=l*h+f*-r+c*-a-u*-s,this.y=c*h+f*-s+u*-r-l*-a,this.z=u*h+f*-a+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,n=this.y,e=this.z,r=t.elements;return this.x=r[0]*i+r[4]*n+r[8]*e,this.y=r[1]*i+r[5]*n+r[9]*e,this.z=r[2]*i+r[6]*n+r[10]*e,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this.z=t.z+(i.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const n=t.x,e=t.y,r=t.z,s=i.x,a=i.y,h=i.z;return this.x=e*h-r*a,this.y=r*s-n*h,this.z=n*a-e*s,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const n=t.dot(this)/i;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Sl.copy(this).projectOnVector(t),this.sub(Sl)}reflect(t){return this.sub(Sl.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(t)/i;return Math.acos(ti(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,n=this.y-t.y,e=this.z-t.z;return i*i+n*n+e*e}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,n){const e=Math.sin(i)*t;return this.x=e*Math.sin(n),this.y=Math.cos(i)*t,this.z=e*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,n){return this.x=t*Math.sin(i),this.y=n,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),e=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=e,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(i),this.y=n*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Sl=new G,Cd=new Ho;class wr{constructor(t=new G(1/0,1/0,1/0),i=new G(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){let i=1/0,n=1/0,e=1/0,r=-1/0,s=-1/0,a=-1/0;for(let h=0,l=t.length;h<l;h+=3){const c=t[h],u=t[h+1],f=t[h+2];c<i&&(i=c),u<n&&(n=u),f<e&&(e=f),c>r&&(r=c),u>s&&(s=u),f>a&&(a=f)}return this.min.set(i,n,e),this.max.set(r,s,a),this}setFromBufferAttribute(t){let i=1/0,n=1/0,e=1/0,r=-1/0,s=-1/0,a=-1/0;for(let h=0,l=t.count;h<l;h++){const c=t.getX(h),u=t.getY(h),f=t.getZ(h);c<i&&(i=c),u<n&&(n=u),f<e&&(e=f),c>r&&(r=c),u>s&&(s=u),f>a&&(a=f)}return this.min.set(i,n,e),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let i=0,n=t.length;i<n;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const n=Qn.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0)if(i&&n.attributes!=null&&n.attributes.position!==void 0){const r=n.attributes.position;for(let s=0,a=r.count;s<a;s++)Qn.fromBufferAttribute(r,s).applyMatrix4(t.matrixWorld),this.expandByPoint(Qn)}else n.boundingBox===null&&n.computeBoundingBox(),Cl.copy(n.boundingBox),Cl.applyMatrix4(t.matrixWorld),this.union(Cl);const e=t.children;for(let r=0,s=e.length;r<s;r++)this.expandByObject(e[r],i);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Qn),Qn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,n;return t.normal.x>0?(i=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),i<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Vs),na.subVectors(this.max,Vs),Nr.subVectors(t.a,Vs),Br.subVectors(t.b,Vs),Gr.subVectors(t.c,Vs),pn.subVectors(Br,Nr),gn.subVectors(Gr,Br),Kn.subVectors(Nr,Gr);let i=[0,-pn.z,pn.y,0,-gn.z,gn.y,0,-Kn.z,Kn.y,pn.z,0,-pn.x,gn.z,0,-gn.x,Kn.z,0,-Kn.x,-pn.y,pn.x,0,-gn.y,gn.x,0,-Kn.y,Kn.x,0];return!Tl(i,Nr,Br,Gr,na)||(i=[1,0,0,0,1,0,0,0,1],!Tl(i,Nr,Br,Gr,na))?!1:(ra.crossVectors(pn,gn),i=[ra.x,ra.y,ra.z],Tl(i,Nr,Br,Gr,na))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Qn.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(Qn).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ji[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ji[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ji[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ji[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ji[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ji[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ji[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ji[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ji),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ji=[new G,new G,new G,new G,new G,new G,new G,new G],Qn=new G,Cl=new wr,Nr=new G,Br=new G,Gr=new G,pn=new G,gn=new G,Kn=new G,Vs=new G,na=new G,ra=new G,tr=new G;function Tl(o,t,i,n,e){for(let r=0,s=o.length-3;r<=s;r+=3){tr.fromArray(o,r);const a=e.x*Math.abs(tr.x)+e.y*Math.abs(tr.y)+e.z*Math.abs(tr.z),h=t.dot(tr),l=i.dot(tr),c=n.dot(tr);if(Math.max(-Math.max(h,l,c),Math.min(h,l,c))>a)return!1}return!0}const V0=new wr,Td=new G,sa=new G,Pl=new G;class Rs{constructor(t=new G,i=-1){this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const n=this.center;i!==void 0?n.copy(i):V0.setFromPoints(t).getCenter(n);let e=0;for(let r=0,s=t.length;r<s;r++)e=Math.max(e,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(e),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const n=this.center.distanceToSquared(t);return i.copy(t),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Pl.subVectors(t,this.center);const i=Pl.lengthSq();if(i>this.radius*this.radius){const n=Math.sqrt(i),e=(n-this.radius)*.5;this.center.add(Pl.multiplyScalar(e/n)),this.radius+=e}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?sa.set(0,0,1).multiplyScalar(t.radius):sa.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Td.copy(t.center).add(sa)),this.expandByPoint(Td.copy(t.center).sub(sa)),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Zi=new G,El=new G,oa=new G,mn=new G,Al=new G,aa=new G,Ll=new G;class Bh{constructor(t=new G,i=new G(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Zi)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=Zi.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(Zi.copy(this.direction).multiplyScalar(i).add(this.origin),Zi.distanceToSquared(t))}distanceSqToSegment(t,i,n,e){El.copy(t).add(i).multiplyScalar(.5),oa.copy(i).sub(t).normalize(),mn.copy(this.origin).sub(El);const r=t.distanceTo(i)*.5,s=-this.direction.dot(oa),a=mn.dot(this.direction),h=-mn.dot(oa),l=mn.lengthSq(),c=Math.abs(1-s*s);let u,f,d,p;if(c>0)if(u=s*h-a,f=s*a-h,p=r*c,u>=0)if(f>=-p)if(f<=p){const g=1/c;u*=g,f*=g,d=u*(u+s*f+2*a)+f*(s*u+f+2*h)+l}else f=r,u=Math.max(0,-(s*f+a)),d=-u*u+f*(f+2*h)+l;else f=-r,u=Math.max(0,-(s*f+a)),d=-u*u+f*(f+2*h)+l;else f<=-p?(u=Math.max(0,-(-s*r+a)),f=u>0?-r:Math.min(Math.max(-r,-h),r),d=-u*u+f*(f+2*h)+l):f<=p?(u=0,f=Math.min(Math.max(-r,-h),r),d=f*(f+2*h)+l):(u=Math.max(0,-(s*r+a)),f=u>0?r:Math.min(Math.max(-r,-h),r),d=-u*u+f*(f+2*h)+l);else f=s>0?-r:r,u=Math.max(0,-(s*f+a)),d=-u*u+f*(f+2*h)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),e&&e.copy(oa).multiplyScalar(f).add(El),d}intersectSphere(t,i){Zi.subVectors(t.center,this.origin);const n=Zi.dot(this.direction),e=Zi.dot(Zi)-n*n,r=t.radius*t.radius;if(e>r)return null;const s=Math.sqrt(r-e),a=n-s,h=n+s;return a<0&&h<0?null:a<0?this.at(h,i):this.at(a,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/i;return n>=0?n:null}intersectPlane(t,i){const n=this.distanceToPlane(t);return n===null?null:this.at(n,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let n,e,r,s,a,h;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,f=this.origin;return l>=0?(n=(t.min.x-f.x)*l,e=(t.max.x-f.x)*l):(n=(t.max.x-f.x)*l,e=(t.min.x-f.x)*l),c>=0?(r=(t.min.y-f.y)*c,s=(t.max.y-f.y)*c):(r=(t.max.y-f.y)*c,s=(t.min.y-f.y)*c),n>s||r>e||((r>n||n!==n)&&(n=r),(s<e||e!==e)&&(e=s),u>=0?(a=(t.min.z-f.z)*u,h=(t.max.z-f.z)*u):(a=(t.max.z-f.z)*u,h=(t.min.z-f.z)*u),n>h||a>e)||((a>n||n!==n)&&(n=a),(h<e||e!==e)&&(e=h),e<0)?null:this.at(n>=0?n:e,i)}intersectsBox(t){return this.intersectBox(t,Zi)!==null}intersectTriangle(t,i,n,e,r){Al.subVectors(i,t),aa.subVectors(n,t),Ll.crossVectors(Al,aa);let s=this.direction.dot(Ll),a;if(s>0){if(e)return null;a=1}else if(s<0)a=-1,s=-s;else return null;mn.subVectors(this.origin,t);const h=a*this.direction.dot(aa.crossVectors(mn,aa));if(h<0)return null;const l=a*this.direction.dot(Al.cross(mn));if(l<0||h+l>s)return null;const c=-a*mn.dot(Ll);return c<0?null:this.at(c/s,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ve{constructor(){ve.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,i,n,e,r,s,a,h,l,c,u,f,d,p,g,m){const v=this.elements;return v[0]=t,v[4]=i,v[8]=n,v[12]=e,v[1]=r,v[5]=s,v[9]=a,v[13]=h,v[2]=l,v[6]=c,v[10]=u,v[14]=f,v[3]=d,v[7]=p,v[11]=g,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ve().fromArray(this.elements)}copy(t){const i=this.elements,n=t.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(t){const i=this.elements,n=t.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,n){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,i,n){return this.set(t.x,i.x,n.x,0,t.y,i.y,n.y,0,t.z,i.z,n.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,n=t.elements,e=1/Hr.setFromMatrixColumn(t,0).length(),r=1/Hr.setFromMatrixColumn(t,1).length(),s=1/Hr.setFromMatrixColumn(t,2).length();return i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=0,i[4]=n[4]*r,i[5]=n[5]*r,i[6]=n[6]*r,i[7]=0,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,n=t.x,e=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),h=Math.cos(e),l=Math.sin(e),c=Math.cos(r),u=Math.sin(r);if(t.order==="XYZ"){const f=s*c,d=s*u,p=a*c,g=a*u;i[0]=h*c,i[4]=-h*u,i[8]=l,i[1]=d+p*l,i[5]=f-g*l,i[9]=-a*h,i[2]=g-f*l,i[6]=p+d*l,i[10]=s*h}else if(t.order==="YXZ"){const f=h*c,d=h*u,p=l*c,g=l*u;i[0]=f+g*a,i[4]=p*a-d,i[8]=s*l,i[1]=s*u,i[5]=s*c,i[9]=-a,i[2]=d*a-p,i[6]=g+f*a,i[10]=s*h}else if(t.order==="ZXY"){const f=h*c,d=h*u,p=l*c,g=l*u;i[0]=f-g*a,i[4]=-s*u,i[8]=p+d*a,i[1]=d+p*a,i[5]=s*c,i[9]=g-f*a,i[2]=-s*l,i[6]=a,i[10]=s*h}else if(t.order==="ZYX"){const f=s*c,d=s*u,p=a*c,g=a*u;i[0]=h*c,i[4]=p*l-d,i[8]=f*l+g,i[1]=h*u,i[5]=g*l+f,i[9]=d*l-p,i[2]=-l,i[6]=a*h,i[10]=s*h}else if(t.order==="YZX"){const f=s*h,d=s*l,p=a*h,g=a*l;i[0]=h*c,i[4]=g-f*u,i[8]=p*u+d,i[1]=u,i[5]=s*c,i[9]=-a*c,i[2]=-l*c,i[6]=d*u+p,i[10]=f-g*u}else if(t.order==="XZY"){const f=s*h,d=s*l,p=a*h,g=a*l;i[0]=h*c,i[4]=-u,i[8]=l*c,i[1]=f*u+g,i[5]=s*c,i[9]=d*u-p,i[2]=p*u-d,i[6]=a*c,i[10]=g*u+f}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(W0,t,j0)}lookAt(t,i,n){const e=this.elements;return si.subVectors(t,i),si.lengthSq()===0&&(si.z=1),si.normalize(),vn.crossVectors(n,si),vn.lengthSq()===0&&(Math.abs(n.z)===1?si.x+=1e-4:si.z+=1e-4,si.normalize(),vn.crossVectors(n,si)),vn.normalize(),ha.crossVectors(si,vn),e[0]=vn.x,e[4]=ha.x,e[8]=si.x,e[1]=vn.y,e[5]=ha.y,e[9]=si.y,e[2]=vn.z,e[6]=ha.z,e[10]=si.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const n=t.elements,e=i.elements,r=this.elements,s=n[0],a=n[4],h=n[8],l=n[12],c=n[1],u=n[5],f=n[9],d=n[13],p=n[2],g=n[6],m=n[10],v=n[14],x=n[3],_=n[7],y=n[11],b=n[15],M=e[0],C=e[4],w=e[8],S=e[12],P=e[1],O=e[5],D=e[9],L=e[13],T=e[2],A=e[6],N=e[10],B=e[14],F=e[3],I=e[7],z=e[11],Z=e[15];return r[0]=s*M+a*P+h*T+l*F,r[4]=s*C+a*O+h*A+l*I,r[8]=s*w+a*D+h*N+l*z,r[12]=s*S+a*L+h*B+l*Z,r[1]=c*M+u*P+f*T+d*F,r[5]=c*C+u*O+f*A+d*I,r[9]=c*w+u*D+f*N+d*z,r[13]=c*S+u*L+f*B+d*Z,r[2]=p*M+g*P+m*T+v*F,r[6]=p*C+g*O+m*A+v*I,r[10]=p*w+g*D+m*N+v*z,r[14]=p*S+g*L+m*B+v*Z,r[3]=x*M+_*P+y*T+b*F,r[7]=x*C+_*O+y*A+b*I,r[11]=x*w+_*D+y*N+b*z,r[15]=x*S+_*L+y*B+b*Z,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],n=t[4],e=t[8],r=t[12],s=t[1],a=t[5],h=t[9],l=t[13],c=t[2],u=t[6],f=t[10],d=t[14],p=t[3],g=t[7],m=t[11],v=t[15];return p*(+r*h*u-e*l*u-r*a*f+n*l*f+e*a*d-n*h*d)+g*(+i*h*d-i*l*f+r*s*f-e*s*d+e*l*c-r*h*c)+m*(+i*l*u-i*a*d-r*s*u+n*s*d+r*a*c-n*l*c)+v*(-e*a*c-i*h*u+i*a*f+e*s*u-n*s*f+n*h*c)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,n){const e=this.elements;return t.isVector3?(e[12]=t.x,e[13]=t.y,e[14]=t.z):(e[12]=t,e[13]=i,e[14]=n),this}invert(){const t=this.elements,i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],a=t[5],h=t[6],l=t[7],c=t[8],u=t[9],f=t[10],d=t[11],p=t[12],g=t[13],m=t[14],v=t[15],x=u*m*l-g*f*l+g*h*d-a*m*d-u*h*v+a*f*v,_=p*f*l-c*m*l-p*h*d+s*m*d+c*h*v-s*f*v,y=c*g*l-p*u*l+p*a*d-s*g*d-c*a*v+s*u*v,b=p*u*h-c*g*h-p*a*f+s*g*f+c*a*m-s*u*m,M=i*x+n*_+e*y+r*b;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/M;return t[0]=x*C,t[1]=(g*f*r-u*m*r-g*e*d+n*m*d+u*e*v-n*f*v)*C,t[2]=(a*m*r-g*h*r+g*e*l-n*m*l-a*e*v+n*h*v)*C,t[3]=(u*h*r-a*f*r-u*e*l+n*f*l+a*e*d-n*h*d)*C,t[4]=_*C,t[5]=(c*m*r-p*f*r+p*e*d-i*m*d-c*e*v+i*f*v)*C,t[6]=(p*h*r-s*m*r-p*e*l+i*m*l+s*e*v-i*h*v)*C,t[7]=(s*f*r-c*h*r+c*e*l-i*f*l-s*e*d+i*h*d)*C,t[8]=y*C,t[9]=(p*u*r-c*g*r-p*n*d+i*g*d+c*n*v-i*u*v)*C,t[10]=(s*g*r-p*a*r+p*n*l-i*g*l-s*n*v+i*a*v)*C,t[11]=(c*a*r-s*u*r-c*n*l+i*u*l+s*n*d-i*a*d)*C,t[12]=b*C,t[13]=(c*g*e-p*u*e+p*n*f-i*g*f-c*n*m+i*u*m)*C,t[14]=(p*a*e-s*g*e-p*n*h+i*g*h+s*n*m-i*a*m)*C,t[15]=(s*u*e-c*a*e+c*n*h-i*u*h-s*n*f+i*a*f)*C,this}scale(t){const i=this.elements,n=t.x,e=t.y,r=t.z;return i[0]*=n,i[4]*=e,i[8]*=r,i[1]*=n,i[5]*=e,i[9]*=r,i[2]*=n,i[6]*=e,i[10]*=r,i[3]*=n,i[7]*=e,i[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],e=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,n,e))}makeTranslation(t,i,n){return this.set(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),n=Math.sin(t);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),n=Math.sin(t);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const n=Math.cos(i),e=Math.sin(i),r=1-n,s=t.x,a=t.y,h=t.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-e*h,l*h+e*a,0,l*a+e*h,c*a+n,c*h-e*s,0,l*h-e*a,c*h+e*s,r*h*h+n,0,0,0,0,1),this}makeScale(t,i,n){return this.set(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,i,n,e,r,s){return this.set(1,n,r,0,t,1,s,0,i,e,1,0,0,0,0,1),this}compose(t,i,n){const e=this.elements,r=i._x,s=i._y,a=i._z,h=i._w,l=r+r,c=s+s,u=a+a,f=r*l,d=r*c,p=r*u,g=s*c,m=s*u,v=a*u,x=h*l,_=h*c,y=h*u,b=n.x,M=n.y,C=n.z;return e[0]=(1-(g+v))*b,e[1]=(d+y)*b,e[2]=(p-_)*b,e[3]=0,e[4]=(d-y)*M,e[5]=(1-(f+v))*M,e[6]=(m+x)*M,e[7]=0,e[8]=(p+_)*C,e[9]=(m-x)*C,e[10]=(1-(f+g))*C,e[11]=0,e[12]=t.x,e[13]=t.y,e[14]=t.z,e[15]=1,this}decompose(t,i,n){const e=this.elements;let r=Hr.set(e[0],e[1],e[2]).length();const s=Hr.set(e[4],e[5],e[6]).length(),a=Hr.set(e[8],e[9],e[10]).length();this.determinant()<0&&(r=-r),t.x=e[12],t.y=e[13],t.z=e[14],Si.copy(this);const l=1/r,c=1/s,u=1/a;return Si.elements[0]*=l,Si.elements[1]*=l,Si.elements[2]*=l,Si.elements[4]*=c,Si.elements[5]*=c,Si.elements[6]*=c,Si.elements[8]*=u,Si.elements[9]*=u,Si.elements[10]*=u,i.setFromRotationMatrix(Si),n.x=r,n.y=s,n.z=a,this}makePerspective(t,i,n,e,r,s){const a=this.elements,h=2*r/(i-t),l=2*r/(n-e),c=(i+t)/(i-t),u=(n+e)/(n-e),f=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=h,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=f,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,i,n,e,r,s){const a=this.elements,h=1/(i-t),l=1/(n-e),c=1/(s-r),u=(i+t)*h,f=(n+e)*l,d=(s+r)*c;return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-f,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const i=this.elements,n=t.elements;for(let e=0;e<16;e++)if(i[e]!==n[e])return!1;return!0}fromArray(t,i=0){for(let n=0;n<16;n++)this.elements[n]=t[n+i];return this}toArray(t=[],i=0){const n=this.elements;return t[i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t[i+9]=n[9],t[i+10]=n[10],t[i+11]=n[11],t[i+12]=n[12],t[i+13]=n[13],t[i+14]=n[14],t[i+15]=n[15],t}}const Hr=new G,Si=new ve,W0=new G(0,0,0),j0=new G(1,1,1),vn=new G,ha=new G,si=new G,Pd=new ve,Ed=new Ho;class Uo{constructor(t=0,i=0,n=0,e=Uo.DefaultOrder){this.isEuler=!0,this._x=t,this._y=i,this._z=n,this._order=e}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,n,e=this._order){return this._x=t,this._y=i,this._z=n,this._order=e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,n=!0){const e=t.elements,r=e[0],s=e[4],a=e[8],h=e[1],l=e[5],c=e[9],u=e[2],f=e[6],d=e[10];switch(i){case"XYZ":this._y=Math.asin(ti(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ti(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(ti(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-ti(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ti(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ti(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,n){return Pd.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Pd,i,n)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return Ed.setFromEuler(this),this.setFromQuaternion(Ed,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){}}Uo.DefaultOrder="XYZ";Uo.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Du{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Z0=0;const Ad=new G,Ur=new Ho,Xi=new ve,la=new G,Ws=new G,X0=new G,$0=new Ho,Ld=new G(1,0,0),Rd=new G(0,1,0),Od=new G(0,0,1),q0={type:"added"},Dd={type:"removed"};class Te extends Ls{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Z0++}),this.uuid=sn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Te.DefaultUp.clone();const t=new G,i=new Uo,n=new Ho,e=new G(1,1,1);function r(){n.setFromEuler(i,!1)}function s(){i.setFromQuaternion(n,void 0,!1)}i._onChange(r),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:e},modelViewMatrix:{value:new ve},normalMatrix:{value:new mi}}),this.matrix=new ve,this.matrixWorld=new ve,this.matrixAutoUpdate=Te.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Te.DefaultMatrixWorldAutoUpdate,this.layers=new Du,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Ur.setFromAxisAngle(t,i),this.quaternion.multiply(Ur),this}rotateOnWorldAxis(t,i){return Ur.setFromAxisAngle(t,i),this.quaternion.premultiply(Ur),this}rotateX(t){return this.rotateOnAxis(Ld,t)}rotateY(t){return this.rotateOnAxis(Rd,t)}rotateZ(t){return this.rotateOnAxis(Od,t)}translateOnAxis(t,i){return Ad.copy(t).applyQuaternion(this.quaternion),this.position.add(Ad.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(Ld,t)}translateY(t){return this.translateOnAxis(Rd,t)}translateZ(t){return this.translateOnAxis(Od,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Xi.copy(this.matrixWorld).invert())}lookAt(t,i,n){t.isVector3?la.copy(t):la.set(t,i,n);const e=this.parent;this.updateWorldMatrix(!0,!1),Ws.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Xi.lookAt(Ws,la,this.up):Xi.lookAt(la,Ws,this.up),this.quaternion.setFromRotationMatrix(Xi),e&&(Xi.extractRotation(e.matrixWorld),Ur.setFromRotationMatrix(Xi),this.quaternion.premultiply(Ur.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?this:(t&&t.isObject3D&&(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(q0)),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(Dd)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(Dd)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Xi.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Xi.multiply(t.parent.matrixWorld)),t.applyMatrix4(Xi),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let n=0,e=this.children.length;n<e;n++){const s=this.children[n].getObjectByProperty(t,i);if(s!==void 0)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ws,t,X0),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ws,$0,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let n=0,e=i.length;n<e;n++)i[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let n=0,e=i.length;n<e;n++)i[n].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let n=0,e=i.length;n<e;n++){const r=i[n];(r.matrixWorldAutoUpdate===!0||t===!0)&&r.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const n=this.parent;if(t===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const e=this.children;for(let r=0,s=e.length;r<s;r++){const a=e[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=t===void 0||typeof t=="string",n={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const e={};e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.castShadow===!0&&(e.castShadow=!0),this.receiveShadow===!0&&(e.receiveShadow=!0),this.visible===!1&&(e.visible=!1),this.frustumCulled===!1&&(e.frustumCulled=!1),this.renderOrder!==0&&(e.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(e.userData=this.userData),e.layers=this.layers.mask,e.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(e.matrixAutoUpdate=!1),this.isInstancedMesh&&(e.type="InstancedMesh",e.count=this.count,e.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(e.instanceColor=this.instanceColor.toJSON()));function r(a,h){return a[h.uuid]===void 0&&(a[h.uuid]=h.toJSON(t)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?e.background=this.background.toJSON():this.background.isTexture&&(e.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(e.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){e.geometry=r(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const h=a.shapes;if(Array.isArray(h))for(let l=0,c=h.length;l<c;l++){const u=h[l];r(t.shapes,u)}else r(t.shapes,h)}}if(this.isSkinnedMesh&&(e.bindMode=this.bindMode,e.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(t.skeletons,this.skeleton),e.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let h=0,l=this.material.length;h<l;h++)a.push(r(t.materials,this.material[h]));e.material=a}else e.material=r(t.materials,this.material);if(this.children.length>0){e.children=[];for(let a=0;a<this.children.length;a++)e.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){e.animations=[];for(let a=0;a<this.animations.length;a++){const h=this.animations[a];e.animations.push(r(t.animations,h))}}if(i){const a=s(t.geometries),h=s(t.materials),l=s(t.textures),c=s(t.images),u=s(t.shapes),f=s(t.skeletons),d=s(t.animations),p=s(t.nodes);a.length>0&&(n.geometries=a),h.length>0&&(n.materials=h),l.length>0&&(n.textures=l),c.length>0&&(n.images=c),u.length>0&&(n.shapes=u),f.length>0&&(n.skeletons=f),d.length>0&&(n.animations=d),p.length>0&&(n.nodes=p)}return n.object=e,n;function s(a){const h=[];for(const l in a){const c=a[l];delete c.metadata,h.push(c)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}}Te.DefaultUp=new G(0,1,0);Te.DefaultMatrixAutoUpdate=!0;Te.DefaultMatrixWorldAutoUpdate=!0;const Ci=new G,$i=new G,Rl=new G,qi=new G,Vr=new G,Wr=new G,Id=new G,Ol=new G,Dl=new G,Il=new G;class nn{constructor(t=new G,i=new G,n=new G){this.a=t,this.b=i,this.c=n}static getNormal(t,i,n,e){e.subVectors(n,i),Ci.subVectors(t,i),e.cross(Ci);const r=e.lengthSq();return r>0?e.multiplyScalar(1/Math.sqrt(r)):e.set(0,0,0)}static getBarycoord(t,i,n,e,r){Ci.subVectors(e,i),$i.subVectors(n,i),Rl.subVectors(t,i);const s=Ci.dot(Ci),a=Ci.dot($i),h=Ci.dot(Rl),l=$i.dot($i),c=$i.dot(Rl),u=s*l-a*a;if(u===0)return r.set(-2,-1,-1);const f=1/u,d=(l*h-a*c)*f,p=(s*c-a*h)*f;return r.set(1-d-p,p,d)}static containsPoint(t,i,n,e){return this.getBarycoord(t,i,n,e,qi),qi.x>=0&&qi.y>=0&&qi.x+qi.y<=1}static getUV(t,i,n,e,r,s,a,h){return this.getBarycoord(t,i,n,e,qi),h.set(0,0),h.addScaledVector(r,qi.x),h.addScaledVector(s,qi.y),h.addScaledVector(a,qi.z),h}static isFrontFacing(t,i,n,e){return Ci.subVectors(n,i),$i.subVectors(t,i),Ci.cross($i).dot(e)<0}set(t,i,n){return this.a.copy(t),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(t,i,n,e){return this.a.copy(t[i]),this.b.copy(t[n]),this.c.copy(t[e]),this}setFromAttributeAndIndices(t,i,n,e){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,e),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ci.subVectors(this.c,this.b),$i.subVectors(this.a,this.b),Ci.cross($i).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return nn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return nn.getBarycoord(t,this.a,this.b,this.c,i)}getUV(t,i,n,e,r){return nn.getUV(t,this.a,this.b,this.c,i,n,e,r)}containsPoint(t){return nn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return nn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const n=this.a,e=this.b,r=this.c;let s,a;Vr.subVectors(e,n),Wr.subVectors(r,n),Ol.subVectors(t,n);const h=Vr.dot(Ol),l=Wr.dot(Ol);if(h<=0&&l<=0)return i.copy(n);Dl.subVectors(t,e);const c=Vr.dot(Dl),u=Wr.dot(Dl);if(c>=0&&u<=c)return i.copy(e);const f=h*u-c*l;if(f<=0&&h>=0&&c<=0)return s=h/(h-c),i.copy(n).addScaledVector(Vr,s);Il.subVectors(t,r);const d=Vr.dot(Il),p=Wr.dot(Il);if(p>=0&&d<=p)return i.copy(r);const g=d*l-h*p;if(g<=0&&l>=0&&p<=0)return a=l/(l-p),i.copy(n).addScaledVector(Wr,a);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Id.subVectors(r,e),a=(u-c)/(u-c+(d-p)),i.copy(e).addScaledVector(Id,a);const v=1/(m+g+f);return s=g*v,a=f*v,i.copy(n).addScaledVector(Vr,s).addScaledVector(Wr,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let J0=0;class Gi extends Ls{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:J0++}),this.uuid=sn(),this.name="",this.type="Material",this.blending=ps,this.side=bs,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=om,this.blendDst=am,this.blendEquation=rs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=qc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=B0,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=_l,this.stencilZFail=_l,this.stencilZPass=_l,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const n=t[i];if(n===void 0)continue;const e=this[i];e!==void 0&&(e&&e.isColor?e.set(n):e&&e.isVector3&&n&&n.isVector3?e.copy(n):this[i]=n)}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ps&&(n.blending=this.blending),this.side!==bs&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function e(r){const s=[];for(const a in r){const h=r[a];delete h.metadata,s.push(h)}return s}if(i){const r=e(t.textures),s=e(t.images);r.length>0&&(n.textures=r),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let n=null;if(i!==null){const e=i.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=i[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class Iu extends Gi{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ou,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Oe=new G,ca=new bt;class It{constructor(t,i,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=n===!0,this.usage=tu,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,i,n){t*=this.itemSize,n*=i.itemSize;for(let e=0,r=this.itemSize;e<r;e++)this.array[t+e]=i.array[n+e];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,n=this.count;i<n;i++)ca.fromBufferAttribute(this,i),ca.applyMatrix3(t),this.setXY(i,ca.x,ca.y);else if(this.itemSize===3)for(let i=0,n=this.count;i<n;i++)Oe.fromBufferAttribute(this,i),Oe.applyMatrix3(t),this.setXYZ(i,Oe.x,Oe.y,Oe.z);return this}applyMatrix4(t){for(let i=0,n=this.count;i<n;i++)Oe.fromBufferAttribute(this,i),Oe.applyMatrix4(t),this.setXYZ(i,Oe.x,Oe.y,Oe.z);return this}applyNormalMatrix(t){for(let i=0,n=this.count;i<n;i++)Oe.fromBufferAttribute(this,i),Oe.applyNormalMatrix(t),this.setXYZ(i,Oe.x,Oe.y,Oe.z);return this}transformDirection(t){for(let i=0,n=this.count;i<n;i++)Oe.fromBufferAttribute(this,i),Oe.transformDirection(t),this.setXYZ(i,Oe.x,Oe.y,Oe.z);return this}set(t,i=0){return this.array.set(t,i),this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=Dn(i,this.array)),i}setX(t,i){return this.normalized&&(i=ue(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=Dn(i,this.array)),i}setY(t,i){return this.normalized&&(i=ue(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=Dn(i,this.array)),i}setZ(t,i){return this.normalized&&(i=ue(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=Dn(i,this.array)),i}setW(t,i){return this.normalized&&(i=ue(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,n){return t*=this.itemSize,this.normalized&&(i=ue(i,this.array),n=ue(n,this.array)),this.array[t+0]=i,this.array[t+1]=n,this}setXYZ(t,i,n,e){return t*=this.itemSize,this.normalized&&(i=ue(i,this.array),n=ue(n,this.array),e=ue(e,this.array)),this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=e,this}setXYZW(t,i,n,e,r){return t*=this.itemSize,this.normalized&&(i=ue(i,this.array),n=ue(n,this.array),e=ue(e,this.array),r=ue(r,this.array)),this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=e,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==tu&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){}copyVector2sArray(){}copyVector3sArray(){}copyVector4sArray(){}}class mm extends It{constructor(t,i,n){super(new Uint16Array(t),i,n)}}class vm extends It{constructor(t,i,n){super(new Uint32Array(t),i,n)}}class Fe extends It{constructor(t,i,n){super(new Float32Array(t),i,n)}}let Y0=0;const ci=new ve,kl=new Te,jr=new G,oi=new wr,js=new wr,Ge=new G;class ae extends Ls{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Y0++}),this.uuid=sn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(um(t)?vm:mm)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,n=0){this.groups.push({start:t,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new mi().getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}const e=this.attributes.tangent;return e!==void 0&&(e.transformDirection(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return ci.makeRotationFromQuaternion(t),this.applyMatrix4(ci),this}rotateX(t){return ci.makeRotationX(t),this.applyMatrix4(ci),this}rotateY(t){return ci.makeRotationY(t),this.applyMatrix4(ci),this}rotateZ(t){return ci.makeRotationZ(t),this.applyMatrix4(ci),this}translate(t,i,n){return ci.makeTranslation(t,i,n),this.applyMatrix4(ci),this}scale(t,i,n){return ci.makeScale(t,i,n),this.applyMatrix4(ci),this}lookAt(t){return kl.lookAt(t),kl.updateMatrix(),this.applyMatrix4(kl.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(jr).negate(),this.translate(jr.x,jr.y,jr.z),this}setFromPoints(t){const i=[];for(let n=0,e=t.length;n<e;n++){const r=t[n];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Fe(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new wr);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){this.boundingBox.set(new G(-1/0,-1/0,-1/0),new G(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let n=0,e=i.length;n<e;n++){const r=i[n];oi.setFromBufferAttribute(r),this.morphTargetsRelative?(Ge.addVectors(this.boundingBox.min,oi.min),this.boundingBox.expandByPoint(Ge),Ge.addVectors(this.boundingBox.max,oi.max),this.boundingBox.expandByPoint(Ge)):(this.boundingBox.expandByPoint(oi.min),this.boundingBox.expandByPoint(oi.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Rs);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){this.boundingSphere.set(new G,1/0);return}if(t){const n=this.boundingSphere.center;if(oi.setFromBufferAttribute(t),i)for(let r=0,s=i.length;r<s;r++){const a=i[r];js.setFromBufferAttribute(a),this.morphTargetsRelative?(Ge.addVectors(oi.min,js.min),oi.expandByPoint(Ge),Ge.addVectors(oi.max,js.max),oi.expandByPoint(Ge)):(oi.expandByPoint(js.min),oi.expandByPoint(js.max))}oi.getCenter(n);let e=0;for(let r=0,s=t.count;r<s;r++)Ge.fromBufferAttribute(t,r),e=Math.max(e,n.distanceToSquared(Ge));if(i)for(let r=0,s=i.length;r<s;r++){const a=i[r],h=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)Ge.fromBufferAttribute(a,l),h&&(jr.fromBufferAttribute(t,l),Ge.add(jr)),e=Math.max(e,n.distanceToSquared(Ge))}this.boundingSphere.radius=Math.sqrt(e),isNaN(this.boundingSphere.radius)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0)return;const n=t.array,e=i.position.array,r=i.normal.array,s=i.uv.array,a=e.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new It(new Float32Array(4*a),4));const h=this.getAttribute("tangent").array,l=[],c=[];for(let P=0;P<a;P++)l[P]=new G,c[P]=new G;const u=new G,f=new G,d=new G,p=new bt,g=new bt,m=new bt,v=new G,x=new G;function _(P,O,D){u.fromArray(e,P*3),f.fromArray(e,O*3),d.fromArray(e,D*3),p.fromArray(s,P*2),g.fromArray(s,O*2),m.fromArray(s,D*2),f.sub(u),d.sub(u),g.sub(p),m.sub(p);const L=1/(g.x*m.y-m.x*g.y);!isFinite(L)||(v.copy(f).multiplyScalar(m.y).addScaledVector(d,-g.y).multiplyScalar(L),x.copy(d).multiplyScalar(g.x).addScaledVector(f,-m.x).multiplyScalar(L),l[P].add(v),l[O].add(v),l[D].add(v),c[P].add(x),c[O].add(x),c[D].add(x))}let y=this.groups;y.length===0&&(y=[{start:0,count:n.length}]);for(let P=0,O=y.length;P<O;++P){const D=y[P],L=D.start,T=D.count;for(let A=L,N=L+T;A<N;A+=3)_(n[A+0],n[A+1],n[A+2])}const b=new G,M=new G,C=new G,w=new G;function S(P){C.fromArray(r,P*3),w.copy(C);const O=l[P];b.copy(O),b.sub(C.multiplyScalar(C.dot(O))).normalize(),M.crossVectors(w,O);const L=M.dot(c[P])<0?-1:1;h[P*4]=b.x,h[P*4+1]=b.y,h[P*4+2]=b.z,h[P*4+3]=L}for(let P=0,O=y.length;P<O;++P){const D=y[P],L=D.start,T=D.count;for(let A=L,N=L+T;A<N;A+=3)S(n[A+0]),S(n[A+1]),S(n[A+2])}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new It(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let f=0,d=n.count;f<d;f++)n.setXYZ(f,0,0,0);const e=new G,r=new G,s=new G,a=new G,h=new G,l=new G,c=new G,u=new G;if(t)for(let f=0,d=t.count;f<d;f+=3){const p=t.getX(f+0),g=t.getX(f+1),m=t.getX(f+2);e.fromBufferAttribute(i,p),r.fromBufferAttribute(i,g),s.fromBufferAttribute(i,m),c.subVectors(s,r),u.subVectors(e,r),c.cross(u),a.fromBufferAttribute(n,p),h.fromBufferAttribute(n,g),l.fromBufferAttribute(n,m),a.add(c),h.add(c),l.add(c),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(g,h.x,h.y,h.z),n.setXYZ(m,l.x,l.y,l.z)}else for(let f=0,d=i.count;f<d;f+=3)e.fromBufferAttribute(i,f+0),r.fromBufferAttribute(i,f+1),s.fromBufferAttribute(i,f+2),c.subVectors(s,r),u.subVectors(e,r),c.cross(u),n.setXYZ(f+0,c.x,c.y,c.z),n.setXYZ(f+1,c.x,c.y,c.z),n.setXYZ(f+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return this}normalizeNormals(){const t=this.attributes.normal;for(let i=0,n=t.count;i<n;i++)Ge.fromBufferAttribute(t,i),Ge.normalize(),t.setXYZ(i,Ge.x,Ge.y,Ge.z)}toNonIndexed(){function t(a,h){const l=a.array,c=a.itemSize,u=a.normalized,f=new l.constructor(h.length*c);let d=0,p=0;for(let g=0,m=h.length;g<m;g++){a.isInterleavedBufferAttribute?d=h[g]*a.data.stride+a.offset:d=h[g]*c;for(let v=0;v<c;v++)f[p++]=l[d++]}return new It(f,c,u)}if(this.index===null)return this;const i=new ae,n=this.index.array,e=this.attributes;for(const a in e){const h=e[a],l=t(h,n);i.setAttribute(a,l)}const r=this.morphAttributes;for(const a in r){const h=[],l=r[a];for(let c=0,u=l.length;c<u;c++){const f=l[c],d=t(f,n);h.push(d)}i.morphAttributes[a]=h}i.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,h=s.length;a<h;a++){const l=s[a];i.addGroup(l.start,l.count,l.materialIndex)}return i}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const l in h)h[l]!==void 0&&(t[l]=h[l]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const h in n){const l=n[h];t.data.attributes[h]=l.toJSON(t.data)}const e={};let r=!1;for(const h in this.morphAttributes){const l=this.morphAttributes[h],c=[];for(let u=0,f=l.length;u<f;u++){const d=l[u];c.push(d.toJSON(t.data))}c.length>0&&(e[h]=c,r=!0)}r&&(t.data.morphAttributes=e,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone(i));const e=t.attributes;for(const l in e){const c=e[l];this.setAttribute(l,c.clone(i))}const r=t.morphAttributes;for(const l in r){const c=[],u=r[l];for(let f=0,d=u.length;f<d;f++)c.push(u[f].clone(i));this.morphAttributes[l]=c}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let l=0,c=s.length;l<c;l++){const u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const kd=new ve,Zr=new Bh,zl=new Rs,_n=new G,yn=new G,xn=new G,Fl=new G,Nl=new G,Bl=new G,ua=new G,fa=new G,da=new G,pa=new bt,ga=new bt,ma=new bt,Gl=new G,va=new G;class ei extends Te{constructor(t=new ae,i=new Iu){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const e=i[n[0]];if(e!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=e.length;r<s;r++){const a=e[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}raycast(t,i){const n=this.geometry,e=this.material,r=this.matrixWorld;if(e===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),zl.copy(n.boundingSphere),zl.applyMatrix4(r),t.ray.intersectsSphere(zl)===!1)||(kd.copy(r).invert(),Zr.copy(t.ray).applyMatrix4(kd),n.boundingBox!==null&&Zr.intersectsBox(n.boundingBox)===!1))return;let s;const a=n.index,h=n.attributes.position,l=n.morphAttributes.position,c=n.morphTargetsRelative,u=n.attributes.uv,f=n.attributes.uv2,d=n.groups,p=n.drawRange;if(a!==null)if(Array.isArray(e))for(let g=0,m=d.length;g<m;g++){const v=d[g],x=e[v.materialIndex],_=Math.max(v.start,p.start),y=Math.min(a.count,Math.min(v.start+v.count,p.start+p.count));for(let b=_,M=y;b<M;b+=3){const C=a.getX(b),w=a.getX(b+1),S=a.getX(b+2);s=_a(this,x,t,Zr,h,l,c,u,f,C,w,S),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const g=Math.max(0,p.start),m=Math.min(a.count,p.start+p.count);for(let v=g,x=m;v<x;v+=3){const _=a.getX(v),y=a.getX(v+1),b=a.getX(v+2);s=_a(this,e,t,Zr,h,l,c,u,f,_,y,b),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}else if(h!==void 0)if(Array.isArray(e))for(let g=0,m=d.length;g<m;g++){const v=d[g],x=e[v.materialIndex],_=Math.max(v.start,p.start),y=Math.min(h.count,Math.min(v.start+v.count,p.start+p.count));for(let b=_,M=y;b<M;b+=3){const C=b,w=b+1,S=b+2;s=_a(this,x,t,Zr,h,l,c,u,f,C,w,S),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=v.materialIndex,i.push(s))}}else{const g=Math.max(0,p.start),m=Math.min(h.count,p.start+p.count);for(let v=g,x=m;v<x;v+=3){const _=v,y=v+1,b=v+2;s=_a(this,e,t,Zr,h,l,c,u,f,_,y,b),s&&(s.faceIndex=Math.floor(v/3),i.push(s))}}}}function Q0(o,t,i,n,e,r,s,a){let h;if(t.side===_i?h=n.intersectTriangle(s,r,e,!0,a):h=n.intersectTriangle(e,r,s,t.side!==On,a),h===null)return null;va.copy(a),va.applyMatrix4(o.matrixWorld);const l=i.ray.origin.distanceTo(va);return l<i.near||l>i.far?null:{distance:l,point:va.clone(),object:o}}function _a(o,t,i,n,e,r,s,a,h,l,c,u){_n.fromBufferAttribute(e,l),yn.fromBufferAttribute(e,c),xn.fromBufferAttribute(e,u);const f=o.morphTargetInfluences;if(r&&f){ua.set(0,0,0),fa.set(0,0,0),da.set(0,0,0);for(let p=0,g=r.length;p<g;p++){const m=f[p],v=r[p];m!==0&&(Fl.fromBufferAttribute(v,l),Nl.fromBufferAttribute(v,c),Bl.fromBufferAttribute(v,u),s?(ua.addScaledVector(Fl,m),fa.addScaledVector(Nl,m),da.addScaledVector(Bl,m)):(ua.addScaledVector(Fl.sub(_n),m),fa.addScaledVector(Nl.sub(yn),m),da.addScaledVector(Bl.sub(xn),m)))}_n.add(ua),yn.add(fa),xn.add(da)}o.isSkinnedMesh&&(o.boneTransform(l,_n),o.boneTransform(c,yn),o.boneTransform(u,xn));const d=Q0(o,t,i,n,_n,yn,xn,Gl);if(d){a&&(pa.fromBufferAttribute(a,l),ga.fromBufferAttribute(a,c),ma.fromBufferAttribute(a,u),d.uv=nn.getUV(Gl,_n,yn,xn,pa,ga,ma,new bt)),h&&(pa.fromBufferAttribute(h,l),ga.fromBufferAttribute(h,c),ma.fromBufferAttribute(h,u),d.uv2=nn.getUV(Gl,_n,yn,xn,pa,ga,ma,new bt));const p={a:l,b:c,c:u,normal:new G,materialIndex:0};nn.getNormal(_n,yn,xn,p.normal),d.face=p}return d}class Os extends ae{constructor(t=1,i=1,n=1,e=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:n,widthSegments:e,heightSegments:r,depthSegments:s};const a=this;e=Math.floor(e),r=Math.floor(r),s=Math.floor(s);const h=[],l=[],c=[],u=[];let f=0,d=0;p("z","y","x",-1,-1,n,i,t,s,r,0),p("z","y","x",1,-1,n,i,-t,s,r,1),p("x","z","y",1,1,t,n,i,e,s,2),p("x","z","y",1,-1,t,n,-i,e,s,3),p("x","y","z",1,-1,t,i,n,e,r,4),p("x","y","z",-1,-1,t,i,-n,e,r,5),this.setIndex(h),this.setAttribute("position",new Fe(l,3)),this.setAttribute("normal",new Fe(c,3)),this.setAttribute("uv",new Fe(u,2));function p(g,m,v,x,_,y,b,M,C,w,S){const P=y/C,O=b/w,D=y/2,L=b/2,T=M/2,A=C+1,N=w+1;let B=0,F=0;const I=new G;for(let z=0;z<N;z++){const Z=z*O-L;for(let j=0;j<A;j++){const K=j*P-D;I[g]=K*x,I[m]=Z*_,I[v]=T,l.push(I.x,I.y,I.z),I[g]=0,I[m]=0,I[v]=M>0?1:-1,c.push(I.x,I.y,I.z),u.push(j/C),u.push(1-z/w),B+=1}}for(let z=0;z<w;z++)for(let Z=0;Z<C;Z++){const j=f+Z+A*z,K=f+Z+A*(z+1),et=f+(Z+1)+A*(z+1),st=f+(Z+1)+A*z;h.push(j,K,st),h.push(K,et,st),F+=6}a.addGroup(d,F,S),d+=F,f+=B}}static fromJSON(t){return new Os(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Ps(o){const t={};for(const i in o){t[i]={};for(const n in o[i]){const e=o[i][n];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture||e.isQuaternion)?t[i][n]=e.clone():Array.isArray(e)?t[i][n]=e.slice():t[i][n]=e}}return t}function Xe(o){const t={};for(let i=0;i<o.length;i++){const n=Ps(o[i]);for(const e in n)t[e]=n[e]}return t}function K0(o){const t=[];for(let i=0;i<o.length;i++)t.push(o[i].clone());return t}const ku={clone:Ps,merge:Xe};var tx=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ex=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Nn extends Gi{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=tx,this.fragmentShader=ex,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ps(t.uniforms),this.uniformsGroups=K0(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const e in this.uniforms){const s=this.uniforms[e].value;s&&s.isTexture?i.uniforms[e]={type:"t",value:s.toJSON(t).uuid}:s&&s.isColor?i.uniforms[e]={type:"c",value:s.getHex()}:s&&s.isVector2?i.uniforms[e]={type:"v2",value:s.toArray()}:s&&s.isVector3?i.uniforms[e]={type:"v3",value:s.toArray()}:s&&s.isVector4?i.uniforms[e]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?i.uniforms[e]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?i.uniforms[e]={type:"m4",value:s.toArray()}:i.uniforms[e]={value:s}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)this.extensions[e]===!0&&(n[e]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class fh extends Te{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ve,this.projectionMatrix=new ve,this.projectionMatrixInverse=new ve}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class gi extends fh{constructor(t=50,i=1,n=.1,e=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=e,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=bd*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(yl*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return bd*2*Math.atan(Math.tan(yl*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,i,n,e,r,s){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=e,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(yl*.5*this.fov)/this.zoom,n=2*i,e=this.aspect*n,r=-.5*e;const s=this.view;if(this.view!==null&&this.view.enabled){const h=s.fullWidth,l=s.fullHeight;r+=s.offsetX*e/h,i-=s.offsetY*n/l,e*=s.width/h,n*=s.height/l}const a=this.filmOffset;a!==0&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+e,i,i-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const Xr=90,$r=1;class ix extends Te{constructor(t,i,n){super(),this.type="CubeCamera",this.renderTarget=n;const e=new gi(Xr,$r,t,i);e.layers=this.layers,e.up.set(0,-1,0),e.lookAt(new G(1,0,0)),this.add(e);const r=new gi(Xr,$r,t,i);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new G(-1,0,0)),this.add(r);const s=new gi(Xr,$r,t,i);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new G(0,1,0)),this.add(s);const a=new gi(Xr,$r,t,i);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new G(0,-1,0)),this.add(a);const h=new gi(Xr,$r,t,i);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new G(0,0,1)),this.add(h);const l=new gi(Xr,$r,t,i);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new G(0,0,-1)),this.add(l)}update(t,i){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[e,r,s,a,h,l]=this.children,c=t.getRenderTarget(),u=t.toneMapping,f=t.xr.enabled;t.toneMapping=rn,t.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(i,e),t.setRenderTarget(n,1),t.render(i,r),t.setRenderTarget(n,2),t.render(i,s),t.setRenderTarget(n,3),t.render(i,a),t.setRenderTarget(n,4),t.render(i,h),n.texture.generateMipmaps=d,t.setRenderTarget(n,5),t.render(i,l),t.setRenderTarget(c),t.toneMapping=u,t.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class _m extends xi{constructor(t,i,n,e,r,s,a,h,l,c){t=t!==void 0?t:[],i=i!==void 0?i:Ss,super(t,i,n,e,r,s,a,h,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class nx extends an{constructor(t,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},e=[n,n,n,n,n,n];this.texture=new _m(e,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:pi}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.encoding=i.encoding,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},e=new Os(5,5,5),r=new Nn({name:"CubemapFromEquirect",uniforms:Ps(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:_i,blending:zn});r.uniforms.tEquirect.value=i;const s=new ei(e,r),a=i.minFilter;return i.minFilter===Nh&&(i.minFilter=pi),new ix(1,10,this).update(t,s),i.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,i,n,e){const r=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(i,n,e);t.setRenderTarget(r)}}const Hl=new G,rx=new G,sx=new mi;class ar{constructor(t=new G(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,n,e){return this.normal.set(t,i,n),this.constant=e,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,n){const e=Hl.subVectors(n,i).cross(rx.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(e,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,i){const n=t.delta(Hl),e=this.normal.dot(n);if(e===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/e;return r<0||r>1?null:i.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const i=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return i<0&&n>0||n<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const n=i||sx.getNormalMatrix(t),e=this.coplanarPoint(Hl).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-e.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const qr=new Rs,ya=new G;class zu{constructor(t=new ar,i=new ar,n=new ar,e=new ar,r=new ar,s=new ar){this.planes=[t,i,n,e,r,s]}set(t,i,n,e,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(i),a[2].copy(n),a[3].copy(e),a[4].copy(r),a[5].copy(s),this}copy(t){const i=this.planes;for(let n=0;n<6;n++)i[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const i=this.planes,n=t.elements,e=n[0],r=n[1],s=n[2],a=n[3],h=n[4],l=n[5],c=n[6],u=n[7],f=n[8],d=n[9],p=n[10],g=n[11],m=n[12],v=n[13],x=n[14],_=n[15];return i[0].setComponents(a-e,u-h,g-f,_-m).normalize(),i[1].setComponents(a+e,u+h,g+f,_+m).normalize(),i[2].setComponents(a+r,u+l,g+d,_+v).normalize(),i[3].setComponents(a-r,u-l,g-d,_-v).normalize(),i[4].setComponents(a-s,u-c,g-p,_-x).normalize(),i[5].setComponents(a+s,u+c,g+p,_+x).normalize(),this}intersectsObject(t){const i=t.geometry;return i.boundingSphere===null&&i.computeBoundingSphere(),qr.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(qr)}intersectsSprite(t){return qr.center.set(0,0,0),qr.radius=.7071067811865476,qr.applyMatrix4(t.matrixWorld),this.intersectsSphere(qr)}intersectsSphere(t){const i=this.planes,n=t.center,e=-t.radius;for(let r=0;r<6;r++)if(i[r].distanceToPoint(n)<e)return!1;return!0}intersectsBox(t){const i=this.planes;for(let n=0;n<6;n++){const e=i[n];if(ya.x=e.normal.x>0?t.max.x:t.min.x,ya.y=e.normal.y>0?t.max.y:t.min.y,ya.z=e.normal.z>0?t.max.z:t.min.z,e.distanceToPoint(ya)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let n=0;n<6;n++)if(i[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ym(){let o=null,t=!1,i=null,n=null;function e(r,s){i(r,s),n=o.requestAnimationFrame(e)}return{start:function(){t!==!0&&i!==null&&(n=o.requestAnimationFrame(e),t=!0)},stop:function(){o.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(r){i=r},setContext:function(r){o=r}}}function ox(o,t){const i=t.isWebGL2,n=new WeakMap;function e(l,c){const u=l.array,f=l.usage,d=o.createBuffer();o.bindBuffer(c,d),o.bufferData(c,u,f),l.onUploadCallback();let p;if(u instanceof Float32Array)p=5126;else if(u instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(i)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(u instanceof Int16Array)p=5122;else if(u instanceof Uint32Array)p=5125;else if(u instanceof Int32Array)p=5124;else if(u instanceof Int8Array)p=5120;else if(u instanceof Uint8Array)p=5121;else if(u instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:d,type:p,bytesPerElement:u.BYTES_PER_ELEMENT,version:l.version}}function r(l,c,u){const f=c.array,d=c.updateRange;o.bindBuffer(u,l),d.count===-1?o.bufferSubData(u,0,f):(i?o.bufferSubData(u,d.offset*f.BYTES_PER_ELEMENT,f,d.offset,d.count):o.bufferSubData(u,d.offset*f.BYTES_PER_ELEMENT,f.subarray(d.offset,d.offset+d.count)),d.count=-1)}function s(l){return l.isInterleavedBufferAttribute&&(l=l.data),n.get(l)}function a(l){l.isInterleavedBufferAttribute&&(l=l.data);const c=n.get(l);c&&(o.deleteBuffer(c.buffer),n.delete(l))}function h(l,c){if(l.isGLBufferAttribute){const f=n.get(l);(!f||f.version<l.version)&&n.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const u=n.get(l);u===void 0?n.set(l,e(l,c)):u.version<l.version&&(r(u.buffer,l,c),u.version=l.version)}return{get:s,remove:a,update:h}}class Fu extends ae{constructor(t=1,i=1,n=1,e=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:n,heightSegments:e};const r=t/2,s=i/2,a=Math.floor(n),h=Math.floor(e),l=a+1,c=h+1,u=t/a,f=i/h,d=[],p=[],g=[],m=[];for(let v=0;v<c;v++){const x=v*f-s;for(let _=0;_<l;_++){const y=_*u-r;p.push(y,-x,0),g.push(0,0,1),m.push(_/a),m.push(1-v/h)}}for(let v=0;v<h;v++)for(let x=0;x<a;x++){const _=x+l*v,y=x+l*(v+1),b=x+1+l*(v+1),M=x+1+l*v;d.push(_,y,M),d.push(y,b,M)}this.setIndex(d),this.setAttribute("position",new Fe(p,3)),this.setAttribute("normal",new Fe(g,3)),this.setAttribute("uv",new Fe(m,2))}static fromJSON(t){return new Fu(t.width,t.height,t.widthSegments,t.heightSegments)}}var ax=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,hx=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,lx=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,cx=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ux=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,fx=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,dx="vec3 transformed = vec3( position );",px=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,gx=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,mx=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,vx=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,_x=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,yx=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,xx=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,wx=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Mx=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,bx=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Sx=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Cx=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Tx=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Px=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Ex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Ax=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Lx=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Rx=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ox=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Dx="gl_FragColor = linearToOutputTexel( gl_FragColor );",Ix=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,kx=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,zx=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Fx=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Nx=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Bx=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Gx=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Hx=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ux=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Vx=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Wx=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,jx=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Zx=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Xx=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,$x=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,qx=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Jx=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Yx=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Qx=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Kx=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,tw=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,ew=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,iw=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,nw=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,rw=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,sw=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,ow=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,aw=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,hw=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,lw=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,cw=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,uw=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,fw=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,dw=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,pw=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,gw=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,mw=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,vw=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,_w=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,yw=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,xw=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,ww=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Mw=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,bw=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Sw=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Cw=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Tw=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Pw=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Ew=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Aw=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Lw=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Rw=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Ow=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Dw=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Iw=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,kw=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,zw=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Fw=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Nw=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Bw=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Gw=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Hw=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Uw=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Vw=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Ww=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,jw=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Zw=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Xw=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,$w=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,qw=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Jw=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Yw=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Qw=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Kw=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,tM=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,eM=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,iM=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,nM=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,rM=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const sM=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,oM=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,aM=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,hM=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,lM=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,cM=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,uM=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fM=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,dM=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,pM=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,gM=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,mM=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vM=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,_M=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yM=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xM=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wM=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,MM=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bM=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,SM=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,CM=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,TM=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PM=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,EM=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AM=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LM=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,RM=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,OM=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,DM=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,IM=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,kM=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,zM=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Qt={alphamap_fragment:ax,alphamap_pars_fragment:hx,alphatest_fragment:lx,alphatest_pars_fragment:cx,aomap_fragment:ux,aomap_pars_fragment:fx,begin_vertex:dx,beginnormal_vertex:px,bsdfs:gx,iridescence_fragment:mx,bumpmap_pars_fragment:vx,clipping_planes_fragment:_x,clipping_planes_pars_fragment:yx,clipping_planes_pars_vertex:xx,clipping_planes_vertex:wx,color_fragment:Mx,color_pars_fragment:bx,color_pars_vertex:Sx,color_vertex:Cx,common:Tx,cube_uv_reflection_fragment:Px,defaultnormal_vertex:Ex,displacementmap_pars_vertex:Ax,displacementmap_vertex:Lx,emissivemap_fragment:Rx,emissivemap_pars_fragment:Ox,encodings_fragment:Dx,encodings_pars_fragment:Ix,envmap_fragment:kx,envmap_common_pars_fragment:zx,envmap_pars_fragment:Fx,envmap_pars_vertex:Nx,envmap_physical_pars_fragment:Jx,envmap_vertex:Bx,fog_vertex:Gx,fog_pars_vertex:Hx,fog_fragment:Ux,fog_pars_fragment:Vx,gradientmap_pars_fragment:Wx,lightmap_fragment:jx,lightmap_pars_fragment:Zx,lights_lambert_fragment:Xx,lights_lambert_pars_fragment:$x,lights_pars_begin:qx,lights_toon_fragment:Yx,lights_toon_pars_fragment:Qx,lights_phong_fragment:Kx,lights_phong_pars_fragment:tw,lights_physical_fragment:ew,lights_physical_pars_fragment:iw,lights_fragment_begin:nw,lights_fragment_maps:rw,lights_fragment_end:sw,logdepthbuf_fragment:ow,logdepthbuf_pars_fragment:aw,logdepthbuf_pars_vertex:hw,logdepthbuf_vertex:lw,map_fragment:cw,map_pars_fragment:uw,map_particle_fragment:fw,map_particle_pars_fragment:dw,metalnessmap_fragment:pw,metalnessmap_pars_fragment:gw,morphcolor_vertex:mw,morphnormal_vertex:vw,morphtarget_pars_vertex:_w,morphtarget_vertex:yw,normal_fragment_begin:xw,normal_fragment_maps:ww,normal_pars_fragment:Mw,normal_pars_vertex:bw,normal_vertex:Sw,normalmap_pars_fragment:Cw,clearcoat_normal_fragment_begin:Tw,clearcoat_normal_fragment_maps:Pw,clearcoat_pars_fragment:Ew,iridescence_pars_fragment:Aw,output_fragment:Lw,packing:Rw,premultiplied_alpha_fragment:Ow,project_vertex:Dw,dithering_fragment:Iw,dithering_pars_fragment:kw,roughnessmap_fragment:zw,roughnessmap_pars_fragment:Fw,shadowmap_pars_fragment:Nw,shadowmap_pars_vertex:Bw,shadowmap_vertex:Gw,shadowmask_pars_fragment:Hw,skinbase_vertex:Uw,skinning_pars_vertex:Vw,skinning_vertex:Ww,skinnormal_vertex:jw,specularmap_fragment:Zw,specularmap_pars_fragment:Xw,tonemapping_fragment:$w,tonemapping_pars_fragment:qw,transmission_fragment:Jw,transmission_pars_fragment:Yw,uv_pars_fragment:Qw,uv_pars_vertex:Kw,uv_vertex:tM,uv2_pars_fragment:eM,uv2_pars_vertex:iM,uv2_vertex:nM,worldpos_vertex:rM,background_vert:sM,background_frag:oM,cube_vert:aM,cube_frag:hM,depth_vert:lM,depth_frag:cM,distanceRGBA_vert:uM,distanceRGBA_frag:fM,equirect_vert:dM,equirect_frag:pM,linedashed_vert:gM,linedashed_frag:mM,meshbasic_vert:vM,meshbasic_frag:_M,meshlambert_vert:yM,meshlambert_frag:xM,meshmatcap_vert:wM,meshmatcap_frag:MM,meshnormal_vert:bM,meshnormal_frag:SM,meshphong_vert:CM,meshphong_frag:TM,meshphysical_vert:PM,meshphysical_frag:EM,meshtoon_vert:AM,meshtoon_frag:LM,points_vert:RM,points_frag:OM,shadow_vert:DM,shadow_frag:IM,sprite_vert:kM,sprite_frag:zM},mt={common:{diffuse:{value:new qt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new mi},uv2Transform:{value:new mi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new bt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new qt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new qt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new mi}},sprite:{diffuse:{value:new qt(16777215)},opacity:{value:1},center:{value:new bt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new mi}}},Ii={basic:{uniforms:Xe([mt.common,mt.specularmap,mt.envmap,mt.aomap,mt.lightmap,mt.fog]),vertexShader:Qt.meshbasic_vert,fragmentShader:Qt.meshbasic_frag},lambert:{uniforms:Xe([mt.common,mt.specularmap,mt.envmap,mt.aomap,mt.lightmap,mt.emissivemap,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.fog,mt.lights,{emissive:{value:new qt(0)}}]),vertexShader:Qt.meshlambert_vert,fragmentShader:Qt.meshlambert_frag},phong:{uniforms:Xe([mt.common,mt.specularmap,mt.envmap,mt.aomap,mt.lightmap,mt.emissivemap,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.fog,mt.lights,{emissive:{value:new qt(0)},specular:{value:new qt(1118481)},shininess:{value:30}}]),vertexShader:Qt.meshphong_vert,fragmentShader:Qt.meshphong_frag},standard:{uniforms:Xe([mt.common,mt.envmap,mt.aomap,mt.lightmap,mt.emissivemap,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.roughnessmap,mt.metalnessmap,mt.fog,mt.lights,{emissive:{value:new qt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag},toon:{uniforms:Xe([mt.common,mt.aomap,mt.lightmap,mt.emissivemap,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.gradientmap,mt.fog,mt.lights,{emissive:{value:new qt(0)}}]),vertexShader:Qt.meshtoon_vert,fragmentShader:Qt.meshtoon_frag},matcap:{uniforms:Xe([mt.common,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.fog,{matcap:{value:null}}]),vertexShader:Qt.meshmatcap_vert,fragmentShader:Qt.meshmatcap_frag},points:{uniforms:Xe([mt.points,mt.fog]),vertexShader:Qt.points_vert,fragmentShader:Qt.points_frag},dashed:{uniforms:Xe([mt.common,mt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qt.linedashed_vert,fragmentShader:Qt.linedashed_frag},depth:{uniforms:Xe([mt.common,mt.displacementmap]),vertexShader:Qt.depth_vert,fragmentShader:Qt.depth_frag},normal:{uniforms:Xe([mt.common,mt.bumpmap,mt.normalmap,mt.displacementmap,{opacity:{value:1}}]),vertexShader:Qt.meshnormal_vert,fragmentShader:Qt.meshnormal_frag},sprite:{uniforms:Xe([mt.sprite,mt.fog]),vertexShader:Qt.sprite_vert,fragmentShader:Qt.sprite_frag},background:{uniforms:{uvTransform:{value:new mi},t2D:{value:null}},vertexShader:Qt.background_vert,fragmentShader:Qt.background_frag},cube:{uniforms:Xe([mt.envmap,{opacity:{value:1}}]),vertexShader:Qt.cube_vert,fragmentShader:Qt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qt.equirect_vert,fragmentShader:Qt.equirect_frag},distanceRGBA:{uniforms:Xe([mt.common,mt.displacementmap,{referencePosition:{value:new G},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qt.distanceRGBA_vert,fragmentShader:Qt.distanceRGBA_frag},shadow:{uniforms:Xe([mt.lights,mt.fog,{color:{value:new qt(0)},opacity:{value:1}}]),vertexShader:Qt.shadow_vert,fragmentShader:Qt.shadow_frag}};Ii.physical={uniforms:Xe([Ii.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new bt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new qt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new bt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new qt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new qt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag};function FM(o,t,i,n,e,r){const s=new qt(0);let a=e===!0?0:1,h,l,c=null,u=0,f=null;function d(g,m){let v=!1,x=m.isScene===!0?m.background:null;x&&x.isTexture&&(x=t.get(x));const _=o.xr,y=_.getSession&&_.getSession();y&&y.environmentBlendMode==="additive"&&(x=null),x===null?p(s,a):x&&x.isColor&&(p(x,1),v=!0),(o.autoClear||v)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Fh)?(l===void 0&&(l=new ei(new Os(1,1,1),new Nn({name:"BackgroundCubeMaterial",uniforms:Ps(Ii.cube.uniforms),vertexShader:Ii.cube.vertexShader,fragmentShader:Ii.cube.fragmentShader,side:_i,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(b,M,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=x,l.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,(c!==x||u!==x.version||f!==o.toneMapping)&&(l.material.needsUpdate=!0,c=x,u=x.version,f=o.toneMapping),l.layers.enableAll(),g.unshift(l,l.geometry,l.material,0,0,null)):x&&x.isTexture&&(h===void 0&&(h=new ei(new Fu(2,2),new Nn({name:"BackgroundMaterial",uniforms:Ps(Ii.background.uniforms),vertexShader:Ii.background.vertexShader,fragmentShader:Ii.background.fragmentShader,side:bs,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(h)),h.material.uniforms.t2D.value=x,x.matrixAutoUpdate===!0&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),(c!==x||u!==x.version||f!==o.toneMapping)&&(h.material.needsUpdate=!0,c=x,u=x.version,f=o.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null))}function p(g,m){i.buffers.color.setClear(g.r,g.g,g.b,m,r)}return{getClearColor:function(){return s},setClearColor:function(g,m=1){s.set(g),a=m,p(s,a)},getClearAlpha:function(){return a},setClearAlpha:function(g){a=g,p(s,a)},render:d}}function NM(o,t,i,n){const e=o.getParameter(34921),r=n.isWebGL2?null:t.get("OES_vertex_array_object"),s=n.isWebGL2||r!==null,a={},h=m(null);let l=h,c=!1;function u(T,A,N,B,F){let I=!1;if(s){const z=g(B,N,A);l!==z&&(l=z,d(l.object)),I=v(T,B,N,F),I&&x(T,B,N,F)}else{const z=A.wireframe===!0;(l.geometry!==B.id||l.program!==N.id||l.wireframe!==z)&&(l.geometry=B.id,l.program=N.id,l.wireframe=z,I=!0)}F!==null&&i.update(F,34963),(I||c)&&(c=!1,w(T,A,N,B),F!==null&&o.bindBuffer(34963,i.get(F).buffer))}function f(){return n.isWebGL2?o.createVertexArray():r.createVertexArrayOES()}function d(T){return n.isWebGL2?o.bindVertexArray(T):r.bindVertexArrayOES(T)}function p(T){return n.isWebGL2?o.deleteVertexArray(T):r.deleteVertexArrayOES(T)}function g(T,A,N){const B=N.wireframe===!0;let F=a[T.id];F===void 0&&(F={},a[T.id]=F);let I=F[A.id];I===void 0&&(I={},F[A.id]=I);let z=I[B];return z===void 0&&(z=m(f()),I[B]=z),z}function m(T){const A=[],N=[],B=[];for(let F=0;F<e;F++)A[F]=0,N[F]=0,B[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:A,enabledAttributes:N,attributeDivisors:B,object:T,attributes:{},index:null}}function v(T,A,N,B){const F=l.attributes,I=A.attributes;let z=0;const Z=N.getAttributes();for(const j in Z)if(Z[j].location>=0){const et=F[j];let st=I[j];if(st===void 0&&(j==="instanceMatrix"&&T.instanceMatrix&&(st=T.instanceMatrix),j==="instanceColor"&&T.instanceColor&&(st=T.instanceColor)),et===void 0||et.attribute!==st||st&&et.data!==st.data)return!0;z++}return l.attributesNum!==z||l.index!==B}function x(T,A,N,B){const F={},I=A.attributes;let z=0;const Z=N.getAttributes();for(const j in Z)if(Z[j].location>=0){let et=I[j];et===void 0&&(j==="instanceMatrix"&&T.instanceMatrix&&(et=T.instanceMatrix),j==="instanceColor"&&T.instanceColor&&(et=T.instanceColor));const st={};st.attribute=et,et&&et.data&&(st.data=et.data),F[j]=st,z++}l.attributes=F,l.attributesNum=z,l.index=B}function _(){const T=l.newAttributes;for(let A=0,N=T.length;A<N;A++)T[A]=0}function y(T){b(T,0)}function b(T,A){const N=l.newAttributes,B=l.enabledAttributes,F=l.attributeDivisors;N[T]=1,B[T]===0&&(o.enableVertexAttribArray(T),B[T]=1),F[T]!==A&&((n.isWebGL2?o:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](T,A),F[T]=A)}function M(){const T=l.newAttributes,A=l.enabledAttributes;for(let N=0,B=A.length;N<B;N++)A[N]!==T[N]&&(o.disableVertexAttribArray(N),A[N]=0)}function C(T,A,N,B,F,I){n.isWebGL2===!0&&(N===5124||N===5125)?o.vertexAttribIPointer(T,A,N,F,I):o.vertexAttribPointer(T,A,N,B,F,I)}function w(T,A,N,B){if(n.isWebGL2===!1&&(T.isInstancedMesh||B.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;_();const F=B.attributes,I=N.getAttributes(),z=A.defaultAttributeValues;for(const Z in I){const j=I[Z];if(j.location>=0){let K=F[Z];if(K===void 0&&(Z==="instanceMatrix"&&T.instanceMatrix&&(K=T.instanceMatrix),Z==="instanceColor"&&T.instanceColor&&(K=T.instanceColor)),K!==void 0){const et=K.normalized,st=K.itemSize,V=i.get(K);if(V===void 0)continue;const pt=V.buffer,xt=V.type,ut=V.bytesPerElement;if(K.isInterleavedBufferAttribute){const ft=K.data,kt=ft.stride,J=K.offset;if(ft.isInstancedInterleavedBuffer){for(let Q=0;Q<j.locationSize;Q++)b(j.location+Q,ft.meshPerAttribute);T.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=ft.meshPerAttribute*ft.count)}else for(let Q=0;Q<j.locationSize;Q++)y(j.location+Q);o.bindBuffer(34962,pt);for(let Q=0;Q<j.locationSize;Q++)C(j.location+Q,st/j.locationSize,xt,et,kt*ut,(J+st/j.locationSize*Q)*ut)}else{if(K.isInstancedBufferAttribute){for(let ft=0;ft<j.locationSize;ft++)b(j.location+ft,K.meshPerAttribute);T.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let ft=0;ft<j.locationSize;ft++)y(j.location+ft);o.bindBuffer(34962,pt);for(let ft=0;ft<j.locationSize;ft++)C(j.location+ft,st/j.locationSize,xt,et,st*ut,st/j.locationSize*ft*ut)}}else if(z!==void 0){const et=z[Z];if(et!==void 0)switch(et.length){case 2:o.vertexAttrib2fv(j.location,et);break;case 3:o.vertexAttrib3fv(j.location,et);break;case 4:o.vertexAttrib4fv(j.location,et);break;default:o.vertexAttrib1fv(j.location,et)}}}}M()}function S(){D();for(const T in a){const A=a[T];for(const N in A){const B=A[N];for(const F in B)p(B[F].object),delete B[F];delete A[N]}delete a[T]}}function P(T){if(a[T.id]===void 0)return;const A=a[T.id];for(const N in A){const B=A[N];for(const F in B)p(B[F].object),delete B[F];delete A[N]}delete a[T.id]}function O(T){for(const A in a){const N=a[A];if(N[T.id]===void 0)continue;const B=N[T.id];for(const F in B)p(B[F].object),delete B[F];delete N[T.id]}}function D(){L(),c=!0,l!==h&&(l=h,d(l.object))}function L(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:u,reset:D,resetDefaultState:L,dispose:S,releaseStatesOfGeometry:P,releaseStatesOfProgram:O,initAttributes:_,enableAttribute:y,disableUnusedAttributes:M}}function BM(o,t,i,n){const e=n.isWebGL2;let r;function s(l){r=l}function a(l,c){o.drawArrays(r,l,c),i.update(c,r,1)}function h(l,c,u){if(u===0)return;let f,d;if(e)f=o,d="drawArraysInstanced";else if(f=t.get("ANGLE_instanced_arrays"),d="drawArraysInstancedANGLE",f===null)return;f[d](r,l,c,u),i.update(c,r,u)}this.setMode=s,this.render=a,this.renderInstances=h}function GM(o,t,i){let n;function e(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){const C=t.get("EXT_texture_filter_anisotropic");n=o.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(C){if(C==="highp"){if(o.getShaderPrecisionFormat(35633,36338).precision>0&&o.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";C="mediump"}return C==="mediump"&&o.getShaderPrecisionFormat(35633,36337).precision>0&&o.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s=typeof WebGL2RenderingContext<"u"&&o instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&o instanceof WebGL2ComputeRenderingContext;let a=i.precision!==void 0?i.precision:"highp";const h=r(a);h!==a&&(a=h);const l=s||t.has("WEBGL_draw_buffers"),c=i.logarithmicDepthBuffer===!0,u=o.getParameter(34930),f=o.getParameter(35660),d=o.getParameter(3379),p=o.getParameter(34076),g=o.getParameter(34921),m=o.getParameter(36347),v=o.getParameter(36348),x=o.getParameter(36349),_=f>0,y=s||t.has("OES_texture_float"),b=_&&y,M=s?o.getParameter(36183):0;return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:e,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:f,maxTextureSize:d,maxCubemapSize:p,maxAttributes:g,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:x,vertexTextures:_,floatFragmentTextures:y,floatVertexTextures:b,maxSamples:M}}function HM(o){const t=this;let i=null,n=0,e=!1,r=!1;const s=new ar,a=new mi,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(u,f,d){const p=u.length!==0||f||n!==0||e;return e=f,i=c(u,d,0),n=u.length,p},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(u,f,d){const p=u.clippingPlanes,g=u.clipIntersection,m=u.clipShadows,v=o.get(u);if(!e||p===null||p.length===0||r&&!m)r?c(null):l();else{const x=r?0:n,_=x*4;let y=v.clippingState||null;h.value=y,y=c(p,f,_,d);for(let b=0;b!==_;++b)y[b]=i[b];v.clippingState=y,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=x}};function l(){h.value!==i&&(h.value=i,h.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function c(u,f,d,p){const g=u!==null?u.length:0;let m=null;if(g!==0){if(m=h.value,p!==!0||m===null){const v=d+g*4,x=f.matrixWorldInverse;a.getNormalMatrix(x),(m===null||m.length<v)&&(m=new Float32Array(v));for(let _=0,y=d;_!==g;++_,y+=4)s.copy(u[_]).applyMatrix4(x,a),s.normal.toArray(m,y),m[y+3]=s.constant}h.value=m,h.needsUpdate=!0}return t.numPlanes=g,t.numIntersection=0,m}}function UM(o){let t=new WeakMap;function i(s,a){return a===Jc?s.mapping=Ss:a===Yc&&(s.mapping=Cs),s}function n(s){if(s&&s.isTexture&&s.isRenderTargetTexture===!1){const a=s.mapping;if(a===Jc||a===Yc)if(t.has(s)){const h=t.get(s).texture;return i(h,s.mapping)}else{const h=s.image;if(h&&h.height>0){const l=new nx(h.height/2);return l.fromEquirectangularTexture(o,s),t.set(s,l),s.addEventListener("dispose",e),i(l.texture,s.mapping)}else return null}}return s}function e(s){const a=s.target;a.removeEventListener("dispose",e);const h=t.get(a);h!==void 0&&(t.delete(a),h.dispose())}function r(){t=new WeakMap}return{get:n,dispose:r}}class xm extends fh{constructor(t=-1,i=1,n=1,e=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=n,this.bottom=e,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,n,e,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=e,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,e=(this.top+this.bottom)/2;let r=n-t,s=n+t,a=e+i,h=e-i;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,s=r+l*this.view.width,a-=c*this.view.offsetY,h=a-c*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,h,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const as=4,zd=[.125,.215,.35,.446,.526,.582],hs=20,Ul=new xm,Fd=new qt;let Vl=null;const hr=(1+Math.sqrt(5))/2,Jr=1/hr,Nd=[new G(1,1,1),new G(-1,1,1),new G(1,1,-1),new G(-1,1,-1),new G(0,hr,Jr),new G(0,hr,-Jr),new G(Jr,0,hr),new G(-Jr,0,hr),new G(hr,Jr,0),new G(-hr,Jr,0)];class Bd{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,n=.1,e=100){Vl=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,e,r),i>0&&this._blur(r,0,0,i),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Ud(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Hd(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Vl),t.scissorTest=!1,xa(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===Ss||t.mapping===Cs?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Vl=this._renderer.getRenderTarget();const n=i||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:pi,minFilter:pi,generateMipmaps:!1,type:xo,format:ki,encoding:xr,depthBuffer:!1},e=Gd(t,i,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Gd(t,i,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=VM(r)),this._blurMaterial=WM(r,t,i)}return e}_compileMaterial(t){const i=new ei(this._lodPlanes[0],t);this._renderer.compile(i,Ul)}_sceneToCubeUV(t,i,n,e){const a=new gi(90,1,i,n),h=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],c=this._renderer,u=c.autoClear,f=c.toneMapping;c.getClearColor(Fd),c.toneMapping=rn,c.autoClear=!1;const d=new Iu({name:"PMREM.Background",side:_i,depthWrite:!1,depthTest:!1}),p=new ei(new Os,d);let g=!1;const m=t.background;m?m.isColor&&(d.color.copy(m),t.background=null,g=!0):(d.color.copy(Fd),g=!0);for(let v=0;v<6;v++){const x=v%3;x===0?(a.up.set(0,h[v],0),a.lookAt(l[v],0,0)):x===1?(a.up.set(0,0,h[v]),a.lookAt(0,l[v],0)):(a.up.set(0,h[v],0),a.lookAt(0,0,l[v]));const _=this._cubeSize;xa(e,x*_,v>2?_:0,_,_),c.setRenderTarget(e),g&&c.render(p,a),c.render(t,a)}p.geometry.dispose(),p.material.dispose(),c.toneMapping=f,c.autoClear=u,t.background=m}_textureToCubeUV(t,i){const n=this._renderer,e=t.mapping===Ss||t.mapping===Cs;e?(this._cubemapMaterial===null&&(this._cubemapMaterial=Ud()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Hd());const r=e?this._cubemapMaterial:this._equirectMaterial,s=new ei(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=t;const h=this._cubeSize;xa(i,0,0,3*h,2*h),n.setRenderTarget(i),n.render(s,Ul)}_applyPMREM(t){const i=this._renderer,n=i.autoClear;i.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const r=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),s=Nd[(e-1)%Nd.length];this._blur(t,e-1,e,r,s)}i.autoClear=n}_blur(t,i,n,e,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,i,n,e,"latitudinal",r),this._halfBlur(s,t,n,n,e,"longitudinal",r)}_halfBlur(t,i,n,e,r,s,a){const h=this._renderer,l=this._blurMaterial,c=3,u=new ei(this._lodPlanes[e],l),f=l.uniforms,d=this._sizeLods[n]-1,p=isFinite(r)?Math.PI/(2*d):2*Math.PI/(2*hs-1),g=r/p,m=isFinite(r)?1+Math.floor(c*g):hs;m>hs;const v=[];let x=0;for(let C=0;C<hs;++C){const w=C/g,S=Math.exp(-w*w/2);v.push(S),C===0?x+=S:C<m&&(x+=2*S)}for(let C=0;C<v.length;C++)v[C]=v[C]/x;f.envMap.value=t.texture,f.samples.value=m,f.weights.value=v,f.latitudinal.value=s==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:_}=this;f.dTheta.value=p,f.mipInt.value=_-n;const y=this._sizeLods[e],b=3*y*(e>_-as?e-_+as:0),M=4*(this._cubeSize-y);xa(i,b,M,3*y,2*y),h.setRenderTarget(i),h.render(u,Ul)}}function VM(o){const t=[],i=[],n=[];let e=o;const r=o-as+1+zd.length;for(let s=0;s<r;s++){const a=Math.pow(2,e);i.push(a);let h=1/a;s>o-as?h=zd[s-o+as-1]:s===0&&(h=0),n.push(h);const l=1/(a-2),c=-l,u=1+l,f=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,g=3,m=2,v=1,x=new Float32Array(g*p*d),_=new Float32Array(m*p*d),y=new Float32Array(v*p*d);for(let M=0;M<d;M++){const C=M%3*2/3-1,w=M>2?0:-1,S=[C,w,0,C+2/3,w,0,C+2/3,w+1,0,C,w,0,C+2/3,w+1,0,C,w+1,0];x.set(S,g*p*M),_.set(f,m*p*M);const P=[M,M,M,M,M,M];y.set(P,v*p*M)}const b=new ae;b.setAttribute("position",new It(x,g)),b.setAttribute("uv",new It(_,m)),b.setAttribute("faceIndex",new It(y,v)),t.push(b),e>as&&e--}return{lodPlanes:t,sizeLods:i,sigmas:n}}function Gd(o,t,i){const n=new an(o,t,i);return n.texture.mapping=Fh,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function xa(o,t,i,n,e){o.viewport.set(t,i,n,e),o.scissor.set(t,i,n,e)}function WM(o,t,i){const n=new Float32Array(hs),e=new G(0,1,0);return new Nn({name:"SphericalGaussianBlur",defines:{n:hs,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${o}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:e}},vertexShader:Nu(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:zn,depthTest:!1,depthWrite:!1})}function Hd(){return new Nn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Nu(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:zn,depthTest:!1,depthWrite:!1})}function Ud(){return new Nn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Nu(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:zn,depthTest:!1,depthWrite:!1})}function Nu(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function jM(o){let t=new WeakMap,i=null;function n(a){if(a&&a.isTexture){const h=a.mapping,l=h===Jc||h===Yc,c=h===Ss||h===Cs;if(l||c)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let u=t.get(a);return i===null&&(i=new Bd(o)),u=l?i.fromEquirectangular(a,u):i.fromCubemap(a,u),t.set(a,u),u.texture}else{if(t.has(a))return t.get(a).texture;{const u=a.image;if(l&&u&&u.height>0||c&&u&&e(u)){i===null&&(i=new Bd(o));const f=l?i.fromEquirectangular(a):i.fromCubemap(a);return t.set(a,f),a.addEventListener("dispose",r),f.texture}else return null}}}return a}function e(a){let h=0;const l=6;for(let c=0;c<l;c++)a[c]!==void 0&&h++;return h===l}function r(a){const h=a.target;h.removeEventListener("dispose",r);const l=t.get(h);l!==void 0&&(t.delete(h),l.dispose())}function s(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:n,dispose:s}}function ZM(o){const t={};function i(n){if(t[n]!==void 0)return t[n];let e;switch(n){case"WEBGL_depth_texture":e=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=o.getExtension(n)}return t[n]=e,e}return{has:function(n){return i(n)!==null},init:function(n){n.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(n){const e=i(n);return e}}}function XM(o,t,i,n){const e={},r=new WeakMap;function s(u){const f=u.target;f.index!==null&&t.remove(f.index);for(const p in f.attributes)t.remove(f.attributes[p]);f.removeEventListener("dispose",s),delete e[f.id];const d=r.get(f);d&&(t.remove(d),r.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,i.memory.geometries--}function a(u,f){return e[f.id]===!0||(f.addEventListener("dispose",s),e[f.id]=!0,i.memory.geometries++),f}function h(u){const f=u.attributes;for(const p in f)t.update(f[p],34962);const d=u.morphAttributes;for(const p in d){const g=d[p];for(let m=0,v=g.length;m<v;m++)t.update(g[m],34962)}}function l(u){const f=[],d=u.index,p=u.attributes.position;let g=0;if(d!==null){const x=d.array;g=d.version;for(let _=0,y=x.length;_<y;_+=3){const b=x[_+0],M=x[_+1],C=x[_+2];f.push(b,M,M,C,C,b)}}else{const x=p.array;g=p.version;for(let _=0,y=x.length/3-1;_<y;_+=3){const b=_+0,M=_+1,C=_+2;f.push(b,M,M,C,C,b)}}const m=new(um(f)?vm:mm)(f,1);m.version=g;const v=r.get(u);v&&t.remove(v),r.set(u,m)}function c(u){const f=r.get(u);if(f){const d=u.index;d!==null&&f.version<d.version&&l(u)}else l(u);return r.get(u)}return{get:a,update:h,getWireframeAttribute:c}}function $M(o,t,i,n){const e=n.isWebGL2;let r;function s(f){r=f}let a,h;function l(f){a=f.type,h=f.bytesPerElement}function c(f,d){o.drawElements(r,d,a,f*h),i.update(d,r,1)}function u(f,d,p){if(p===0)return;let g,m;if(e)g=o,m="drawElementsInstanced";else if(g=t.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",g===null)return;g[m](r,d,a,f*h,p),i.update(d,r,p)}this.setMode=s,this.setIndex=l,this.render=c,this.renderInstances=u}function qM(o){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,s,a){switch(i.calls++,s){case 4:i.triangles+=a*(r/3);break;case 1:i.lines+=a*(r/2);break;case 3:i.lines+=a*(r-1);break;case 2:i.lines+=a*r;break;case 0:i.points+=a*r;break;default:break}}function e(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:e,update:n}}function JM(o,t){return o[0]-t[0]}function YM(o,t){return Math.abs(t[1])-Math.abs(o[1])}function QM(o,t,i){const n={},e=new Float32Array(8),r=new WeakMap,s=new Ve,a=[];for(let l=0;l<8;l++)a[l]=[l,0];function h(l,c,u,f){const d=l.morphTargetInfluences;if(t.isWebGL2===!0){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,g=p!==void 0?p.length:0;let m=r.get(c);if(m===void 0||m.count!==g){let A=function(){L.dispose(),r.delete(c),c.removeEventListener("dispose",A)};m!==void 0&&m.texture.dispose();const _=c.morphAttributes.position!==void 0,y=c.morphAttributes.normal!==void 0,b=c.morphAttributes.color!==void 0,M=c.morphAttributes.position||[],C=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let S=0;_===!0&&(S=1),y===!0&&(S=2),b===!0&&(S=3);let P=c.attributes.position.count*S,O=1;P>t.maxTextureSize&&(O=Math.ceil(P/t.maxTextureSize),P=t.maxTextureSize);const D=new Float32Array(P*O*4*g),L=new gm(D,P,O,g);L.type=cr,L.needsUpdate=!0;const T=S*4;for(let N=0;N<g;N++){const B=M[N],F=C[N],I=w[N],z=P*O*4*N;for(let Z=0;Z<B.count;Z++){const j=Z*T;_===!0&&(s.fromBufferAttribute(B,Z),D[z+j+0]=s.x,D[z+j+1]=s.y,D[z+j+2]=s.z,D[z+j+3]=0),y===!0&&(s.fromBufferAttribute(F,Z),D[z+j+4]=s.x,D[z+j+5]=s.y,D[z+j+6]=s.z,D[z+j+7]=0),b===!0&&(s.fromBufferAttribute(I,Z),D[z+j+8]=s.x,D[z+j+9]=s.y,D[z+j+10]=s.z,D[z+j+11]=I.itemSize===4?s.w:1)}}m={count:g,texture:L,size:new bt(P,O)},r.set(c,m),c.addEventListener("dispose",A)}let v=0;for(let _=0;_<d.length;_++)v+=d[_];const x=c.morphTargetsRelative?1:1-v;f.getUniforms().setValue(o,"morphTargetBaseInfluence",x),f.getUniforms().setValue(o,"morphTargetInfluences",d),f.getUniforms().setValue(o,"morphTargetsTexture",m.texture,i),f.getUniforms().setValue(o,"morphTargetsTextureSize",m.size)}else{const p=d===void 0?0:d.length;let g=n[c.id];if(g===void 0||g.length!==p){g=[];for(let y=0;y<p;y++)g[y]=[y,0];n[c.id]=g}for(let y=0;y<p;y++){const b=g[y];b[0]=y,b[1]=d[y]}g.sort(YM);for(let y=0;y<8;y++)y<p&&g[y][1]?(a[y][0]=g[y][0],a[y][1]=g[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(JM);const m=c.morphAttributes.position,v=c.morphAttributes.normal;let x=0;for(let y=0;y<8;y++){const b=a[y],M=b[0],C=b[1];M!==Number.MAX_SAFE_INTEGER&&C?(m&&c.getAttribute("morphTarget"+y)!==m[M]&&c.setAttribute("morphTarget"+y,m[M]),v&&c.getAttribute("morphNormal"+y)!==v[M]&&c.setAttribute("morphNormal"+y,v[M]),e[y]=C,x+=C):(m&&c.hasAttribute("morphTarget"+y)===!0&&c.deleteAttribute("morphTarget"+y),v&&c.hasAttribute("morphNormal"+y)===!0&&c.deleteAttribute("morphNormal"+y),e[y]=0)}const _=c.morphTargetsRelative?1:1-x;f.getUniforms().setValue(o,"morphTargetBaseInfluence",_),f.getUniforms().setValue(o,"morphTargetInfluences",e)}}return{update:h}}function KM(o,t,i,n){let e=new WeakMap;function r(h){const l=n.render.frame,c=h.geometry,u=t.get(h,c);return e.get(u)!==l&&(t.update(u),e.set(u,l)),h.isInstancedMesh&&(h.hasEventListener("dispose",a)===!1&&h.addEventListener("dispose",a),i.update(h.instanceMatrix,34962),h.instanceColor!==null&&i.update(h.instanceColor,34962)),u}function s(){e=new WeakMap}function a(h){const l=h.target;l.removeEventListener("dispose",a),i.remove(l.instanceMatrix),l.instanceColor!==null&&i.remove(l.instanceColor)}return{update:r,dispose:s}}const wm=new xi,Mm=new gm,bm=new U0,Sm=new _m,Vd=[],Wd=[],jd=new Float32Array(16),Zd=new Float32Array(9),Xd=new Float32Array(4);function Ds(o,t,i){const n=o[0];if(n<=0||n>0)return o;const e=t*i;let r=Vd[e];if(r===void 0&&(r=new Float32Array(e),Vd[e]=r),t!==0){n.toArray(r,0);for(let s=1,a=0;s!==t;++s)a+=i,o[s].toArray(r,a)}return r}function Ne(o,t){if(o.length!==t.length)return!1;for(let i=0,n=o.length;i<n;i++)if(o[i]!==t[i])return!1;return!0}function Be(o,t){for(let i=0,n=t.length;i<n;i++)o[i]=t[i]}function Gh(o,t){let i=Wd[t];i===void 0&&(i=new Int32Array(t),Wd[t]=i);for(let n=0;n!==t;++n)i[n]=o.allocateTextureUnit();return i}function t1(o,t){const i=this.cache;i[0]!==t&&(o.uniform1f(this.addr,t),i[0]=t)}function e1(o,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(o.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Ne(i,t))return;o.uniform2fv(this.addr,t),Be(i,t)}}function i1(o,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(o.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(o.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Ne(i,t))return;o.uniform3fv(this.addr,t),Be(i,t)}}function n1(o,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(o.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Ne(i,t))return;o.uniform4fv(this.addr,t),Be(i,t)}}function r1(o,t){const i=this.cache,n=t.elements;if(n===void 0){if(Ne(i,t))return;o.uniformMatrix2fv(this.addr,!1,t),Be(i,t)}else{if(Ne(i,n))return;Xd.set(n),o.uniformMatrix2fv(this.addr,!1,Xd),Be(i,n)}}function s1(o,t){const i=this.cache,n=t.elements;if(n===void 0){if(Ne(i,t))return;o.uniformMatrix3fv(this.addr,!1,t),Be(i,t)}else{if(Ne(i,n))return;Zd.set(n),o.uniformMatrix3fv(this.addr,!1,Zd),Be(i,n)}}function o1(o,t){const i=this.cache,n=t.elements;if(n===void 0){if(Ne(i,t))return;o.uniformMatrix4fv(this.addr,!1,t),Be(i,t)}else{if(Ne(i,n))return;jd.set(n),o.uniformMatrix4fv(this.addr,!1,jd),Be(i,n)}}function a1(o,t){const i=this.cache;i[0]!==t&&(o.uniform1i(this.addr,t),i[0]=t)}function h1(o,t){const i=this.cache;Ne(i,t)||(o.uniform2iv(this.addr,t),Be(i,t))}function l1(o,t){const i=this.cache;Ne(i,t)||(o.uniform3iv(this.addr,t),Be(i,t))}function c1(o,t){const i=this.cache;Ne(i,t)||(o.uniform4iv(this.addr,t),Be(i,t))}function u1(o,t){const i=this.cache;i[0]!==t&&(o.uniform1ui(this.addr,t),i[0]=t)}function f1(o,t){const i=this.cache;Ne(i,t)||(o.uniform2uiv(this.addr,t),Be(i,t))}function d1(o,t){const i=this.cache;Ne(i,t)||(o.uniform3uiv(this.addr,t),Be(i,t))}function p1(o,t){const i=this.cache;Ne(i,t)||(o.uniform4uiv(this.addr,t),Be(i,t))}function g1(o,t,i){const n=this.cache,e=i.allocateTextureUnit();n[0]!==e&&(o.uniform1i(this.addr,e),n[0]=e),i.setTexture2D(t||wm,e)}function m1(o,t,i){const n=this.cache,e=i.allocateTextureUnit();n[0]!==e&&(o.uniform1i(this.addr,e),n[0]=e),i.setTexture3D(t||bm,e)}function v1(o,t,i){const n=this.cache,e=i.allocateTextureUnit();n[0]!==e&&(o.uniform1i(this.addr,e),n[0]=e),i.setTextureCube(t||Sm,e)}function _1(o,t,i){const n=this.cache,e=i.allocateTextureUnit();n[0]!==e&&(o.uniform1i(this.addr,e),n[0]=e),i.setTexture2DArray(t||Mm,e)}function y1(o){switch(o){case 5126:return t1;case 35664:return e1;case 35665:return i1;case 35666:return n1;case 35674:return r1;case 35675:return s1;case 35676:return o1;case 5124:case 35670:return a1;case 35667:case 35671:return h1;case 35668:case 35672:return l1;case 35669:case 35673:return c1;case 5125:return u1;case 36294:return f1;case 36295:return d1;case 36296:return p1;case 35678:case 36198:case 36298:case 36306:case 35682:return g1;case 35679:case 36299:case 36307:return m1;case 35680:case 36300:case 36308:case 36293:return v1;case 36289:case 36303:case 36311:case 36292:return _1}}function x1(o,t){o.uniform1fv(this.addr,t)}function w1(o,t){const i=Ds(t,this.size,2);o.uniform2fv(this.addr,i)}function M1(o,t){const i=Ds(t,this.size,3);o.uniform3fv(this.addr,i)}function b1(o,t){const i=Ds(t,this.size,4);o.uniform4fv(this.addr,i)}function S1(o,t){const i=Ds(t,this.size,4);o.uniformMatrix2fv(this.addr,!1,i)}function C1(o,t){const i=Ds(t,this.size,9);o.uniformMatrix3fv(this.addr,!1,i)}function T1(o,t){const i=Ds(t,this.size,16);o.uniformMatrix4fv(this.addr,!1,i)}function P1(o,t){o.uniform1iv(this.addr,t)}function E1(o,t){o.uniform2iv(this.addr,t)}function A1(o,t){o.uniform3iv(this.addr,t)}function L1(o,t){o.uniform4iv(this.addr,t)}function R1(o,t){o.uniform1uiv(this.addr,t)}function O1(o,t){o.uniform2uiv(this.addr,t)}function D1(o,t){o.uniform3uiv(this.addr,t)}function I1(o,t){o.uniform4uiv(this.addr,t)}function k1(o,t,i){const n=this.cache,e=t.length,r=Gh(i,e);Ne(n,r)||(o.uniform1iv(this.addr,r),Be(n,r));for(let s=0;s!==e;++s)i.setTexture2D(t[s]||wm,r[s])}function z1(o,t,i){const n=this.cache,e=t.length,r=Gh(i,e);Ne(n,r)||(o.uniform1iv(this.addr,r),Be(n,r));for(let s=0;s!==e;++s)i.setTexture3D(t[s]||bm,r[s])}function F1(o,t,i){const n=this.cache,e=t.length,r=Gh(i,e);Ne(n,r)||(o.uniform1iv(this.addr,r),Be(n,r));for(let s=0;s!==e;++s)i.setTextureCube(t[s]||Sm,r[s])}function N1(o,t,i){const n=this.cache,e=t.length,r=Gh(i,e);Ne(n,r)||(o.uniform1iv(this.addr,r),Be(n,r));for(let s=0;s!==e;++s)i.setTexture2DArray(t[s]||Mm,r[s])}function B1(o){switch(o){case 5126:return x1;case 35664:return w1;case 35665:return M1;case 35666:return b1;case 35674:return S1;case 35675:return C1;case 35676:return T1;case 5124:case 35670:return P1;case 35667:case 35671:return E1;case 35668:case 35672:return A1;case 35669:case 35673:return L1;case 5125:return R1;case 36294:return O1;case 36295:return D1;case 36296:return I1;case 35678:case 36198:case 36298:case 36306:case 35682:return k1;case 35679:case 36299:case 36307:return z1;case 35680:case 36300:case 36308:case 36293:return F1;case 36289:case 36303:case 36311:case 36292:return N1}}class G1{constructor(t,i,n){this.id=t,this.addr=n,this.cache=[],this.setValue=y1(i.type)}}class H1{constructor(t,i,n){this.id=t,this.addr=n,this.cache=[],this.size=i.size,this.setValue=B1(i.type)}}class U1{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,n){const e=this.seq;for(let r=0,s=e.length;r!==s;++r){const a=e[r];a.setValue(t,i[a.id],n)}}}const Wl=/(\w+)(\])?(\[|\.)?/g;function $d(o,t){o.seq.push(t),o.map[t.id]=t}function V1(o,t,i){const n=o.name,e=n.length;for(Wl.lastIndex=0;;){const r=Wl.exec(n),s=Wl.lastIndex;let a=r[1];const h=r[2]==="]",l=r[3];if(h&&(a=a|0),l===void 0||l==="["&&s+2===e){$d(i,l===void 0?new G1(a,o,t):new H1(a,o,t));break}else{let u=i.map[a];u===void 0&&(u=new U1(a),$d(i,u)),i=u}}}class sh{constructor(t,i){this.seq=[],this.map={};const n=t.getProgramParameter(i,35718);for(let e=0;e<n;++e){const r=t.getActiveUniform(i,e),s=t.getUniformLocation(i,r.name);V1(r,s,this)}}setValue(t,i,n,e){const r=this.map[i];r!==void 0&&r.setValue(t,n,e)}setOptional(t,i,n){const e=i[n];e!==void 0&&this.setValue(t,n,e)}static upload(t,i,n,e){for(let r=0,s=i.length;r!==s;++r){const a=i[r],h=n[a.id];h.needsUpdate!==!1&&a.setValue(t,h.value,e)}}static seqWithValue(t,i){const n=[];for(let e=0,r=t.length;e!==r;++e){const s=t[e];s.id in i&&n.push(s)}return n}}function qd(o,t,i){const n=o.createShader(t);return o.shaderSource(n,i),o.compileShader(n),n}let W1=0;function j1(o,t){const i=o.split(`
`),n=[],e=Math.max(t-6,0),r=Math.min(t+6,i.length);for(let s=e;s<r;s++){const a=s+1;n.push(`${a===t?">":" "} ${a}: ${i[s]}`)}return n.join(`
`)}function Z1(o){switch(o){case xr:return["Linear","( value )"];case Se:return["sRGB","( value )"];default:return["Linear","( value )"]}}function Jd(o,t,i){const n=o.getShaderParameter(t,35713),e=o.getShaderInfoLog(t).trim();if(n&&e==="")return"";const r=/ERROR: 0:(\d+)/.exec(e);if(r){const s=parseInt(r[1]);return i.toUpperCase()+`

`+e+`

`+j1(o.getShaderSource(t),s)}else return e}function X1(o,t){const i=Z1(t);return"vec4 "+o+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function $1(o,t){let i;switch(t){case g0:i="Linear";break;case m0:i="Reinhard";break;case v0:i="OptimizedCineon";break;case _0:i="ACESFilmic";break;case y0:i="Custom";break;default:i="Linear"}return"vec3 "+o+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function q1(o){return[o.extensionDerivatives||!!o.envMapCubeUVHeight||o.bumpMap||o.tangentSpaceNormalMap||o.clearcoatNormalMap||o.flatShading||o.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(o.extensionFragDepth||o.logarithmicDepthBuffer)&&o.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",o.extensionDrawBuffers&&o.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(o.extensionShaderTextureLOD||o.envMap||o.transmission)&&o.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(lo).join(`
`)}function J1(o){const t=[];for(const i in o){const n=o[i];n!==!1&&t.push("#define "+i+" "+n)}return t.join(`
`)}function Y1(o,t){const i={},n=o.getProgramParameter(t,35721);for(let e=0;e<n;e++){const r=o.getActiveAttrib(t,e),s=r.name;let a=1;r.type===35674&&(a=2),r.type===35675&&(a=3),r.type===35676&&(a=4),i[s]={type:r.type,location:o.getAttribLocation(t,s),locationSize:a}}return i}function lo(o){return o!==""}function Yd(o,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return o.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Qd(o,t){return o.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Q1=/^[ \t]*#include +<([\w\d./]+)>/gm;function nu(o){return o.replace(Q1,K1)}function K1(o,t){const i=Qt[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return nu(i)}const tb=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Kd(o){return o.replace(tb,eb)}function eb(o,t,i,n){let e="";for(let r=parseInt(t);r<parseInt(i);r++)e+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return e}function tp(o){let t="precision "+o.precision+` float;
precision `+o.precision+" int;";return o.precision==="highp"?t+=`
#define HIGH_PRECISION`:o.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function ib(o){let t="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===sm?t="SHADOWMAP_TYPE_PCF":o.shadowMapType===Xy?t="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===ho&&(t="SHADOWMAP_TYPE_VSM"),t}function nb(o){let t="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case Ss:case Cs:t="ENVMAP_TYPE_CUBE";break;case Fh:t="ENVMAP_TYPE_CUBE_UV";break}return t}function rb(o){let t="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case Cs:t="ENVMAP_MODE_REFRACTION";break}return t}function sb(o){let t="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case Ou:t="ENVMAP_BLENDING_MULTIPLY";break;case d0:t="ENVMAP_BLENDING_MIX";break;case p0:t="ENVMAP_BLENDING_ADD";break}return t}function ob(o){const t=o.envMapCubeUVHeight;if(t===null)return null;const i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:n,maxMip:i}}function ab(o,t,i,n){const e=o.getContext(),r=i.defines;let s=i.vertexShader,a=i.fragmentShader;const h=ib(i),l=nb(i),c=rb(i),u=sb(i),f=ob(i),d=i.isWebGL2?"":q1(i),p=J1(r),g=e.createProgram();let m,v,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=[p].filter(lo).join(`
`),m.length>0&&(m+=`
`),v=[d,p].filter(lo).join(`
`),v.length>0&&(v+=`
`)):(m=[tp(i),"#define SHADER_NAME "+i.shaderName,p,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(lo).join(`
`),v=[d,tp(i),"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+l:"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==rn?"#define TONE_MAPPING":"",i.toneMapping!==rn?Qt.tonemapping_pars_fragment:"",i.toneMapping!==rn?$1("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Qt.encodings_pars_fragment,X1("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(lo).join(`
`)),s=nu(s),s=Yd(s,i),s=Qd(s,i),a=nu(a),a=Yd(a,i),a=Qd(a,i),s=Kd(s),a=Kd(a),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",i.glslVersion===Md?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Md?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const _=x+m+s,y=x+v+a,b=qd(e,35633,_),M=qd(e,35632,y);if(e.attachShader(g,b),e.attachShader(g,M),i.index0AttributeName!==void 0?e.bindAttribLocation(g,0,i.index0AttributeName):i.morphTargets===!0&&e.bindAttribLocation(g,0,"position"),e.linkProgram(g),o.debug.checkShaderErrors){const S=e.getProgramInfoLog(g).trim(),P=e.getShaderInfoLog(b).trim(),O=e.getShaderInfoLog(M).trim();let D=!0,L=!0;if(e.getProgramParameter(g,35714)===!1){D=!1;const T=Jd(e,b,"vertex"),A=Jd(e,M,"fragment")}else S!==""||(P===""||O==="")&&(L=!1);L&&(this.diagnostics={runnable:D,programLog:S,vertexShader:{log:P,prefix:m},fragmentShader:{log:O,prefix:v}})}e.deleteShader(b),e.deleteShader(M);let C;this.getUniforms=function(){return C===void 0&&(C=new sh(e,g)),C};let w;return this.getAttributes=function(){return w===void 0&&(w=Y1(e,g)),w},this.destroy=function(){n.releaseStatesOfProgram(this),e.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=W1++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=b,this.fragmentShader=M,this}let hb=0;class lb{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,n=t.fragmentShader,e=this._getShaderStage(i),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return s.has(e)===!1&&(s.add(e),e.usedTimes++),s.has(r)===!1&&(s.add(r),r.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const n of i)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let n=i.get(t);return n===void 0&&(n=new Set,i.set(t,n)),n}_getShaderStage(t){const i=this.shaderCache;let n=i.get(t);return n===void 0&&(n=new cb(t),i.set(t,n)),n}}class cb{constructor(t){this.id=hb++,this.code=t,this.usedTimes=0}}function ub(o,t,i,n,e,r,s){const a=new Du,h=new lb,l=[],c=e.isWebGL2,u=e.logarithmicDepthBuffer,f=e.vertexTextures;let d=e.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(w,S,P,O,D){const L=O.fog,T=D.geometry,A=w.isMeshStandardMaterial?O.environment:null,N=(w.isMeshStandardMaterial?i:t).get(w.envMap||A),B=!!N&&N.mapping===Fh?N.image.height:null,F=p[w.type];w.precision!==null&&(d=e.getMaxPrecision(w.precision),w.precision);const I=T.morphAttributes.position||T.morphAttributes.normal||T.morphAttributes.color,z=I!==void 0?I.length:0;let Z=0;T.morphAttributes.position!==void 0&&(Z=1),T.morphAttributes.normal!==void 0&&(Z=2),T.morphAttributes.color!==void 0&&(Z=3);let j,K,et,st;if(F){const kt=Ii[F];j=kt.vertexShader,K=kt.fragmentShader}else j=w.vertexShader,K=w.fragmentShader,h.update(w),et=h.getVertexShaderID(w),st=h.getFragmentShaderID(w);const V=o.getRenderTarget(),pt=w.alphaTest>0,xt=w.clearcoat>0,ut=w.iridescence>0;return{isWebGL2:c,shaderID:F,shaderName:w.type,vertexShader:j,fragmentShader:K,defines:w.defines,customVertexShaderID:et,customFragmentShaderID:st,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:d,instancing:D.isInstancedMesh===!0,instancingColor:D.isInstancedMesh===!0&&D.instanceColor!==null,supportsVertexTextures:f,outputEncoding:V===null?o.outputEncoding:V.isXRRenderTarget===!0?V.texture.encoding:xr,map:!!w.map,matcap:!!w.matcap,envMap:!!N,envMapMode:N&&N.mapping,envMapCubeUVHeight:B,lightMap:!!w.lightMap,aoMap:!!w.aoMap,emissiveMap:!!w.emissiveMap,bumpMap:!!w.bumpMap,normalMap:!!w.normalMap,objectSpaceNormalMap:w.normalMapType===N0,tangentSpaceNormalMap:w.normalMapType===cm,decodeVideoTexture:!!w.map&&w.map.isVideoTexture===!0&&w.map.encoding===Se,clearcoat:xt,clearcoatMap:xt&&!!w.clearcoatMap,clearcoatRoughnessMap:xt&&!!w.clearcoatRoughnessMap,clearcoatNormalMap:xt&&!!w.clearcoatNormalMap,iridescence:ut,iridescenceMap:ut&&!!w.iridescenceMap,iridescenceThicknessMap:ut&&!!w.iridescenceThicknessMap,displacementMap:!!w.displacementMap,roughnessMap:!!w.roughnessMap,metalnessMap:!!w.metalnessMap,specularMap:!!w.specularMap,specularIntensityMap:!!w.specularIntensityMap,specularColorMap:!!w.specularColorMap,opaque:w.transparent===!1&&w.blending===ps,alphaMap:!!w.alphaMap,alphaTest:pt,gradientMap:!!w.gradientMap,sheen:w.sheen>0,sheenColorMap:!!w.sheenColorMap,sheenRoughnessMap:!!w.sheenRoughnessMap,transmission:w.transmission>0,transmissionMap:!!w.transmissionMap,thicknessMap:!!w.thicknessMap,combine:w.combine,vertexTangents:!!w.normalMap&&!!T.attributes.tangent,vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!T.attributes.color&&T.attributes.color.itemSize===4,vertexUvs:!!w.map||!!w.bumpMap||!!w.normalMap||!!w.specularMap||!!w.alphaMap||!!w.emissiveMap||!!w.roughnessMap||!!w.metalnessMap||!!w.clearcoatMap||!!w.clearcoatRoughnessMap||!!w.clearcoatNormalMap||!!w.iridescenceMap||!!w.iridescenceThicknessMap||!!w.displacementMap||!!w.transmissionMap||!!w.thicknessMap||!!w.specularIntensityMap||!!w.specularColorMap||!!w.sheenColorMap||!!w.sheenRoughnessMap,uvsVertexOnly:!(!!w.map||!!w.bumpMap||!!w.normalMap||!!w.specularMap||!!w.alphaMap||!!w.emissiveMap||!!w.roughnessMap||!!w.metalnessMap||!!w.clearcoatNormalMap||!!w.iridescenceMap||!!w.iridescenceThicknessMap||w.transmission>0||!!w.transmissionMap||!!w.thicknessMap||!!w.specularIntensityMap||!!w.specularColorMap||w.sheen>0||!!w.sheenColorMap||!!w.sheenRoughnessMap)&&!!w.displacementMap,fog:!!L,useFog:w.fog===!0,fogExp2:L&&L.isFogExp2,flatShading:!!w.flatShading,sizeAttenuation:w.sizeAttenuation,logarithmicDepthBuffer:u,skinning:D.isSkinnedMesh===!0,morphTargets:T.morphAttributes.position!==void 0,morphNormals:T.morphAttributes.normal!==void 0,morphColors:T.morphAttributes.color!==void 0,morphTargetsCount:z,morphTextureStride:Z,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:w.dithering,shadowMapEnabled:o.shadowMap.enabled&&P.length>0,shadowMapType:o.shadowMap.type,toneMapping:w.toneMapped?o.toneMapping:rn,physicallyCorrectLights:o.physicallyCorrectLights,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===On,flipSided:w.side===_i,useDepthPacking:!!w.depthPacking,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionDerivatives:w.extensions&&w.extensions.derivatives,extensionFragDepth:w.extensions&&w.extensions.fragDepth,extensionDrawBuffers:w.extensions&&w.extensions.drawBuffers,extensionShaderTextureLOD:w.extensions&&w.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),customProgramCacheKey:w.customProgramCacheKey()}}function m(w){const S=[];if(w.shaderID?S.push(w.shaderID):(S.push(w.customVertexShaderID),S.push(w.customFragmentShaderID)),w.defines!==void 0)for(const P in w.defines)S.push(P),S.push(w.defines[P]);return w.isRawShaderMaterial===!1&&(v(S,w),x(S,w),S.push(o.outputEncoding)),S.push(w.customProgramCacheKey),S.join()}function v(w,S){w.push(S.precision),w.push(S.outputEncoding),w.push(S.envMapMode),w.push(S.envMapCubeUVHeight),w.push(S.combine),w.push(S.vertexUvs),w.push(S.fogExp2),w.push(S.sizeAttenuation),w.push(S.morphTargetsCount),w.push(S.morphAttributeCount),w.push(S.numDirLights),w.push(S.numPointLights),w.push(S.numSpotLights),w.push(S.numSpotLightMaps),w.push(S.numHemiLights),w.push(S.numRectAreaLights),w.push(S.numDirLightShadows),w.push(S.numPointLightShadows),w.push(S.numSpotLightShadows),w.push(S.numSpotLightShadowsWithMaps),w.push(S.shadowMapType),w.push(S.toneMapping),w.push(S.numClippingPlanes),w.push(S.numClipIntersection),w.push(S.depthPacking)}function x(w,S){a.disableAll(),S.isWebGL2&&a.enable(0),S.supportsVertexTextures&&a.enable(1),S.instancing&&a.enable(2),S.instancingColor&&a.enable(3),S.map&&a.enable(4),S.matcap&&a.enable(5),S.envMap&&a.enable(6),S.lightMap&&a.enable(7),S.aoMap&&a.enable(8),S.emissiveMap&&a.enable(9),S.bumpMap&&a.enable(10),S.normalMap&&a.enable(11),S.objectSpaceNormalMap&&a.enable(12),S.tangentSpaceNormalMap&&a.enable(13),S.clearcoat&&a.enable(14),S.clearcoatMap&&a.enable(15),S.clearcoatRoughnessMap&&a.enable(16),S.clearcoatNormalMap&&a.enable(17),S.iridescence&&a.enable(18),S.iridescenceMap&&a.enable(19),S.iridescenceThicknessMap&&a.enable(20),S.displacementMap&&a.enable(21),S.specularMap&&a.enable(22),S.roughnessMap&&a.enable(23),S.metalnessMap&&a.enable(24),S.gradientMap&&a.enable(25),S.alphaMap&&a.enable(26),S.alphaTest&&a.enable(27),S.vertexColors&&a.enable(28),S.vertexAlphas&&a.enable(29),S.vertexUvs&&a.enable(30),S.vertexTangents&&a.enable(31),S.uvsVertexOnly&&a.enable(32),w.push(a.mask),a.disableAll(),S.fog&&a.enable(0),S.useFog&&a.enable(1),S.flatShading&&a.enable(2),S.logarithmicDepthBuffer&&a.enable(3),S.skinning&&a.enable(4),S.morphTargets&&a.enable(5),S.morphNormals&&a.enable(6),S.morphColors&&a.enable(7),S.premultipliedAlpha&&a.enable(8),S.shadowMapEnabled&&a.enable(9),S.physicallyCorrectLights&&a.enable(10),S.doubleSided&&a.enable(11),S.flipSided&&a.enable(12),S.useDepthPacking&&a.enable(13),S.dithering&&a.enable(14),S.specularIntensityMap&&a.enable(15),S.specularColorMap&&a.enable(16),S.transmission&&a.enable(17),S.transmissionMap&&a.enable(18),S.thicknessMap&&a.enable(19),S.sheen&&a.enable(20),S.sheenColorMap&&a.enable(21),S.sheenRoughnessMap&&a.enable(22),S.decodeVideoTexture&&a.enable(23),S.opaque&&a.enable(24),w.push(a.mask)}function _(w){const S=p[w.type];let P;if(S){const O=Ii[S];P=ku.clone(O.uniforms)}else P=w.uniforms;return P}function y(w,S){let P;for(let O=0,D=l.length;O<D;O++){const L=l[O];if(L.cacheKey===S){P=L,++P.usedTimes;break}}return P===void 0&&(P=new ab(o,S,w,r),l.push(P)),P}function b(w){if(--w.usedTimes===0){const S=l.indexOf(w);l[S]=l[l.length-1],l.pop(),w.destroy()}}function M(w){h.remove(w)}function C(){h.dispose()}return{getParameters:g,getProgramCacheKey:m,getUniforms:_,acquireProgram:y,releaseProgram:b,releaseShaderCache:M,programs:l,dispose:C}}function fb(){let o=new WeakMap;function t(r){let s=o.get(r);return s===void 0&&(s={},o.set(r,s)),s}function i(r){o.delete(r)}function n(r,s,a){o.get(r)[s]=a}function e(){o=new WeakMap}return{get:t,remove:i,update:n,dispose:e}}function db(o,t){return o.groupOrder!==t.groupOrder?o.groupOrder-t.groupOrder:o.renderOrder!==t.renderOrder?o.renderOrder-t.renderOrder:o.material.id!==t.material.id?o.material.id-t.material.id:o.z!==t.z?o.z-t.z:o.id-t.id}function ep(o,t){return o.groupOrder!==t.groupOrder?o.groupOrder-t.groupOrder:o.renderOrder!==t.renderOrder?o.renderOrder-t.renderOrder:o.z!==t.z?t.z-o.z:o.id-t.id}function ip(){const o=[];let t=0;const i=[],n=[],e=[];function r(){t=0,i.length=0,n.length=0,e.length=0}function s(u,f,d,p,g,m){let v=o[t];return v===void 0?(v={id:u.id,object:u,geometry:f,material:d,groupOrder:p,renderOrder:u.renderOrder,z:g,group:m},o[t]=v):(v.id=u.id,v.object=u,v.geometry=f,v.material=d,v.groupOrder=p,v.renderOrder=u.renderOrder,v.z=g,v.group=m),t++,v}function a(u,f,d,p,g,m){const v=s(u,f,d,p,g,m);d.transmission>0?n.push(v):d.transparent===!0?e.push(v):i.push(v)}function h(u,f,d,p,g,m){const v=s(u,f,d,p,g,m);d.transmission>0?n.unshift(v):d.transparent===!0?e.unshift(v):i.unshift(v)}function l(u,f){i.length>1&&i.sort(u||db),n.length>1&&n.sort(f||ep),e.length>1&&e.sort(f||ep)}function c(){for(let u=t,f=o.length;u<f;u++){const d=o[u];if(d.id===null)break;d.id=null,d.object=null,d.geometry=null,d.material=null,d.group=null}}return{opaque:i,transmissive:n,transparent:e,init:r,push:a,unshift:h,finish:c,sort:l}}function pb(){let o=new WeakMap;function t(n,e){const r=o.get(n);let s;return r===void 0?(s=new ip,o.set(n,[s])):e>=r.length?(s=new ip,r.push(s)):s=r[e],s}function i(){o=new WeakMap}return{get:t,dispose:i}}function gb(){const o={};return{get:function(t){if(o[t.id]!==void 0)return o[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new G,color:new qt};break;case"SpotLight":i={position:new G,direction:new G,color:new qt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new G,color:new qt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new G,skyColor:new qt,groundColor:new qt};break;case"RectAreaLight":i={color:new qt,position:new G,halfWidth:new G,halfHeight:new G};break}return o[t.id]=i,i}}}function mb(){const o={};return{get:function(t){if(o[t.id]!==void 0)return o[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bt};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bt};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new bt,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[t.id]=i,i}}}let vb=0;function _b(o,t){return(t.castShadow?2:0)-(o.castShadow?2:0)+(t.map?1:0)-(o.map?1:0)}function yb(o,t){const i=new gb,n=mb(),e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let c=0;c<9;c++)e.probe.push(new G);const r=new G,s=new ve,a=new ve;function h(c,u){let f=0,d=0,p=0;for(let O=0;O<9;O++)e.probe[O].set(0,0,0);let g=0,m=0,v=0,x=0,_=0,y=0,b=0,M=0,C=0,w=0;c.sort(_b);const S=u!==!0?Math.PI:1;for(let O=0,D=c.length;O<D;O++){const L=c[O],T=L.color,A=L.intensity,N=L.distance,B=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)f+=T.r*A*S,d+=T.g*A*S,p+=T.b*A*S;else if(L.isLightProbe)for(let F=0;F<9;F++)e.probe[F].addScaledVector(L.sh.coefficients[F],A);else if(L.isDirectionalLight){const F=i.get(L);if(F.color.copy(L.color).multiplyScalar(L.intensity*S),L.castShadow){const I=L.shadow,z=n.get(L);z.shadowBias=I.bias,z.shadowNormalBias=I.normalBias,z.shadowRadius=I.radius,z.shadowMapSize=I.mapSize,e.directionalShadow[g]=z,e.directionalShadowMap[g]=B,e.directionalShadowMatrix[g]=L.shadow.matrix,y++}e.directional[g]=F,g++}else if(L.isSpotLight){const F=i.get(L);F.position.setFromMatrixPosition(L.matrixWorld),F.color.copy(T).multiplyScalar(A*S),F.distance=N,F.coneCos=Math.cos(L.angle),F.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),F.decay=L.decay,e.spot[v]=F;const I=L.shadow;if(L.map&&(e.spotLightMap[C]=L.map,C++,I.updateMatrices(L),L.castShadow&&w++),e.spotLightMatrix[v]=I.matrix,L.castShadow){const z=n.get(L);z.shadowBias=I.bias,z.shadowNormalBias=I.normalBias,z.shadowRadius=I.radius,z.shadowMapSize=I.mapSize,e.spotShadow[v]=z,e.spotShadowMap[v]=B,M++}v++}else if(L.isRectAreaLight){const F=i.get(L);F.color.copy(T).multiplyScalar(A),F.halfWidth.set(L.width*.5,0,0),F.halfHeight.set(0,L.height*.5,0),e.rectArea[x]=F,x++}else if(L.isPointLight){const F=i.get(L);if(F.color.copy(L.color).multiplyScalar(L.intensity*S),F.distance=L.distance,F.decay=L.decay,L.castShadow){const I=L.shadow,z=n.get(L);z.shadowBias=I.bias,z.shadowNormalBias=I.normalBias,z.shadowRadius=I.radius,z.shadowMapSize=I.mapSize,z.shadowCameraNear=I.camera.near,z.shadowCameraFar=I.camera.far,e.pointShadow[m]=z,e.pointShadowMap[m]=B,e.pointShadowMatrix[m]=L.shadow.matrix,b++}e.point[m]=F,m++}else if(L.isHemisphereLight){const F=i.get(L);F.skyColor.copy(L.color).multiplyScalar(A*S),F.groundColor.copy(L.groundColor).multiplyScalar(A*S),e.hemi[_]=F,_++}}x>0&&(t.isWebGL2||o.has("OES_texture_float_linear")===!0?(e.rectAreaLTC1=mt.LTC_FLOAT_1,e.rectAreaLTC2=mt.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0&&(e.rectAreaLTC1=mt.LTC_HALF_1,e.rectAreaLTC2=mt.LTC_HALF_2)),e.ambient[0]=f,e.ambient[1]=d,e.ambient[2]=p;const P=e.hash;(P.directionalLength!==g||P.pointLength!==m||P.spotLength!==v||P.rectAreaLength!==x||P.hemiLength!==_||P.numDirectionalShadows!==y||P.numPointShadows!==b||P.numSpotShadows!==M||P.numSpotMaps!==C)&&(e.directional.length=g,e.spot.length=v,e.rectArea.length=x,e.point.length=m,e.hemi.length=_,e.directionalShadow.length=y,e.directionalShadowMap.length=y,e.pointShadow.length=b,e.pointShadowMap.length=b,e.spotShadow.length=M,e.spotShadowMap.length=M,e.directionalShadowMatrix.length=y,e.pointShadowMatrix.length=b,e.spotLightMatrix.length=M+C-w,e.spotLightMap.length=C,e.numSpotLightShadowsWithMaps=w,P.directionalLength=g,P.pointLength=m,P.spotLength=v,P.rectAreaLength=x,P.hemiLength=_,P.numDirectionalShadows=y,P.numPointShadows=b,P.numSpotShadows=M,P.numSpotMaps=C,e.version=vb++)}function l(c,u){let f=0,d=0,p=0,g=0,m=0;const v=u.matrixWorldInverse;for(let x=0,_=c.length;x<_;x++){const y=c[x];if(y.isDirectionalLight){const b=e.directional[f];b.direction.setFromMatrixPosition(y.matrixWorld),r.setFromMatrixPosition(y.target.matrixWorld),b.direction.sub(r),b.direction.transformDirection(v),f++}else if(y.isSpotLight){const b=e.spot[p];b.position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(v),b.direction.setFromMatrixPosition(y.matrixWorld),r.setFromMatrixPosition(y.target.matrixWorld),b.direction.sub(r),b.direction.transformDirection(v),p++}else if(y.isRectAreaLight){const b=e.rectArea[g];b.position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(v),a.identity(),s.copy(y.matrixWorld),s.premultiply(v),a.extractRotation(s),b.halfWidth.set(y.width*.5,0,0),b.halfHeight.set(0,y.height*.5,0),b.halfWidth.applyMatrix4(a),b.halfHeight.applyMatrix4(a),g++}else if(y.isPointLight){const b=e.point[d];b.position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(v),d++}else if(y.isHemisphereLight){const b=e.hemi[m];b.direction.setFromMatrixPosition(y.matrixWorld),b.direction.transformDirection(v),m++}}}return{setup:h,setupView:l,state:e}}function np(o,t){const i=new yb(o,t),n=[],e=[];function r(){n.length=0,e.length=0}function s(u){n.push(u)}function a(u){e.push(u)}function h(u){i.setup(n,u)}function l(u){i.setupView(n,u)}return{init:r,state:{lightsArray:n,shadowsArray:e,lights:i},setupLights:h,setupLightsView:l,pushLight:s,pushShadow:a}}function xb(o,t){let i=new WeakMap;function n(r,s=0){const a=i.get(r);let h;return a===void 0?(h=new np(o,t),i.set(r,[h])):s>=a.length?(h=new np(o,t),a.push(h)):h=a[s],h}function e(){i=new WeakMap}return{get:n,dispose:e}}class wb extends Gi{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=z0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Mb extends Gi{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new G,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const bb=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Sb=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Cb(o,t,i){let n=new zu;const e=new bt,r=new bt,s=new Ve,a=new wb({depthPacking:F0}),h=new Mb,l={},c=i.maxTextureSize,u={0:_i,1:bs,2:On},f=new Nn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new bt},radius:{value:4}},vertexShader:bb,fragmentShader:Sb}),d=f.clone();d.defines.HORIZONTAL_PASS=1;const p=new ae;p.setAttribute("position",new It(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new ei(p,f),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=sm,this.render=function(y,b,M){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||y.length===0)return;const C=o.getRenderTarget(),w=o.getActiveCubeFace(),S=o.getActiveMipmapLevel(),P=o.state;P.setBlending(zn),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);for(let O=0,D=y.length;O<D;O++){const L=y[O],T=L.shadow;if(T===void 0||T.autoUpdate===!1&&T.needsUpdate===!1)continue;e.copy(T.mapSize);const A=T.getFrameExtents();if(e.multiply(A),r.copy(T.mapSize),(e.x>c||e.y>c)&&(e.x>c&&(r.x=Math.floor(c/A.x),e.x=r.x*A.x,T.mapSize.x=r.x),e.y>c&&(r.y=Math.floor(c/A.y),e.y=r.y*A.y,T.mapSize.y=r.y)),T.map===null){const B=this.type!==ho?{minFilter:ii,magFilter:ii}:{};T.map=new an(e.x,e.y,B),T.map.texture.name=L.name+".shadowMap",T.camera.updateProjectionMatrix()}o.setRenderTarget(T.map),o.clear();const N=T.getViewportCount();for(let B=0;B<N;B++){const F=T.getViewport(B);s.set(r.x*F.x,r.y*F.y,r.x*F.z,r.y*F.w),P.viewport(s),T.updateMatrices(L,B),n=T.getFrustum(),_(b,M,T.camera,L,this.type)}T.isPointLightShadow!==!0&&this.type===ho&&v(T,M),T.needsUpdate=!1}m.needsUpdate=!1,o.setRenderTarget(C,w,S)};function v(y,b){const M=t.update(g);f.defines.VSM_SAMPLES!==y.blurSamples&&(f.defines.VSM_SAMPLES=y.blurSamples,d.defines.VSM_SAMPLES=y.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),y.mapPass===null&&(y.mapPass=new an(e.x,e.y)),f.uniforms.shadow_pass.value=y.map.texture,f.uniforms.resolution.value=y.mapSize,f.uniforms.radius.value=y.radius,o.setRenderTarget(y.mapPass),o.clear(),o.renderBufferDirect(b,null,M,f,g,null),d.uniforms.shadow_pass.value=y.mapPass.texture,d.uniforms.resolution.value=y.mapSize,d.uniforms.radius.value=y.radius,o.setRenderTarget(y.map),o.clear(),o.renderBufferDirect(b,null,M,d,g,null)}function x(y,b,M,C,w,S){let P=null;const O=M.isPointLight===!0?y.customDistanceMaterial:y.customDepthMaterial;if(O!==void 0?P=O:P=M.isPointLight===!0?h:a,o.localClippingEnabled&&b.clipShadows===!0&&Array.isArray(b.clippingPlanes)&&b.clippingPlanes.length!==0||b.displacementMap&&b.displacementScale!==0||b.alphaMap&&b.alphaTest>0){const D=P.uuid,L=b.uuid;let T=l[D];T===void 0&&(T={},l[D]=T);let A=T[L];A===void 0&&(A=P.clone(),T[L]=A),P=A}return P.visible=b.visible,P.wireframe=b.wireframe,S===ho?P.side=b.shadowSide!==null?b.shadowSide:b.side:P.side=b.shadowSide!==null?b.shadowSide:u[b.side],P.alphaMap=b.alphaMap,P.alphaTest=b.alphaTest,P.clipShadows=b.clipShadows,P.clippingPlanes=b.clippingPlanes,P.clipIntersection=b.clipIntersection,P.displacementMap=b.displacementMap,P.displacementScale=b.displacementScale,P.displacementBias=b.displacementBias,P.wireframeLinewidth=b.wireframeLinewidth,P.linewidth=b.linewidth,M.isPointLight===!0&&P.isMeshDistanceMaterial===!0&&(P.referencePosition.setFromMatrixPosition(M.matrixWorld),P.nearDistance=C,P.farDistance=w),P}function _(y,b,M,C,w){if(y.visible===!1)return;if(y.layers.test(b.layers)&&(y.isMesh||y.isLine||y.isPoints)&&(y.castShadow||y.receiveShadow&&w===ho)&&(!y.frustumCulled||n.intersectsObject(y))){y.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,y.matrixWorld);const O=t.update(y),D=y.material;if(Array.isArray(D)){const L=O.groups;for(let T=0,A=L.length;T<A;T++){const N=L[T],B=D[N.materialIndex];if(B&&B.visible){const F=x(y,B,C,M.near,M.far,w);o.renderBufferDirect(M,null,O,F,y,N)}}}else if(D.visible){const L=x(y,D,C,M.near,M.far,w);o.renderBufferDirect(M,null,O,L,y,null)}}const P=y.children;for(let O=0,D=P.length;O<D;O++)_(P[O],b,M,C,w)}}function Tb(o,t,i){const n=i.isWebGL2;function e(){let U=!1;const Lt=new Ve;let vt=null;const rt=new Ve(0,0,0,0);return{setMask:function(_t){vt!==_t&&!U&&(o.colorMask(_t,_t,_t,_t),vt=_t)},setLocked:function(_t){U=_t},setClear:function(_t,Ut,pe,Ee,fn){fn===!0&&(_t*=Ee,Ut*=Ee,pe*=Ee),Lt.set(_t,Ut,pe,Ee),rt.equals(Lt)===!1&&(o.clearColor(_t,Ut,pe,Ee),rt.copy(Lt))},reset:function(){U=!1,vt=null,rt.set(-1,0,0,0)}}}function r(){let U=!1,Lt=null,vt=null,rt=null;return{setTest:function(_t){_t?pt(2929):xt(2929)},setMask:function(_t){Lt!==_t&&!U&&(o.depthMask(_t),Lt=_t)},setFunc:function(_t){if(vt!==_t){switch(_t){case o0:o.depthFunc(512);break;case a0:o.depthFunc(519);break;case h0:o.depthFunc(513);break;case qc:o.depthFunc(515);break;case l0:o.depthFunc(514);break;case c0:o.depthFunc(518);break;case u0:o.depthFunc(516);break;case f0:o.depthFunc(517);break;default:o.depthFunc(515)}vt=_t}},setLocked:function(_t){U=_t},setClear:function(_t){rt!==_t&&(o.clearDepth(_t),rt=_t)},reset:function(){U=!1,Lt=null,vt=null,rt=null}}}function s(){let U=!1,Lt=null,vt=null,rt=null,_t=null,Ut=null,pe=null,Ee=null,fn=null;return{setTest:function(Me){U||(Me?pt(2960):xt(2960))},setMask:function(Me){Lt!==Me&&!U&&(o.stencilMask(Me),Lt=Me)},setFunc:function(Me,Wi,hi){(vt!==Me||rt!==Wi||_t!==hi)&&(o.stencilFunc(Me,Wi,hi),vt=Me,rt=Wi,_t=hi)},setOp:function(Me,Wi,hi){(Ut!==Me||pe!==Wi||Ee!==hi)&&(o.stencilOp(Me,Wi,hi),Ut=Me,pe=Wi,Ee=hi)},setLocked:function(Me){U=Me},setClear:function(Me){fn!==Me&&(o.clearStencil(Me),fn=Me)},reset:function(){U=!1,Lt=null,vt=null,rt=null,_t=null,Ut=null,pe=null,Ee=null,fn=null}}}const a=new e,h=new r,l=new s,c=new WeakMap,u=new WeakMap;let f={},d={},p=new WeakMap,g=[],m=null,v=!1,x=null,_=null,y=null,b=null,M=null,C=null,w=null,S=!1,P=null,O=null,D=null,L=null,T=null;const A=o.getParameter(35661);let N=!1,B=0;const F=o.getParameter(7938);F.indexOf("WebGL")!==-1?(B=parseFloat(/^WebGL (\d)/.exec(F)[1]),N=B>=1):F.indexOf("OpenGL ES")!==-1&&(B=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),N=B>=2);let I=null,z={};const Z=o.getParameter(3088),j=o.getParameter(2978),K=new Ve().fromArray(Z),et=new Ve().fromArray(j);function st(U,Lt,vt){const rt=new Uint8Array(4),_t=o.createTexture();o.bindTexture(U,_t),o.texParameteri(U,10241,9728),o.texParameteri(U,10240,9728);for(let Ut=0;Ut<vt;Ut++)o.texImage2D(Lt+Ut,0,6408,1,1,0,6408,5121,rt);return _t}const V={};V[3553]=st(3553,3553,1),V[34067]=st(34067,34069,6),a.setClear(0,0,0,1),h.setClear(1),l.setClear(0),pt(2929),h.setFunc(qc),at(!1),Ft(Xf),pt(2884),lt(zn);function pt(U){f[U]!==!0&&(o.enable(U),f[U]=!0)}function xt(U){f[U]!==!1&&(o.disable(U),f[U]=!1)}function ut(U,Lt){return d[U]!==Lt?(o.bindFramebuffer(U,Lt),d[U]=Lt,n&&(U===36009&&(d[36160]=Lt),U===36160&&(d[36009]=Lt)),!0):!1}function ft(U,Lt){let vt=g,rt=!1;if(U)if(vt=p.get(Lt),vt===void 0&&(vt=[],p.set(Lt,vt)),U.isWebGLMultipleRenderTargets){const _t=U.texture;if(vt.length!==_t.length||vt[0]!==36064){for(let Ut=0,pe=_t.length;Ut<pe;Ut++)vt[Ut]=36064+Ut;vt.length=_t.length,rt=!0}}else vt[0]!==36064&&(vt[0]=36064,rt=!0);else vt[0]!==1029&&(vt[0]=1029,rt=!0);rt&&(i.isWebGL2?o.drawBuffers(vt):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(vt))}function kt(U){return m!==U?(o.useProgram(U),m=U,!0):!1}const J={[rs]:32774,[qy]:32778,[Jy]:32779};if(n)J[Yf]=32775,J[Qf]=32776;else{const U=t.get("EXT_blend_minmax");U!==null&&(J[Yf]=U.MIN_EXT,J[Qf]=U.MAX_EXT)}const Q={[Yy]:0,[Qy]:1,[Ky]:768,[om]:770,[s0]:776,[n0]:774,[e0]:772,[t0]:769,[am]:771,[r0]:775,[i0]:773};function lt(U,Lt,vt,rt,_t,Ut,pe,Ee){if(U===zn){v===!0&&(xt(3042),v=!1);return}if(v===!1&&(pt(3042),v=!0),U!==$y){if(U!==x||Ee!==S){if((_!==rs||M!==rs)&&(o.blendEquation(32774),_=rs,M=rs),Ee)switch(U){case ps:o.blendFuncSeparate(1,771,1,771);break;case $f:o.blendFunc(1,1);break;case qf:o.blendFuncSeparate(0,769,0,1);break;case Jf:o.blendFuncSeparate(0,768,0,770);break;default:break}else switch(U){case ps:o.blendFuncSeparate(770,771,1,771);break;case $f:o.blendFunc(770,1);break;case qf:o.blendFuncSeparate(0,769,0,1);break;case Jf:o.blendFunc(0,768);break;default:break}y=null,b=null,C=null,w=null,x=U,S=Ee}return}_t=_t||Lt,Ut=Ut||vt,pe=pe||rt,(Lt!==_||_t!==M)&&(o.blendEquationSeparate(J[Lt],J[_t]),_=Lt,M=_t),(vt!==y||rt!==b||Ut!==C||pe!==w)&&(o.blendFuncSeparate(Q[vt],Q[rt],Q[Ut],Q[pe]),y=vt,b=rt,C=Ut,w=pe),x=U,S=null}function Ct(U,Lt){U.side===On?xt(2884):pt(2884);let vt=U.side===_i;Lt&&(vt=!vt),at(vt),U.blending===ps&&U.transparent===!1?lt(zn):lt(U.blending,U.blendEquation,U.blendSrc,U.blendDst,U.blendEquationAlpha,U.blendSrcAlpha,U.blendDstAlpha,U.premultipliedAlpha),h.setFunc(U.depthFunc),h.setTest(U.depthTest),h.setMask(U.depthWrite),a.setMask(U.colorWrite);const rt=U.stencilWrite;l.setTest(rt),rt&&(l.setMask(U.stencilWriteMask),l.setFunc(U.stencilFunc,U.stencilRef,U.stencilFuncMask),l.setOp(U.stencilFail,U.stencilZFail,U.stencilZPass)),At(U.polygonOffset,U.polygonOffsetFactor,U.polygonOffsetUnits),U.alphaToCoverage===!0?pt(32926):xt(32926)}function at(U){P!==U&&(U?o.frontFace(2304):o.frontFace(2305),P=U)}function Ft(U){U!==jy?(pt(2884),U!==O&&(U===Xf?o.cullFace(1029):U===Zy?o.cullFace(1028):o.cullFace(1032))):xt(2884),O=U}function Pt(U){U!==D&&(N&&o.lineWidth(U),D=U)}function At(U,Lt,vt){U?(pt(32823),(L!==Lt||T!==vt)&&(o.polygonOffset(Lt,vt),L=Lt,T=vt)):xt(32823)}function ce(U){U?pt(3089):xt(3089)}function re(U){U===void 0&&(U=33984+A-1),I!==U&&(o.activeTexture(U),I=U)}function k(U,Lt,vt){vt===void 0&&(I===null?vt=33984+A-1:vt=I);let rt=z[vt];rt===void 0&&(rt={type:void 0,texture:void 0},z[vt]=rt),(rt.type!==U||rt.texture!==Lt)&&(I!==vt&&(o.activeTexture(vt),I=vt),o.bindTexture(U,Lt||V[U]),rt.type=U,rt.texture=Lt)}function E(){const U=z[I];U!==void 0&&U.type!==void 0&&(o.bindTexture(U.type,null),U.type=void 0,U.texture=void 0)}function Y(){try{o.compressedTexImage2D.apply(o,arguments)}catch{}}function ct(){try{o.texSubImage2D.apply(o,arguments)}catch{}}function gt(){try{o.texSubImage3D.apply(o,arguments)}catch{}}function wt(){try{o.compressedTexSubImage2D.apply(o,arguments)}catch{}}function Gt(){try{o.texStorage2D.apply(o,arguments)}catch{}}function Mt(){try{o.texStorage3D.apply(o,arguments)}catch{}}function nt(){try{o.texImage2D.apply(o,arguments)}catch{}}function Ot(){try{o.texImage3D.apply(o,arguments)}catch{}}function Ht(U){K.equals(U)===!1&&(o.scissor(U.x,U.y,U.z,U.w),K.copy(U))}function Rt(U){et.equals(U)===!1&&(o.viewport(U.x,U.y,U.z,U.w),et.copy(U))}function Dt(U,Lt){let vt=u.get(Lt);vt===void 0&&(vt=new WeakMap,u.set(Lt,vt));let rt=vt.get(U);rt===void 0&&(rt=o.getUniformBlockIndex(Lt,U.name),vt.set(U,rt))}function Wt(U,Lt){const rt=u.get(Lt).get(U);c.get(U)!==rt&&(o.uniformBlockBinding(Lt,rt,U.__bindingPointIndex),c.set(U,rt))}function le(){o.disable(3042),o.disable(2884),o.disable(2929),o.disable(32823),o.disable(3089),o.disable(2960),o.disable(32926),o.blendEquation(32774),o.blendFunc(1,0),o.blendFuncSeparate(1,0,1,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(513),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(519,0,4294967295),o.stencilOp(7680,7680,7680),o.clearStencil(0),o.cullFace(1029),o.frontFace(2305),o.polygonOffset(0,0),o.activeTexture(33984),o.bindFramebuffer(36160,null),n===!0&&(o.bindFramebuffer(36009,null),o.bindFramebuffer(36008,null)),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),f={},I=null,z={},d={},p=new WeakMap,g=[],m=null,v=!1,x=null,_=null,y=null,b=null,M=null,C=null,w=null,S=!1,P=null,O=null,D=null,L=null,T=null,K.set(0,0,o.canvas.width,o.canvas.height),et.set(0,0,o.canvas.width,o.canvas.height),a.reset(),h.reset(),l.reset()}return{buffers:{color:a,depth:h,stencil:l},enable:pt,disable:xt,bindFramebuffer:ut,drawBuffers:ft,useProgram:kt,setBlending:lt,setMaterial:Ct,setFlipSided:at,setCullFace:Ft,setLineWidth:Pt,setPolygonOffset:At,setScissorTest:ce,activeTexture:re,bindTexture:k,unbindTexture:E,compressedTexImage2D:Y,texImage2D:nt,texImage3D:Ot,updateUBOMapping:Dt,uniformBlockBinding:Wt,texStorage2D:Gt,texStorage3D:Mt,texSubImage2D:ct,texSubImage3D:gt,compressedTexSubImage2D:wt,scissor:Ht,viewport:Rt,reset:le}}function Pb(o,t,i,n,e,r,s){const a=e.isWebGL2,h=e.maxTextures,l=e.maxCubemapSize,c=e.maxTextureSize,u=e.maxSamples,f=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,d=/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let g;const m=new WeakMap;let v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function x(k,E){return v?new OffscreenCanvas(k,E):wo("canvas")}function _(k,E,Y,ct){let gt=1;if((k.width>ct||k.height>ct)&&(gt=ct/Math.max(k.width,k.height)),gt<1||E===!0)if(typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&k instanceof ImageBitmap){const wt=E?iu:Math.floor,Gt=wt(gt*k.width),Mt=wt(gt*k.height);g===void 0&&(g=x(Gt,Mt));const nt=Y?x(Gt,Mt):g;return nt.width=Gt,nt.height=Mt,nt.getContext("2d").drawImage(k,0,0,Gt,Mt),nt}else return"data"in k,k;return k}function y(k){return Sd(k.width)&&Sd(k.height)}function b(k){return a?!1:k.wrapS!==Pi||k.wrapT!==Pi||k.minFilter!==ii&&k.minFilter!==pi}function M(k,E){return k.generateMipmaps&&E&&k.minFilter!==ii&&k.minFilter!==pi}function C(k){o.generateMipmap(k)}function w(k,E,Y,ct,gt=!1){if(a===!1)return E;if(k!==null&&o[k]!==void 0)return o[k];let wt=E;return E===6403&&(Y===5126&&(wt=33326),Y===5131&&(wt=33325),Y===5121&&(wt=33321)),E===33319&&(Y===5126&&(wt=33328),Y===5131&&(wt=33327),Y===5121&&(wt=33323)),E===6408&&(Y===5126&&(wt=34836),Y===5131&&(wt=34842),Y===5121&&(wt=ct===Se&&gt===!1?35907:32856),Y===32819&&(wt=32854),Y===32820&&(wt=32855)),(wt===33325||wt===33326||wt===33327||wt===33328||wt===34842||wt===34836)&&t.get("EXT_color_buffer_float"),wt}function S(k,E,Y){return M(k,Y)===!0||k.isFramebufferTexture&&k.minFilter!==ii&&k.minFilter!==pi?Math.log2(Math.max(E.width,E.height))+1:k.mipmaps!==void 0&&k.mipmaps.length>0?k.mipmaps.length:k.isCompressedTexture&&Array.isArray(k.image)?E.mipmaps.length:1}function P(k){return k===ii||k===Kf||k===td?9728:9729}function O(k){const E=k.target;E.removeEventListener("dispose",O),L(E),E.isVideoTexture&&p.delete(E)}function D(k){const E=k.target;E.removeEventListener("dispose",D),A(E)}function L(k){const E=n.get(k);if(E.__webglInit===void 0)return;const Y=k.source,ct=m.get(Y);if(ct){const gt=ct[E.__cacheKey];gt.usedTimes--,gt.usedTimes===0&&T(k),Object.keys(ct).length===0&&m.delete(Y)}n.remove(k)}function T(k){const E=n.get(k);o.deleteTexture(E.__webglTexture);const Y=k.source,ct=m.get(Y);delete ct[E.__cacheKey],s.memory.textures--}function A(k){const E=k.texture,Y=n.get(k),ct=n.get(E);if(ct.__webglTexture!==void 0&&(o.deleteTexture(ct.__webglTexture),s.memory.textures--),k.depthTexture&&k.depthTexture.dispose(),k.isWebGLCubeRenderTarget)for(let gt=0;gt<6;gt++)o.deleteFramebuffer(Y.__webglFramebuffer[gt]),Y.__webglDepthbuffer&&o.deleteRenderbuffer(Y.__webglDepthbuffer[gt]);else{if(o.deleteFramebuffer(Y.__webglFramebuffer),Y.__webglDepthbuffer&&o.deleteRenderbuffer(Y.__webglDepthbuffer),Y.__webglMultisampledFramebuffer&&o.deleteFramebuffer(Y.__webglMultisampledFramebuffer),Y.__webglColorRenderbuffer)for(let gt=0;gt<Y.__webglColorRenderbuffer.length;gt++)Y.__webglColorRenderbuffer[gt]&&o.deleteRenderbuffer(Y.__webglColorRenderbuffer[gt]);Y.__webglDepthRenderbuffer&&o.deleteRenderbuffer(Y.__webglDepthRenderbuffer)}if(k.isWebGLMultipleRenderTargets)for(let gt=0,wt=E.length;gt<wt;gt++){const Gt=n.get(E[gt]);Gt.__webglTexture&&(o.deleteTexture(Gt.__webglTexture),s.memory.textures--),n.remove(E[gt])}n.remove(E),n.remove(k)}let N=0;function B(){N=0}function F(){const k=N;return k>=h,N+=1,k}function I(k){const E=[];return E.push(k.wrapS),E.push(k.wrapT),E.push(k.magFilter),E.push(k.minFilter),E.push(k.anisotropy),E.push(k.internalFormat),E.push(k.format),E.push(k.type),E.push(k.generateMipmaps),E.push(k.premultiplyAlpha),E.push(k.flipY),E.push(k.unpackAlignment),E.push(k.encoding),E.join()}function z(k,E){const Y=n.get(k);if(k.isVideoTexture&&ce(k),k.isRenderTargetTexture===!1&&k.version>0&&Y.__version!==k.version){const ct=k.image;if(ct!==null){if(ct.complete!==!1){xt(Y,k,E);return}}}i.bindTexture(3553,Y.__webglTexture,33984+E)}function Z(k,E){const Y=n.get(k);if(k.version>0&&Y.__version!==k.version){xt(Y,k,E);return}i.bindTexture(35866,Y.__webglTexture,33984+E)}function j(k,E){const Y=n.get(k);if(k.version>0&&Y.__version!==k.version){xt(Y,k,E);return}i.bindTexture(32879,Y.__webglTexture,33984+E)}function K(k,E){const Y=n.get(k);if(k.version>0&&Y.__version!==k.version){ut(Y,k,E);return}i.bindTexture(34067,Y.__webglTexture,33984+E)}const et={[Qc]:10497,[Pi]:33071,[Kc]:33648},st={[ii]:9728,[Kf]:9984,[td]:9986,[pi]:9729,[x0]:9985,[Nh]:9987};function V(k,E,Y){if(Y?(o.texParameteri(k,10242,et[E.wrapS]),o.texParameteri(k,10243,et[E.wrapT]),(k===32879||k===35866)&&o.texParameteri(k,32882,et[E.wrapR]),o.texParameteri(k,10240,st[E.magFilter]),o.texParameteri(k,10241,st[E.minFilter])):(o.texParameteri(k,10242,33071),o.texParameteri(k,10243,33071),(k===32879||k===35866)&&o.texParameteri(k,32882,33071),E.wrapS!==Pi||E.wrapT,o.texParameteri(k,10240,P(E.magFilter)),o.texParameteri(k,10241,P(E.minFilter)),E.minFilter!==ii&&E.minFilter),t.has("EXT_texture_filter_anisotropic")===!0){const ct=t.get("EXT_texture_filter_anisotropic");if(E.type===cr&&t.has("OES_texture_float_linear")===!1||a===!1&&E.type===xo&&t.has("OES_texture_half_float_linear")===!1)return;(E.anisotropy>1||n.get(E).__currentAnisotropy)&&(o.texParameterf(k,ct.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(E.anisotropy,e.getMaxAnisotropy())),n.get(E).__currentAnisotropy=E.anisotropy)}}function pt(k,E){let Y=!1;k.__webglInit===void 0&&(k.__webglInit=!0,E.addEventListener("dispose",O));const ct=E.source;let gt=m.get(ct);gt===void 0&&(gt={},m.set(ct,gt));const wt=I(E);if(wt!==k.__cacheKey){gt[wt]===void 0&&(gt[wt]={texture:o.createTexture(),usedTimes:0},s.memory.textures++,Y=!0),gt[wt].usedTimes++;const Gt=gt[k.__cacheKey];Gt!==void 0&&(gt[k.__cacheKey].usedTimes--,Gt.usedTimes===0&&T(E)),k.__cacheKey=wt,k.__webglTexture=gt[wt].texture}return Y}function xt(k,E,Y){let ct=3553;E.isDataArrayTexture&&(ct=35866),E.isData3DTexture&&(ct=32879);const gt=pt(k,E),wt=E.source;i.bindTexture(ct,k.__webglTexture,33984+Y);const Gt=n.get(wt);if(wt.version!==Gt.__version||gt===!0){i.activeTexture(33984+Y),o.pixelStorei(37440,E.flipY),o.pixelStorei(37441,E.premultiplyAlpha),o.pixelStorei(3317,E.unpackAlignment),o.pixelStorei(37443,0);const Mt=b(E)&&y(E.image)===!1;let nt=_(E.image,Mt,!1,c);nt=re(E,nt);const Ot=y(nt)||a,Ht=r.convert(E.format,E.encoding);let Rt=r.convert(E.type),Dt=w(E.internalFormat,Ht,Rt,E.encoding,E.isVideoTexture);V(ct,E,Ot);let Wt;const le=E.mipmaps,U=a&&E.isVideoTexture!==!0,Lt=Gt.__version===void 0||gt===!0,vt=S(E,nt,Ot);if(E.isDepthTexture)Dt=6402,a?E.type===cr?Dt=36012:E.type===lr?Dt=33190:E.type===gs?Dt=35056:Dt=33189:E.type,E.format===dr&&Dt===6402&&E.type!==lm&&E.type!==lr&&(E.type=lr,Rt=r.convert(E.type)),E.format===Ts&&Dt===6402&&(Dt=34041,E.type!==gs&&(E.type=gs,Rt=r.convert(E.type))),Lt&&(U?i.texStorage2D(3553,1,Dt,nt.width,nt.height):i.texImage2D(3553,0,Dt,nt.width,nt.height,0,Ht,Rt,null));else if(E.isDataTexture)if(le.length>0&&Ot){U&&Lt&&i.texStorage2D(3553,vt,Dt,le[0].width,le[0].height);for(let rt=0,_t=le.length;rt<_t;rt++)Wt=le[rt],U?i.texSubImage2D(3553,rt,0,0,Wt.width,Wt.height,Ht,Rt,Wt.data):i.texImage2D(3553,rt,Dt,Wt.width,Wt.height,0,Ht,Rt,Wt.data);E.generateMipmaps=!1}else U?(Lt&&i.texStorage2D(3553,vt,Dt,nt.width,nt.height),i.texSubImage2D(3553,0,0,0,nt.width,nt.height,Ht,Rt,nt.data)):i.texImage2D(3553,0,Dt,nt.width,nt.height,0,Ht,Rt,nt.data);else if(E.isCompressedTexture){U&&Lt&&i.texStorage2D(3553,vt,Dt,le[0].width,le[0].height);for(let rt=0,_t=le.length;rt<_t;rt++)Wt=le[rt],E.format!==ki?Ht!==null&&(U?i.compressedTexSubImage2D(3553,rt,0,0,Wt.width,Wt.height,Ht,Wt.data):i.compressedTexImage2D(3553,rt,Dt,Wt.width,Wt.height,0,Wt.data)):U?i.texSubImage2D(3553,rt,0,0,Wt.width,Wt.height,Ht,Rt,Wt.data):i.texImage2D(3553,rt,Dt,Wt.width,Wt.height,0,Ht,Rt,Wt.data)}else if(E.isDataArrayTexture)U?(Lt&&i.texStorage3D(35866,vt,Dt,nt.width,nt.height,nt.depth),i.texSubImage3D(35866,0,0,0,0,nt.width,nt.height,nt.depth,Ht,Rt,nt.data)):i.texImage3D(35866,0,Dt,nt.width,nt.height,nt.depth,0,Ht,Rt,nt.data);else if(E.isData3DTexture)U?(Lt&&i.texStorage3D(32879,vt,Dt,nt.width,nt.height,nt.depth),i.texSubImage3D(32879,0,0,0,0,nt.width,nt.height,nt.depth,Ht,Rt,nt.data)):i.texImage3D(32879,0,Dt,nt.width,nt.height,nt.depth,0,Ht,Rt,nt.data);else if(E.isFramebufferTexture){if(Lt)if(U)i.texStorage2D(3553,vt,Dt,nt.width,nt.height);else{let rt=nt.width,_t=nt.height;for(let Ut=0;Ut<vt;Ut++)i.texImage2D(3553,Ut,Dt,rt,_t,0,Ht,Rt,null),rt>>=1,_t>>=1}}else if(le.length>0&&Ot){U&&Lt&&i.texStorage2D(3553,vt,Dt,le[0].width,le[0].height);for(let rt=0,_t=le.length;rt<_t;rt++)Wt=le[rt],U?i.texSubImage2D(3553,rt,0,0,Ht,Rt,Wt):i.texImage2D(3553,rt,Dt,Ht,Rt,Wt);E.generateMipmaps=!1}else U?(Lt&&i.texStorage2D(3553,vt,Dt,nt.width,nt.height),i.texSubImage2D(3553,0,0,0,Ht,Rt,nt)):i.texImage2D(3553,0,Dt,Ht,Rt,nt);M(E,Ot)&&C(ct),Gt.__version=wt.version,E.onUpdate&&E.onUpdate(E)}k.__version=E.version}function ut(k,E,Y){if(E.image.length!==6)return;const ct=pt(k,E),gt=E.source;i.bindTexture(34067,k.__webglTexture,33984+Y);const wt=n.get(gt);if(gt.version!==wt.__version||ct===!0){i.activeTexture(33984+Y),o.pixelStorei(37440,E.flipY),o.pixelStorei(37441,E.premultiplyAlpha),o.pixelStorei(3317,E.unpackAlignment),o.pixelStorei(37443,0);const Gt=E.isCompressedTexture||E.image[0].isCompressedTexture,Mt=E.image[0]&&E.image[0].isDataTexture,nt=[];for(let rt=0;rt<6;rt++)!Gt&&!Mt?nt[rt]=_(E.image[rt],!1,!0,l):nt[rt]=Mt?E.image[rt].image:E.image[rt],nt[rt]=re(E,nt[rt]);const Ot=nt[0],Ht=y(Ot)||a,Rt=r.convert(E.format,E.encoding),Dt=r.convert(E.type),Wt=w(E.internalFormat,Rt,Dt,E.encoding),le=a&&E.isVideoTexture!==!0,U=wt.__version===void 0||ct===!0;let Lt=S(E,Ot,Ht);V(34067,E,Ht);let vt;if(Gt){le&&U&&i.texStorage2D(34067,Lt,Wt,Ot.width,Ot.height);for(let rt=0;rt<6;rt++){vt=nt[rt].mipmaps;for(let _t=0;_t<vt.length;_t++){const Ut=vt[_t];E.format!==ki?Rt!==null&&(le?i.compressedTexSubImage2D(34069+rt,_t,0,0,Ut.width,Ut.height,Rt,Ut.data):i.compressedTexImage2D(34069+rt,_t,Wt,Ut.width,Ut.height,0,Ut.data)):le?i.texSubImage2D(34069+rt,_t,0,0,Ut.width,Ut.height,Rt,Dt,Ut.data):i.texImage2D(34069+rt,_t,Wt,Ut.width,Ut.height,0,Rt,Dt,Ut.data)}}}else{vt=E.mipmaps,le&&U&&(vt.length>0&&Lt++,i.texStorage2D(34067,Lt,Wt,nt[0].width,nt[0].height));for(let rt=0;rt<6;rt++)if(Mt){le?i.texSubImage2D(34069+rt,0,0,0,nt[rt].width,nt[rt].height,Rt,Dt,nt[rt].data):i.texImage2D(34069+rt,0,Wt,nt[rt].width,nt[rt].height,0,Rt,Dt,nt[rt].data);for(let _t=0;_t<vt.length;_t++){const pe=vt[_t].image[rt].image;le?i.texSubImage2D(34069+rt,_t+1,0,0,pe.width,pe.height,Rt,Dt,pe.data):i.texImage2D(34069+rt,_t+1,Wt,pe.width,pe.height,0,Rt,Dt,pe.data)}}else{le?i.texSubImage2D(34069+rt,0,0,0,Rt,Dt,nt[rt]):i.texImage2D(34069+rt,0,Wt,Rt,Dt,nt[rt]);for(let _t=0;_t<vt.length;_t++){const Ut=vt[_t];le?i.texSubImage2D(34069+rt,_t+1,0,0,Rt,Dt,Ut.image[rt]):i.texImage2D(34069+rt,_t+1,Wt,Rt,Dt,Ut.image[rt])}}}M(E,Ht)&&C(34067),wt.__version=gt.version,E.onUpdate&&E.onUpdate(E)}k.__version=E.version}function ft(k,E,Y,ct,gt){const wt=r.convert(Y.format,Y.encoding),Gt=r.convert(Y.type),Mt=w(Y.internalFormat,wt,Gt,Y.encoding);n.get(E).__hasExternalTextures||(gt===32879||gt===35866?i.texImage3D(gt,0,Mt,E.width,E.height,E.depth,0,wt,Gt,null):i.texImage2D(gt,0,Mt,E.width,E.height,0,wt,Gt,null)),i.bindFramebuffer(36160,k),At(E)?f.framebufferTexture2DMultisampleEXT(36160,ct,gt,n.get(Y).__webglTexture,0,Pt(E)):o.framebufferTexture2D(36160,ct,gt,n.get(Y).__webglTexture,0),i.bindFramebuffer(36160,null)}function kt(k,E,Y){if(o.bindRenderbuffer(36161,k),E.depthBuffer&&!E.stencilBuffer){let ct=33189;if(Y||At(E)){const gt=E.depthTexture;gt&&gt.isDepthTexture&&(gt.type===cr?ct=36012:gt.type===lr&&(ct=33190));const wt=Pt(E);At(E)?f.renderbufferStorageMultisampleEXT(36161,wt,ct,E.width,E.height):o.renderbufferStorageMultisample(36161,wt,ct,E.width,E.height)}else o.renderbufferStorage(36161,ct,E.width,E.height);o.framebufferRenderbuffer(36160,36096,36161,k)}else if(E.depthBuffer&&E.stencilBuffer){const ct=Pt(E);Y&&At(E)===!1?o.renderbufferStorageMultisample(36161,ct,35056,E.width,E.height):At(E)?f.renderbufferStorageMultisampleEXT(36161,ct,35056,E.width,E.height):o.renderbufferStorage(36161,34041,E.width,E.height),o.framebufferRenderbuffer(36160,33306,36161,k)}else{const ct=E.isWebGLMultipleRenderTargets===!0?E.texture:[E.texture];for(let gt=0;gt<ct.length;gt++){const wt=ct[gt],Gt=r.convert(wt.format,wt.encoding),Mt=r.convert(wt.type),nt=w(wt.internalFormat,Gt,Mt,wt.encoding),Ot=Pt(E);Y&&At(E)===!1?o.renderbufferStorageMultisample(36161,Ot,nt,E.width,E.height):At(E)?f.renderbufferStorageMultisampleEXT(36161,Ot,nt,E.width,E.height):o.renderbufferStorage(36161,nt,E.width,E.height)}}o.bindRenderbuffer(36161,null)}function J(k,E){if(E&&E.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,k),!(E.depthTexture&&E.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(E.depthTexture).__webglTexture||E.depthTexture.image.width!==E.width||E.depthTexture.image.height!==E.height)&&(E.depthTexture.image.width=E.width,E.depthTexture.image.height=E.height,E.depthTexture.needsUpdate=!0),z(E.depthTexture,0);const ct=n.get(E.depthTexture).__webglTexture,gt=Pt(E);if(E.depthTexture.format===dr)At(E)?f.framebufferTexture2DMultisampleEXT(36160,36096,3553,ct,0,gt):o.framebufferTexture2D(36160,36096,3553,ct,0);else if(E.depthTexture.format===Ts)At(E)?f.framebufferTexture2DMultisampleEXT(36160,33306,3553,ct,0,gt):o.framebufferTexture2D(36160,33306,3553,ct,0);else throw new Error("Unknown depthTexture format")}function Q(k){const E=n.get(k),Y=k.isWebGLCubeRenderTarget===!0;if(k.depthTexture&&!E.__autoAllocateDepthBuffer){if(Y)throw new Error("target.depthTexture not supported in Cube render targets");J(E.__webglFramebuffer,k)}else if(Y){E.__webglDepthbuffer=[];for(let ct=0;ct<6;ct++)i.bindFramebuffer(36160,E.__webglFramebuffer[ct]),E.__webglDepthbuffer[ct]=o.createRenderbuffer(),kt(E.__webglDepthbuffer[ct],k,!1)}else i.bindFramebuffer(36160,E.__webglFramebuffer),E.__webglDepthbuffer=o.createRenderbuffer(),kt(E.__webglDepthbuffer,k,!1);i.bindFramebuffer(36160,null)}function lt(k,E,Y){const ct=n.get(k);E!==void 0&&ft(ct.__webglFramebuffer,k,k.texture,36064,3553),Y!==void 0&&Q(k)}function Ct(k){const E=k.texture,Y=n.get(k),ct=n.get(E);k.addEventListener("dispose",D),k.isWebGLMultipleRenderTargets!==!0&&(ct.__webglTexture===void 0&&(ct.__webglTexture=o.createTexture()),ct.__version=E.version,s.memory.textures++);const gt=k.isWebGLCubeRenderTarget===!0,wt=k.isWebGLMultipleRenderTargets===!0,Gt=y(k)||a;if(gt){Y.__webglFramebuffer=[];for(let Mt=0;Mt<6;Mt++)Y.__webglFramebuffer[Mt]=o.createFramebuffer()}else{if(Y.__webglFramebuffer=o.createFramebuffer(),wt&&e.drawBuffers){const Mt=k.texture;for(let nt=0,Ot=Mt.length;nt<Ot;nt++){const Ht=n.get(Mt[nt]);Ht.__webglTexture===void 0&&(Ht.__webglTexture=o.createTexture(),s.memory.textures++)}}if(a&&k.samples>0&&At(k)===!1){const Mt=wt?E:[E];Y.__webglMultisampledFramebuffer=o.createFramebuffer(),Y.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,Y.__webglMultisampledFramebuffer);for(let nt=0;nt<Mt.length;nt++){const Ot=Mt[nt];Y.__webglColorRenderbuffer[nt]=o.createRenderbuffer(),o.bindRenderbuffer(36161,Y.__webglColorRenderbuffer[nt]);const Ht=r.convert(Ot.format,Ot.encoding),Rt=r.convert(Ot.type),Dt=w(Ot.internalFormat,Ht,Rt,Ot.encoding,k.isXRRenderTarget===!0),Wt=Pt(k);o.renderbufferStorageMultisample(36161,Wt,Dt,k.width,k.height),o.framebufferRenderbuffer(36160,36064+nt,36161,Y.__webglColorRenderbuffer[nt])}o.bindRenderbuffer(36161,null),k.depthBuffer&&(Y.__webglDepthRenderbuffer=o.createRenderbuffer(),kt(Y.__webglDepthRenderbuffer,k,!0)),i.bindFramebuffer(36160,null)}}if(gt){i.bindTexture(34067,ct.__webglTexture),V(34067,E,Gt);for(let Mt=0;Mt<6;Mt++)ft(Y.__webglFramebuffer[Mt],k,E,36064,34069+Mt);M(E,Gt)&&C(34067),i.unbindTexture()}else if(wt){const Mt=k.texture;for(let nt=0,Ot=Mt.length;nt<Ot;nt++){const Ht=Mt[nt],Rt=n.get(Ht);i.bindTexture(3553,Rt.__webglTexture),V(3553,Ht,Gt),ft(Y.__webglFramebuffer,k,Ht,36064+nt,3553),M(Ht,Gt)&&C(3553)}i.unbindTexture()}else{let Mt=3553;(k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&a&&(Mt=k.isWebGL3DRenderTarget?32879:35866),i.bindTexture(Mt,ct.__webglTexture),V(Mt,E,Gt),ft(Y.__webglFramebuffer,k,E,36064,Mt),M(E,Gt)&&C(Mt),i.unbindTexture()}k.depthBuffer&&Q(k)}function at(k){const E=y(k)||a,Y=k.isWebGLMultipleRenderTargets===!0?k.texture:[k.texture];for(let ct=0,gt=Y.length;ct<gt;ct++){const wt=Y[ct];if(M(wt,E)){const Gt=k.isWebGLCubeRenderTarget?34067:3553,Mt=n.get(wt).__webglTexture;i.bindTexture(Gt,Mt),C(Gt),i.unbindTexture()}}}function Ft(k){if(a&&k.samples>0&&At(k)===!1){const E=k.isWebGLMultipleRenderTargets?k.texture:[k.texture],Y=k.width,ct=k.height;let gt=16384;const wt=[],Gt=k.stencilBuffer?33306:36096,Mt=n.get(k),nt=k.isWebGLMultipleRenderTargets===!0;if(nt)for(let Ot=0;Ot<E.length;Ot++)i.bindFramebuffer(36160,Mt.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064+Ot,36161,null),i.bindFramebuffer(36160,Mt.__webglFramebuffer),o.framebufferTexture2D(36009,36064+Ot,3553,null,0);i.bindFramebuffer(36008,Mt.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Mt.__webglFramebuffer);for(let Ot=0;Ot<E.length;Ot++){wt.push(36064+Ot),k.depthBuffer&&wt.push(Gt);const Ht=Mt.__ignoreDepthValues!==void 0?Mt.__ignoreDepthValues:!1;if(Ht===!1&&(k.depthBuffer&&(gt|=256),k.stencilBuffer&&(gt|=1024)),nt&&o.framebufferRenderbuffer(36008,36064,36161,Mt.__webglColorRenderbuffer[Ot]),Ht===!0&&(o.invalidateFramebuffer(36008,[Gt]),o.invalidateFramebuffer(36009,[Gt])),nt){const Rt=n.get(E[Ot]).__webglTexture;o.framebufferTexture2D(36009,36064,3553,Rt,0)}o.blitFramebuffer(0,0,Y,ct,0,0,Y,ct,gt,9728),d&&o.invalidateFramebuffer(36008,wt)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),nt)for(let Ot=0;Ot<E.length;Ot++){i.bindFramebuffer(36160,Mt.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064+Ot,36161,Mt.__webglColorRenderbuffer[Ot]);const Ht=n.get(E[Ot]).__webglTexture;i.bindFramebuffer(36160,Mt.__webglFramebuffer),o.framebufferTexture2D(36009,36064+Ot,3553,Ht,0)}i.bindFramebuffer(36009,Mt.__webglMultisampledFramebuffer)}}function Pt(k){return Math.min(u,k.samples)}function At(k){const E=n.get(k);return a&&k.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&E.__useRenderToTexture!==!1}function ce(k){const E=s.render.frame;p.get(k)!==E&&(p.set(k,E),k.update())}function re(k,E){const Y=k.encoding,ct=k.format,gt=k.type;return k.isCompressedTexture===!0||k.isVideoTexture===!0||k.format===eu||Y!==xr&&Y===Se&&a===!1&&(t.has("EXT_sRGB")===!0&&ct===ki?(k.format=eu,k.minFilter=pi,k.generateMipmaps=!1):E=dm.sRGBToLinear(E)),E}this.allocateTextureUnit=F,this.resetTextureUnits=B,this.setTexture2D=z,this.setTexture2DArray=Z,this.setTexture3D=j,this.setTextureCube=K,this.rebindTextures=lt,this.setupRenderTarget=Ct,this.updateRenderTargetMipmap=at,this.updateMultisampleRenderTarget=Ft,this.setupDepthRenderbuffer=Q,this.setupFrameBufferTexture=ft,this.useMultisampledRTT=At}function Eb(o,t,i){const n=i.isWebGL2;function e(r,s=null){let a;if(r===yr)return 5121;if(r===S0)return 32819;if(r===C0)return 32820;if(r===w0)return 5120;if(r===M0)return 5122;if(r===lm)return 5123;if(r===b0)return 5124;if(r===lr)return 5125;if(r===cr)return 5126;if(r===xo)return n?5131:(a=t.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===T0)return 6406;if(r===ki)return 6408;if(r===E0)return 6409;if(r===A0)return 6410;if(r===dr)return 6402;if(r===Ts)return 34041;if(r===L0)return 6403;if(r===P0)return 6408;if(r===eu)return a=t.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===R0)return 36244;if(r===O0)return 33319;if(r===D0)return 33320;if(r===I0)return 36249;if(r===pl||r===gl||r===ml||r===vl)if(s===Se)if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===pl)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===gl)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===ml)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===vl)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===pl)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===gl)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===ml)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===vl)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===ed||r===id||r===nd||r===rd)if(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===ed)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===id)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===nd)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===rd)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===k0)return a=t.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===sd||r===od)if(a=t.get("WEBGL_compressed_texture_etc"),a!==null){if(r===sd)return s===Se?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===od)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===ad||r===hd||r===ld||r===cd||r===ud||r===fd||r===dd||r===pd||r===gd||r===md||r===vd||r===_d||r===yd||r===xd)if(a=t.get("WEBGL_compressed_texture_astc"),a!==null){if(r===ad)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===hd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===ld)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===cd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===ud)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===fd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===dd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===pd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===gd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===md)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===vd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===_d)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===yd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===xd)return s===Se?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===wd)if(a=t.get("EXT_texture_compression_bptc"),a!==null){if(r===wd)return s===Se?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return r===gs?n?34042:(a=t.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):o[r]!==void 0?o[r]:null}return{convert:e}}class Ab extends gi{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class ls extends Te{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Lb={type:"move"};class jl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ls,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ls,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new G,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new G),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ls,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new G,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new G),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,n){let e=null,r=null,s=null;const a=this._targetRay,h=this._grip,l=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(l&&t.hand){s=!0;for(const g of t.hand.values()){const m=i.getJointPose(g,n);if(l.joints[g.jointName]===void 0){const x=new ls;x.matrixAutoUpdate=!1,x.visible=!1,l.joints[g.jointName]=x,l.add(x)}const v=l.joints[g.jointName];m!==null&&(v.matrix.fromArray(m.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=m.radius),v.visible=m!==null}const c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],f=c.position.distanceTo(u.position),d=.02,p=.005;l.inputState.pinching&&f>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&f<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else h!==null&&t.gripSpace&&(r=i.getPose(t.gripSpace,n),r!==null&&(h.matrix.fromArray(r.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),r.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(r.linearVelocity)):h.hasLinearVelocity=!1,r.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(r.angularVelocity)):h.hasAngularVelocity=!1));a!==null&&(e=i.getPose(t.targetRaySpace,n),e===null&&r!==null&&(e=r),e!==null&&(a.matrix.fromArray(e.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),e.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(e.linearVelocity)):a.hasLinearVelocity=!1,e.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(e.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Lb)))}return a!==null&&(a.visible=e!==null),h!==null&&(h.visible=r!==null),l!==null&&(l.visible=s!==null),this}}class Rb extends xi{constructor(t,i,n,e,r,s,a,h,l,c){if(c=c!==void 0?c:dr,c!==dr&&c!==Ts)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&c===dr&&(n=lr),n===void 0&&c===Ts&&(n=gs),super(null,e,r,s,a,h,c,n,l),this.isDepthTexture=!0,this.image={width:t,height:i},this.magFilter=a!==void 0?a:ii,this.minFilter=h!==void 0?h:ii,this.flipY=!1,this.generateMipmaps=!1}}class Ob extends Ls{constructor(t,i){super();const n=this;let e=null,r=1,s=null,a="local-floor",h=null,l=null,c=null,u=null,f=null,d=null;const p=i.getContextAttributes();let g=null,m=null;const v=[],x=[],_=new gi;_.layers.enable(1),_.viewport=new Ve;const y=new gi;y.layers.enable(2),y.viewport=new Ve;const b=[_,y],M=new Ab;M.layers.enable(1),M.layers.enable(2);let C=null,w=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(I){let z=v[I];return z===void 0&&(z=new jl,v[I]=z),z.getTargetRaySpace()},this.getControllerGrip=function(I){let z=v[I];return z===void 0&&(z=new jl,v[I]=z),z.getGripSpace()},this.getHand=function(I){let z=v[I];return z===void 0&&(z=new jl,v[I]=z),z.getHandSpace()};function S(I){const z=x.indexOf(I.inputSource);if(z===-1)return;const Z=v[z];Z!==void 0&&Z.dispatchEvent({type:I.type,data:I.inputSource})}function P(){e.removeEventListener("select",S),e.removeEventListener("selectstart",S),e.removeEventListener("selectend",S),e.removeEventListener("squeeze",S),e.removeEventListener("squeezestart",S),e.removeEventListener("squeezeend",S),e.removeEventListener("end",P),e.removeEventListener("inputsourceschange",O);for(let I=0;I<v.length;I++){const z=x[I];z!==null&&(x[I]=null,v[I].disconnect(z))}C=null,w=null,t.setRenderTarget(g),f=null,u=null,c=null,e=null,m=null,F.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(I){r=I,n.isPresenting},this.setReferenceSpaceType=function(I){a=I,n.isPresenting},this.getReferenceSpace=function(){return h||s},this.setReferenceSpace=function(I){h=I},this.getBaseLayer=function(){return u!==null?u:f},this.getBinding=function(){return c},this.getFrame=function(){return d},this.getSession=function(){return e},this.setSession=async function(I){if(e=I,e!==null){if(g=t.getRenderTarget(),e.addEventListener("select",S),e.addEventListener("selectstart",S),e.addEventListener("selectend",S),e.addEventListener("squeeze",S),e.addEventListener("squeezestart",S),e.addEventListener("squeezeend",S),e.addEventListener("end",P),e.addEventListener("inputsourceschange",O),p.xrCompatible!==!0&&await i.makeXRCompatible(),e.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const z={antialias:e.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(e,i,z),e.updateRenderState({baseLayer:f}),m=new an(f.framebufferWidth,f.framebufferHeight,{format:ki,type:yr,encoding:t.outputEncoding,stencilBuffer:p.stencil})}else{let z=null,Z=null,j=null;p.depth&&(j=p.stencil?35056:33190,z=p.stencil?Ts:dr,Z=p.stencil?gs:lr);const K={colorFormat:32856,depthFormat:j,scaleFactor:r};c=new XRWebGLBinding(e,i),u=c.createProjectionLayer(K),e.updateRenderState({layers:[u]}),m=new an(u.textureWidth,u.textureHeight,{format:ki,type:yr,depthTexture:new Rb(u.textureWidth,u.textureHeight,Z,void 0,void 0,void 0,void 0,void 0,void 0,z),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0});const et=t.properties.get(m);et.__ignoreDepthValues=u.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),h=null,s=await e.requestReferenceSpace(a),F.setContext(e),F.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function O(I){for(let z=0;z<I.removed.length;z++){const Z=I.removed[z],j=x.indexOf(Z);j>=0&&(x[j]=null,v[j].dispatchEvent({type:"disconnected",data:Z}))}for(let z=0;z<I.added.length;z++){const Z=I.added[z];let j=x.indexOf(Z);if(j===-1){for(let et=0;et<v.length;et++)if(et>=x.length){x.push(Z),j=et;break}else if(x[et]===null){x[et]=Z,j=et;break}if(j===-1)break}const K=v[j];K&&K.dispatchEvent({type:"connected",data:Z})}}const D=new G,L=new G;function T(I,z,Z){D.setFromMatrixPosition(z.matrixWorld),L.setFromMatrixPosition(Z.matrixWorld);const j=D.distanceTo(L),K=z.projectionMatrix.elements,et=Z.projectionMatrix.elements,st=K[14]/(K[10]-1),V=K[14]/(K[10]+1),pt=(K[9]+1)/K[5],xt=(K[9]-1)/K[5],ut=(K[8]-1)/K[0],ft=(et[8]+1)/et[0],kt=st*ut,J=st*ft,Q=j/(-ut+ft),lt=Q*-ut;z.matrixWorld.decompose(I.position,I.quaternion,I.scale),I.translateX(lt),I.translateZ(Q),I.matrixWorld.compose(I.position,I.quaternion,I.scale),I.matrixWorldInverse.copy(I.matrixWorld).invert();const Ct=st+Q,at=V+Q,Ft=kt-lt,Pt=J+(j-lt),At=pt*V/at*Ct,ce=xt*V/at*Ct;I.projectionMatrix.makePerspective(Ft,Pt,At,ce,Ct,at)}function A(I,z){z===null?I.matrixWorld.copy(I.matrix):I.matrixWorld.multiplyMatrices(z.matrixWorld,I.matrix),I.matrixWorldInverse.copy(I.matrixWorld).invert()}this.updateCamera=function(I){if(e===null)return;M.near=y.near=_.near=I.near,M.far=y.far=_.far=I.far,(C!==M.near||w!==M.far)&&(e.updateRenderState({depthNear:M.near,depthFar:M.far}),C=M.near,w=M.far);const z=I.parent,Z=M.cameras;A(M,z);for(let K=0;K<Z.length;K++)A(Z[K],z);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),I.matrix.copy(M.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale);const j=I.children;for(let K=0,et=j.length;K<et;K++)j[K].updateMatrixWorld(!0);Z.length===2?T(M,_,y):M.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){if(u!==null)return u.fixedFoveation;if(f!==null)return f.fixedFoveation},this.setFoveation=function(I){u!==null&&(u.fixedFoveation=I),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=I)};let N=null;function B(I,z){if(l=z.getViewerPose(h||s),d=z,l!==null){const Z=l.views;f!==null&&(t.setRenderTargetFramebuffer(m,f.framebuffer),t.setRenderTarget(m));let j=!1;Z.length!==M.cameras.length&&(M.cameras.length=0,j=!0);for(let K=0;K<Z.length;K++){const et=Z[K];let st=null;if(f!==null)st=f.getViewport(et);else{const pt=c.getViewSubImage(u,et);st=pt.viewport,K===0&&(t.setRenderTargetTextures(m,pt.colorTexture,u.ignoreDepthValues?void 0:pt.depthStencilTexture),t.setRenderTarget(m))}let V=b[K];V===void 0&&(V=new gi,V.layers.enable(K),V.viewport=new Ve,b[K]=V),V.matrix.fromArray(et.transform.matrix),V.projectionMatrix.fromArray(et.projectionMatrix),V.viewport.set(st.x,st.y,st.width,st.height),K===0&&M.matrix.copy(V.matrix),j===!0&&M.cameras.push(V)}}for(let Z=0;Z<v.length;Z++){const j=x[Z],K=v[Z];j!==null&&K!==void 0&&K.update(j,z,h||s)}N&&N(I,z),d=null}const F=new ym;F.setAnimationLoop(B),this.setAnimationLoop=function(I){N=I},this.dispose=function(){}}}function Db(o,t){function i(g,m){g.fogColor.value.copy(m.color),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function n(g,m,v,x,_){m.isMeshBasicMaterial||m.isMeshLambertMaterial?e(g,m):m.isMeshToonMaterial?(e(g,m),c(g,m)):m.isMeshPhongMaterial?(e(g,m),l(g,m)):m.isMeshStandardMaterial?(e(g,m),u(g,m),m.isMeshPhysicalMaterial&&f(g,m,_)):m.isMeshMatcapMaterial?(e(g,m),d(g,m)):m.isMeshDepthMaterial?e(g,m):m.isMeshDistanceMaterial?(e(g,m),p(g,m)):m.isMeshNormalMaterial?e(g,m):m.isLineBasicMaterial?(r(g,m),m.isLineDashedMaterial&&s(g,m)):m.isPointsMaterial?a(g,m,v,x):m.isSpriteMaterial?h(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function e(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===_i&&(g.bumpScale.value*=-1)),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===_i&&g.normalScale.value.negate()),m.specularMap&&(g.specularMap.value=m.specularMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const v=t.get(m).envMap;if(v&&(g.envMap.value=v,g.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap){g.lightMap.value=m.lightMap;const y=o.physicallyCorrectLights!==!0?Math.PI:1;g.lightMapIntensity.value=m.lightMapIntensity*y}m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity);let x;m.map?x=m.map:m.specularMap?x=m.specularMap:m.displacementMap?x=m.displacementMap:m.normalMap?x=m.normalMap:m.bumpMap?x=m.bumpMap:m.roughnessMap?x=m.roughnessMap:m.metalnessMap?x=m.metalnessMap:m.alphaMap?x=m.alphaMap:m.emissiveMap?x=m.emissiveMap:m.clearcoatMap?x=m.clearcoatMap:m.clearcoatNormalMap?x=m.clearcoatNormalMap:m.clearcoatRoughnessMap?x=m.clearcoatRoughnessMap:m.iridescenceMap?x=m.iridescenceMap:m.iridescenceThicknessMap?x=m.iridescenceThicknessMap:m.specularIntensityMap?x=m.specularIntensityMap:m.specularColorMap?x=m.specularColorMap:m.transmissionMap?x=m.transmissionMap:m.thicknessMap?x=m.thicknessMap:m.sheenColorMap?x=m.sheenColorMap:m.sheenRoughnessMap&&(x=m.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),g.uvTransform.value.copy(x.matrix));let _;m.aoMap?_=m.aoMap:m.lightMap&&(_=m.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),g.uv2Transform.value.copy(_.matrix))}function r(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity}function s(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function a(g,m,v,x){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*v,g.scale.value=x*.5,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let _;m.map?_=m.map:m.alphaMap&&(_=m.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),g.uvTransform.value.copy(_.matrix))}function h(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let v;m.map?v=m.map:m.alphaMap&&(v=m.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),g.uvTransform.value.copy(v.matrix))}function l(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function c(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function u(g,m){g.roughness.value=m.roughness,g.metalness.value=m.metalness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap),t.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function f(g,m,v){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),g.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===_i&&g.clearcoatNormalScale.value.negate())),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap)),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap)}function d(g,m){m.matcap&&(g.matcap.value=m.matcap)}function p(g,m){g.referencePosition.value.copy(m.referencePosition),g.nearDistance.value=m.nearDistance,g.farDistance.value=m.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:n}}function Ib(o,t,i,n){let e={},r={},s=[];const a=i.isWebGL2?o.getParameter(35375):0;function h(x,_){const y=_.program;n.uniformBlockBinding(x,y)}function l(x,_){let y=e[x.id];y===void 0&&(p(x),y=c(x),e[x.id]=y,x.addEventListener("dispose",m));const b=_.program;n.updateUBOMapping(x,b);const M=t.render.frame;r[x.id]!==M&&(f(x),r[x.id]=M)}function c(x){const _=u();x.__bindingPointIndex=_;const y=o.createBuffer(),b=x.__size,M=x.usage;return o.bindBuffer(35345,y),o.bufferData(35345,b,M),o.bindBuffer(35345,null),o.bindBufferBase(35345,_,y),y}function u(){for(let x=0;x<a;x++)if(s.indexOf(x)===-1)return s.push(x),x;return 0}function f(x){const _=e[x.id],y=x.uniforms,b=x.__cache;o.bindBuffer(35345,_);for(let M=0,C=y.length;M<C;M++){const w=y[M];if(d(w,M,b)===!0){const S=w.value,P=w.__offset;typeof S=="number"?(w.__data[0]=S,o.bufferSubData(35345,P,w.__data)):(w.value.isMatrix3?(w.__data[0]=w.value.elements[0],w.__data[1]=w.value.elements[1],w.__data[2]=w.value.elements[2],w.__data[3]=w.value.elements[0],w.__data[4]=w.value.elements[3],w.__data[5]=w.value.elements[4],w.__data[6]=w.value.elements[5],w.__data[7]=w.value.elements[0],w.__data[8]=w.value.elements[6],w.__data[9]=w.value.elements[7],w.__data[10]=w.value.elements[8],w.__data[11]=w.value.elements[0]):S.toArray(w.__data),o.bufferSubData(35345,P,w.__data))}}o.bindBuffer(35345,null)}function d(x,_,y){const b=x.value;if(y[_]===void 0)return typeof b=="number"?y[_]=b:y[_]=b.clone(),!0;if(typeof b=="number"){if(y[_]!==b)return y[_]=b,!0}else{const M=y[_];if(M.equals(b)===!1)return M.copy(b),!0}return!1}function p(x){const _=x.uniforms;let y=0;const b=16;let M=0;for(let C=0,w=_.length;C<w;C++){const S=_[C],P=g(S);if(S.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),S.__offset=y,C>0){M=y%b;const O=b-M;M!==0&&O-P.boundary<0&&(y+=b-M,S.__offset=y)}y+=P.storage}return M=y%b,M>0&&(y+=b-M),x.__size=y,x.__cache={},this}function g(x){const _=x.value,y={boundary:0,storage:0};return typeof _=="number"?(y.boundary=4,y.storage=4):_.isVector2?(y.boundary=8,y.storage=8):_.isVector3||_.isColor?(y.boundary=16,y.storage=12):_.isVector4?(y.boundary=16,y.storage=16):_.isMatrix3?(y.boundary=48,y.storage=48):_.isMatrix4?(y.boundary=64,y.storage=64):_.isTexture,y}function m(x){const _=x.target;_.removeEventListener("dispose",m);const y=s.indexOf(_.__bindingPointIndex);s.splice(y,1),o.deleteBuffer(e[_.id]),delete e[_.id],delete r[_.id]}function v(){for(const x in e)o.deleteBuffer(e[x]);s=[],e={},r={}}return{bind:h,update:l,dispose:v}}function kb(){const o=wo("canvas");return o.style.display="block",o}function Cm(o={}){this.isWebGLRenderer=!0;const t=o.canvas!==void 0?o.canvas:kb(),i=o.context!==void 0?o.context:null,n=o.depth!==void 0?o.depth:!0,e=o.stencil!==void 0?o.stencil:!0,r=o.antialias!==void 0?o.antialias:!1,s=o.premultipliedAlpha!==void 0?o.premultipliedAlpha:!0,a=o.preserveDrawingBuffer!==void 0?o.preserveDrawingBuffer:!1,h=o.powerPreference!==void 0?o.powerPreference:"default",l=o.failIfMajorPerformanceCaveat!==void 0?o.failIfMajorPerformanceCaveat:!1;let c;i!==null?c=i.getContextAttributes().alpha:c=o.alpha!==void 0?o.alpha:!1;let u=null,f=null;const d=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=xr,this.physicallyCorrectLights=!1,this.toneMapping=rn,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return 2},set:function(){}}});const g=this;let m=!1,v=0,x=0,_=null,y=-1,b=null;const M=new Ve,C=new Ve;let w=null,S=t.width,P=t.height,O=1,D=null,L=null;const T=new Ve(0,0,S,P),A=new Ve(0,0,S,P);let N=!1;const B=new zu;let F=!1,I=!1,z=null;const Z=new ve,j=new bt,K=new G,et={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function st(){return _===null?O:1}let V=i;function pt(R,$){for(let tt=0;tt<R.length;tt++){const X=R[tt],it=t.getContext(X,$);if(it!==null)return it}return null}try{const R={alpha:!0,depth:n,stencil:e,antialias:r,premultipliedAlpha:s,preserveDrawingBuffer:a,powerPreference:h,failIfMajorPerformanceCaveat:l};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Go}`),t.addEventListener("webglcontextlost",Dt,!1),t.addEventListener("webglcontextrestored",Wt,!1),t.addEventListener("webglcontextcreationerror",le,!1),V===null){const $=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&$.shift(),V=pt($,R),V===null)throw pt($)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}V.getShaderPrecisionFormat===void 0&&(V.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(R){throw R}let xt,ut,ft,kt,J,Q,lt,Ct,at,Ft,Pt,At,ce,re,k,E,Y,ct,gt,wt,Gt,Mt,nt,Ot;function Ht(){xt=new ZM(V),ut=new GM(V,xt,o),xt.init(ut),Mt=new Eb(V,xt,ut),ft=new Tb(V,xt,ut),kt=new qM,J=new fb,Q=new Pb(V,xt,ft,J,ut,Mt,kt),lt=new UM(g),Ct=new jM(g),at=new ox(V,ut),nt=new NM(V,xt,at,ut),Ft=new XM(V,at,kt,nt),Pt=new KM(V,Ft,at,kt),gt=new QM(V,ut,Q),E=new HM(J),At=new ub(g,lt,Ct,xt,ut,nt,E),ce=new Db(g,J),re=new pb,k=new xb(xt,ut),ct=new FM(g,lt,ft,Pt,c,s),Y=new Cb(g,Pt,ut),Ot=new Ib(V,kt,ut,ft),wt=new BM(V,xt,kt,ut),Gt=new $M(V,xt,kt,ut),kt.programs=At.programs,g.capabilities=ut,g.extensions=xt,g.properties=J,g.renderLists=re,g.shadowMap=Y,g.state=ft,g.info=kt}Ht();const Rt=new Ob(g,V);this.xr=Rt,this.getContext=function(){return V},this.getContextAttributes=function(){return V.getContextAttributes()},this.forceContextLoss=function(){const R=xt.get("WEBGL_lose_context");R&&R.loseContext()},this.forceContextRestore=function(){const R=xt.get("WEBGL_lose_context");R&&R.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(R){R!==void 0&&(O=R,this.setSize(S,P,!1))},this.getSize=function(R){return R.set(S,P)},this.setSize=function(R,$,tt){Rt.isPresenting||(S=R,P=$,t.width=Math.floor(R*O),t.height=Math.floor($*O),tt!==!1&&(t.style.width=R+"px",t.style.height=$+"px"),this.setViewport(0,0,R,$))},this.getDrawingBufferSize=function(R){return R.set(S*O,P*O).floor()},this.setDrawingBufferSize=function(R,$,tt){S=R,P=$,O=tt,t.width=Math.floor(R*tt),t.height=Math.floor($*tt),this.setViewport(0,0,R,$)},this.getCurrentViewport=function(R){return R.copy(M)},this.getViewport=function(R){return R.copy(T)},this.setViewport=function(R,$,tt,X){R.isVector4?T.set(R.x,R.y,R.z,R.w):T.set(R,$,tt,X),ft.viewport(M.copy(T).multiplyScalar(O).floor())},this.getScissor=function(R){return R.copy(A)},this.setScissor=function(R,$,tt,X){R.isVector4?A.set(R.x,R.y,R.z,R.w):A.set(R,$,tt,X),ft.scissor(C.copy(A).multiplyScalar(O).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(R){ft.setScissorTest(N=R)},this.setOpaqueSort=function(R){D=R},this.setTransparentSort=function(R){L=R},this.getClearColor=function(R){return R.copy(ct.getClearColor())},this.setClearColor=function(){ct.setClearColor.apply(ct,arguments)},this.getClearAlpha=function(){return ct.getClearAlpha()},this.setClearAlpha=function(){ct.setClearAlpha.apply(ct,arguments)},this.clear=function(R=!0,$=!0,tt=!0){let X=0;R&&(X|=16384),$&&(X|=256),tt&&(X|=1024),V.clear(X)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Dt,!1),t.removeEventListener("webglcontextrestored",Wt,!1),t.removeEventListener("webglcontextcreationerror",le,!1),re.dispose(),k.dispose(),J.dispose(),lt.dispose(),Ct.dispose(),Pt.dispose(),nt.dispose(),Ot.dispose(),At.dispose(),Rt.dispose(),Rt.removeEventListener("sessionstart",Ut),Rt.removeEventListener("sessionend",pe),z&&(z.dispose(),z=null),Ee.stop()};function Dt(R){R.preventDefault(),m=!0}function Wt(){m=!1;const R=kt.autoReset,$=Y.enabled,tt=Y.autoUpdate,X=Y.needsUpdate,it=Y.type;Ht(),kt.autoReset=R,Y.enabled=$,Y.autoUpdate=tt,Y.needsUpdate=X,Y.type=it}function le(R){}function U(R){const $=R.target;$.removeEventListener("dispose",U),Lt($)}function Lt(R){vt(R),J.remove(R)}function vt(R){const $=J.get(R).programs;$!==void 0&&($.forEach(function(tt){At.releaseProgram(tt)}),R.isShaderMaterial&&At.releaseShaderCache(R))}this.renderBufferDirect=function(R,$,tt,X,it,zt){$===null&&($=et);const Zt=it.isMesh&&it.matrixWorld.determinant()<0,Yt=zy(R,$,tt,X,it);ft.setMaterial(X,Zt);let $t=tt.index;const he=tt.attributes.position;if($t===null){if(he===void 0||he.count===0)return}else if($t.count===0)return;let Kt=1;X.wireframe===!0&&($t=Ft.getWireframeAttribute(tt),Kt=2),nt.setup(it,X,Yt,tt,$t);let te,be=wt;$t!==null&&(te=at.get($t),be=Gt,be.setIndex(te));const Jn=$t!==null?$t.count:he.count,Ir=tt.drawRange.start*Kt,kr=tt.drawRange.count*Kt,Di=zt!==null?zt.start*Kt:0,se=zt!==null?zt.count*Kt:1/0,zr=Math.max(Ir,Di),Re=Math.min(Jn,Ir+kr,Di+se)-1,li=Math.max(0,Re-zr+1);if(li!==0){if(it.isMesh)X.wireframe===!0?(ft.setLineWidth(X.wireframeLinewidth*st()),be.setMode(1)):be.setMode(4);else if(it.isLine){let dn=X.linewidth;dn===void 0&&(dn=1),ft.setLineWidth(dn*st()),it.isLineSegments?be.setMode(1):it.isLineLoop?be.setMode(2):be.setMode(3)}else it.isPoints?be.setMode(0):it.isSprite&&be.setMode(4);if(it.isInstancedMesh)be.renderInstances(zr,li,it.count);else if(tt.isInstancedBufferGeometry){const dn=Math.min(tt.instanceCount,tt._maxInstanceCount);be.renderInstances(zr,li,dn)}else be.render(zr,li)}},this.compile=function(R,$){function tt(X,it,zt){X.transparent===!0&&X.side===On?(X.side=_i,X.needsUpdate=!0,ta(X,it,zt),X.side=bs,X.needsUpdate=!0,ta(X,it,zt),X.side=On):ta(X,it,zt)}f=k.get(R),f.init(),p.push(f),R.traverseVisible(function(X){X.isLight&&X.layers.test($.layers)&&(f.pushLight(X),X.castShadow&&f.pushShadow(X))}),f.setupLights(g.physicallyCorrectLights),R.traverse(function(X){const it=X.material;if(it)if(Array.isArray(it))for(let zt=0;zt<it.length;zt++){const Zt=it[zt];tt(Zt,R,X)}else tt(it,R,X)}),p.pop(),f=null};let rt=null;function _t(R){rt&&rt(R)}function Ut(){Ee.stop()}function pe(){Ee.start()}const Ee=new ym;Ee.setAnimationLoop(_t),typeof self<"u"&&Ee.setContext(self),this.setAnimationLoop=function(R){rt=R,Rt.setAnimationLoop(R),R===null?Ee.stop():Ee.start()},Rt.addEventListener("sessionstart",Ut),Rt.addEventListener("sessionend",pe),this.render=function(R,$){if($!==void 0&&$.isCamera!==!0||m===!0)return;R.matrixWorldAutoUpdate===!0&&R.updateMatrixWorld(),$.parent===null&&$.matrixWorldAutoUpdate===!0&&$.updateMatrixWorld(),Rt.enabled===!0&&Rt.isPresenting===!0&&(Rt.cameraAutoUpdate===!0&&Rt.updateCamera($),$=Rt.getCamera()),R.isScene===!0&&R.onBeforeRender(g,R,$,_),f=k.get(R,p.length),f.init(),p.push(f),Z.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),B.setFromProjectionMatrix(Z),I=this.localClippingEnabled,F=E.init(this.clippingPlanes,I,$),u=re.get(R,d.length),u.init(),d.push(u),fn(R,$,0,g.sortObjects),u.finish(),g.sortObjects===!0&&u.sort(D,L),F===!0&&E.beginShadows();const tt=f.state.shadowsArray;if(Y.render(tt,R,$),F===!0&&E.endShadows(),this.info.autoReset===!0&&this.info.reset(),ct.render(u,R),f.setupLights(g.physicallyCorrectLights),$.isArrayCamera){const X=$.cameras;for(let it=0,zt=X.length;it<zt;it++){const Zt=X[it];Me(u,R,Zt,Zt.viewport)}}else Me(u,R,$);_!==null&&(Q.updateMultisampleRenderTarget(_),Q.updateRenderTargetMipmap(_)),R.isScene===!0&&R.onAfterRender(g,R,$),nt.resetDefaultState(),y=-1,b=null,p.pop(),p.length>0?f=p[p.length-1]:f=null,d.pop(),d.length>0?u=d[d.length-1]:u=null};function fn(R,$,tt,X){if(R.visible===!1)return;if(R.layers.test($.layers)){if(R.isGroup)tt=R.renderOrder;else if(R.isLOD)R.autoUpdate===!0&&R.update($);else if(R.isLight)f.pushLight(R),R.castShadow&&f.pushShadow(R);else if(R.isSprite){if(!R.frustumCulled||B.intersectsSprite(R)){X&&K.setFromMatrixPosition(R.matrixWorld).applyMatrix4(Z);const Zt=Pt.update(R),Yt=R.material;Yt.visible&&u.push(R,Zt,Yt,tt,K.z,null)}}else if((R.isMesh||R.isLine||R.isPoints)&&(R.isSkinnedMesh&&R.skeleton.frame!==kt.render.frame&&(R.skeleton.update(),R.skeleton.frame=kt.render.frame),!R.frustumCulled||B.intersectsObject(R))){X&&K.setFromMatrixPosition(R.matrixWorld).applyMatrix4(Z);const Zt=Pt.update(R),Yt=R.material;if(Array.isArray(Yt)){const $t=Zt.groups;for(let he=0,Kt=$t.length;he<Kt;he++){const te=$t[he],be=Yt[te.materialIndex];be&&be.visible&&u.push(R,Zt,be,tt,K.z,te)}}else Yt.visible&&u.push(R,Zt,Yt,tt,K.z,null)}}const zt=R.children;for(let Zt=0,Yt=zt.length;Zt<Yt;Zt++)fn(zt[Zt],$,tt,X)}function Me(R,$,tt,X){const it=R.opaque,zt=R.transmissive,Zt=R.transparent;f.setupLightsView(tt),zt.length>0&&Wi(it,$,tt),X&&ft.viewport(M.copy(X)),it.length>0&&hi(it,$,tt),zt.length>0&&hi(zt,$,tt),Zt.length>0&&hi(Zt,$,tt),ft.buffers.depth.setTest(!0),ft.buffers.depth.setMask(!0),ft.buffers.color.setMask(!0),ft.setPolygonOffset(!1)}function Wi(R,$,tt){const X=ut.isWebGL2;z===null&&(z=new an(1,1,{generateMipmaps:!0,type:xt.has("EXT_color_buffer_half_float")?xo:yr,minFilter:Nh,samples:X&&r===!0?4:0})),g.getDrawingBufferSize(j),X?z.setSize(j.x,j.y):z.setSize(iu(j.x),iu(j.y));const it=g.getRenderTarget();g.setRenderTarget(z),g.clear();const zt=g.toneMapping;g.toneMapping=rn,hi(R,$,tt),g.toneMapping=zt,Q.updateMultisampleRenderTarget(z),Q.updateRenderTargetMipmap(z),g.setRenderTarget(it)}function hi(R,$,tt){const X=$.isScene===!0?$.overrideMaterial:null;for(let it=0,zt=R.length;it<zt;it++){const Zt=R[it],Yt=Zt.object,$t=Zt.geometry,he=X===null?Zt.material:X,Kt=Zt.group;Yt.layers.test(tt.layers)&&ky(Yt,$,tt,$t,he,Kt)}}function ky(R,$,tt,X,it,zt){R.onBeforeRender(g,$,tt,X,it,zt),R.modelViewMatrix.multiplyMatrices(tt.matrixWorldInverse,R.matrixWorld),R.normalMatrix.getNormalMatrix(R.modelViewMatrix),it.onBeforeRender(g,$,tt,X,R,zt),it.transparent===!0&&it.side===On?(it.side=_i,it.needsUpdate=!0,g.renderBufferDirect(tt,$,X,it,R,zt),it.side=bs,it.needsUpdate=!0,g.renderBufferDirect(tt,$,X,it,R,zt),it.side=On):g.renderBufferDirect(tt,$,X,it,R,zt),R.onAfterRender(g,$,tt,X,it,zt)}function ta(R,$,tt){$.isScene!==!0&&($=et);const X=J.get(R),it=f.state.lights,zt=f.state.shadowsArray,Zt=it.state.version,Yt=At.getParameters(R,it.state,zt,$,tt),$t=At.getProgramCacheKey(Yt);let he=X.programs;X.environment=R.isMeshStandardMaterial?$.environment:null,X.fog=$.fog,X.envMap=(R.isMeshStandardMaterial?Ct:lt).get(R.envMap||X.environment),he===void 0&&(R.addEventListener("dispose",U),he=new Map,X.programs=he);let Kt=he.get($t);if(Kt!==void 0){if(X.currentProgram===Kt&&X.lightsStateVersion===Zt)return Vf(R,Yt),Kt}else Yt.uniforms=At.getUniforms(R),R.onBuild(tt,Yt,g),R.onBeforeCompile(Yt,g),Kt=At.acquireProgram(Yt,$t),he.set($t,Kt),X.uniforms=Yt.uniforms;const te=X.uniforms;(!R.isShaderMaterial&&!R.isRawShaderMaterial||R.clipping===!0)&&(te.clippingPlanes=E.uniform),Vf(R,Yt),X.needsLights=Ny(R),X.lightsStateVersion=Zt,X.needsLights&&(te.ambientLightColor.value=it.state.ambient,te.lightProbe.value=it.state.probe,te.directionalLights.value=it.state.directional,te.directionalLightShadows.value=it.state.directionalShadow,te.spotLights.value=it.state.spot,te.spotLightShadows.value=it.state.spotShadow,te.rectAreaLights.value=it.state.rectArea,te.ltc_1.value=it.state.rectAreaLTC1,te.ltc_2.value=it.state.rectAreaLTC2,te.pointLights.value=it.state.point,te.pointLightShadows.value=it.state.pointShadow,te.hemisphereLights.value=it.state.hemi,te.directionalShadowMap.value=it.state.directionalShadowMap,te.directionalShadowMatrix.value=it.state.directionalShadowMatrix,te.spotShadowMap.value=it.state.spotShadowMap,te.spotLightMatrix.value=it.state.spotLightMatrix,te.spotLightMap.value=it.state.spotLightMap,te.pointShadowMap.value=it.state.pointShadowMap,te.pointShadowMatrix.value=it.state.pointShadowMatrix);const be=Kt.getUniforms(),Jn=sh.seqWithValue(be.seq,te);return X.currentProgram=Kt,X.uniformsList=Jn,Kt}function Vf(R,$){const tt=J.get(R);tt.outputEncoding=$.outputEncoding,tt.instancing=$.instancing,tt.skinning=$.skinning,tt.morphTargets=$.morphTargets,tt.morphNormals=$.morphNormals,tt.morphColors=$.morphColors,tt.morphTargetsCount=$.morphTargetsCount,tt.numClippingPlanes=$.numClippingPlanes,tt.numIntersection=$.numClipIntersection,tt.vertexAlphas=$.vertexAlphas,tt.vertexTangents=$.vertexTangents,tt.toneMapping=$.toneMapping}function zy(R,$,tt,X,it){$.isScene!==!0&&($=et),Q.resetTextureUnits();const zt=$.fog,Zt=X.isMeshStandardMaterial?$.environment:null,Yt=_===null?g.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:xr,$t=(X.isMeshStandardMaterial?Ct:lt).get(X.envMap||Zt),he=X.vertexColors===!0&&!!tt.attributes.color&&tt.attributes.color.itemSize===4,Kt=!!X.normalMap&&!!tt.attributes.tangent,te=!!tt.morphAttributes.position,be=!!tt.morphAttributes.normal,Jn=!!tt.morphAttributes.color,Ir=X.toneMapped?g.toneMapping:rn,kr=tt.morphAttributes.position||tt.morphAttributes.normal||tt.morphAttributes.color,Di=kr!==void 0?kr.length:0,se=J.get(X),zr=f.state.lights;if(F===!0&&(I===!0||R!==b)){const ri=R===b&&X.id===y;E.setState(X,R,ri)}let Re=!1;X.version===se.__version?(se.needsLights&&se.lightsStateVersion!==zr.state.version||se.outputEncoding!==Yt||it.isInstancedMesh&&se.instancing===!1||!it.isInstancedMesh&&se.instancing===!0||it.isSkinnedMesh&&se.skinning===!1||!it.isSkinnedMesh&&se.skinning===!0||se.envMap!==$t||X.fog===!0&&se.fog!==zt||se.numClippingPlanes!==void 0&&(se.numClippingPlanes!==E.numPlanes||se.numIntersection!==E.numIntersection)||se.vertexAlphas!==he||se.vertexTangents!==Kt||se.morphTargets!==te||se.morphNormals!==be||se.morphColors!==Jn||se.toneMapping!==Ir||ut.isWebGL2===!0&&se.morphTargetsCount!==Di)&&(Re=!0):(Re=!0,se.__version=X.version);let li=se.currentProgram;Re===!0&&(li=ta(X,$,it));let dn=!1,Us=!1,ul=!1;const Ye=li.getUniforms(),Yn=se.uniforms;if(ft.useProgram(li.program)&&(dn=!0,Us=!0,ul=!0),X.id!==y&&(y=X.id,Us=!0),dn||b!==R){if(Ye.setValue(V,"projectionMatrix",R.projectionMatrix),ut.logarithmicDepthBuffer&&Ye.setValue(V,"logDepthBufFC",2/(Math.log(R.far+1)/Math.LN2)),b!==R&&(b=R,Us=!0,ul=!0),X.isShaderMaterial||X.isMeshPhongMaterial||X.isMeshToonMaterial||X.isMeshStandardMaterial||X.envMap){const ri=Ye.map.cameraPosition;ri!==void 0&&ri.setValue(V,K.setFromMatrixPosition(R.matrixWorld))}(X.isMeshPhongMaterial||X.isMeshToonMaterial||X.isMeshLambertMaterial||X.isMeshBasicMaterial||X.isMeshStandardMaterial||X.isShaderMaterial)&&Ye.setValue(V,"isOrthographic",R.isOrthographicCamera===!0),(X.isMeshPhongMaterial||X.isMeshToonMaterial||X.isMeshLambertMaterial||X.isMeshBasicMaterial||X.isMeshStandardMaterial||X.isShaderMaterial||X.isShadowMaterial||it.isSkinnedMesh)&&Ye.setValue(V,"viewMatrix",R.matrixWorldInverse)}if(it.isSkinnedMesh){Ye.setOptional(V,it,"bindMatrix"),Ye.setOptional(V,it,"bindMatrixInverse");const ri=it.skeleton;ri&&ut.floatVertexTextures&&(ri.boneTexture===null&&ri.computeBoneTexture(),Ye.setValue(V,"boneTexture",ri.boneTexture,Q),Ye.setValue(V,"boneTextureSize",ri.boneTextureSize))}const fl=tt.morphAttributes;if((fl.position!==void 0||fl.normal!==void 0||fl.color!==void 0&&ut.isWebGL2===!0)&&gt.update(it,tt,X,li),(Us||se.receiveShadow!==it.receiveShadow)&&(se.receiveShadow=it.receiveShadow,Ye.setValue(V,"receiveShadow",it.receiveShadow)),X.isMeshGouraudMaterial&&X.envMap!==null&&(Yn.envMap.value=$t,Yn.flipEnvMap.value=$t.isCubeTexture&&$t.isRenderTargetTexture===!1?-1:1),Us&&(Ye.setValue(V,"toneMappingExposure",g.toneMappingExposure),se.needsLights&&Fy(Yn,ul),zt&&X.fog===!0&&ce.refreshFogUniforms(Yn,zt),ce.refreshMaterialUniforms(Yn,X,O,P,z),sh.upload(V,se.uniformsList,Yn,Q)),X.isShaderMaterial&&X.uniformsNeedUpdate===!0&&(sh.upload(V,se.uniformsList,Yn,Q),X.uniformsNeedUpdate=!1),X.isSpriteMaterial&&Ye.setValue(V,"center",it.center),Ye.setValue(V,"modelViewMatrix",it.modelViewMatrix),Ye.setValue(V,"normalMatrix",it.normalMatrix),Ye.setValue(V,"modelMatrix",it.matrixWorld),X.isShaderMaterial||X.isRawShaderMaterial){const ri=X.uniformsGroups;for(let dl=0,By=ri.length;dl<By;dl++)if(ut.isWebGL2){const Wf=ri[dl];Ot.update(Wf,li),Ot.bind(Wf,li)}}return li}function Fy(R,$){R.ambientLightColor.needsUpdate=$,R.lightProbe.needsUpdate=$,R.directionalLights.needsUpdate=$,R.directionalLightShadows.needsUpdate=$,R.pointLights.needsUpdate=$,R.pointLightShadows.needsUpdate=$,R.spotLights.needsUpdate=$,R.spotLightShadows.needsUpdate=$,R.rectAreaLights.needsUpdate=$,R.hemisphereLights.needsUpdate=$}function Ny(R){return R.isMeshLambertMaterial||R.isMeshToonMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial||R.isShadowMaterial||R.isShaderMaterial&&R.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(R,$,tt){J.get(R.texture).__webglTexture=$,J.get(R.depthTexture).__webglTexture=tt;const X=J.get(R);X.__hasExternalTextures=!0,X.__hasExternalTextures&&(X.__autoAllocateDepthBuffer=tt===void 0,X.__autoAllocateDepthBuffer||xt.has("WEBGL_multisampled_render_to_texture")===!0&&(X.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(R,$){const tt=J.get(R);tt.__webglFramebuffer=$,tt.__useDefaultFramebuffer=$===void 0},this.setRenderTarget=function(R,$=0,tt=0){_=R,v=$,x=tt;let X=!0;if(R){const $t=J.get(R);$t.__useDefaultFramebuffer!==void 0?(ft.bindFramebuffer(36160,null),X=!1):$t.__webglFramebuffer===void 0?Q.setupRenderTarget(R):$t.__hasExternalTextures&&Q.rebindTextures(R,J.get(R.texture).__webglTexture,J.get(R.depthTexture).__webglTexture)}let it=null,zt=!1,Zt=!1;if(R){const $t=R.texture;($t.isData3DTexture||$t.isDataArrayTexture)&&(Zt=!0);const he=J.get(R).__webglFramebuffer;R.isWebGLCubeRenderTarget?(it=he[$],zt=!0):ut.isWebGL2&&R.samples>0&&Q.useMultisampledRTT(R)===!1?it=J.get(R).__webglMultisampledFramebuffer:it=he,M.copy(R.viewport),C.copy(R.scissor),w=R.scissorTest}else M.copy(T).multiplyScalar(O).floor(),C.copy(A).multiplyScalar(O).floor(),w=N;if(ft.bindFramebuffer(36160,it)&&ut.drawBuffers&&X&&ft.drawBuffers(R,it),ft.viewport(M),ft.scissor(C),ft.setScissorTest(w),zt){const $t=J.get(R.texture);V.framebufferTexture2D(36160,36064,34069+$,$t.__webglTexture,tt)}else if(Zt){const $t=J.get(R.texture),he=$||0;V.framebufferTextureLayer(36160,36064,$t.__webglTexture,tt||0,he)}y=-1},this.readRenderTargetPixels=function(R,$,tt,X,it,zt,Zt){if(!(R&&R.isWebGLRenderTarget))return;let Yt=J.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&Zt!==void 0&&(Yt=Yt[Zt]),Yt){ft.bindFramebuffer(36160,Yt);try{const $t=R.texture,he=$t.format,Kt=$t.type;if(he!==ki&&Mt.convert(he)!==V.getParameter(35739))return;const te=Kt===xo&&(xt.has("EXT_color_buffer_half_float")||ut.isWebGL2&&xt.has("EXT_color_buffer_float"));if(Kt!==yr&&Mt.convert(Kt)!==V.getParameter(35738)&&!(Kt===cr&&(ut.isWebGL2||xt.has("OES_texture_float")||xt.has("WEBGL_color_buffer_float")))&&!te)return;$>=0&&$<=R.width-X&&tt>=0&&tt<=R.height-it&&V.readPixels($,tt,X,it,Mt.convert(he),Mt.convert(Kt),zt)}finally{const $t=_!==null?J.get(_).__webglFramebuffer:null;ft.bindFramebuffer(36160,$t)}}},this.copyFramebufferToTexture=function(R,$,tt=0){const X=Math.pow(2,-tt),it=Math.floor($.image.width*X),zt=Math.floor($.image.height*X);Q.setTexture2D($,0),V.copyTexSubImage2D(3553,tt,0,0,R.x,R.y,it,zt),ft.unbindTexture()},this.copyTextureToTexture=function(R,$,tt,X=0){const it=$.image.width,zt=$.image.height,Zt=Mt.convert(tt.format),Yt=Mt.convert(tt.type);Q.setTexture2D(tt,0),V.pixelStorei(37440,tt.flipY),V.pixelStorei(37441,tt.premultiplyAlpha),V.pixelStorei(3317,tt.unpackAlignment),$.isDataTexture?V.texSubImage2D(3553,X,R.x,R.y,it,zt,Zt,Yt,$.image.data):$.isCompressedTexture?V.compressedTexSubImage2D(3553,X,R.x,R.y,$.mipmaps[0].width,$.mipmaps[0].height,Zt,$.mipmaps[0].data):V.texSubImage2D(3553,X,R.x,R.y,Zt,Yt,$.image),X===0&&tt.generateMipmaps&&V.generateMipmap(3553),ft.unbindTexture()},this.copyTextureToTexture3D=function(R,$,tt,X,it=0){if(g.isWebGL1Renderer)return;const zt=R.max.x-R.min.x+1,Zt=R.max.y-R.min.y+1,Yt=R.max.z-R.min.z+1,$t=Mt.convert(X.format),he=Mt.convert(X.type);let Kt;if(X.isData3DTexture)Q.setTexture3D(X,0),Kt=32879;else if(X.isDataArrayTexture)Q.setTexture2DArray(X,0),Kt=35866;else return;V.pixelStorei(37440,X.flipY),V.pixelStorei(37441,X.premultiplyAlpha),V.pixelStorei(3317,X.unpackAlignment);const te=V.getParameter(3314),be=V.getParameter(32878),Jn=V.getParameter(3316),Ir=V.getParameter(3315),kr=V.getParameter(32877),Di=tt.isCompressedTexture?tt.mipmaps[0]:tt.image;V.pixelStorei(3314,Di.width),V.pixelStorei(32878,Di.height),V.pixelStorei(3316,R.min.x),V.pixelStorei(3315,R.min.y),V.pixelStorei(32877,R.min.z),tt.isDataTexture||tt.isData3DTexture?V.texSubImage3D(Kt,it,$.x,$.y,$.z,zt,Zt,Yt,$t,he,Di.data):tt.isCompressedTexture?V.compressedTexSubImage3D(Kt,it,$.x,$.y,$.z,zt,Zt,Yt,$t,Di.data):V.texSubImage3D(Kt,it,$.x,$.y,$.z,zt,Zt,Yt,$t,he,Di),V.pixelStorei(3314,te),V.pixelStorei(32878,be),V.pixelStorei(3316,Jn),V.pixelStorei(3315,Ir),V.pixelStorei(32877,kr),it===0&&X.generateMipmaps&&V.generateMipmap(Kt),ft.unbindTexture()},this.initTexture=function(R){R.isCubeTexture?Q.setTextureCube(R,0):R.isData3DTexture?Q.setTexture3D(R,0):R.isDataArrayTexture?Q.setTexture2DArray(R,0):Q.setTexture2D(R,0),ft.unbindTexture()},this.resetState=function(){v=0,x=0,_=null,ft.reset(),nt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class zb extends Cm{}zb.prototype.isWebGL1Renderer=!0;class Tm extends Te{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),i}get autoUpdate(){return this.matrixWorldAutoUpdate}set autoUpdate(t){this.matrixWorldAutoUpdate=t}}class Fb{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=tu,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=sn()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,n){t*=this.stride,n*=i.stride;for(let e=0,r=this.stride;e<r;e++)this.array[t+e]=i.array[n+e];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=sn()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(i,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=sn()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Qe=new G;class In{constructor(t,i,n,e=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=n,this.normalized=e===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,n=this.data.count;i<n;i++)Qe.fromBufferAttribute(this,i),Qe.applyMatrix4(t),this.setXYZ(i,Qe.x,Qe.y,Qe.z);return this}applyNormalMatrix(t){for(let i=0,n=this.count;i<n;i++)Qe.fromBufferAttribute(this,i),Qe.applyNormalMatrix(t),this.setXYZ(i,Qe.x,Qe.y,Qe.z);return this}transformDirection(t){for(let i=0,n=this.count;i<n;i++)Qe.fromBufferAttribute(this,i),Qe.transformDirection(t),this.setXYZ(i,Qe.x,Qe.y,Qe.z);return this}setX(t,i){return this.normalized&&(i=ue(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=ue(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=ue(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=ue(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=Dn(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=Dn(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=Dn(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=Dn(i,this.array)),i}setXY(t,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(i=ue(i,this.array),n=ue(n,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=n,this}setXYZ(t,i,n,e){return t=t*this.data.stride+this.offset,this.normalized&&(i=ue(i,this.array),n=ue(n,this.array),e=ue(e,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=e,this}setXYZW(t,i,n,e,r){return t=t*this.data.stride+this.offset,this.normalized&&(i=ue(i,this.array),n=ue(n,this.array),e=ue(e,this.array),r=ue(r,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=e,this.data.array[t+3]=r,this}clone(t){if(t===void 0){const i=[];for(let n=0;n<this.count;n++){const e=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)i.push(this.data.array[e+r])}return new It(new this.array.constructor(i),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new In(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){const i=[];for(let n=0;n<this.count;n++){const e=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)i.push(this.data.array[e+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class rp extends It{constructor(t,i,n,e=1){super(t,i,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=e}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const sp=new ve,op=new ve,wa=[],Zs=new ei;class Nb extends ei{constructor(t,i,n){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new rp(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,i){i.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,t*16)}raycast(t,i){const n=this.matrixWorld,e=this.count;if(Zs.geometry=this.geometry,Zs.material=this.material,Zs.material!==void 0)for(let r=0;r<e;r++){this.getMatrixAt(r,sp),op.multiplyMatrices(n,sp),Zs.matrixWorld=op,Zs.raycast(t,wa);for(let s=0,a=wa.length;s<a;s++){const h=wa[s];h.instanceId=r,h.object=this,i.push(h)}wa.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new rp(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Bu extends Gi{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new qt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const ap=new G,hp=new G,lp=new ve,Zl=new Bh,Ma=new Rs;class Pm extends Te{constructor(t=new ae,i=new Bu){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,n=[0];for(let e=1,r=i.count;e<r;e++)ap.fromBufferAttribute(i,e-1),hp.fromBufferAttribute(i,e),n[e]=n[e-1],n[e]+=ap.distanceTo(hp);t.setAttribute("lineDistance",new Fe(n,1))}return this}raycast(t,i){const n=this.geometry,e=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Ma.copy(n.boundingSphere),Ma.applyMatrix4(e),Ma.radius+=r,t.ray.intersectsSphere(Ma)===!1)return;lp.copy(e).invert(),Zl.copy(t.ray).applyMatrix4(lp);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=a*a,l=new G,c=new G,u=new G,f=new G,d=this.isLineSegments?2:1,p=n.index,m=n.attributes.position;if(p!==null){const v=Math.max(0,s.start),x=Math.min(p.count,s.start+s.count);for(let _=v,y=x-1;_<y;_+=d){const b=p.getX(_),M=p.getX(_+1);if(l.fromBufferAttribute(m,b),c.fromBufferAttribute(m,M),Zl.distanceSqToSegment(l,c,f,u)>h)continue;f.applyMatrix4(this.matrixWorld);const w=t.ray.origin.distanceTo(f);w<t.near||w>t.far||i.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const v=Math.max(0,s.start),x=Math.min(m.count,s.start+s.count);for(let _=v,y=x-1;_<y;_+=d){if(l.fromBufferAttribute(m,_),c.fromBufferAttribute(m,_+1),Zl.distanceSqToSegment(l,c,f,u)>h)continue;f.applyMatrix4(this.matrixWorld);const M=t.ray.origin.distanceTo(f);M<t.near||M>t.far||i.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const e=i[n[0]];if(e!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=e.length;r<s;r++){const a=e[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}const cp=new G,up=new G;class Gu extends Pm{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,n=[];for(let e=0,r=i.count;e<r;e+=2)cp.fromBufferAttribute(i,e),up.fromBufferAttribute(i,e+1),n[e]=e===0?0:n[e-1],n[e+1]=n[e]+cp.distanceTo(up);t.setAttribute("lineDistance",new Fe(n,1))}return this}}class Em extends Gi{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new qt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const fp=new ve,ru=new Bh,ba=new Rs,Sa=new G;class Bb extends Te{constructor(t=new ae,i=new Em){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=t.material,this.geometry=t.geometry,this}raycast(t,i){const n=this.geometry,e=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),ba.copy(n.boundingSphere),ba.applyMatrix4(e),ba.radius+=r,t.ray.intersectsSphere(ba)===!1)return;fp.copy(e).invert(),ru.copy(t.ray).applyMatrix4(fp);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=a*a,l=n.index,u=n.attributes.position;if(l!==null){const f=Math.max(0,s.start),d=Math.min(l.count,s.start+s.count);for(let p=f,g=d;p<g;p++){const m=l.getX(p);Sa.fromBufferAttribute(u,m),dp(Sa,m,h,e,t,i,this)}}else{const f=Math.max(0,s.start),d=Math.min(u.count,s.start+s.count);for(let p=f,g=d;p<g;p++)Sa.fromBufferAttribute(u,p),dp(Sa,p,h,e,t,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const e=i[n[0]];if(e!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=e.length;r<s;r++){const a=e[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function dp(o,t,i,n,e,r,s){const a=ru.distanceSqToPoint(o);if(a<i){const h=new G;ru.closestPointToPoint(o,h),h.applyMatrix4(n);const l=e.ray.origin.distanceTo(h);if(l<e.near||l>e.far)return;r.push({distance:l,distanceToRay:Math.sqrt(a),point:h,index:t,face:null,object:s})}}class Hi{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(t,i){const n=this.getUtoTmapping(t);return this.getPoint(n,i)}getPoints(t=5){const i=[];for(let n=0;n<=t;n++)i.push(this.getPoint(n/t));return i}getSpacedPoints(t=5){const i=[];for(let n=0;n<=t;n++)i.push(this.getPointAt(n/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let n,e=this.getPoint(0),r=0;i.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(e),i.push(r),e=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i){const n=this.getLengths();let e=0;const r=n.length;let s;i?s=i:s=t*n[r-1];let a=0,h=r-1,l;for(;a<=h;)if(e=Math.floor(a+(h-a)/2),l=n[e]-s,l<0)a=e+1;else if(l>0)h=e-1;else{h=e;break}if(e=h,n[e]===s)return e/(r-1);const c=n[e],f=n[e+1]-c,d=(s-c)/f;return(e+d)/(r-1)}getTangent(t,i){let e=t-1e-4,r=t+1e-4;e<0&&(e=0),r>1&&(r=1);const s=this.getPoint(e),a=this.getPoint(r),h=i||(s.isVector2?new bt:new G);return h.copy(a).sub(s).normalize(),h}getTangentAt(t,i){const n=this.getUtoTmapping(t);return this.getTangent(n,i)}computeFrenetFrames(t,i){const n=new G,e=[],r=[],s=[],a=new G,h=new ve;for(let d=0;d<=t;d++){const p=d/t;e[d]=this.getTangentAt(p,new G)}r[0]=new G,s[0]=new G;let l=Number.MAX_VALUE;const c=Math.abs(e[0].x),u=Math.abs(e[0].y),f=Math.abs(e[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),f<=l&&n.set(0,0,1),a.crossVectors(e[0],n).normalize(),r[0].crossVectors(e[0],a),s[0].crossVectors(e[0],r[0]);for(let d=1;d<=t;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(e[d-1],e[d]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(ti(e[d-1].dot(e[d]),-1,1));r[d].applyMatrix4(h.makeRotationAxis(a,p))}s[d].crossVectors(e[d],r[d])}if(i===!0){let d=Math.acos(ti(r[0].dot(r[t]),-1,1));d/=t,e[0].dot(a.crossVectors(r[0],r[t]))>0&&(d=-d);for(let p=1;p<=t;p++)r[p].applyMatrix4(h.makeRotationAxis(e[p],d*p)),s[p].crossVectors(e[p],r[p])}return{tangents:e,normals:r,binormals:s}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Hu extends Hi{constructor(t=0,i=0,n=1,e=1,r=0,s=Math.PI*2,a=!1,h=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=n,this.yRadius=e,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=h}getPoint(t,i){const n=i||new bt,e=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=e;for(;r>e;)r-=e;r<Number.EPSILON&&(s?r=0:r=e),this.aClockwise===!0&&!s&&(r===e?r=-e:r=r-e);const a=this.aStartAngle+t*r;let h=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),f=h-this.aX,d=l-this.aY;h=f*c-d*u+this.aX,l=f*u+d*c+this.aY}return n.set(h,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Gb extends Hu{constructor(t,i,n,e,r,s){super(t,i,n,n,e,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function Uu(){let o=0,t=0,i=0,n=0;function e(r,s,a,h){o=r,t=a,i=-3*r+3*s-2*a-h,n=2*r-2*s+a+h}return{initCatmullRom:function(r,s,a,h,l){e(s,a,l*(a-r),l*(h-s))},initNonuniformCatmullRom:function(r,s,a,h,l,c,u){let f=(s-r)/l-(a-r)/(l+c)+(a-s)/c,d=(a-s)/c-(h-s)/(c+u)+(h-a)/u;f*=c,d*=c,e(s,a,f,d)},calc:function(r){const s=r*r,a=s*r;return o+t*r+i*s+n*a}}}const Ca=new G,Xl=new Uu,$l=new Uu,ql=new Uu;class Hb extends Hi{constructor(t=[],i=!1,n="centripetal",e=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=n,this.tension=e}getPoint(t,i=new G){const n=i,e=this.points,r=e.length,s=(r-(this.closed?0:1))*t;let a=Math.floor(s),h=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:h===0&&a===r-1&&(a=r-2,h=1);let l,c;this.closed||a>0?l=e[(a-1)%r]:(Ca.subVectors(e[0],e[1]).add(e[0]),l=Ca);const u=e[a%r],f=e[(a+1)%r];if(this.closed||a+2<r?c=e[(a+2)%r]:(Ca.subVectors(e[r-1],e[r-2]).add(e[r-1]),c=Ca),this.curveType==="centripetal"||this.curveType==="chordal"){const d=this.curveType==="chordal"?.5:.25;let p=Math.pow(l.distanceToSquared(u),d),g=Math.pow(u.distanceToSquared(f),d),m=Math.pow(f.distanceToSquared(c),d);g<1e-4&&(g=1),p<1e-4&&(p=g),m<1e-4&&(m=g),Xl.initNonuniformCatmullRom(l.x,u.x,f.x,c.x,p,g,m),$l.initNonuniformCatmullRom(l.y,u.y,f.y,c.y,p,g,m),ql.initNonuniformCatmullRom(l.z,u.z,f.z,c.z,p,g,m)}else this.curveType==="catmullrom"&&(Xl.initCatmullRom(l.x,u.x,f.x,c.x,this.tension),$l.initCatmullRom(l.y,u.y,f.y,c.y,this.tension),ql.initCatmullRom(l.z,u.z,f.z,c.z,this.tension));return n.set(Xl.calc(h),$l.calc(h),ql.calc(h)),n}copy(t){super.copy(t),this.points=[];for(let i=0,n=t.points.length;i<n;i++){const e=t.points[i];this.points.push(e.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,n=this.points.length;i<n;i++){const e=this.points[i];t.points.push(e.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,n=t.points.length;i<n;i++){const e=t.points[i];this.points.push(new G().fromArray(e))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function pp(o,t,i,n,e){const r=(n-t)*.5,s=(e-i)*.5,a=o*o,h=o*a;return(2*i-2*n+r+s)*h+(-3*i+3*n-2*r-s)*a+r*o+i}function Ub(o,t){const i=1-o;return i*i*t}function Vb(o,t){return 2*(1-o)*o*t}function Wb(o,t){return o*o*t}function vo(o,t,i,n){return Ub(o,t)+Vb(o,i)+Wb(o,n)}function jb(o,t){const i=1-o;return i*i*i*t}function Zb(o,t){const i=1-o;return 3*i*i*o*t}function Xb(o,t){return 3*(1-o)*o*o*t}function $b(o,t){return o*o*o*t}function _o(o,t,i,n,e){return jb(o,t)+Zb(o,i)+Xb(o,n)+$b(o,e)}class Am extends Hi{constructor(t=new bt,i=new bt,n=new bt,e=new bt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=n,this.v3=e}getPoint(t,i=new bt){const n=i,e=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(_o(t,e.x,r.x,s.x,a.x),_o(t,e.y,r.y,s.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class qb extends Hi{constructor(t=new G,i=new G,n=new G,e=new G){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=n,this.v3=e}getPoint(t,i=new G){const n=i,e=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(_o(t,e.x,r.x,s.x,a.x),_o(t,e.y,r.y,s.y,a.y),_o(t,e.z,r.z,s.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Vu extends Hi{constructor(t=new bt,i=new bt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new bt){const n=i;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i){const n=i||new bt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Jb extends Hi{constructor(t=new G,i=new G){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=i}getPoint(t,i=new G){const n=i;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,i){return this.getPoint(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Lm extends Hi{constructor(t=new bt,i=new bt,n=new bt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=n}getPoint(t,i=new bt){const n=i,e=this.v0,r=this.v1,s=this.v2;return n.set(vo(t,e.x,r.x,s.x),vo(t,e.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Yb extends Hi{constructor(t=new G,i=new G,n=new G){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=n}getPoint(t,i=new G){const n=i,e=this.v0,r=this.v1,s=this.v2;return n.set(vo(t,e.x,r.x,s.x),vo(t,e.y,r.y,s.y),vo(t,e.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Rm extends Hi{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,i=new bt){const n=i,e=this.points,r=(e.length-1)*t,s=Math.floor(r),a=r-s,h=e[s===0?s:s-1],l=e[s],c=e[s>e.length-2?e.length-1:s+1],u=e[s>e.length-3?e.length-1:s+2];return n.set(pp(a,h.x,l.x,c.x,u.x),pp(a,h.y,l.y,c.y,u.y)),n}copy(t){super.copy(t),this.points=[];for(let i=0,n=t.points.length;i<n;i++){const e=t.points[i];this.points.push(e.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,n=this.points.length;i<n;i++){const e=this.points[i];t.points.push(e.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,n=t.points.length;i<n;i++){const e=t.points[i];this.points.push(new bt().fromArray(e))}return this}}var Om=Object.freeze({__proto__:null,ArcCurve:Gb,CatmullRomCurve3:Hb,CubicBezierCurve:Am,CubicBezierCurve3:qb,EllipseCurve:Hu,LineCurve:Vu,LineCurve3:Jb,QuadraticBezierCurve:Lm,QuadraticBezierCurve3:Yb,SplineCurve:Rm});class Qb extends Hi{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);t.equals(i)||this.curves.push(new Vu(i,t))}getPoint(t,i){const n=t*this.getLength(),e=this.getCurveLengths();let r=0;for(;r<e.length;){if(e[r]>=n){const s=e[r]-n,a=this.curves[r],h=a.getLength(),l=h===0?0:1-s/h;return a.getPointAt(l,i)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let n=0,e=this.curves.length;n<e;n++)i+=this.curves[n].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let n=0;n<=t;n++)i.push(this.getPoint(n/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let n;for(let e=0,r=this.curves;e<r.length;e++){const s=r[e],a=s.isEllipseCurve?t*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,h=s.getPoints(a);for(let l=0;l<h.length;l++){const c=h[l];n&&n.equals(c)||(i.push(c),n=c)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,n=t.curves.length;i<n;i++){const e=t.curves[i];this.curves.push(e.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,n=this.curves.length;i<n;i++){const e=this.curves[i];t.curves.push(e.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,n=t.curves.length;i<n;i++){const e=t.curves[i];this.curves.push(new Om[e.type]().fromJSON(e))}return this}}class gp extends Qb{constructor(t){super(),this.type="Path",this.currentPoint=new bt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,n=t.length;i<n;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const n=new Vu(this.currentPoint.clone(),new bt(t,i));return this.curves.push(n),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,n,e){const r=new Lm(this.currentPoint.clone(),new bt(t,i),new bt(n,e));return this.curves.push(r),this.currentPoint.set(n,e),this}bezierCurveTo(t,i,n,e,r,s){const a=new Am(this.currentPoint.clone(),new bt(t,i),new bt(n,e),new bt(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),n=new Rm(i);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,n,e,r,s){const a=this.currentPoint.x,h=this.currentPoint.y;return this.absarc(t+a,i+h,n,e,r,s),this}absarc(t,i,n,e,r,s){return this.absellipse(t,i,n,n,e,r,s),this}ellipse(t,i,n,e,r,s,a,h){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,i+c,n,e,r,s,a,h),this}absellipse(t,i,n,e,r,s,a,h){const l=new Hu(t,i,n,e,r,s,a,h);if(this.curves.length>0){const u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class su extends gp{constructor(t){super(t),this.uuid=sn(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let n=0,e=this.holes.length;n<e;n++)i[n]=this.holes[n].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,n=t.holes.length;i<n;i++){const e=t.holes[i];this.holes.push(e.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,n=this.holes.length;i<n;i++){const e=this.holes[i];t.holes.push(e.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,n=t.holes.length;i<n;i++){const e=t.holes[i];this.holes.push(new gp().fromJSON(e))}return this}}const Kb={triangulate:function(o,t,i=2){const n=t&&t.length,e=n?t[0]*i:o.length;let r=Dm(o,0,e,i,!0);const s=[];if(!r||r.next===r.prev)return s;let a,h,l,c,u,f,d;if(n&&(r=rS(o,t,r,i)),o.length>80*i){a=l=o[0],h=c=o[1];for(let p=i;p<e;p+=i)u=o[p],f=o[p+1],u<a&&(a=u),f<h&&(h=f),u>l&&(l=u),f>c&&(c=f);d=Math.max(l-a,c-h),d=d!==0?1/d:0}return Mo(r,s,i,a,h,d),s}};function Dm(o,t,i,n,e){let r,s;if(e===gS(o,t,i,n)>0)for(r=t;r<i;r+=n)s=mp(r,o[r],o[r+1],s);else for(r=i-n;r>=t;r-=n)s=mp(r,o[r],o[r+1],s);return s&&Hh(s,s.next)&&(So(s),s=s.next),s}function Bn(o,t){if(!o)return o;t||(t=o);let i=o,n;do if(n=!1,!i.steiner&&(Hh(i,i.next)||_e(i.prev,i,i.next)===0)){if(So(i),i=t=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==t);return t}function Mo(o,t,i,n,e,r,s){if(!o)return;!s&&r&&lS(o,n,e,r);let a=o,h,l;for(;o.prev!==o.next;){if(h=o.prev,l=o.next,r?eS(o,n,e,r):tS(o)){t.push(h.i/i),t.push(o.i/i),t.push(l.i/i),So(o),o=l.next,a=l.next;continue}if(o=l,o===a){s?s===1?(o=iS(Bn(o),t,i),Mo(o,t,i,n,e,r,2)):s===2&&nS(o,t,i,n,e,r):Mo(Bn(o),t,i,n,e,r,1);break}}}function tS(o){const t=o.prev,i=o,n=o.next;if(_e(t,i,n)>=0)return!1;let e=o.next.next;for(;e!==o.prev;){if(cs(t.x,t.y,i.x,i.y,n.x,n.y,e.x,e.y)&&_e(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function eS(o,t,i,n){const e=o.prev,r=o,s=o.next;if(_e(e,r,s)>=0)return!1;const a=e.x<r.x?e.x<s.x?e.x:s.x:r.x<s.x?r.x:s.x,h=e.y<r.y?e.y<s.y?e.y:s.y:r.y<s.y?r.y:s.y,l=e.x>r.x?e.x>s.x?e.x:s.x:r.x>s.x?r.x:s.x,c=e.y>r.y?e.y>s.y?e.y:s.y:r.y>s.y?r.y:s.y,u=ou(a,h,t,i,n),f=ou(l,c,t,i,n);let d=o.prevZ,p=o.nextZ;for(;d&&d.z>=u&&p&&p.z<=f;){if(d!==o.prev&&d!==o.next&&cs(e.x,e.y,r.x,r.y,s.x,s.y,d.x,d.y)&&_e(d.prev,d,d.next)>=0||(d=d.prevZ,p!==o.prev&&p!==o.next&&cs(e.x,e.y,r.x,r.y,s.x,s.y,p.x,p.y)&&_e(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;d&&d.z>=u;){if(d!==o.prev&&d!==o.next&&cs(e.x,e.y,r.x,r.y,s.x,s.y,d.x,d.y)&&_e(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==o.prev&&p!==o.next&&cs(e.x,e.y,r.x,r.y,s.x,s.y,p.x,p.y)&&_e(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function iS(o,t,i){let n=o;do{const e=n.prev,r=n.next.next;!Hh(e,r)&&Im(e,n,n.next,r)&&bo(e,r)&&bo(r,e)&&(t.push(e.i/i),t.push(n.i/i),t.push(r.i/i),So(n),So(n.next),n=o=r),n=n.next}while(n!==o);return Bn(n)}function nS(o,t,i,n,e,r){let s=o;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&fS(s,a)){let h=km(s,a);s=Bn(s,s.next),h=Bn(h,h.next),Mo(s,t,i,n,e,r),Mo(h,t,i,n,e,r);return}a=a.next}s=s.next}while(s!==o)}function rS(o,t,i,n){const e=[];let r,s,a,h,l;for(r=0,s=t.length;r<s;r++)a=t[r]*n,h=r<s-1?t[r+1]*n:o.length,l=Dm(o,a,h,n,!1),l===l.next&&(l.steiner=!0),e.push(uS(l));for(e.sort(sS),r=0;r<e.length;r++)oS(e[r],i),i=Bn(i,i.next);return i}function sS(o,t){return o.x-t.x}function oS(o,t){if(t=aS(o,t),t){const i=km(t,o);Bn(t,t.next),Bn(i,i.next)}}function aS(o,t){let i=t;const n=o.x,e=o.y;let r=-1/0,s;do{if(e<=i.y&&e>=i.next.y&&i.next.y!==i.y){const f=i.x+(e-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(f<=n&&f>r){if(r=f,f===n){if(e===i.y)return i;if(e===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(n===r)return s;const a=s,h=s.x,l=s.y;let c=1/0,u;i=s;do n>=i.x&&i.x>=h&&n!==i.x&&cs(e<l?n:r,e,h,l,e<l?r:n,e,i.x,i.y)&&(u=Math.abs(e-i.y)/(n-i.x),bo(i,o)&&(u<c||u===c&&(i.x>s.x||i.x===s.x&&hS(s,i)))&&(s=i,c=u)),i=i.next;while(i!==a);return s}function hS(o,t){return _e(o.prev,o,t.prev)<0&&_e(t.next,o,o.next)<0}function lS(o,t,i,n){let e=o;do e.z===null&&(e.z=ou(e.x,e.y,t,i,n)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==o);e.prevZ.nextZ=null,e.prevZ=null,cS(e)}function cS(o){let t,i,n,e,r,s,a,h,l=1;do{for(i=o,o=null,r=null,s=0;i;){for(s++,n=i,a=0,t=0;t<l&&(a++,n=n.nextZ,!!n);t++);for(h=l;a>0||h>0&&n;)a!==0&&(h===0||!n||i.z<=n.z)?(e=i,i=i.nextZ,a--):(e=n,n=n.nextZ,h--),r?r.nextZ=e:o=e,e.prevZ=r,r=e;i=n}r.nextZ=null,l*=2}while(s>1);return o}function ou(o,t,i,n,e){return o=32767*(o-i)*e,t=32767*(t-n)*e,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,o|t<<1}function uS(o){let t=o,i=o;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==o);return i}function cs(o,t,i,n,e,r,s,a){return(e-s)*(t-a)-(o-s)*(r-a)>=0&&(o-s)*(n-a)-(i-s)*(t-a)>=0&&(i-s)*(r-a)-(e-s)*(n-a)>=0}function fS(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!dS(o,t)&&(bo(o,t)&&bo(t,o)&&pS(o,t)&&(_e(o.prev,o,t.prev)||_e(o,t.prev,t))||Hh(o,t)&&_e(o.prev,o,o.next)>0&&_e(t.prev,t,t.next)>0)}function _e(o,t,i){return(t.y-o.y)*(i.x-t.x)-(t.x-o.x)*(i.y-t.y)}function Hh(o,t){return o.x===t.x&&o.y===t.y}function Im(o,t,i,n){const e=Pa(_e(o,t,i)),r=Pa(_e(o,t,n)),s=Pa(_e(i,n,o)),a=Pa(_e(i,n,t));return!!(e!==r&&s!==a||e===0&&Ta(o,i,t)||r===0&&Ta(o,n,t)||s===0&&Ta(i,o,n)||a===0&&Ta(i,t,n))}function Ta(o,t,i){return t.x<=Math.max(o.x,i.x)&&t.x>=Math.min(o.x,i.x)&&t.y<=Math.max(o.y,i.y)&&t.y>=Math.min(o.y,i.y)}function Pa(o){return o>0?1:o<0?-1:0}function dS(o,t){let i=o;do{if(i.i!==o.i&&i.next.i!==o.i&&i.i!==t.i&&i.next.i!==t.i&&Im(i,i.next,o,t))return!0;i=i.next}while(i!==o);return!1}function bo(o,t){return _e(o.prev,o,o.next)<0?_e(o,t,o.next)>=0&&_e(o,o.prev,t)>=0:_e(o,t,o.prev)<0||_e(o,o.next,t)<0}function pS(o,t){let i=o,n=!1;const e=(o.x+t.x)/2,r=(o.y+t.y)/2;do i.y>r!=i.next.y>r&&i.next.y!==i.y&&e<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==o);return n}function km(o,t){const i=new au(o.i,o.x,o.y),n=new au(t.i,t.x,t.y),e=o.next,r=t.prev;return o.next=t,t.prev=o,i.next=e,e.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function mp(o,t,i,n){const e=new au(o,t,i);return n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function So(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function au(o,t,i){this.i=o,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gS(o,t,i,n){let e=0;for(let r=t,s=i-n;r<i;r+=n)e+=(o[s]-o[r])*(o[r+1]+o[s+1]),s=r;return e}class yo{static area(t){const i=t.length;let n=0;for(let e=i-1,r=0;r<i;e=r++)n+=t[e].x*t[r].y-t[r].x*t[e].y;return n*.5}static isClockWise(t){return yo.area(t)<0}static triangulateShape(t,i){const n=[],e=[],r=[];vp(t),_p(n,t);let s=t.length;i.forEach(vp);for(let h=0;h<i.length;h++)e.push(s),s+=i[h].length,_p(n,i[h]);const a=Kb.triangulate(n,e);for(let h=0;h<a.length;h+=3)r.push(a.slice(h,h+3));return r}}function vp(o){const t=o.length;t>2&&o[t-1].equals(o[0])&&o.pop()}function _p(o,t){for(let i=0;i<t.length;i++)o.push(t[i].x),o.push(t[i].y)}class Wu extends ae{constructor(t=new su([new bt(.5,.5),new bt(-.5,.5),new bt(-.5,-.5),new bt(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const n=this,e=[],r=[];for(let a=0,h=t.length;a<h;a++){const l=t[a];s(l)}this.setAttribute("position",new Fe(e,3)),this.setAttribute("uv",new Fe(r,2)),this.computeVertexNormals();function s(a){const h=[],l=i.curveSegments!==void 0?i.curveSegments:12,c=i.steps!==void 0?i.steps:1,u=i.depth!==void 0?i.depth:1;let f=i.bevelEnabled!==void 0?i.bevelEnabled:!0,d=i.bevelThickness!==void 0?i.bevelThickness:.2,p=i.bevelSize!==void 0?i.bevelSize:d-.1,g=i.bevelOffset!==void 0?i.bevelOffset:0,m=i.bevelSegments!==void 0?i.bevelSegments:3;const v=i.extrudePath,x=i.UVGenerator!==void 0?i.UVGenerator:mS;let _,y=!1,b,M,C,w;v&&(_=v.getSpacedPoints(c),y=!0,f=!1,b=v.computeFrenetFrames(c,!1),M=new G,C=new G,w=new G),f||(m=0,d=0,p=0,g=0);const S=a.extractPoints(l);let P=S.shape;const O=S.holes;if(!yo.isClockWise(P)){P=P.reverse();for(let J=0,Q=O.length;J<Q;J++){const lt=O[J];yo.isClockWise(lt)&&(O[J]=lt.reverse())}}const L=yo.triangulateShape(P,O),T=P;for(let J=0,Q=O.length;J<Q;J++){const lt=O[J];P=P.concat(lt)}function A(J,Q,lt){return Q.clone().multiplyScalar(lt).add(J)}const N=P.length,B=L.length;function F(J,Q,lt){let Ct,at,Ft;const Pt=J.x-Q.x,At=J.y-Q.y,ce=lt.x-J.x,re=lt.y-J.y,k=Pt*Pt+At*At,E=Pt*re-At*ce;if(Math.abs(E)>Number.EPSILON){const Y=Math.sqrt(k),ct=Math.sqrt(ce*ce+re*re),gt=Q.x-At/Y,wt=Q.y+Pt/Y,Gt=lt.x-re/ct,Mt=lt.y+ce/ct,nt=((Gt-gt)*re-(Mt-wt)*ce)/(Pt*re-At*ce);Ct=gt+Pt*nt-J.x,at=wt+At*nt-J.y;const Ot=Ct*Ct+at*at;if(Ot<=2)return new bt(Ct,at);Ft=Math.sqrt(Ot/2)}else{let Y=!1;Pt>Number.EPSILON?ce>Number.EPSILON&&(Y=!0):Pt<-Number.EPSILON?ce<-Number.EPSILON&&(Y=!0):Math.sign(At)===Math.sign(re)&&(Y=!0),Y?(Ct=-At,at=Pt,Ft=Math.sqrt(k)):(Ct=Pt,at=At,Ft=Math.sqrt(k/2))}return new bt(Ct/Ft,at/Ft)}const I=[];for(let J=0,Q=T.length,lt=Q-1,Ct=J+1;J<Q;J++,lt++,Ct++)lt===Q&&(lt=0),Ct===Q&&(Ct=0),I[J]=F(T[J],T[lt],T[Ct]);const z=[];let Z,j=I.concat();for(let J=0,Q=O.length;J<Q;J++){const lt=O[J];Z=[];for(let Ct=0,at=lt.length,Ft=at-1,Pt=Ct+1;Ct<at;Ct++,Ft++,Pt++)Ft===at&&(Ft=0),Pt===at&&(Pt=0),Z[Ct]=F(lt[Ct],lt[Ft],lt[Pt]);z.push(Z),j=j.concat(Z)}for(let J=0;J<m;J++){const Q=J/m,lt=d*Math.cos(Q*Math.PI/2),Ct=p*Math.sin(Q*Math.PI/2)+g;for(let at=0,Ft=T.length;at<Ft;at++){const Pt=A(T[at],I[at],Ct);pt(Pt.x,Pt.y,-lt)}for(let at=0,Ft=O.length;at<Ft;at++){const Pt=O[at];Z=z[at];for(let At=0,ce=Pt.length;At<ce;At++){const re=A(Pt[At],Z[At],Ct);pt(re.x,re.y,-lt)}}}const K=p+g;for(let J=0;J<N;J++){const Q=f?A(P[J],j[J],K):P[J];y?(C.copy(b.normals[0]).multiplyScalar(Q.x),M.copy(b.binormals[0]).multiplyScalar(Q.y),w.copy(_[0]).add(C).add(M),pt(w.x,w.y,w.z)):pt(Q.x,Q.y,0)}for(let J=1;J<=c;J++)for(let Q=0;Q<N;Q++){const lt=f?A(P[Q],j[Q],K):P[Q];y?(C.copy(b.normals[J]).multiplyScalar(lt.x),M.copy(b.binormals[J]).multiplyScalar(lt.y),w.copy(_[J]).add(C).add(M),pt(w.x,w.y,w.z)):pt(lt.x,lt.y,u/c*J)}for(let J=m-1;J>=0;J--){const Q=J/m,lt=d*Math.cos(Q*Math.PI/2),Ct=p*Math.sin(Q*Math.PI/2)+g;for(let at=0,Ft=T.length;at<Ft;at++){const Pt=A(T[at],I[at],Ct);pt(Pt.x,Pt.y,u+lt)}for(let at=0,Ft=O.length;at<Ft;at++){const Pt=O[at];Z=z[at];for(let At=0,ce=Pt.length;At<ce;At++){const re=A(Pt[At],Z[At],Ct);y?pt(re.x,re.y+_[c-1].y,_[c-1].x+lt):pt(re.x,re.y,u+lt)}}}et(),st();function et(){const J=e.length/3;if(f){let Q=0,lt=N*Q;for(let Ct=0;Ct<B;Ct++){const at=L[Ct];xt(at[2]+lt,at[1]+lt,at[0]+lt)}Q=c+m*2,lt=N*Q;for(let Ct=0;Ct<B;Ct++){const at=L[Ct];xt(at[0]+lt,at[1]+lt,at[2]+lt)}}else{for(let Q=0;Q<B;Q++){const lt=L[Q];xt(lt[2],lt[1],lt[0])}for(let Q=0;Q<B;Q++){const lt=L[Q];xt(lt[0]+N*c,lt[1]+N*c,lt[2]+N*c)}}n.addGroup(J,e.length/3-J,0)}function st(){const J=e.length/3;let Q=0;V(T,Q),Q+=T.length;for(let lt=0,Ct=O.length;lt<Ct;lt++){const at=O[lt];V(at,Q),Q+=at.length}n.addGroup(J,e.length/3-J,1)}function V(J,Q){let lt=J.length;for(;--lt>=0;){const Ct=lt;let at=lt-1;at<0&&(at=J.length-1);for(let Ft=0,Pt=c+m*2;Ft<Pt;Ft++){const At=N*Ft,ce=N*(Ft+1),re=Q+Ct+At,k=Q+at+At,E=Q+at+ce,Y=Q+Ct+ce;ut(re,k,E,Y)}}}function pt(J,Q,lt){h.push(J),h.push(Q),h.push(lt)}function xt(J,Q,lt){ft(J),ft(Q),ft(lt);const Ct=e.length/3,at=x.generateTopUV(n,e,Ct-3,Ct-2,Ct-1);kt(at[0]),kt(at[1]),kt(at[2])}function ut(J,Q,lt,Ct){ft(J),ft(Q),ft(Ct),ft(Q),ft(lt),ft(Ct);const at=e.length/3,Ft=x.generateSideWallUV(n,e,at-6,at-3,at-2,at-1);kt(Ft[0]),kt(Ft[1]),kt(Ft[3]),kt(Ft[1]),kt(Ft[2]),kt(Ft[3])}function ft(J){e.push(h[J*3+0]),e.push(h[J*3+1]),e.push(h[J*3+2])}function kt(J){r.push(J.x),r.push(J.y)}}}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,n=this.parameters.options;return vS(i,n,t)}static fromJSON(t,i){const n=[];for(let r=0,s=t.shapes.length;r<s;r++){const a=i[t.shapes[r]];n.push(a)}const e=t.options.extrudePath;return e!==void 0&&(t.options.extrudePath=new Om[e.type]().fromJSON(e)),new Wu(n,t.options)}}const mS={generateTopUV:function(o,t,i,n,e){const r=t[i*3],s=t[i*3+1],a=t[n*3],h=t[n*3+1],l=t[e*3],c=t[e*3+1];return[new bt(r,s),new bt(a,h),new bt(l,c)]},generateSideWallUV:function(o,t,i,n,e,r){const s=t[i*3],a=t[i*3+1],h=t[i*3+2],l=t[n*3],c=t[n*3+1],u=t[n*3+2],f=t[e*3],d=t[e*3+1],p=t[e*3+2],g=t[r*3],m=t[r*3+1],v=t[r*3+2];return Math.abs(a-c)<Math.abs(s-l)?[new bt(s,1-h),new bt(l,1-u),new bt(f,1-p),new bt(g,1-v)]:[new bt(a,1-h),new bt(c,1-u),new bt(d,1-p),new bt(m,1-v)]}};function vS(o,t,i){if(i.shapes=[],Array.isArray(o))for(let n=0,e=o.length;n<e;n++){const r=o[n];i.shapes.push(r.uuid)}else i.shapes.push(o.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class _S extends ae{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const i=[],n=new Set,e=new G,r=new G;if(t.index!==null){const s=t.attributes.position,a=t.index;let h=t.groups;h.length===0&&(h=[{start:0,count:a.count,materialIndex:0}]);for(let l=0,c=h.length;l<c;++l){const u=h[l],f=u.start,d=u.count;for(let p=f,g=f+d;p<g;p+=3)for(let m=0;m<3;m++){const v=a.getX(p+m),x=a.getX(p+(m+1)%3);e.fromBufferAttribute(s,v),r.fromBufferAttribute(s,x),yp(e,r,n)===!0&&(i.push(e.x,e.y,e.z),i.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let a=0,h=s.count/3;a<h;a++)for(let l=0;l<3;l++){const c=3*a+l,u=3*a+(l+1)%3;e.fromBufferAttribute(s,c),r.fromBufferAttribute(s,u),yp(e,r,n)===!0&&(i.push(e.x,e.y,e.z),i.push(r.x,r.y,r.z))}}this.setAttribute("position",new Fe(i,3))}}}function yp(o,t,i){const n=`${o.x},${o.y},${o.z}-${t.x},${t.y},${t.z}`,e=`${t.x},${t.y},${t.z}-${o.x},${o.y},${o.z}`;return i.has(n)===!0||i.has(e)===!0?!1:(i.add(n),i.add(e),!0)}class Jl extends Gi{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cm,this.normalScale=new bt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ou,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class yS extends Bu{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}const xp={enabled:!1,files:{},add:function(o,t){this.enabled!==!1&&(this.files[o]=t)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}};class xS{constructor(t,i,n){const e=this;let r=!1,s=0,a=0,h;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=n,this.itemStart=function(c){a++,r===!1&&e.onStart!==void 0&&e.onStart(c,s,a),r=!0},this.itemEnd=function(c){s++,e.onProgress!==void 0&&e.onProgress(c,s,a),s===a&&(r=!1,e.onLoad!==void 0&&e.onLoad())},this.itemError=function(c){e.onError!==void 0&&e.onError(c)},this.resolveURL=function(c){return h?h(c):c},this.setURLModifier=function(c){return h=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){const u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,f=l.length;u<f;u+=2){const d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}}const wS=new xS;class zm{constructor(t){this.manager=t!==void 0?t:wS,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const n=this;return new Promise(function(e,r){n.load(t,e,i,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}class MS extends zm{constructor(t){super(t)}load(t,i,n,e){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=xp.get(t);if(s!==void 0)return r.manager.itemStart(t),setTimeout(function(){i&&i(s),r.manager.itemEnd(t)},0),s;const a=wo("img");function h(){c(),xp.add(t,this),i&&i(this),r.manager.itemEnd(t)}function l(u){c(),e&&e(u),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){a.removeEventListener("load",h,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",h,!1),a.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class bS extends zm{constructor(t){super(t)}load(t,i,n,e){const r=new xi,s=new MS(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(a){r.image=a,r.needsUpdate=!0,i!==void 0&&i(r)},n,e),r}}class Fm extends Te{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new qt(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}const Yl=new ve,wp=new G,Mp=new G;class SS{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new bt(512,512),this.map=null,this.mapPass=null,this.matrix=new ve,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zu,this._frameExtents=new bt(1,1),this._viewportCount=1,this._viewports=[new Ve(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,n=this.matrix;wp.setFromMatrixPosition(t.matrixWorld),i.position.copy(wp),Mp.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(Mp),i.updateMatrixWorld(),Yl.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Yl),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Yl)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class CS extends SS{constructor(){super(new xm(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class TS extends Fm{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Te.DefaultUp),this.updateMatrix(),this.target=new Te,this.shadow=new CS}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class PS extends Fm{constructor(t,i){super(t,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class ES extends ae{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class hu extends Fb{constructor(t,i,n=1){super(t,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class AS{constructor(t,i,n=0,e=1/0){this.ray=new Bh(t,i),this.near=n,this.far=e,this.camera=null,this.layers=new Du,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,i){this.ray.set(t,i)}setFromCamera(t,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera&&(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i)}intersectObject(t,i=!0,n=[]){return lu(t,this,n,i),n.sort(bp),n}intersectObjects(t,i=!0,n=[]){for(let e=0,r=t.length;e<r;e++)lu(t[e],this,n,i);return n.sort(bp),n}}function bp(o,t){return o.distance-t.distance}function lu(o,t,i,n){if(o.layers.test(t.layers)&&o.raycast(t,i),n===!0){const e=o.children;for(let r=0,s=e.length;r<s;r++)lu(e[r],t,i,!0)}}class Nm extends Os{constructor(t,i,n,e,r,s){super(t,i,n,e,r,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Go}}));typeof window<"u"&&(window.__THREE__||(window.__THREE__=Go));var Bm={exports:{}};(function(o){(function(t){var i,n,e="fulfilled",r="undefined",s=function(){var c=[],u=0;function f(){for(;c.length-u;){try{c[u]()}catch(p){t.console&&t.console.error(p)}c[u++]=n,u==1024&&(c.splice(0,1024),u=0)}}var d=function(){if(typeof MutationObserver===r)return typeof process!==r&&typeof process.nextTick=="function"?function(){process.nextTick(f)}:typeof setImmediate!==r?function(){setImmediate(f)}:function(){setTimeout(f,0)};var p=document.createElement("div");return new MutationObserver(f).observe(p,{attributes:!0}),function(){p.setAttribute("a",0)}}();return function(p){c.push(p),c.length-u==1&&d()}}();function a(c){if(!(this instanceof a))throw new TypeError("Zousan must be created with the new keyword");if(typeof c=="function"){var u=this;try{c(function(f){u.resolve(f)},function(f){u.reject(f)})}catch(f){u.reject(f)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+c+" is not a function")}function h(c,u){if(typeof c.y=="function")try{var f=c.y.call(n,u);c.p.resolve(f)}catch(d){c.p.reject(d)}else c.p.resolve(u)}function l(c,u){if(typeof c.n=="function")try{var f=c.n.call(n,u);c.p.resolve(f)}catch(d){c.p.reject(d)}else c.p.reject(u)}a.prototype={resolve:function(c){if(this.state===i){if(c===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var u=this;if(c&&(typeof c=="function"||typeof c=="object"))try{var f=!0,d=c.then;if(typeof d=="function")return void d.call(c,function(p){f&&(f=!1,u.resolve(p))},function(p){f&&(f=!1,u.reject(p))})}catch(p){return void(f&&this.reject(p))}this.state=e,this.v=c,u.c&&s(function(){for(var p=0,g=u.c.length;p<g;p++)h(u.c[p],c)})}},reject:function(c){if(this.state===i){var u=this;this.state="rejected",this.v=c;var f=this.c;s(f?function(){for(var d=0,p=f.length;d<p;d++)l(f[d],c)}:function(){u.handled||!a.suppressUncaughtRejectionError&&t.console&&a.warn("You upset Zousan. Please catch rejections: ",c,c?c.stack:null)})}},then:function(c,u){var f=new a,d={y:c,n:u,p:f};if(this.state===i)this.c?this.c.push(d):this.c=[d];else{var p=this.state,g=this.v;this.handled=!0,s(function(){p===e?h(d,g):l(d,g)})}return f},catch:function(c){return this.then(null,c)},finally:function(c){return this.then(c,c)},timeout:function(c,u){u=u||"Timeout";var f=this;return new a(function(d,p){setTimeout(function(){p(Error(u))},c),f.then(function(g){d(g)},function(g){p(g)})})}},a.resolve=function(c){var u=new a;return u.resolve(c),u},a.reject=function(c){var u=new a;return u.c=[],u.reject(c),u},a.all=function(c){var u=[],f=0,d=new a;function p(m,v){m&&typeof m.then=="function"||(m=a.resolve(m)),m.then(function(x){u[v]=x,++f==c.length&&d.resolve(u)},function(x){d.reject(x)})}for(var g=0;g<c.length;g++)p(c[g],g);return c.length||d.resolve(u),d},a.warn=console.warn,o.exports&&(o.exports=a),t.define&&t.define.amd&&t.define([],function(){return a}),(t.Zousan=a).soon=s})(typeof nh<"u"?nh:nh)})(Bm);const LS=Bm.exports;var ju={exports:{}},Gm={exports:{}};(function(o,t){(function(i,n){o.exports=n()})(nh,function(){function i(s,a,h,l,c){n(s,a,h||0,l||s.length-1,c||r)}function n(s,a,h,l,c){for(;l>h;){if(l-h>600){var u=l-h+1,f=a-h+1,d=Math.log(u),p=.5*Math.exp(2*d/3),g=.5*Math.sqrt(d*p*(u-p)/u)*(f-u/2<0?-1:1),m=Math.max(h,Math.floor(a-f*p/u+g)),v=Math.min(l,Math.floor(a+(u-f)*p/u+g));n(s,a,m,v,c)}var x=s[a],_=h,y=l;for(e(s,h,a),c(s[l],x)>0&&e(s,h,l);_<y;){for(e(s,_,y),_++,y--;c(s[_],x)<0;)_++;for(;c(s[y],x)>0;)y--}c(s[h],x)===0?e(s,h,y):(y++,e(s,y,l)),y<=a&&(h=y+1),a<=y&&(l=y-1)}}function e(s,a,h){var l=s[a];s[a]=s[h],s[h]=l}function r(s,a){return s<a?-1:s>a?1:0}return i})})(Gm);ju.exports=Co;ju.exports.default=Co;var RS=Gm.exports;function Co(o,t){if(!(this instanceof Co))return new Co(o,t);this._maxEntries=Math.max(4,o||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),t&&this._initFormat(t),this.clear()}Co.prototype={all:function(){return this._all(this.data,[])},search:function(o){var t=this.data,i=[],n=this.toBBox;if(!Aa(o,t))return i;for(var e=[],r,s,a,h;t;){for(r=0,s=t.children.length;r<s;r++)a=t.children[r],h=t.leaf?n(a):a,Aa(o,h)&&(t.leaf?i.push(a):Kl(o,h)?this._all(a,i):e.push(a));t=e.pop()}return i},collides:function(o){var t=this.data,i=this.toBBox;if(!Aa(o,t))return!1;for(var n=[],e,r,s,a;t;){for(e=0,r=t.children.length;e<r;e++)if(s=t.children[e],a=t.leaf?i(s):s,Aa(o,a)){if(t.leaf||Kl(o,a))return!0;n.push(s)}t=n.pop()}return!1},load:function(o){if(!(o&&o.length))return this;if(o.length<this._minEntries){for(var t=0,i=o.length;t<i;t++)this.insert(o[t]);return this}var n=this._build(o.slice(),0,o.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var e=this.data;this.data=n,n=e}this._insert(n,this.data.height-n.height-1,!0)}return this},insert:function(o){return o&&this._insert(o,this.data.height-1),this},clear:function(){return this.data=ss([]),this},remove:function(o,t){if(!o)return this;for(var i=this.data,n=this.toBBox(o),e=[],r=[],s,a,h,l;i||e.length;){if(i||(i=e.pop(),a=e[e.length-1],s=r.pop(),l=!0),i.leaf&&(h=OS(o,i.children,t),h!==-1))return i.children.splice(h,1),e.push(i),this._condense(e),this;!l&&!i.leaf&&Kl(i,n)?(e.push(i),r.push(s),s=0,a=i,i=i.children[0]):a?(s++,i=a.children[s],l=!1):i=null}return this},toBBox:function(o){return o},compareMinX:Sp,compareMinY:Cp,toJSON:function(){return this.data},fromJSON:function(o){return this.data=o,this},_all:function(o,t){for(var i=[];o;)o.leaf?t.push.apply(t,o.children):i.push.apply(i,o.children),o=i.pop();return t},_build:function(o,t,i,n){var e=i-t+1,r=this._maxEntries,s;if(e<=r)return s=ss(o.slice(t,i+1)),Yr(s,this.toBBox),s;n||(n=Math.ceil(Math.log(e)/Math.log(r)),r=Math.ceil(e/Math.pow(r,n-1))),s=ss([]),s.leaf=!1,s.height=n;var a=Math.ceil(e/r),h=a*Math.ceil(Math.sqrt(r)),l,c,u,f;for(Tp(o,t,i,h,this.compareMinX),l=t;l<=i;l+=h)for(u=Math.min(l+h-1,i),Tp(o,l,u,a,this.compareMinY),c=l;c<=u;c+=a)f=Math.min(c+a-1,u),s.children.push(this._build(o,c,f,n-1));return Yr(s,this.toBBox),s},_chooseSubtree:function(o,t,i,n){for(var e,r,s,a,h,l,c,u;n.push(t),!(t.leaf||n.length-1===i);){for(c=u=1/0,e=0,r=t.children.length;e<r;e++)s=t.children[e],h=Ql(s),l=DS(o,s)-h,l<u?(u=l,c=h<c?h:c,a=s):l===u&&h<c&&(c=h,a=s);t=a||t.children[0]}return t},_insert:function(o,t,i){var n=this.toBBox,e=i?o:n(o),r=[],s=this._chooseSubtree(e,this.data,t,r);for(s.children.push(o),uo(s,e);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(e,r,t)},_split:function(o,t){var i=o[t],n=i.children.length,e=this._minEntries;this._chooseSplitAxis(i,e,n);var r=this._chooseSplitIndex(i,e,n),s=ss(i.children.splice(r,i.children.length-r));s.height=i.height,s.leaf=i.leaf,Yr(i,this.toBBox),Yr(s,this.toBBox),t?o[t-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(o,t){this.data=ss([o,t]),this.data.height=o.height+1,this.data.leaf=!1,Yr(this.data,this.toBBox)},_chooseSplitIndex:function(o,t,i){var n,e,r,s,a,h,l,c;for(h=l=1/0,n=t;n<=i-t;n++)e=co(o,0,n,this.toBBox),r=co(o,n,i,this.toBBox),s=IS(e,r),a=Ql(e)+Ql(r),s<h?(h=s,c=n,l=a<l?a:l):s===h&&a<l&&(l=a,c=n);return c},_chooseSplitAxis:function(o,t,i){var n=o.leaf?this.compareMinX:Sp,e=o.leaf?this.compareMinY:Cp,r=this._allDistMargin(o,t,i,n),s=this._allDistMargin(o,t,i,e);r<s&&o.children.sort(n)},_allDistMargin:function(o,t,i,n){o.children.sort(n);var e=this.toBBox,r=co(o,0,t,e),s=co(o,i-t,i,e),a=Ea(r)+Ea(s),h,l;for(h=t;h<i-t;h++)l=o.children[h],uo(r,o.leaf?e(l):l),a+=Ea(r);for(h=i-t-1;h>=t;h--)l=o.children[h],uo(s,o.leaf?e(l):l),a+=Ea(s);return a},_adjustParentBBoxes:function(o,t,i){for(var n=i;n>=0;n--)uo(t[n],o)},_condense:function(o){for(var t=o.length-1,i;t>=0;t--)o[t].children.length===0?t>0?(i=o[t-1].children,i.splice(i.indexOf(o[t]),1)):this.clear():Yr(o[t],this.toBBox)},_initFormat:function(o){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(o[0])),this.compareMinY=new Function("a","b",t.join(o[1])),this.toBBox=new Function("a","return {minX: a"+o[0]+", minY: a"+o[1]+", maxX: a"+o[2]+", maxY: a"+o[3]+"};")}};function OS(o,t,i){if(!i)return t.indexOf(o);for(var n=0;n<t.length;n++)if(i(o,t[n]))return n;return-1}function Yr(o,t){co(o,0,o.children.length,t,o)}function co(o,t,i,n,e){e||(e=ss(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var r=t,s;r<i;r++)s=o.children[r],uo(e,o.leaf?n(s):s);return e}function uo(o,t){return o.minX=Math.min(o.minX,t.minX),o.minY=Math.min(o.minY,t.minY),o.maxX=Math.max(o.maxX,t.maxX),o.maxY=Math.max(o.maxY,t.maxY),o}function Sp(o,t){return o.minX-t.minX}function Cp(o,t){return o.minY-t.minY}function Ql(o){return(o.maxX-o.minX)*(o.maxY-o.minY)}function Ea(o){return o.maxX-o.minX+(o.maxY-o.minY)}function DS(o,t){return(Math.max(t.maxX,o.maxX)-Math.min(t.minX,o.minX))*(Math.max(t.maxY,o.maxY)-Math.min(t.minY,o.minY))}function IS(o,t){var i=Math.max(o.minX,t.minX),n=Math.max(o.minY,t.minY),e=Math.min(o.maxX,t.maxX),r=Math.min(o.maxY,t.maxY);return Math.max(0,e-i)*Math.max(0,r-n)}function Kl(o,t){return o.minX<=t.minX&&o.minY<=t.minY&&t.maxX<=o.maxX&&t.maxY<=o.maxY}function Aa(o,t){return t.minX<=o.maxX&&t.minY<=o.maxY&&t.maxX>=o.minX&&t.maxY>=o.minY}function ss(o){return{children:o,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Tp(o,t,i,n,e){for(var r=[t,i],s;r.length;)i=r.pop(),t=r.pop(),!(i-t<=n)&&(s=t+Math.ceil((i-t)/n/2)*n,RS(o,s,t,i,e),r.push(t,s,s,i))}var Hm={exports:{}};(function(o){(function(){function t(a,h){var l=a.x-h.x,c=a.y-h.y;return l*l+c*c}function i(a,h,l){var c=h.x,u=h.y,f=l.x-c,d=l.y-u;if(f!==0||d!==0){var p=((a.x-c)*f+(a.y-u)*d)/(f*f+d*d);p>1?(c=l.x,u=l.y):p>0&&(c+=f*p,u+=d*p)}return f=a.x-c,d=a.y-u,f*f+d*d}function n(a,h){for(var l=a[0],c=[l],u,f=1,d=a.length;f<d;f++)u=a[f],t(u,l)>h&&(c.push(u),l=u);return l!==u&&c.push(u),c}function e(a,h,l,c,u){for(var f=c,d,p=h+1;p<l;p++){var g=i(a[p],a[h],a[l]);g>f&&(d=p,f=g)}f>c&&(d-h>1&&e(a,h,d,c,u),u.push(a[d]),l-d>1&&e(a,d,l,c,u))}function r(a,h){var l=a.length-1,c=[a[0]];return e(a,0,l,h,c),c.push(a[l]),c}function s(a,h,l){if(a.length<=2)return a;var c=h!==void 0?h*h:1;return a=l?a:n(a,c),a=r(a,c),a}o.exports=s,o.exports.default=s})()})(Hm);const kS=Hm.exports;/*!
* Contains code from THREE.js
* MIT License
* https://github.com/mrdoob/three.js
*/var Pn=[];for(var tc=0;tc<6;tc++)Pn[tc]=[];var La=[];function ec(o,t,i){zS(o);for(var n=0;n<6;n++)if(!(i&&i.charAt(n)==="0")){var e=Pn[n];if(La[0]=e[0]>0?t[1][0]:t[0][0],La[1]=e[1]>0?t[1][1]:t[0][1],La[2]=e[2]>0?t[1][2]:t[0][2],FS(e,La)<0)return!1}return!0}function zS(o){var t=o,i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],a=t[5],h=t[6],l=t[7],c=t[8],u=t[9],f=t[10],d=t[11],p=t[12],g=t[13],m=t[14],v=t[15];Qr(Pn[0],r-i,l-s,d-c,v-p),Qr(Pn[1],r+i,l+s,d+c,v+p),Qr(Pn[2],r+n,l+a,d+u,v+g),Qr(Pn[3],r-n,l-a,d-u,v-g),Qr(Pn[4],r-e,l-h,d-f,v-m),Qr(Pn[5],r+e,l+h,d+f,v+m)}var Ra=1/6;function Qr(o,t,i,n,e){return o[0]=t*Ra,o[1]=i*Ra,o[2]=n*Ra,o[3]=e*Ra,o}function FS(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]+o[3]}/*!
 * maptalks v1.0.0-rc.14
 * LICENSE : BSD-3-Clause
 * (c) 2016-2022 maptalks.org
 */var NS="1.0.0-rc.14",Vo="_maptalks__internal_layer_",Um=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],BS=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(Um),Vm=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],GS=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],HS={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},US=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],Wm=14;function me(){return Date.now()}function dt(o){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)o[n]=i[n]}return o}function H(o){return o==null}function St(o){return typeof o=="number"&&!isNaN(o)}function en(o){return(o|0)===o}function yi(o){return typeof o=="object"&&!!o}function Xt(o){return H(o)?!1:typeof o=="string"||o.constructor!==null&&o.constructor===String}function ne(o){return H(o)?!1:typeof o=="function"||o.constructor!==null&&o.constructor===Function}var VS=Object.prototype.hasOwnProperty;function Is(o,t){return VS.call(o,t)}function WS(o,t){return o.join?o.join(t||","):Array.prototype.join.call(o,t||",")}function jS(o){var t;for(t in o)return!1;return!t}var jm=Math.PI/180;function He(o){return o*jm}function Zm(o){return o/jm}var De=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"],Ti={},Oa={};function Pp(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!De){var Ji=navigator.userAgent.toLowerCase(),ic=document.documentElement,Kr="ActiveXObject"in window,nc=Ji.indexOf("webkit")!==-1,rc=Ji.indexOf("phantom")!==-1,Ep=Ji.search("android [23]")!==-1,sc=Ji.indexOf("chrome")!==-1,Ap=Ji.indexOf("gecko")!==-1&&!nc&&!window.opera&&!Kr,Xs=typeof orientation<"u"||Ji.indexOf("mobile")!==-1,Lp=!window.PointerEvent&&window.MSPointerEvent,Rp=window.PointerEvent&&navigator.pointerEnabled||Lp,Op=Kr&&"transition"in ic.style,oc="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ep,Dp="MozPerspective"in ic.style,Ip="OTransition"in ic.style,ZS=(Op||oc||Dp)&&!Ip&&!rc,XS=typeof window<"u"&&ne(window.createImageBitmap),$S=typeof window<"u"&&ne(window.ResizeObserver),qS=typeof window<"u"&&ne(window.btoa),kp=0;sc&&(kp=Ji.match(/chrome\/([\d.]+)/)[1]);var JS=!rc&&(Rp||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),YS=typeof window<"u"&&"WebGLRenderingContext"in window,zp=Pp(),ac=!1;try{var QS=new OffscreenCanvas(2,2);QS.getContext("2d"),ac=!0}catch{ac=!1}var Fp=!1;try{window.addEventListener("testPassive",function(){},{get passive(){Fp=!0}})}catch{}if(Ti={ie:Kr,ielt9:Kr&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:nc,gecko:Ap,android:Ji.indexOf("android")!==-1,android23:Ep,chrome:sc,chromeVersion:kp,safari:!sc&&Ji.indexOf("safari")!==-1,phantomjs:rc,ie3d:Op,webkit3d:oc,gecko3d:Dp,opera12:Ip,any3d:ZS,mobile:Xs,mobileWebkit:Xs&&nc,mobileWebkit3d:Xs&&oc,mobileOpera:Xs&&window.opera,mobileGecko:Xs&&Ap,touch:!!JS,msPointer:!!Lp,pointer:!!Rp,retina:zp>1,devicePixelRatio:zp,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:Kr&&document.documentMode===9,ie10:Kr&&document.documentMode===10,webgl:YS,imageBitMap:XS,resizeObserver:$S,btoa:qS,decodeImageInWorker:ac,monitorDPRChange:!0,supportsPassive:Fp,removeDPRListening:function(t){t&&delete Oa[t.id]},checkDevicePixelRatio:function(){if(typeof window<"u"&&Ti.monitorDPRChange){var t=Pp(),i=t!==Ti.devicePixelRatio;return i&&(Ti.devicePixelRatio=t),i}return!1},addDPRListening:function(t){t&&(Oa[t.id]=t)}},typeof window<"u"&&window.matchMedia)for(var hc=1;hc<500;hc++){var KS=(hc*.01).toFixed(2),$s=window.matchMedia("screen and (resolution: "+KS+"dppx)");$s&&($s.addEventListener?$s.addEventListener("change",Ti.checkDevicePixelRatio):$s.addListener&&$s.addListener(Ti.checkDevicePixelRatio))}if(Ti.devicePixelRatio){var lc=Ti.devicePixelRatio;Object.defineProperty(Ti,"devicePixelRatio",{get:function(){return lc},set:function(t){if(t!==lc&&(lc=t,!!Ti.monitorDPRChange))for(var i in Oa){var n=Oa[i];if(!(!n||!n.options||n.options.devicePixelRatio||!n.checkSize||!n.getRenderer)){var e=n.getRenderer();e&&n.checkSize(!0)}}}})}}var jt=Ti;function ht(o,t){o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.__proto__=t}function ze(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}var Xm=function(){function o(i,n,e){if(!H(i)&&!H(n)?(this.x=+i,this.y=+n,this.z=e):!H(i.x)&&!H(i.y)?(this.x=+i.x,this.y=+i.y,this.z=i.z):Array.isArray(i)&&(this.x=+i[0],this.y=+i[1],this.z=i[2]),this._isNaN())throw new Error("Position is NaN")}var t=o.prototype;return t.set=function(n,e,r){return this.x=n,this.y=e,this.z=r||0,this},t.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},t._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},t._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},t._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},t.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},t.distanceTo=function(n){var e=n.x-this.x,r=n.y-this.y;return Math.sqrt(e*e+r*r)},t.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},t.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},t.copy=function(){return new this.constructor(this.x,this.y,this.z)},t._add=function(n,e){return H(n.x)?H(n[0])?(this.x+=n,this.y+=e):(this.x+=n[0],this.y+=n[1]):(this.x+=n.x,this.y+=n.y),this},t.add=function(n,e){var r,s;return H(n.x)?H(n[0])?(r=this.x+n,s=this.y+e):(r=this.x+n[0],s=this.y+n[1]):(r=this.x+n.x,s=this.y+n.y),new this.constructor(r,s)},t._sub=function(n,e){return H(n.x)?H(n[0])?(this.x-=n,this.y-=e):(this.x-=n[0],this.y-=n[1]):(this.x-=n.x,this.y-=n.y),this},t._substract=function(){return this._sub.apply(this,arguments)},t.sub=function(n,e){var r,s;return H(n.x)?H(n[0])?(r=this.x-n,s=this.y-e):(r=this.x-n[0],s=this.y-n[1]):(r=this.x-n.x,s=this.y-n.y),new this.constructor(r,s)},t.substract=function(){return this.sub.apply(this,arguments)},t.multi=function(n){return new this.constructor(this.x*n,this.y*n)},t._multi=function(n){return this.x*=n,this.y*=n,this},t.div=function(n){return this.multi(1/n)},t._div=function(n){return this._multi(1/n)},t.equals=function(n){return n instanceof this.constructor?this.x===n.x&&this.y===n.y&&this.z===n.z:!1},t._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},t.isZero=function(){return this.x===0&&this.y===0},t.toArray=function(){return St(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},t.toFixed=function(n){return new this.constructor(this.x.toFixed(n),this.y.toFixed(n))},t.toJSON=function(){return{x:this.x,y:this.y}},o}(),W=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.closeTo=function(e,r){return r||(r=0),this.x>=e.x-r&&this.x<=e.x+r&&this.y>=e.y-r&&this.y<=e.y+r},i.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.unit=function(){return this.copy()._unit()},i._unit=function(){return this._div(this.mag()),this},i.perp=function(){return this.copy()._perp()},i._perp=function(){var e=this.y;return this.y=this.x,this.x=-e,this},i.angleWith=function(e){return this.angleWithSep(e.x,e.y)},i.angleWithSep=function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},i._rotate=function(e){var r=Math.cos(e),s=Math.sin(e),a=r*this.x-s*this.y,h=s*this.x+r*this.y;return this.x=a,this.y=h,this},i.rotate=function(e){return this.copy()._rotate(e)},t}(Xm),Fi,To;(function(){if(De){Fi=function(s){return setTimeout(s,16)},To=clearTimeout;return}var o,t,i=1e3/30;function n(r){return setTimeout(r,i)}function e(r){return window["webkit"+r]||window["moz"+r]||window["ms"+r]}typeof window<"u"?(o=window.requestAnimationFrame||e("RequestAnimationFrame")||n,t=window.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(r){window.clearTimeout(r)}):(o=n,t=clearTimeout),Fi=function(s){return o(s)},To=function(s){s&&t(s)}})();function gr(o){var t="data:image/svg+xml";return o.length>4&&o.slice(-4)===".svg"?1:o.slice(0,t.length)===t?2:0}function Po(o,t){if(De&&Po.node){Po.node(o,t);return}o.src=t[0]}var tC=0;function Xn(){return tC++}var eC=Xn;function Uh(o){return!o||!Xt(o)?o:JSON.parse(o)}function Ar(o){for(var t=1;t<arguments.length;t++){var i=arguments[t];if(i)for(var n=0,e=i.length;n<e;n++)o.push(i[n])}return o.length}function dh(o,t){var i=t.indexOf(o);i>-1&&t.splice(i,1)}function Mr(o,t,i){if(!Array.isArray(o))return i?t.call(i,o):t(o);for(var n=[],e,r,s=0,a=o.length;s<a;s++){if(e=o[s],H(e)){n.push(null);continue}Array.isArray(e)?n.push(Mr(e,t,i)):(r=i?t.call(i,e):t(e),n.push(r))}return n}function Tt(o,t){return o===void 0?t:o}function Ie(o){return Math.sign?Math.sign(o):(o=+o,o===0||isNaN(o)?Number(o):o>0?1:-1)}function cu(o){if(Math.log2)return Math.log2(o);var t=Math.log(o)*Math.LOG2E,i=Math.round(t);return Math.abs(i-t)<1e-14?i:t}function ph(o,t,i){return o*(1-i)+t*i}function Gn(o,t,i){if(o===i||o===t)return o;var n=i-t,e=((o-t)%n+n)%n+t;return e}function gh(o,t,i){return Math.min(i,Math.max(t,o))}function ee(o){return Array.isArray(o)&&o.length>0}var iC=/^([a-z][a-z\d+\-.]*:)?\/\//i;function nC(o){return iC.test(o)}var $m=/^url\((['"])(.+)\1\)$/i,qm=/^url\(([^'"].*[^'"])\)$/i;function Jm(o){return Xt(o)?qm.test(o)?1:$m.test(o)?2:3:0}function Vh(o){var t=Jm(o),i;return t===3?o:t===1?(i=qm.exec(o),i[1]):t===2?(i=$m.exec(o),i[2]):o}var rC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ym(o){if(jt.btoa)return window.btoa(o);for(var t=String(o),i="",n,e,r=0,s=rC;t.charAt(r|0)||(s="=",r%1);i+=s.charAt(63&n>>8-r%1*8)){if(e=t.charCodeAt(r+=3/4),e>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|e}return i}function Qm(o,t){for(var i=atob(o),n=new ArrayBuffer(i.length),e=new Uint8Array(n),r=0;r<i.length;r++)e[r]=i.charCodeAt(r)&255;var s=new Blob([n],{type:t});return s}function mh(o,t,i,n){var e=i-o,r=n-t;return Math.atan2(r,e)}var Zu="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function vh(o,t){if(!o&&!t)return!0;if(!o||!t)return!1;for(var i in o)if(i==="center"){if(!t[i]||!Np(o[i][0],t[i][0])||!Np(o[i][1],t[i][1]))return!1}else if(o[i]!==t[i])return!1;return!0}function Np(o,t,i){return i==null&&(i=1e-6),o>=t-i&&o<=t+i}function Xu(o,t,i,n){o||(o=100),t||(t=4);var e=this;t*=2,this._flashTimeout&&clearTimeout(this._flashTimeout);function r(){if(t===0){e.show(),i&&(n?i.call(n):i());return}t%2===0?e.hide():e.show(),t--,e._flashTimeout=setTimeout(r,o)}return this._flashTimeout=setTimeout(r,o),this}function sC(o,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var e=i[n],r=Object.getOwnPropertyDescriptor(t,e);r&&r.configurable&&o[e]===void 0&&Object.defineProperty(o,e,r)}return o}function Eo(o,t){o===void 0&&(o=[]),t===void 0&&(t="_pt");for(var i=[],n=0,e=o.length;n<e;n++){var r=o[n];if(!r){i.push(null);continue}r[t]||(r[t]=new W(0,0));var s=r[t];s.x=0,s.y=0,i.push(s)}return i}var Km;if(jt.decodeImageInWorker){var cc=document.createElement("canvas");cc.width=1,cc.height=1,Km=cc.getContext("2d")}function $u(o,t){var i=Km.createImageData(o.width,o.height);i.data.set(o.data),createImageBitmap(i).then(function(n){t(n)})}function qu(o){if(o&&o.indexOf("http://")===0||o.indexOf("https://")===0)return o;var t=document.createElement("a");return t.href=o,o=t.href,t=null,o}var qs={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function Ju(o,t){t===void 0&&(t=1);var i=o.width,n=o.height;return qs.cssWidth=i+"px",qs.cssHeight=n+"px",qs.width=Math.round(i*t),qs.height=Math.round(n*t),qs}function tv(o,t){var i,n,e;if(!Ae(o))i=function(){return o},n=!0,e=!0;else{var r=o.stops&&typeof o.stops[0][0]=="object",s=r||o.property!==void 0,a=r||!s,h=o.type||t||"exponential",l;if(h==="exponential")l=Bp;else if(h==="interval")l=hC;else if(h==="categorical")l=aC;else if(h==="identity")l=lC;else throw new Error('Unknown function type "'+h+'"');if(r){for(var c={},u=[],f=0;f<o.stops.length;f++){var d=o.stops[f];c[d[0].zoom]===void 0&&(c[d[0].zoom]={zoom:d[0].zoom,type:o.type,property:o.property,default:o.default,stops:[]}),c[d[0].zoom].stops.push([d[0].value,d[1]])}for(var p in c)u.push([c[p].zoom,tv(c[p])]);i=function(m,v){var x=Bp({stops:u,base:o.base},m)(m,v);return typeof x=="function"?x(m,v):x},n=!1,e=!1}else a?(i=function(m){var v=l(o,m);return typeof v=="function"?v(m):v},n=!0,e=!1):(i=function(m,v){var x=l(o,v?v[o.property]:null);return typeof x=="function"?x(m,v):x},n=!1,e=!0)}return i.isZoomConstant=e,i.isFeatureConstant=n,i}function oC(o,t,i){return o!==void 0?o:t!==void 0?t:i!==void 0?i:null}function aC(o,t){for(var i=0;i<o.stops.length;i++)if(t===o.stops[i][0])return o.stops[i][1];return o.default}function hC(o,t){for(var i=0;i<o.stops.length&&!(t<o.stops[i][0]);i++);return o.stops[Math.max(i-1,0)][1]}function Bp(o,t){for(var i=o.base!==void 0?o.base:1,n=0;!(n>=o.stops.length);){if(t<=o.stops[n][0])break;n++}return n===0?o.stops[n][1]:n===o.stops.length?o.stops[n-1][1]:ev(t,i,o.stops[n-1][0],o.stops[n][0],o.stops[n-1][1],o.stops[n][1])}function lC(o,t){return oC(t,o.default)}function ev(o,t,i,n,e,r){return typeof e=="function"?function(){var s=e.apply(void 0,arguments),a=r.apply(void 0,arguments);return ev(o,t,i,n,s,a)}:e.length?cC(o,t,i,n,e,r):iv(o,t,i,n,e,r)}function iv(o,t,i,n,e,r){var s=n-i,a=o-i,h;return t===1?h=a/s:h=(Math.pow(t,a)-1)/(Math.pow(t,s)-1),e*(1-h)+r*h}function cC(o,t,i,n,e,r){for(var s=[],a=0;a<e.length;a++)s[a]=iv(o,t,i,n,e[a],r[a]);return s}function Ae(o){return o&&typeof o=="object"&&(o.stops||o.property&&o.type==="identity")}function nv(o){for(var t in o)if(Ae(o[t]))return!0;return!1}function rv(o){return sv(o,"exponential")}function Yu(o,t){if(!o)return null;var i=!1;if(Array.isArray(o)){for(var n=[],e,r=0;r<o.length;r++)e=Yu(o[r],t),e?(n.push(e),i=!0):n.push(o[r]);return i?n:o}var s={__fn_types_loaded:!0},a=[],h;for(h in o)o.hasOwnProperty(h)&&a.push(h);for(var l=function(d){Object.defineProperty(s,d,{get:function(){return this["__fn_"+d]||(this["__fn_"+d]=rv(this["_"+d])),this["__fn_"+d].apply(this,t())},set:function(g){this["_"+d]=g},configurable:!0,enumerable:!0})},c=0,u=a.length;c<u;c++)h=a[c],Ae(o[h])?(i=!0,s["_"+h]=o[h],l(h)):s[h]=o[h];return i?s:o}function Gp(o){if(!o||!o.stops)return[];for(var t=[],i=0,n=o.stops.length;i<n;i++)t.push(o.stops[i][1]);return t}function sv(o,t){if(!Ae(o))return function(){return o};o=JSON.parse(JSON.stringify(o));var i=!0,n=!0,e=o.stops;if(e){for(var r=0;r<e.length;r++)if(Ae(e[r][1])){var s=sv(e[r][1],t);i=i&&s.isZoomConstant,n=n&&s.isFeatureConstant,e[r]=[e[r][0],s]}}var a=tv(o,t);return a.isZoomConstant=i&&a.isZoomConstant,a.isFeatureConstant=n&&a.isFeatureConstant,a}var Qu=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Ku(o){return new Function("f","var p = (f && f.properties || {}); return "+ov(o))}function ov(o){if(!o)return"true";var t=o[0];if(o.length<=1)return t==="any"?"false":"true";var i=t==="=="?uc(o[1],o[2],"===",!1):t==="!="?uc(o[1],o[2],"!==",!1):t==="<"||t===">"||t==="<="||t===">="?uc(o[1],o[2],t,!0):t==="any"?fc(o.slice(1),"||"):t==="all"?fc(o.slice(1),"&&"):t==="none"?dc(fc(o.slice(1),"||")):t==="in"?Hp(o[1],o.slice(2)):t==="!in"?dc(Hp(o[1],o.slice(2))):t==="has"?Up(o[1]):t==="!has"?dc(Up(o[1])):"true";return"("+i+")"}function av(o){return o[0]==="$"?"f."+o.substring(1):"p["+JSON.stringify(o)+"]"}function uc(o,t,i,n){var e=av(o),r=o==="$type"?Qu.indexOf(t):JSON.stringify(t);return(n?"typeof "+e+"=== typeof "+r+"&&":"")+e+i+r}function fc(o,t){return o.map(ov).join(t)}function Hp(o,t){o==="$type"&&(t=t.map(function(e){return Qu.indexOf(e)}));var i=JSON.stringify(t.sort(uC)),n=av(o);return t.length<=200?i+".indexOf("+n+") !== -1":`function(v, a, i, j) {
        while (i <= j) { var m = (i + j) >> 1;
            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;
        }
    return false; }(`+n+", "+i+",0,"+(t.length-1)+")"}function Up(o){return o==="$id"?'"id" in f':JSON.stringify(o)+" in p"}function dc(o){return"!("+o+")"}function uC(o,t){return o<t?-1:o>t?1:0}function uu(o){var t=o._toJSON(),i=t.feature;return i.type=Qu.indexOf(i.geometry.type),i.subType=t.subType,i}function hv(o){if(!Array.isArray(o))return hv([o]);for(var t=[],i=0;i<o.length;i++){var n=void 0;o[i].filter===!0?n=function(){return!0}:n=Ku(o[i].filter),t.push(fC({},o[i],{filter:n}))}return t}function fC(o){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)o[n]=i[n]}return o}var dC=[],pC={};function _h(o,t){return Yu(o,function(){var i=t.getMap();return gC(dC,i?i.getZoom():12,dt({},t.getProperties(),mC(pC,i&&i.getBearing()||0,i&&i.getPitch()||0,i?i.getZoom():10)))})}function gC(o,t,i){return o[0]=t,o[1]=i,o}function mC(o,t,i,n){return o["{bearing}"]=t,o["{pitch}"]=i,o["{zoom}"]=n,o}function lv(o){var t={stroke:{stroke:o.markerLineColor,"stroke-width":o.markerLineWidth,"stroke-opacity":o.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:o.markerFill,"fill-opacity":o.markerFillOpacity}};return t.stroke["stroke-width"]===0&&(t.stroke["stroke-opacity"]=0),t}function Ao(o,t,i){if(!o.markerPath)return null;var n=1,e=lv(o);St(o.markerOpacity)&&(n=o.markerOpacity),St(o.opacity)&&(n*=o.opacity);var r={};if(e){for(var s in e.stroke)e.stroke.hasOwnProperty(s)&&(H(e.stroke[s])||(r[s]=e.stroke[s]));for(var a in e.fill)e.fill.hasOwnProperty(a)&&(H(e.fill[a])||(r[a]=e.fill[a]))}for(var h=Array.isArray(o.markerPath)?o.markerPath:[o.markerPath],l,c=[],u=0;u<h.length;u++)l=Xt(h[u])?{path:h[u]}:h[u],l=dt({},l,r),l.d=l.path,delete l.path,c.push(l);var f=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];n<1&&f.push('opacity="'+n+'"'),o.markerPathWidth&&o.markerPathHeight&&f.push('viewBox="0 0 '+o.markerPathWidth+" "+o.markerPathHeight+'"'),f.push('preserveAspectRatio="none"'),t&&f.push('width="'+t+'"'),i&&f.push('height="'+i+'"'),f.push("><defs></defs>");for(var d=0;d<c.length;d++){var p="<path ";for(var g in c[d])c[d].hasOwnProperty(g)&&(p+=" "+g+'="'+c[d][g]+'"');p+="></path>",f.push(p)}f.push("</svg>");var m="data:image/svg+xml;base64,"+Ym(f.join(" "));return m}function Wo(o,t){if(!o)return[];var i=o;Array.isArray(o)||(i=[o]);for(var n=[],e=Vm,r,s,a,h,l=i.length-1;l>=0;l--)if(o=i[l],!!o){t&&(o=yh(o));for(var c=0;c<e.length;c++)if(r=o[e[c]],Ae(r)&&(r=Gp(r)),!!r){Array.isArray(r)||(r=[r]);for(var u=0;u<r.length;u++)r[u].slice(0,4)==="url("&&(r[u]=Vh(r[u])),s=GS[c],n.push([r[u],o[s[0]],o[s[1]]])}if(o.markerType==="path"&&o.markerPath)if(a=Ae(o.markerWidth)?200:o.markerWidth,h=Ae(o.markerHeight)?200:o.markerHeight,Ae(o.markerPath)){r=Gp(o.markerPath);for(var f=o.markerPath,d=0;d<r.length;d++)o.markerPath=r[d],n.push([Ao(o),a,h]);o.markerPath=f}else n.push([Ao(o),a,h])}return n}function yh(o){if(!o)return null;var t=o;if(De)return t;for(var i=Vm,n,e=0,r=i.length;e<r;e++)n=t[i[e]],n&&(t[i[e]]=cv(n));return t}function cv(o){if(Ae(o)){for(var t=o.stops,i=0;i<t.length;i++)t[i][1]=cv(t[i][1]);return o}return o.slice(0,4)==="url("&&(o=Vh(o)),o}var Pe=function(){function o(i,n){St(i)&&St(n)?(this.width=i,this.height=n):St(i.width)?(this.width=i.width,this.height=i.height):Array.isArray(i)&&(this.width=i[0],this.height=i[1])}var t=o.prototype;return t.copy=function(){return new o(this.width,this.height)},t.add=function(n,e){var r,s;return n instanceof o?(r=this.width+n.width,s=this.height+n.height):(r=this.width+n,s=this.height+e),new o(r,s)},t.equals=function(n){return this.width===n.width&&this.height===n.height},t.multi=function(n){return new o(this.width*n,this.height*n)},t._multi=function(n){return this.width*=n,this.height*=n,this},t._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},t.toPoint=function(){return new W(this.width,this.height)},t.toArray=function(){return[this.width,this.height]},t.toJSON=function(){return{width:this.width,height:this.height}},o}();function tf(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}var vC=/[\b\t\r\v\f]/igm;function Wh(o){return Xt(o)?o.replace(vC,""):o}function uv(o){return tf(o).split(/\s+/)}var Vp=typeof document<"u"?document.createElement("canvas").getContext("2d"):null;function Fn(o,t){return Fn.node?Fn.node(o,t):(Vp.font=t,Vp.measureText(o).width)}function ef(o,t,i){var n=Fn(o,t);return new Pe(n,i||Wm)}function fu(o,t,i,n){if(!o||o.length===0)return[{text:"",width:0}];var e=H(n)?Fn(o,t):n,r=e/o.length,s=Math.floor(i/r/2);if(r>=i||s<=0)return[{text:"",width:i}];if(e<=i)return[{text:o,width:e}];for(var a=[],h=o.substring(0,s),l=r*s,c=s,u=o.length;c<u;c++){var f=o[c],d=Fn(h+f);d>=i?(a.push({text:h,width:l}),h=o.substring(c,s+c),c+=s-1,l=r*s):(h+=f,l=d),c>=u-1&&(l=Fn(h),a.push({text:h,width:l}))}return a}var fv=/\{([\w_]+)\}/g;function xh(o,t){return Xt(o)?o.replace(fv,function(i,n){if(!t)return"";var e=t[n];return H(e)?"":Array.isArray(e)?e.join():e}):o}function wh(o,t){St(o)&&(o+=""),o=o||"";var i=t.textMaxHeight||0,n=rf(o,t);return i&&i<n.size.height&&(n.size.height=i),n}function Hn(o,t,i){var n=o.width,e=o.height,r,s;return t==="left"?r=-n:t==="right"?r=0:r=-n/2,i==="top"?s=-e:i==="bottom"?s=0:s=-e/2,new W(r,s)}var _C="monospace";function nf(o){return o.textFont?o.textFont:(o.textStyle&&o.textStyle!=="normal"?o.textStyle+" ":"")+(o.textWeight&&o.textWeight!=="normal"?o.textWeight+" ":"")+o.textSize+"px "+(o.textFaceName?o.textFaceName[0]==='"'?o.textFaceName:'"'+o.textFaceName+'"':_C)}function rf(o,t){var i=nf(t),n=t.textLineSpacing||0,e=ef(o,i,t.textSize),r=e.width,s=e.height,a=t.textWrapCharacter,h=[],l=t.textWrapWidth;(!l||l>r)&&(l=r),Xt(o)||(o+="");var c=0;if(a&&o.indexOf(a)>=0)for(var u=o.split(a),f=0,d=u.length;f<d;f++){var p=u[f],g=Fn(p,i);if(g>l)for(var m=fu(p,i,l,g),v=0,x=m.length;v<x;v++){var _=m[v].width;_>c&&(c=_),h.push({text:m[v].text,size:new Pe(_,s)})}else g>c&&(c=g),h.push({text:p,size:new Pe(g,s)})}else if(r>l)for(var y=fu(o,i,l,r),b=0;b<y.length;b++){var M=y[b].width;M>c&&(c=M),h.push({text:y[b].text,size:new Pe(M,s)})}else r>c&&(c=r),h.push({text:o,size:e});var C=h.length,w=new Pe(c,s*C+n*(C-1));return{total:C,size:w,rows:h,rawSize:e}}function sf(o){var t=0,i=o&&o.length||0;if(!i)return t;for(var n,e=0;e<i;e++)n=o.charCodeAt(e),t=(t<<5)-t+n,t=t&t;return t}function hn(o){return o&&o.colorStops}function du(o){var t=[o.type];if(o.places&&t.push(o.places.join()),o.colorStops){for(var i=[],n=o.colorStops.length-1;n>=0;n--)i.push(o.colorStops[n].join());t.push(i.join(","))}return t.join("_")}function yC(o,t){return jo(o,t)}function jo(o,t){if(!o)return 1;var i=[];if(Array.isArray(o)){for(var n=0;n<o.length;n++)i.push(jo(o[n],t));return i.sort().join(",")}var e=Object.keys(o).sort(),r=e.reduce(function(a,h){return(!t||h.indexOf(t)===0)&&(a[h]=o[h]),a},{}),s=sf(JSON.stringify(r));return s}function Mh(o,t){function i(s,a){var h=s.opacity;H(h)?s.opacity=a:s.opacity*=a}var n;if(Array.isArray(o)){n=[];for(var e=0;e<o.length;e++){var r=dt({},o[e]);i(r,t),n.push(r)}}else n=dt({},o),i(n,t);return n}function Ai(o){var t=Array.prototype.slice.call(arguments,1);if((!t||!t.length)&&(t=[{}]),Array.isArray(o)){for(var i,n,e=[],r=0,s=o.length;r<s;r++){i=o[r],n={};for(var a=0,h=t.length;a<h;a++)Array.isArray(t[a])?H(t[a][r])?dt(n,i||{}):dt(n,i,t[a][r]):dt(n,i,t[a]?t[a]:{});e.push(n)}return e}else{var l=[{},o];return l.push.apply(l,t),dt.apply(this,l)}}function dv(o){if(o.symbol&&(o=[o]),Array.isArray(o))return o;var t=o.$root,i=o.$iconset;if(o=o.style,t||i){t&&t[t.length-1]==="/"&&(t=t.substring(0,t.length-1)),i&&i[i.length-1]==="/"&&(i=i.substring(0,i.length-1));var n=function(r){return r==="{$root}"?t:r==="{$iconset}"?i:null};pv(o,n)}return o}function pv(o,t){for(var i=0;i<o.length;i++){var n=o[i].symbol;n&&of(n,t)}}var pu=/(\{\$root\}|\{\$iconset\})/g;function of(o,t){for(var i in o)o.hasOwnProperty(i)&&i!=="textName"&&(Xt(o[i])&&o[i].length>2?o[i]=o[i].replace(pu,t):Ae(o[i])?o[i]=gv(o[i],t):yi(o[i])&&of(o[i],t))}function gv(o,t){var i=o.default;Xt(i)&&(o.default=i.replace(pu,t));for(var n=o.stops,e=0;e<n.length;e++)!Array.isArray(n[e])||(Xt(n[e][1])?n[e][1]=n[e][1].replace(pu,t):Ae(n[e][1])&&(n[e][1]=gv(n[e][1],t)));return o}function mv(o){o===void 0&&(o=[]),Array.isArray(o)||(o=[o]);for(var t=o.length,i=0;i<t;i++){var n=o[i];if(!!n.style){var e=n.style,r=e.lineDasharray,s=e.lineWidth;if(s&&St(s)&&s>0&&r&&Array.isArray(r)&&r.length)return!0}}return!1}var yt=Object.freeze({now:me,extend:dt,isNil:H,isNumber:St,isInteger:en,isObject:yi,isString:Xt,isFunction:ne,hasOwn:Is,join:WS,isEmpty:jS,toRadian:He,toDegree:Zm,IS_NODE:De,get requestAnimFrame(){return Fi},get cancelAnimFrame(){return To},isSVG:gr,loadImage:Po,UID:Xn,GUID:eC,parseJSON:Uh,pushIn:Ar,removeFromArray:dh,forEachCoord:Mr,getValueOrDefault:Tt,sign:Ie,log2:cu,interpolate:ph,wrap:Gn,clamp:gh,isArrayHasData:ee,isURL:nC,isCssUrl:Jm,extractCssUrl:Vh,btoa:Ym,b64toBlob:Qm,computeDegree:mh,emptyImageUrl:Zu,equalMapView:vh,flash:Xu,_defaults:sC,getPointsResultPts:Eo,getImageBitMap:$u,getAbsoluteURL:qu,calCanvasSize:Ju,translateToSVGStyles:lv,getMarkerPathBase64:Ao,getExternalResources:Wo,convertResourceUrl:yh,isGradient:hn,getGradientStamp:du,getSymbolStamp:yC,getSymbolHash:jo,lowerSymbolOpacity:Mh,extendSymbol:Ai,parseStyleRootPath:dv,convertStylePath:pv,parseSymbolPath:of,isDashLine:mv,trim:tf,escapeSpecialChars:Wh,splitWords:uv,stringWidth:Fn,stringLength:ef,splitContent:fu,CONTENT_EXPRE:fv,replaceVariable:xh,describeText:wh,getAlignPoint:Hn,getFont:nf,splitTextToRow:rf,hashCode:sf}),xC=function(t){return t[0]},jh=De?xC:function(o){for(var t=document.documentElement.style,i=0;i<o.length;i++)if(o[i]in t)return o[i];return!1},Ei=jh(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),vv=jh(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),fo=jh(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]),wC=jh(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function Et(o,t){var i=document.createElement(o);return t&&Xh(i,t),i}function gu(o,t,i){var n=Et(o);return t&&Zh(n,t),i&&i.appendChild(n),n}function br(o){if(!o)return this;if(jt.ielt9||jt.ie9){var t=Et("div");t.appendChild(o),t.innerHTML="",t=null}else o.parentNode&&o.parentNode.removeChild(o);return this}function on(o,t,i,n){if(!o||!o.addEventListener||!t||!i)return this;for(var e=function(c){c||(c=window.event),i.call(n||o,c)},r=t.split(" "),s=r.length-1;s>=0;s--){var a=r[s];if(!!a){o["Z__"+a]||(o["Z__"+a]=[]);var h=af(o,a,i);h>=0&&$n(o,a,i),o["Z__"+a].push({callback:e,src:i}),o.addEventListener(a,e,jt.supportsPassive?{capture:!1,passive:!1}:!1)}}return this}function $n(o,t,i){function n(f,d){f==="mousewheel"&&jt.gecko&&(f="DOMMouseScroll"),o.removeEventListener(f,d,!1)}if(!o||!o.removeEventListener||!t)return this;for(var e=t.split(" "),r=e.length-1;r>=0;r--){var s=e[r];if(!!s){if(!i&&o["Z__"+s]){for(var a=o["Z__"+s],h=0,l=a.length;h<l;h++)n(a[h].callback);return delete o["Z__"+s],this}var c=af(o,s,i);if(c<0)return this;var u=o["Z__"+s][c];n(s,u.callback),o["Z__"+s].splice(c,1)}}return this}function af(o,t,i){if(!o||!o["Z__"+t]||!i)return-1;for(var n=o["Z__"+t],e=0,r=n.length;e<r;e++)if(n[e].src===i)return e;return-1}function ai(o){return o.preventDefault?o.preventDefault():o.returnValue=!1,this}function ni(o){return o.stopPropagation?o.stopPropagation():o.cancelBubble=!0,this}function _v(o){return o.onselectstart=function(){return!1},o.ondragstart=function(){return!1},o.setAttribute("unselectable","on"),this}function po(o,t){return o?(jt.any3d?yv(o,t):(o.style.left=t.x+"px",o.style.top=t.y+"px"),t):null}function Zo(o){var t=window.getComputedStyle(o),i=[parseInt(t["padding-left"]),parseInt(t["padding-top"])],n=o.getBoundingClientRect(),e=o.offsetWidth,r=o.offsetHeight,s=e?n.width/e:1,a=r?n.height/r:1;return o.__position=[n.left+i[0],n.top+i[1],s,a],o.__position}function $e(o,t){o||(o=window.event);var i=t.__position;return i||(i=Zo(t)),new W((o.clientX-i[0]-t.clientLeft)/i[2],(o.clientY-i[1]-t.clientTop)/i[3])}function MC(o,t){var i=o.length-t.length;return i>=0&&o.indexOf(t,i)===i}function Zh(o,t){var i=o.style.cssText;return MC(i,";")||(i+=";"),o.style.cssText=i+t,this}function hf(o,t){if(o.classList!==void 0)return o.classList.contains(t);var i=lf(o);return i.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)}function mr(o,t){if(o.classList!==void 0&&!hf(o,t))for(var i=uv(t),n=0,e=i.length;n<e;n++)o.classList.add(i[n]);else{var r=lf(o);Xh(o,(r?r+" ":"")+t)}return this}function Xh(o,t){return H(o.className.baseVal)?o.className=t:o.className.baseVal=t,this}function lf(o){return H(o.className.baseVal)?o.className:o.className.baseVal}function bC(o,t){return o.style.opacity=t,this}function yv(o,t){var i=t||new W(0,0);return o.style[Ei]=jt.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)",this}function SC(o,t){var i="matrix("+(Xt(t)?t:t.join())+")";return o.style[Ei]!==i&&(o.style[Ei]=i),this}function CC(o){return o.style[Ei]&&(o.style[Ei]=""),this}function xv(o){return/<[a-z\][\s\S]*>/i.test(o)}function wv(o,t){var i=Mv(o);Xt(t)?i.innerHTML=t:i.appendChild(t);var n=new Pe(i.clientWidth,i.clientHeight);return br(i),n}function Mv(o){var t=document.createElement(o);return t.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(t),t}var we=on,ge=$n,pc=Object.freeze({TRANSFORM:Ei,TRANSFORMORIGIN:vv,TRANSITION:fo,CSSFILTER:wC,createEl:Et,createElOn:gu,removeDomNode:br,addDomEvent:on,removeDomEvent:$n,listensDomEvent:af,preventDefault:ai,stopPropagation:ni,preventSelection:_v,offsetDom:po,computeDomPosition:Zo,getEventContainerPoint:$e,setStyle:Zh,hasClass:hf,addClass:mr,setClass:Xh,getClass:lf,setOpacity:bC,setTransform:yv,setTransformMatrix:SC,removeTransform:CC,isHTML:xv,measureDom:wv,getDomRuler:Mv,on:we,off:ge}),bv=typeof Map=="function",Sv=function(){},TC=function(){function o(i,n){this.max=i,this.onRemove=n||Sv,this.reset()}var t=o.prototype;return t.reset=function(){for(var n in this.data)this.onRemove(this.data[n]);return this.data={},this.order=[],this},t.clear=function(){this.reset(),delete this.onRemove},t.add=function(n,e){if(this.has(n))this.order.splice(this.order.indexOf(n),1),this.data[n]=e,this.order.push(n);else if(this.data[n]=e,this.order.push(n),this.order.length>this.max){var r=this.getAndRemove(this.order[0]);r&&this.onRemove(r)}return this},t.has=function(n){return n in this.data},t.keys=function(){return this.order},t.getAndRemove=function(n){if(!this.has(n))return null;var e=this.data[n];return delete this.data[n],this.order.splice(this.order.indexOf(n),1),e},t.get=function(n){if(!this.has(n))return null;var e=this.data[n];return e},t.remove=function(n){if(!this.has(n))return this;var e=this.data[n];return delete this.data[n],this.onRemove(e),this.order.splice(this.order.indexOf(n),1),this},t.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},o}(),Cv;bv&&(Cv=function(){function o(i,n){this.max=i,this.onRemove=n||Sv,this.reset()}var t=o.prototype;return t.reset=function(){if(this.data)for(var n=this.data.values(),s=n,e=Array.isArray(s),r=0,s=e?s:s[Symbol.iterator]();;){var a;if(e){if(r>=s.length)break;a=s[r++]}else{if(r=s.next(),r.done)break;a=r.value}var h=a;this.onRemove(h)}return this.data=new Map,this},t.clear=function(){this.reset(),delete this.onRemove},t.add=function(n,e){return e?(this.has(n)?(this.data.delete(n),this.data.set(n,e),this.data.size>this.max&&this.shrink()):this.data.set(n,e),this):this},t.keys=function(){for(var n=new Array(this.data.size),e=0,r=this.data.keys(),h=r,s=Array.isArray(h),a=0,h=s?h:h[Symbol.iterator]();;){var l;if(s){if(a>=h.length)break;l=h[a++]}else{if(a=h.next(),a.done)break;l=a.value}var c=l;n[e++]=c}return n},t.shrink=function(){for(var n=this.data.keys(),e=n.next();this.data.size>this.max;){var r=this.getAndRemove(e.value);r&&this.onRemove(r),e=n.next()}},t.has=function(n){return this.data.has(n)},t.getAndRemove=function(n){if(!this.has(n))return null;var e=this.data.get(n);return this.data.delete(n),e},t.get=function(n){if(!this.has(n))return null;var e=this.data.get(n);return e},t.remove=function(n){if(!this.has(n))return this;var e=this.data.get(n);return this.data.delete(n),this.onRemove(e),this},t.setMaxSize=function(n){return this.max=n,this.data.size>this.max&&this.shrink(),this},o}());var Tv=bv?Cv:TC,Ke={jsonp:function(t,i){var n="_maptalks_jsonp_"+Xn();t.match(/\?/)?t+="&callback="+n:t+="?callback="+n;var e=document.createElement("script");return e.type="text/javascript",e.src=t,window[n]=function(r){i(null,r),document.getElementsByTagName("head")[0].removeChild(e),e=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(e),this},get:function(t,i,n){if(ne(i)){var e=n;n=i,i=e}if(De&&Ke.get.node)return Ke.get.node(t,n,i);var r=Ke._getClient(n);if(r.open("GET",t,!0),i){for(var s in i.headers)r.setRequestHeader(s,i.headers[s]);r.withCredentials=i.credentials==="include",i.responseType&&(r.responseType=i.responseType)}return r.send(null),r},post:function(t,i,n){var e;if(Xt(t)){if(ne(i)){var s=n;n=i,i=s}i=i||{},e=i.postData}else{var r=n;e=i,i=t,t=i.url,n=r}if(De&&Ke.post.node)return i.url=t,Ke.post.node(i,e,n);var a=Ke._getClient(n);if(a.open("POST",i.url,!0),i.headers||(i.headers={}),i.headers["Content-Type"]||(i.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in a)for(var h in i.headers)i.headers.hasOwnProperty(h)&&a.setRequestHeader(h,i.headers[h]);return Xt(e)||(e=JSON.stringify(e)),a.send(e),a},_wrapCallback:function(t,i){return function(){if(t.readyState===4)if(t.status===200)if(t.responseType==="arraybuffer"){var n=t.response;n.byteLength===0?i(new Error("http status 200 returned without content.")):i(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")})}else i(null,t.responseText);else i(new Error(t.statusText+","+t.status))}},_getClient:function(t){var i;try{i=new XMLHttpRequest}catch{try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch{try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch{}}}return i.onreadystatechange=Ke._wrapCallback(i,t),i},getArrayBuffer:function(t,i,n){if(ne(i)){var e=n;n=i,i=e}return i||(i={}),i.responseType="arraybuffer",Ke.get(t,i,n)},getImage:function(t,i,n){return Ke.getArrayBuffer(i,n,function(e,r){if(e)t.onerror&&t.onerror(e);else if(r){var s=window.URL||window.webkitURL,a=t.onload;t.onload=function(){a&&a(),s.revokeObjectURL(t.src)};var h=new Blob([new Uint8Array(r.data)],{type:r.contentType});t.cacheControl=r.cacheControl,t.expires=r.expires,t.src=r.data.byteLength?s.createObjectURL(h):Zu}})}};Ke.getJSON=function(o,t,i){if(ne(t)){var n=i;i=t,t=n}var e=function(s,a){var h=a?Uh(a):null;i(s,h)};return t&&t.jsonp?Ke.jsonp(o,e):Ke.get(o,t,e)};var Wp="#000",PC="rgba(255,255,255,0)",EC="#000",Da=!1,ts=null,es=Math.PI/180,jp=1,ot={setHitTesting:function(t){Da=t},createCanvas:function(t,i,n){var e;return De?e=new n(t,i):(e=Et("canvas"),e.width=t,e.height=i),e},prepareCanvasFont:function(t,i){t.textBaseline="top",t.font=nf(i);var n=i.textFill;n||(n=EC),t.fillStyle=ot.getRgba(n,i.textOpacity)},prepareCanvas:function(t,i,n,e){if(!!i){var r=i.lineWidth;!H(r)&&t.lineWidth!==r&&(t.lineWidth=r);var s=i.linePatternFile,a=i.lineColor||Wp;if(e)t.strokeStyle="#000";else if(s&&n){var h;(i.linePatternDx||i.linePatternDy)&&(h=[i.linePatternDx,i.linePatternDy]),ot._setStrokePattern(t,s,r,h,n),i.lineDasharray=[]}else hn(a)?i.lineGradientExtent?t.strokeStyle=ot._createGradient(t,a,i.lineGradientExtent):t.strokeStyle=Wp:(Array.isArray(a)&&(a=ot.normalizeColorToRGBA(a)),t.strokeStyle=a);i.lineJoin&&(t.lineJoin=i.lineJoin),i.lineCap&&(t.lineCap=i.lineCap),t.setLineDash&&ee(i.lineDasharray)&&t.setLineDash(i.lineDasharray);var l=i.polygonPatternFile,c=i.polygonFill||PC;if(e)t.fillStyle="#000";else if(l&&n){var u=Xp(l),f=n.getImage([u,null,null]);if(f||(f=n.getImage([u+"-texture",null,r])),gr(u)&&f instanceof Image&&(jt.edge||jt.ie)){var d=f.width||20,p=f.height||20,g=ot.createCanvas(d,p);ot.image(g.getContext("2d"),f,0,0,d,p),f=g}f&&(t.fillStyle=t.createPattern(f,"repeat"),(i.polygonPatternDx||i.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[i.polygonPatternDx,i.polygonPatternDy]))}else hn(c)?i.polygonGradientExtent?t.fillStyle=ot._createGradient(t,c,i.polygonGradientExtent):t.fillStyle="rgba(255,255,255,0)":(Array.isArray(c)&&(c=ot.normalizeColorToRGBA(c)),t.fillStyle=c)}},_createGradient:function(t,i,n){var e=null,r=i.places,s=n.getMin(),a=n.getMax(),h=n.getWidth(),l=n.getHeight();if(!i.type||i.type==="linear"){if(!r)r=[s.x,s.y,a.x,s.y];else{if(r.length!==4)throw new Error("A linear gradient's places should have 4 numbers.");r=[s.x+r[0]*h,s.y+r[1]*l,s.x+r[2]*h,s.y+r[3]*l]}e=t.createLinearGradient.apply(t,r)}else if(i.type==="radial"){if(r){if(r.length!==6)throw new Error("A radial gradient's places should have 6 numbers.");r=[s.x+r[0]*h,s.y+r[1]*l,h*r[2],s.x+r[3]*h,s.y+r[4]*l,h*r[5]]}else{var c=n.getCenter()._round();r=[c.x,c.y,Math.abs(c.x-s.x),c.x,c.y,0]}e=t.createRadialGradient.apply(t,r)}return i.colorStops.forEach(function(u){e.addColorStop.apply(e,u)}),e},_setStrokePattern:function(t,i,n,e,r){var s=Xp(i),a;if(De)a=r.getImage([s,null,n]);else{var h=s+"-texture-"+n;if(a=r.getImage(h),!a){var l=r.getImage([s,null,null]);if(l){var c;!l.width||!l.height?c=n:c=Math.round(l.width*n/l.height);var u=ot.createCanvas(c,n,t.canvas.constructor);ot.image(u.getContext("2d"),l,0,0,c,n),r.addResource([h,null,n],u),a=u}}}a&&(t.strokeStyle=t.createPattern(a,"repeat"),t.strokeStyle.linePatternOffset=e)},clearRect:function(t,i,n,e,r){t.canvas._drawn=!1,t.clearRect(i,n,e,r)},fillCanvas:function(t,i,n,e){if(Da&&(i=1),t.canvas._drawn=!0,i!==0){var r=ot._isPattern(t.fillStyle),s=t.fillStyle&&t.fillStyle.polygonPatternOffset,a=s?s[0]:0,h=s?s[1]:0;H(i)&&(i=1);var l;i<1&&(l=t.globalAlpha,t.globalAlpha*=i),r&&(n=n||0,e=e||0,t.translate(n+a,e+h)),t.fill(),r&&t.translate(-n-a,-e-h),i<1&&(t.globalAlpha=l)}},getRgba:function(t,i){if(H(i)&&(i=1),t[0]!=="#")return Array.isArray(t)&&(t=ot.normalizeColorToRGBA(t,i)),t;var n,e,r;return t.length===7?(n=parseInt(t.substring(1,3),16),e=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(n=parseInt(t.substring(1,2),16)*17,e=parseInt(t.substring(2,3),16)*17,r=parseInt(t.substring(3,4),16)*17),"rgba("+n+","+e+","+r+","+i+")"},normalizeColorToRGBA:function(t,i){return i===void 0&&(i=1),"rgba("+t[0]*255+","+t[1]*255+","+t[2]*255+","+(t.length===4?t[3]:1)*i+")"},image:function(t,i,n,e,r,s){t.canvas._drawn=!0;try{St(r)&&St(s)?t.drawImage(i,n,e,r,s):t.drawImage(i,n,e)}catch{}},text:function(t,i,n,e,r){ot._textOnMultiRow(t,r.rows,e,n,r.size,r.rawSize)},_textOnMultiRow:function(t,i,n,e,r,s){for(var a=Hn(r,n.textHorizontalAlignment,n.textVerticalAlignment),h=s.height+n.textLineSpacing,l=e.add(0,a.y),c=n.textMaxHeight,u,f,d=0,p=0,g=i.length;p<g&&(u=i[p].text,f=Hn(i[p].size,n.textHorizontalAlignment,n.textVerticalAlignment),ot._textOnLine(t,u,l.add(f.x,p*h),n.textHaloRadius,n.textHaloFill,n.textHaloOpacity),!(c>0&&(d+=h,d+s.height>=c)));p++);},_textOnLine:function(t,i,n,e,r,s){Da&&(s=1);var a=s!==0&&e!==0;t.textBaseline="top";var h,l,c=t.shadowBlur,u=t.shadowOffsetX,f=t.shadowOffsetY;if(a){var d=t.globalAlpha;t.globalAlpha*=s,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=e*2,Array.isArray(r)&&(r=ot.normalizeColorToRGBA(r)),t.strokeStyle=r,t.strokeText(i,n.x,n.y+jp),t.miterLimit=10,t.globalAlpha=d,h=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",l=t.fillStyle,t.fillStyle="#000"}c&&a&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),ot.fillText(t,i,n),h&&(t.globalCompositeOperation=h,ot.fillText(t,i,n,l),c&&(t.shadowBlur=c,t.shadowOffsetX=u,t.shadowOffsetY=f))},fillText:function(t,i,n,e){t.canvas._drawn=!0,e&&(t.fillStyle=e),t.fillText(i,n.x,n.y+jp)},_stroke:function(t,i,n,e){if(Da&&(i=1),t.canvas._drawn=!0,i!==0){var r=t.strokeStyle&&t.strokeStyle.linePatternOffset,s=r?r[0]:0,a=r?r[1]:0,h=ot._isPattern(t.strokeStyle)&&(!H(n)&&!H(e)||!H(s)&&!H(a));H(i)&&(i=1);var l;i<1&&(l=t.globalAlpha,t.globalAlpha*=i),h&&(n=n||0,e=e||0,t.translate(n+s,e+a)),t.stroke(),h&&t.translate(-n-s,-e-a),i<1&&(t.globalAlpha=l)}},_path:function(t,i,n,e,r){if(!ee(i))return;function s(p,g){var m=mh(p.x,p.y,g.x,g.y);t.save();var v=Math.cos(m);Math.abs(v)<1e-7?t.translate(p.x-t.lineWidth/2,p.y):t.translate(p.x,p.y-t.lineWidth/2/v),t.rotate(m),ot._stroke(t,e),t.restore()}for(var a=ee(n),h=r===!0?!1:ot._isPattern(t.strokeStyle),l,c,u,f=0,d=i.length;f<d;f++)if(l=i[f],!a||t.setLineDash)t.lineTo(l.x,l.y),h&&f>0&&(c=i[f-1],s(c,l),t.beginPath(),t.moveTo(l.x,l.y));else if(a){if(f===d-1)break;u=i[f+1],AC(t,l,u,n)}},path:function(t,i,n,e,r){!ee(i)||(t.beginPath(),t.moveTo(i[0].x,i[0].y),ot._path(t,i,r,n),ot._stroke(t,n))},_multiClip:function(t,i){if(!(!i||i.length===0)){i=i[0];for(var n=0,e=i.length;n<e;n++){var r=i[n],s=r.x,a=r.y;n===0?t.moveTo(s,a):t.lineTo(s,a),n===e-1&&(s=i[0].x,a=i[0].y,t.lineTo(s,a))}}},polygon:function(t,i,n,e,r,s){if(t.isMultiClip){ot._multiClip(t,i);return}if(!!ee(i)){var a=ot._isPattern(t.strokeStyle),h=ee(r)&&!t.setLineDash||a&&!s;ee(i[0])||(i=[i]);var l=t;i.length>1&&!De&&(ts||(ts=ot.createCanvas(1,1)),t.canvas._drawn=!1,ts.width=t.canvas.width,ts.height=t.canvas.height,t=ts.getContext("2d"),$p(t,l));var c,u,f;if(h){for(t.save(),u=0,f=i.length;u<f;u++)!ee(i[u])||(ot._ring(t,i[u],null,0,!0),c=e,u>0&&(t.globalCompositeOperation="destination-out",c=1),ot.fillCanvas(t,c,i[u][0].x,i[u][0].y),u>0?t.globalCompositeOperation="source-over":f>1&&(t.fillStyle="#fff"),ot._stroke(t,0));t.restore()}var d=t.fillStyle;for(u=0,f=i.length;u<f;u++)!ee(i[u])||(s?(ot.paintSmoothLine(t,i[u],n,s,!0),t.closePath()):ot._ring(t,i[u],r,n),h||(c=e,u>0&&(t.globalCompositeOperation="destination-out",c=1),ot.fillCanvas(t,c,i[u][0].x,i[u][0].y),u>0?t.globalCompositeOperation="source-over":f>1&&(t.fillStyle="#fff")),ot._stroke(t,n));t.fillStyle!==d&&(t.fillStyle=d),i.length>1&&!De&&(l.drawImage(ts,0,0),l.canvas._drawn=t.canvas._drawn,$p(l,t))}},_ring:function(t,i,n,e,r){var s=ot._isPattern(t.strokeStyle);!r&&s&&!i[0].equals(i[i.length-1])&&(i=i.concat([i[0]])),t.beginPath(),t.moveTo(i[0].x,i[0].y),ot._path(t,i,n,e,r),s||t.closePath()},paintSmoothLine:function(t,i,n,e,r,s,a){if(!i)return;if(i.length<=2||!e){ot.path(t,i,n);return}function h(w,S,P,O,D,L,T,A,N,B){var F=1-w,I=1-S,z=P*F*F+D*2*w*F+T*w*w,Z=P*I*I+D*2*S*I+T*S*S,j=D*F*F+T*2*w*F+N*w*w,K=D*I*I+T*2*S*I+N*S*S,et=O*F*F+L*2*w*F+A*w*w,st=O*I*I+L*2*S*I+A*S*S,V=L*F*F+A*2*w*F+B*w*w,pt=L*I*I+A*2*S*I+B*S*S,xt=z*I+j*S,ut=Z*F+K*w,ft=Z*I+K*S,kt=et*I+V*S,J=st*F+pt*w,Q=st*I+pt*S;return[xt,kt,ut,J,ft,Q]}function l(w,S,P,O,D,L,T,A,N,B){var F=(w+P)/2,I=(S+O)/2,z=(P+D)/2,Z=(O+L)/2,j=(D+T)/2,K=(L+A)/2,et=Math.sqrt((P-w)*(P-w)+(O-S)*(O-S)),st=Math.sqrt((D-P)*(D-P)+(L-O)*(L-O)),V=Math.sqrt((T-D)*(T-D)+(A-L)*(A-L)),pt=et/(et+st),xt=st/(st+V),ut=F+(z-F)*pt,ft=I+(Z-I)*pt,kt=z+(j-z)*xt,J=Z+(K-Z)*xt,Q=ut+(z-ut)*N+P-ut,lt=ft+(Z-ft)*N+O-ft,Ct=kt+(z-kt)*N+D-kt,at=J+(Z-J)*N+L-J,Ft=[Q,lt,Ct,at];return B<1?h(0,B,P,O,Q,lt,Ct,at,D,L):Ft}var c=i.length,u=r?c:c-1;t.beginPath(),t.moveTo(i[0].x,i[0].y),a!==void 0&&(u-=Math.max(u-s-1,0));for(var f,d=0;d<u;d++){var p=i[d].x,g=i[d].y,m=void 0,v=void 0,x=void 0,_=void 0,y=void 0,b=void 0;d-1<0?r?(m=i[u-1].x,v=i[u-1].y):(m=i[d+1].x,v=i[d+1].y):(m=i[d-1].x,v=i[d-1].y),d+1<c?(x=i[d+1].x,_=i[d+1].y):(x=i[d+1-c].x,_=i[d+1-c].y),d+2<c?(y=i[d+2].x,b=i[d+2].y):r?(y=i[d+2-c].x,b=i[d+2-c].y):(y=i[d].x,b=i[d].y);var M=l(m,v,p,g,x,_,y,b,e,d===u-1?a:1);if(d===u-1&&a>=0&&a<1){t.bezierCurveTo(M[0],M[1],M[2],M[3],M[4],M[5]),i.splice(u-1,c-(u-1)-1);var C=new W(M[4],M[5]);C.prevCtrlPoint=new W(M[2],M[3]),i.push(C),c=i.length}else t.bezierCurveTo(M[0],M[1],M[2],M[3],x,_);i[d].nextCtrlPoint=M.slice(0,2),i[d].prevCtrlPoint=f?f.slice(2):null,f=M}!r&&i[1].prevCtrlPoint&&(i[0].nextCtrlPoint=i[1].prevCtrlPoint,delete i[0].prevCtrlPoint),i[c-1].prevCtrlPoint||(i[c-1].prevCtrlPoint=i[c-2].nextCtrlPoint),ot._stroke(t,n)},_arcBetween:function(t,i,n,e){var r=e,s=i.distanceTo(n),a=s/2/Math.sin(r/2),h=Math.asin((n.y-i.y)/s);i.x>n.x&&(h=Math.PI-h);var l=90*es-r/2,c=h-l,u=Math.cos(c)*a,f=Math.sin(c)*a,d=i.x+u,p=i.y+f,g=Math.asin((n.y-p)/a);d>n.x&&(g=Math.PI-g);var m=g+r;return t.beginPath(),t.arc(d,p,a,g,m),[d,p]},_lineTo:function(t,i){t.lineTo(i.x,i.y)},bezierCurveAndFill:function(t,i,n,e){t.beginPath();var r=i[0];t.moveTo(r.x,r.y);var s=[t];s.push.apply(s,i.splice(1)),ot._bezierCurveTo.apply(ot,s),ot.fillCanvas(t,e),ot._stroke(t,n)},_bezierCurveTo:function(t,i,n,e){t.bezierCurveTo(i.x,i.y,n.x,n.y,e.x,e.y)},ellipse:function(t,i,n,e,r,s,a){function h(l,c,u,f,d){var p=.5522848,g=u*p,m=f*p,v=d*p;t.moveTo(l-u,c),t.bezierCurveTo(l-u,c-m,l-g,c-f,l,c-f),t.bezierCurveTo(l+g,c-f,l+u,c-m,l+u,c),t.bezierCurveTo(l+u,c+v,l+g,c+d,l,c+d),t.bezierCurveTo(l-g,c+d,l-u,c+v,l-u,c),t.closePath()}t.beginPath(),n===e&&n===r?t.arc(i.x,i.y,n,0,2*Math.PI):t.ellipse?e!==r?(t.ellipse(i.x,i.y,n,e,0,es*180,es*360,!1),t.ellipse(i.x,i.y,n,r,0,0,es*180,!1)):t.ellipse(i.x,i.y,n,e,0,0,es*360,!1):h(i.x,i.y,n,e,r),ot.fillCanvas(t,a,i.x-n,i.y-e),ot._stroke(t,s,i.x-n,i.y-e)},rectangle:function(t,i,n,e,r){var s=i.x,a=i.y;t.beginPath(),t.rect(s,a,n.width,n.height),ot.fillCanvas(t,r,s,a),ot._stroke(t,e,s,a)},sector:function(t,i,n,e,r,s){var a=es,h=e[0],l=e[1];function c(u,f,d,p,g,m){var v=a*-m,x=a*-g;u.beginPath(),u.moveTo(f,d),u.arc(f,d,p,v,x),u.lineTo(f,d),ot.fillCanvas(u,s,f-p,d-p),ot._stroke(u,r,f-p,d-p)}c(t,i.x,i.y,n,h,l)},_isPattern:function(t){return!Xt(t)&&!("addColorStop"in t)},drawCross:function(t,i,n,e,r){t.canvas._drawn=!0,t.strokeStyle=r,t.lineWidth=e,t.beginPath(),t.moveTo(i-5,n),t.lineTo(i+5,n),t.moveTo(i,n-5),t.lineTo(i,n+5),t.stroke()},copy:function(t,i){var n=i||Et("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),n},pixelRect:function(t,i,n,e){var r=t.lineWidth,s=t.globalAlpha,a=!1;if(r>0&&n>0)a=!0,n<1&&(t.globalAlpha*=n);else if(e>0)e<1&&(t.globalAlpha*=e);else return;t.canvas._drawn=!0,a?t.strokeRect(i[0],i[1],1,1):t.fillRect(i[0],i[1],1,1),t.globalAlpha!==s&&(t.globalAlpha=s)}};function AC(o,t,i,n){var e=t.x,r=t.y,s=i.x,a=i.y,h=n,l=function(M,C){return M<=C},c=function(M,C){return M>=C},u=function(M,C){return Math.min(M,C)},f=function(M,C){return Math.max(M,C)},d={thereYet:c,cap:u},p={thereYet:c,cap:u};r-a>0&&(p.thereYet=l,p.cap=f),e-s>0&&(d.thereYet=l,d.cap=f),o.moveTo(e,r);for(var g=e,m=r,v=0,x=!0,_,y;!(d.thereYet(g,s)&&p.thereYet(m,a));)_=Math.atan2(a-r,s-e),y=h[v],g=d.cap(s,g+Math.cos(_)*y),m=p.cap(a,m+Math.sin(_)*y),x?o.lineTo(g,m):o.moveTo(g,m),v=(v+1)%h.length,x=!x}var Zp="data:image/";function Xp(o){return o.substring(0,Zp.length)===Zp?o:Vh(o)}function $p(o,t){o.filter=t.filter,o.fillStyle=t.fillStyle,o.globalAlpha=t.globalAlpha,o.lineCap=t.lineCap,o.lineDashOffset=t.lineDashOffset,o.lineJoin=t.lineJoin,o.lineWidth=t.lineWidth,o.shadowBlur=t.shadowBlur,o.shadowColor=t.shadowColor,o.shadowOffsetX=t.shadowOffsetX,o.shadowOffsetY=t.shadowOffsetY,o.strokeStyle=t.strokeStyle}var mu;typeof Promise<"u"?mu=Promise:mu=LS;var qp=mu,Ui=function(t){return function(i){ht(n,i);function n(){return i.apply(this,arguments)||this}var e=n.prototype;return e.on=function(s,a,h){if(!s)return this;if(!Xt(s))return this._switch("on",s,a);if(!a)return this;this._eventMap||(this._eventMap={});var l=s.toLowerCase().split(" "),c;h||(h=this);for(var u,f=0,d=l.length;f<d;f++){c=l[f],u=this._eventMap[c],u||(u=[],this._eventMap[c]=u);var p=u.length;if(p>0){for(var g=0;g<p;g++)if(a===u[g].handler&&u[g].context===h)return this}u.push({handler:a,context:h})}return this},e.addEventListener=function(){return this.on.apply(this,arguments)},e.once=function(s,a,h){if(!Xt(s)){var l={};for(var c in s)s.hasOwnProperty(c)&&(l[c]=this._wrapOnceHandler(c,s[c],h));return this._switch("on",l)}for(var u=s.split(" "),f=0,d=u.length;f<d;f++)this.on(u[f],this._wrapOnceHandler(u[f],a,h));return this},e.off=function(s,a,h){if(!this._eventMap||!s)return this;if(!Xt(s))return this._switch("off",s,a);if(!a)return this;var l=s.split(" "),c,u,f;h||(h=this);for(var d=0,p=l.length;d<p;d++){if(c=l[d].toLowerCase(),f="Z__"+c,u=this._eventMap[c],!u)return this;for(var g=u.length-1;g>=0;g--){var m=u[g];(a===m.handler||a===m.handler[f])&&m.context===h&&(delete m.handler[f],u.splice(g,1))}u.length||delete this._eventMap[c]}return this},e.removeEventListener=function(){return this.off.apply(this,arguments)},e.listens=function(s,a,h){if(!this._eventMap||!Xt(s))return 0;var l=this._eventMap[s.toLowerCase()];if(!l||!l.length)return 0;if(!a)return l.length;for(var c=0,u=l.length;c<u;c++)if(a===l[c].handler&&(H(h)||l[c].context===h))return 1;return 0},e.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},e.copyEventListeners=function(s){var a=s._eventMap;if(!a)return this;var h;for(var l in a){h=a[l];for(var c=0,u=h.length;c<u;c++)this.on(l,h[c].handler,h[c].context)}return this},e.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},e._wrapOnceHandler=function(s,a,h){var l=this,c="Z__"+s,u=!1,f=function d(){u||(delete f[c],u=!0,h?a.apply(h,arguments):a.apply(this,arguments),l.off(s,d,this))};return f[c]=a,f},e._switch=function(s,a,h){for(var l in a)a.hasOwnProperty(l)&&this[s](l,a[l],h);return this},e._clearListeners=function(s){if(!(!this._eventMap||!Xt(s))){var a=this._eventMap[s.toLowerCase()];!a||(this._eventMap[s]=null)}},e._clearAllListeners=function(){this._eventMap=null},e._setEventParent=function(s){return this._eventParent=s,this},e._setEventTarget=function(s){return this._eventTarget=s,this},e._fire=function(s,a){if(!this._eventMap)return this;var h=this._eventMap[s.toLowerCase()];if(!h)return this;a||(a={}),a.type=s,a.target=this._eventTarget||this;for(var l=h.slice(0),c,u,f,d=0,p=l.length;d<p;d++)!l[d]||(c=l[d].context,u=!0,f=dt({},a),c?u=l[d].handler.call(c,f):u=l[d].handler(f),u===!1&&a.domEvent&&ni(a.domEvent));return this},n}(t)},LC=function(){function o(i){this.target=i}var t=o.prototype;return t.enable=function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},t.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},t.enabled=function(){return!!this._enabled},t.remove=function(){this.disable(),delete this.target,delete this.dom},o}(),Li=Ui(LC),wi=function(){function o(i){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(i),this.callInitHooks()}var t=o.prototype;return t.callInitHooks=function(){var n=Object.getPrototypeOf(this);return this._visitInitHooks(n),this},t.setOptions=function(n){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!n)return this;for(var e in n)this.options[e]=n[e];return this},t.config=function(n){if(n){if(arguments.length===2){var s={};s[n]=arguments[1],n=s}for(var a in n)this.options[a]=n[a],this[a]&&this[a]instanceof Li&&(n[a]?this[a].enable():this[a].disable());this.onConfig(n)}else{var e={};for(var r in this.options)this.options.hasOwnProperty(r)&&(e[r]=this.options[r]);return e}return this},t.onConfig=function(){},t._visitInitHooks=function(n){if(!this._initHooksCalled){var e=Object.getPrototypeOf(n);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var r=n._initHooks;if(r&&r!==e._initHooks)for(var s=0;s<r.length;s++)r[s].call(this)}},o.addInitHook=function(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];var a=typeof n=="function"?n:function(){this[n].apply(this,r)},h=this.prototype,l=Object.getPrototypeOf(h);return(!h._initHooks||h._initHooks===l._initHooks)&&(h._initHooks=[]),h._initHooks.push(a),this},o.include=function(){for(var n=0;n<arguments.length;n++)dt(this.prototype,n<0||arguments.length<=n?void 0:arguments[n]);return this},o.mergeOptions=function(n){var e=this.prototype,r=Object.getPrototypeOf(e);return(!e.options||e.options===r.options)&&(e.options=e.options?Object.create(e.options):{}),dt(e.options,n),this},o}(),Ia={},Pv=function(o){return function(t){ht(i,t);function i(){return t.apply(this,arguments)||this}i.registerJSONType=function(r){return r?(Ia[r]=this,this):this},i.getJSONClass=function(r){return r?Ia[r]:null};var n=i.prototype;return n.getJSONType=function(){if(this._jsonType===void 0){var r=Object.getPrototypeOf(this).constructor;for(var s in Ia)if(Ia[s]===r){this._jsonType=s;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},i}(o)},Js={},Ev=function(){function o(){this._tree=ju.exports(9,["[0]","[1]","[2]","[3]"])}var t=o.prototype;return t.collides=function(n){return Js.minX=n[0],Js.minY=n[1],Js.maxX=n[2],Js.maxY=n[3],this._tree.collides(Js)},t.insertBox=function(n){var e=this._tree;return e.insert(n),this},t.bulkInsertBox=function(n){return this._tree.load(n),this},t.clear=function(){return this._tree.clear(),this},o}();function cf(o){return function(t){ht(i,t);function i(){return t.apply(this,arguments)||this}var n=i.prototype;return n.addHandler=function(r,s){if(!s)return this;if(this._handlers||(this._handlers=[]),this[r])return this[r].enable(),this;var a=this[r]=new s(this);return this._handlers.push(a),this.options[r]&&a.enable(),this},n.removeHandler=function(r){if(!r)return this;var s=this[r];if(s){var a=this._handlers.indexOf(s);a>=0&&this._handlers.splice(a,1),this[r].remove(),delete this[r]}return this},n._clearHandlers=function(){for(var r=0,s=this._handlers.length;r<s;r++)this._handlers[r].remove();this._handlers=[]},i}(o)}var Jp="touchstart mousedown",ka={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},gc={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},ks=function(o){ht(t,o);function t(n,e){var r;return e===void 0&&(e={}),r=o.call(this,null)||this,r.dom=n,r.options=e,r}var i=t.prototype;return i.enable=function(){return this.dom?(this._onMouseDown=function(e){return this.onMouseDown(e)},we(this.dom,Jp,this._onMouseDown,this),this):this},i.disable=function(){return this.dom?(this._offEvents(),ge(this.dom,Jp,this._onMouseDown),delete this._onMouseDown,this):this},i.onMouseDown=function(e){if(!(!this.options.rightclick&&e.button===2)&&!(e.touches&&e.touches.length>1)&&!(this.options.cancelOn&&this.options.cancelOn(e)===!0)){var r=this.dom;r.setCapture?r.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),r.ondragstart=function(){return!1},delete this.moved;var s=e.touches?e.touches[0]:e;this.startPos=new W(s.clientX,s.clientY),ge(document,ka[e.type],this.onMouseMove),ge(document,gc[e.type],this.onMouseUp),we(document,ka[e.type],this.onMouseMove,this),we(document,gc[e.type],this.onMouseUp,this),this.options.ignoreMouseleave||(ge(this.dom,"mouseleave",this.onMouseUp),we(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:e,mousePos:new W(s.clientX,s.clientY)})}},i.onMouseMove=function(e){if(e.touches&&e.touches.length>1){this.moved&&(this.interupted=!0,this.onMouseUp(e));return}var r=e.touches?e.touches[0]:e,s=new W(r.clientX,r.clientY),a=s.sub(this.startPos);!a.x&&!a.y||(this.moved?this.fire("dragging",{domEvent:e,mousePos:new W(r.clientX,r.clientY)}):(this.fire("dragstart",{domEvent:e,mousePos:this.startPos.copy()}),this.moved=!0))},i.onMouseUp=function(e){var r=e.changedTouches?e.changedTouches[0]:e;this._offEvents();var s={domEvent:e};St(r.clientX)&&(s.mousePos=new W(parseInt(r.clientX,0),parseInt(r.clientY,0))),this.moved&&(s.interupted=this.interupted,this.fire("dragend",s),delete this.interupted,delete this.moved),this.fire("mouseup",s)},i._offEvents=function(){var e=this.dom;if(ge(e,"mouseleave",this.onMouseUp),!(typeof document>"u"||typeof window>"u")){for(var r in ka)ge(document,ka[r],this.onMouseMove),ge(document,gc[r],this.onMouseUp);e.releaseCapture?e.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},t}(Li),q=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}return t.toNumberArrays=function(n){return Array.isArray(n)?Mr(n,function(e){return[e.x,e.y]}):[n.x,n.y]},t.toCoordinates=function(n){if(St(n[0])&&St(n[1]))return new t(n);if(n instanceof t)return n;for(var e=[],r=0,s=n.length;r<s;r++){var a=n[r];Array.isArray(a)?St(a[0])?e.push(new t(a)):e.push(t.toCoordinates(a)):a instanceof t?e.push(a):e.push(new t(a))}return e},t}(Xm),qe=function(){function o(t,i){this.type=t,this.properties=i}return o.createProj4=function(i){return new o("proj4",{proj:i})},o.fromProjectionCode=function(i){return i?(i=i.toUpperCase().replace(":",""),o[i]||null):null},o}();qe.WGS84=qe.createProj4("+proj=longlat +datum=WGS84 +no_defs");qe.EPSG4326=qe.WGS84;qe.EPSG3857=qe.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs");qe.IDENTITY=qe.createProj4("+proj=identity +no_defs");qe.CGCS2000=qe.createProj4("+proj=longlat +datum=CGCS2000");qe.EPSG4490=qe.CGCS2000;qe.BD09LL=qe.createProj4("+proj=longlat +datum=BD09");qe.GCJ02=qe.createProj4("+proj=longlat +datum=GCJ02");var RC=new W(0,0),OC=new q(0,0),mc=new q(0,0),vc=new q(0,0),_c=new q(0,0),yc=new q(0,0),DC=new q(0,0),Yp=new q(0,0),Qp=new q(0,0),xc=[],os,Ys=[],oe=function(){function o(i,n,e,r){this._clazz=q;var s=arguments.length,a=s>0?arguments[s-1]:null;a&&a.unproject&&(this.projection=arguments[s-1]),this._dirty=!0,this._initialize(i,n,e,r)}var t=o.prototype;return t._initialize=function(n,e,r,s){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!H(n)){var a=this.projection;if(St(n)&&St(e)&&St(r)&&St(s)){a?this.set(n,e,r,s):this.set(Math.min(n,r),Math.min(e,s),Math.max(n,r),Math.max(e,s));return}else Array.isArray(n)?a?this.set(n[0],n[1],n[2],n[3]):this.set(Math.min(n[0],n[2]),Math.min(n[1],n[3]),Math.max(n[0],n[2]),Math.max(n[1],n[3])):St(n.x)&&St(e.x)&&St(n.y)&&St(e.y)?a?this.set(n.x,n.y,e.x,e.y):(n.x>e.x?(this.xmin=e.x,this.xmax=n.x):(this.xmin=n.x,this.xmax=e.x),n.y>e.y?(this.ymin=e.y,this.ymax=n.y):(this.ymin=n.y,this.ymax=e.y)):St(n.xmin)&&St(n.xmax)&&St(n.ymin)&&St(n.ymax)&&this.set(n.xmin,n.ymin,n.xmax,n.ymax)}},t._add=function(n){return this._dirty=!0,H(n.x)?H(n.xmin)?H(n[0])||(this.xmin+=n[0],this.ymin+=n[1],this.xmax+=n[0],this.ymax+=n[1]):(this.xmin+=n.xmin,this.ymin+=n.ymin,this.xmax+=n.xmax,this.ymax+=n.ymax):(this.xmin+=n.x,this.ymin+=n.y,this.xmax+=n.x,this.ymax+=n.y),this},t.add=function(){var n=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return n._add.apply(n,arguments)},t._scale=function(n){return this._dirty=!0,this.xmin*=n,this.ymin*=n,this.xmax*=n,this.ymax*=n,this},t._sub=function(n){return this._dirty=!0,H(n.x)?H(n.xmin)?H(n[0])||(this.xmin-=n[0],this.ymin-=n[1],this.xmax-=n[0],this.ymax-=n[1]):(this.xmin-=n.xmin,this.ymin-=n.ymin,this.xmax-=n.xmax,this.ymax-=n.ymax):(this.xmin-=n.x,this.ymin-=n.y,this.xmax-=n.x,this.ymax-=n.y),this},t._substract=function(){return this._sub.apply(this,arguments)},t.sub=function(){var n=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return n._sub.apply(n,arguments)},t.substract=function(){return this.sub.apply(this,arguments)},t.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},t._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},t.getMin=function(n){return n?(n.set(this.xmin,this.ymin),n):new this._clazz(this.xmin,this.ymin)},t.getMax=function(n){return n?(n.set(this.xmax,this.ymax),n):new this._clazz(this.xmax,this.ymax)},t.getCenter=function(n){var e=(this.xmin+this.xmax)/2,r=(this.ymin+this.ymax)/2;return n?(n.set(e,r),n):new this._clazz(e,r)},t.isValid=function(){return!H(this.xmin)&&!H(this.ymin)&&!H(this.xmax)&&!H(this.ymax)},t.equals=function(n){return this.xmin===n.xmin&&this.xmax===n.xmax&&this.ymin===n.ymin&&this.ymax===n.ymax},t.intersects=function(n){this._project(this),this._project(n);var e=Math.max(this.pxmin,n.pxmin),r=Math.max(this.pymin,n.pymin),s=Math.min(this.pxmax,n.pxmax),a=Math.min(this.pymax,n.pymax),h=!(e>s||r>a);return h},t.within=function(n){return this._project(this),this._project(n),this.pxmin>=n.pxmin&&this.pxmax<=n.pxmax&&this.pymin>=n.pymin&&this.pymax<=n.pymax},t.contains=function(n){if(!n)return!1;this._project(this);var e=this.projection;if(e)if(n.x!==void 0){var r=OC;Array.isArray(n)?(r.x=n[0],r.y=n[1]):(r.x=n.x,r.y=n.y),n=e.project(r,r)}else n.xmin!==void 0&&this._project(n);return(n.x||n.pxmin||0)>=this.pxmin&&(n.x||n.pxmax||0)<=this.pxmax&&(n.y||n.pymin||0)>=this.pymin&&(n.y||n.pymax||0)<=this.pymax},t.getWidth=function(){return Math.abs(this.xmax-this.xmin)},t.getHeight=function(){return Math.abs(this.ymax-this.ymin)},t.getSize=function(){return new Pe(this.getWidth(),this.getHeight())},t.set=function(n,e,r,s){return this.xmin=n,this.ymin=e,this.xmax=r,this.ymax=s,this._dirty=!0,this},t.__combine=function(n){n.x!==void 0&&(os.xmin=os.xmax=n.x,os.ymin=os.ymax=n.y,n=os),this._project(n),this._project(this);var e=St(this.pxmin),r,s,a,h;e?(r=Math.min(this.pxmin,n.pxmin),s=Math.min(this.pymin,n.pymin),a=Math.max(this.pxmax,n.pxmax),h=Math.max(this.pymax,n.pymax)):(r=n.pxmin,s=n.pymin,a=n.pxmax,h=n.pymax);var l=this.projection;if(l){mc.set(r,s),vc.set(a,h);var c=l.unproject(mc,mc),u=l.unproject(vc,vc);r=c.x,s=c.y,a=u.x,h=u.y}return Ys[0]=r,Ys[1]=s,Ys[2]=a,Ys[3]=h,Ys},t._combine=function(n){if(!n||n.isValid&&!n.isValid())return this;var e=this.__combine(n);return this.set(e[0],e[1],e[2],e[3]),this._dirty=!0,this},t.combine=function(n){if(!n||n.isValid&&!n.isValid())return this;var e=this.__combine(n);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},t.intersection=function(n){if(!this.intersects(n))return null;_c.x=Math.max(this.pxmin,n.pxmin),_c.y=Math.max(this.pymin,n.pymin),yc.x=Math.min(this.pxmax,n.pxmax),yc.y=Math.min(this.pymax,n.pymax);var e=_c,r=yc,s=this.projection;return s&&(e=s.unproject(e,e),r=s.unproject(r,r)),new this.constructor(e,r,s)},t.expand=function(n){var e,r;return St(n)?e=r=n:(e=n.width||n.x||n[0]||0,r=n.height||n.y||n[1]||0),new this.constructor(this.xmin-e,this.ymin-r,this.xmax+e,this.ymax+r,this.projection)},t._expand=function(n){var e,r;return St(n)?e=r=n:(e=n.width||n.x||n[0]||0,r=n.height||n.y||n[1]||0),this.xmin-=e,this.ymin-=r,this.xmax+=e,this.ymax+=r,this._dirty=!0,this},t.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},t.toArray=function(n){var e=this.xmin,r=this.ymin,s=this.xmax,a=this.ymax;return n?(n[0].x=e,n[0].y=a,n[1].x=s,n[1].y=a,n[2].x=s,n[2].y=r,n[3].x=e,n[3].y=r,n[4].x=e,n[4].y=a,n):[new this._clazz([e,a]),new this._clazz([s,a]),new this._clazz([s,r]),new this._clazz([e,r]),new this._clazz([e,a])]},t.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},t.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},t.convertTo=function(n,e){if(!this.isValid())return null;var r=e||new this.constructor;e&&r.set(null,null,null,null);var s;return this._clazz===q?s=DC:this._clazz===W&&(s=RC),s.x=this.xmin,s.y=this.ymax,r._combine(n(s)),s.x=this.xmax,r._combine(n(s)),s.y=this.ymin,r._combine(n(s)),s.x=this.xmin,r._combine(n(s)),r},t._project=function(n){if(!n||!n.isValid()){n&&(n.pxmin=n.pxmax=n.pymin=n.pymax=null);return}var e=this.projection;if(e){if(n._dirty){Yp.set(n.xmax,n.ymin),Qp.set(n.xmin,n.ymax),xc[0]=Yp,xc[1]=Qp;var r=e.projectCoords(xc),s=r[0],a=r[1];n.pxmin=Math.min(s.x,a.x),n.pymin=Math.min(s.y,a.y),n.pxmax=Math.max(s.x,a.x),n.pymax=Math.max(s.y,a.y)}delete n._dirty}else n.pxmin=n.xmin,n.pxmax=n.xmax,n.pymin=n.ymin,n.pymax=n.ymax},o}();os=new oe(0,0,0,0);var Vt=function(o){ht(t,o);function t(i,n,e,r){var s;return s=o.call(this,i,n,e,r)||this,s._clazz=W,s}return t}(oe),Av=function(){function o(i){this.matrix=i}var t=o.prototype;return t.transform=function(n,e,r){var s=this.matrix[0]*(n.x-this.matrix[2])/e,a=-this.matrix[1]*(n.y-this.matrix[3])/e;return r?(r.x=s,r.y=a,r):new W(s,a)},t.untransform=function(n,e,r){var s=n.x*e/this.matrix[0]+this.matrix[2],a=n.y*e/-this.matrix[1]+this.matrix[3];return r?(r.x=s,r.y=a,r):new q(s,a)},o}(),zs={project:function(){},unproject:function(){},projectCoords:function(t,i){var n=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(t.length===0)return[];if(!this.isSphere())return Mr(t,this.project,this);if(Array.isArray(t[0]))return t.map(function(_){return n.projectCoords(_,i)});for(var e=i!==!1,r=this.getCircum(),s=this.getSphereExtent(),a=s.sx,h=s.sy,l,c,u=t[0],f,d,p,g,m=[this.project(u)],v=1,x=t.length;v<x;v++)f=t[v],d=f.x-u.x,p=f.y-u.y,g=this.project(f),Math.abs(d)>180&&e&&(l===void 0&&(l=f.x>u.x),l&&(g._add(-r.x*Ie(d)*a,0),f._add(-360*Ie(d),0))),Math.abs(p)>90&&e&&(c===void 0&&(c=f.y<u.y),c&&(g._add(0,-r.y*Ie(p)*h),f._add(0,-180*Ie(p)))),u=f,m.push(g);return m},unprojectCoords:function(t){return t?Array.isArray(t)?Mr(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){if(!this.isSphere())return!1;var i=this.getSphereExtent();return!i.contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var i=this.getSphereExtent(),n=new q(t);return i.contains(n)||(n.x=Gn(t.x,i.xmin,i.xmax),n.y=Gn(t.y,i.ymin,i.ymax)),n},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new q(180,90)),i=this.project(new q(-180,-90));this.extent=new oe(i,t,this),this.extent.sx=t.x>i.x?1:-1,this.extent.sy=t.y>i.y?1:-1}return this.extent}},uf={measureLength:function(t,i){if(!Array.isArray(t))return this.measureLenBetween(t,i);for(var n=0,e=0,r=t.length;e<r-1;e++)n+=this.measureLenBetween(t[e],t[e+1]);return n}},Lv=dt({measure:"IDENTITY",measureLenBetween:function(t,i){if(!t||!i)return 0;try{return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}catch{return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var i=0,n=0,e=t.length;n<e;n++){var r=t[n],s=null;n===e-1?s=t[0]:s=t[n+1],i+=r.x*s.y-r.y*s.x}return Math.abs(i/2)},locate:function(t,i,n,e){return e=e||new q(0,0),e.set(t.x,t.y),this._locate(e,i,n)},_locate:function(t,i,n){return t?(i||(i=0),n||(n=0),!i&&!n||(t.x=t.x+i,t.y=t.y+n),t):null},rotate:function(t,i,n){return t=new q(t.x,t.y),this._rotate(t,i,n)},_rotate:function(){var o=new W(0,0);return function(t,i,n){return o.x=t.x-i.x,o.y=t.y-i.y,o._rotate(n*Math.PI/180),t.x=i.x+o.x,t.y=i.y+o.y,t}}()},uf),Rv=function(){function o(i){this.radius=i}var t=o.prototype;return t.measureLenBetween=function(n,e){if(!n||!e)return 0;var r=He(n.y),s=He(e.y),a=r-s,h=He(n.x)-He(e.x);return r=2*Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2)+Math.cos(r)*Math.cos(s)*Math.pow(Math.sin(h/2),2))),r*=this.radius,Math.round(r*1e5)/1e5},t.measureArea=function(n){var e=He(this.radius),r=0,s=n,a=s.length;if(a<3)return 0;var h;for(h=0;h<a-1;h++){var l=s[h],c=s[h+1];r+=l.x*e*Math.cos(He(l.y))*c.y*e-c.x*e*Math.cos(He(c.y))*l.y*e}return a=s[h],s=s[0],r+=a.x*e*Math.cos(He(a.y))*s.y*e-s.x*e*Math.cos(He(s.y))*a.y*e,.5*Math.abs(r)},t.locate=function(n,e,r,s){return s=s||new q(0,0),s.set(n.x,n.y),this._locate(s,e,r)},t._locate=function(n,e,r){if(!n)return null;if(e||(e=0),r||(r=0),!e&&!r)return n;var s,a,h=He(n.y);if(r!==0){var l=Math.abs(r),c=Math.sin(l/(2*this.radius))*2;h=h+c*(r>0?1:-1),a=Gn(h*180/Math.PI,-90,90)}else a=n.y;if(e!==0){var u=Math.abs(e),f=He(n.x),d=2*Math.sqrt(Math.pow(Math.sin(u/(2*this.radius)),2)/Math.pow(Math.cos(h),2));f=f+d*(e>0?1:-1),s=Gn(f*180/Math.PI,-180,180)}else s=n.x;return n.x=s,n.y=a,n},t.rotate=function(n,e,r){return n=new q(n),this._rotate(n,e,r)},t._rotate=function(n,e,r){var s=IC(e,n),a=s-r,h=this.measureLenBetween(e,n);return n.x=e.x,n.y=e.y,kC(n,h,a,this.radius)},o}();function IC(o,t,i){i===void 0&&(i={});var n;i.final?n=Kp(t,o):n=Kp(o,t);var e=n>180?-(360-n):n;return e}function Kp(o,t){var i=He(o.y),n=He(t.y),e=He(t.x-o.x);e>Math.PI&&(e-=2*Math.PI),e<-Math.PI&&(e+=2*Math.PI);var r=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),s=Math.atan2(e,r);return(Zm(s)+360)%360}function kC(o,t,i,n){var e=t/n,r=o.x*Math.PI/180,s=He(o.y),a=He(i),h=e*Math.cos(a),l=s+h;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);var c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),u=Math.abs(c)>1e-11?h/c:Math.cos(s),f=e*Math.sin(a)/u,d=r+f;return o.x=(d*180/Math.PI+540)%360-180,o.y=l*180/Math.PI,o}var $h=dt({measure:"EPSG:4326",sphere:new Rv(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},uf),Ov=dt({measure:"BAIDU",sphere:new Rv(637099681e-2),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},uf),zC=$h,go={};function ff(o){go[o.measure]=o}ff(Lv);ff($h);ff(Ov);var wc={getInstance:function(t){if(!t)return zC;for(var i in go)if(Is(go,i)){var n=go[i].measure;if(!n)continue;if(t.toLowerCase()===n.toLowerCase())return go[i]}return null}},tg=1e-7,Dv=dt({},zs,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t,i){var n=this.rad,e=this.metersPerDegree,r=this.maxLatitude,s=t.x,a=Math.max(Math.min(r,t.y),-r),h;a===0?h=0:h=Math.log(Math.tan((90+a)*n/2))/n;var l=s*e,c=h*e;return i?(i.x=l,i.y=c,i):new q(l,c)},unproject:function(t,i){var n=this.rad,e=this.metersPerDegree,r=t.x/e,s=t.y,a;s===0?a=0:(a=s/e,a=(2*Math.atan(Math.exp(a*n))-Math.PI/2)/n),Math.abs(Math.abs(r)-180)<tg&&(r=Ie(r)*180),Math.abs(Math.abs(a)-this.maxLatitude)<tg&&(a=Ie(a)*this.maxLatitude);var h=Gn(r,-180,180),l=Gn(a,-this.maxLatitude,this.maxLatitude);return i?(i.x=h,i.y=l,i):new q(h,l)}},$h),Iv=dt({},zs,{code:"EPSG:4326",project:function(t,i){return i?(i.x=t.x,i.y=t.y,i):new q(t)},unproject:function(t,i){return i?(i.x=t.x,i.y=t.y,i):new q(t)}},$h),FC=dt({},Iv,{code:"EPSG:4490"}),NC=dt({},zs,{code:"BAIDU",project:function(t,i){return this.convertLL2MC(t,i)},unproject:function(t,i){return this.convertMC2LL(t,i)}},Ov,{EARTHRADIUS:637099681e-2,MCBAND:[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t,i){for(var n,e=0,r=this.MCBAND.length;e<r;e++)if(Math.abs(t.y)>=this.MCBAND[e]){n=this.MC2LL[e];break}var s=this.convertor(t,n,i);return s},convertLL2MC:function(t,i){var n,e,r;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var s=new q(t.x,t.y);for(e=0,r=this.LLBAND.length;e<r;e++)if(s.y>=this.LLBAND[e]){n=this.LL2MC[e];break}if(!n){for(e=this.LLBAND.length-1;e>=0;e--)if(s.y<=-this.LLBAND[e]){n=this.LL2MC[e];break}}var a=this.convertor(t,n,i);return a},convertor:function(t,i,n){if(!t||!i)return null;var e=i[0]+i[1]*Math.abs(t.x),r=Math.abs(t.y)/i[9],s=i[2]+i[3]*r+i[4]*r*r+i[5]*r*r*r+i[6]*r*r*r*r+i[7]*r*r*r*r*r+i[8]*r*r*r*r*r*r;return e*=t.x<0?-1:1,s*=t.y<0?-1:1,n?(n.x=e,n.y=s,n):new q(e,s)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,i,n){return i!=null&&(t=Math.max(t,i)),n!=null&&(t=Math.min(t,n)),t},getLoop:function(t,i,n){if(t===1/0)return n;if(t===-1/0)return i;for(;t>n;)t-=n-i;for(;t<i;)t+=n-i;return t}}),BC=dt({},zs,{code:"IDENTITY",project:function(t,i){return i?(i.x=t.x,i.y=t.y,i):t.copy()},unproject:function(t,i){return i?(i.x=t.x,i.y=t.y,i):t.copy()}},Lv),kv=Dv,za=Object.freeze({EPSG3857:Dv,DEFAULT:kv,EPSG4326:Iv,EPSG4490:FC,BAIDU:NC,IDENTITY:BC,Common:zs}),df=function(o){return function(t){ht(i,t);function i(){return t.apply(this,arguments)||this}return i.registerRenderer=function(e,r){var s=this.prototype,a=Object.getPrototypeOf(s);return(!s._rendererClasses||s._rendererClasses===a._rendererClasses)&&(s._rendererClasses=s._rendererClasses?Object.create(s._rendererClasses):{}),s._rendererClasses[e.toLowerCase()]=r,this},i.getRendererClass=function(e){var r=this.prototype;return r._rendererClasses?r._rendererClasses[e.toLowerCase()]:null},i}(o)},bh={};function oh(o,t){bh[o]=t}var GC=`
    var adapters = {};
    onmessage = function (msg) {
        msg = msg.data;
        if (msg.messageType === 'batch') {
            const messages = msg.messages;
            if (messages) {
                for (let i = 0; i < messages.length; i++) {
                    dispatch(messages[i]);
                }
            }
        } else {
            dispatch(msg);
        }
    };

    function dispatch(msg) {
        var workerKey = msg.workerKey;
        var adapter = adapters[workerKey];
        if (!adapter) {
            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);
            return;
        }
        try {
            adapter.onmessage(msg, wrap(msg.callback));
        } catch (err) {
            post(msg.callback, workerKey + ':' + err.message);
            console.error(err);
            throw err;
        }
    }

    function post(callback, err, data, buffers) {
        var msg = {
            callback : callback
        };
        if (err) {
            msg.error = err;
        } else {
            msg.data = data;
        }
        if (buffers && buffers.length > 0) {
            postMessage(msg, buffers);
        } else {
            postMessage(msg);
        }
    }
    function wrap(callback) {
        return function (err, data, buffers) {
            post(callback, err, data, buffers);
        };
    }
    var workerExports;
`,HC=`
    workerExports = null;
`;function UC(){var o=GC;for(var t in bh){var i=bh[t];ne(i)&&i.length===0&&(i=i()),o+=`
    workerExports = {};
    (`+i+`)(workerExports, self);
    adapters['`+t+"'] = workerExports",o+=`
    workerExports.initialize && workerExports.initialize(self);
        `}return o+=HC,o}var Mc;function VC(){if(typeof window>"u")return null;if(!Mc){var o=UC();Mc=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})),bh=null}return Mc}var WC=typeof window<"u"?window.navigator.hardwareConcurrency||4:0,jC=Math.max(Math.floor(WC/2),1),eg=function(){function o(i){i===void 0&&(i=50),this._limit=i,this._messages=[],this.buffers=[]}var t=o.prototype;return t.addMessage=function(n,e){if(this._messages.push(n),!!Array.isArray(e))for(var r=0;r<e.length;r++)this.buffers.indexOf(e[r])<0&&this.buffers.push(e[r])},t.isFull=function(){return this._messages.length>=this._limit},t.getMessage=function(){return{messageType:"batch",messages:this._messages}},o}(),ZC=function(){function o(){this.active={},this.workerCount=typeof window<"u"?window.MAPTALKS_WORKER_COUNT||jC:0,this._messages=[],this._messageBuffers=[]}var t=o.prototype;return t.acquire=function(n){if(!this.workers){this.workers=[];for(var e=VC(),r=0;r<this.workerCount;r++){var s=new Worker(e);s.id=r,this.workers.push(s)}URL.revokeObjectURL(e)}return this.active[n]=!0,this.workers.slice()},t.release=function(n){delete this.active[n],Object.keys(this.active).length===0&&(this.workers.forEach(function(e){e.terminate()}),this.workers=null)},t.addMessage=function(n,e,r){var s=this._messages[n];(!s||!s.length)&&(s=this._messages[n]=[new eg]);var a=s[s.length-1];a.isFull()&&(a=new eg,this._messages[n].push(a)),a.addMessage(e,r)},t.commit=function(){if(this._messages.length){for(var n=0;n<this._messages.length;n++)if(!(!this._messages[n]||!this._messages[n].length)){var e=this._messages[n].shift();this.workers[n].postMessage(e.getMessage(),e.buffers)}}},o}(),bc;function zv(){return bc||(bc=new ZC),bc}function Fv(){zv().commit(),Fi(Fv)}Fi&&Fi(Fv);var Sc=0,ig=[],pf=function(){function o(i){var n=this;this.workerKey=i,this.workerPool=zv(),this.currentActor=0,this.actorId=Xn(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach(function(e){e.addEventListener("message",n.receiveFn,!1)})}var t=o.prototype;return t.isActive=function(){return!!this.workers},t.broadcast=function(n,e,r){var s=this;return r=r||function(){},XC(this.workers,function(a,h){s.send(n,e,h,a.id)},r),this},t.send=function(n,e,r,s){var a=r?this.actorId+":"+this.callbackID++:null;return r&&(this.callbacks[a]=r),this.post({data:n,callback:String(a)},e,s),this},t.receive=function(n){var e=this,r=n.data,s=r.callback,a=this.callbacks[s];delete this.callbacks[s],r.type==="<request>"?this.actorId===r.actorId&&this[r.command](r.params,function(h,l,c){var u={type:"<response>",callback:r.callback};h?u.error=h.message:u.data=l,e.post(u,c||ig,r.workerId)}):a&&r.error?a(r.error):a&&a(null,r.data)},t.remove=function(){var n=this;this.workers.forEach(function(e){e.removeEventListener("message",n.receiveFn,!1)}),this.workerPool.release(this.actorId),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},t.post=function(n,e,r){return(typeof r!="number"||isNaN(r))&&(r=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),n.workerId=r,n.workerKey=this.workerKey,n.actorId=this.actorId,this.workerPool.addMessage(r,n,e||ig),r},t.getDedicatedWorker=function(){return Sc=(Sc+1)%this.workerPool.workerCount,Sc},o}();function XC(o,t,i){o.length||i(null,[]);var n=o.length,e=new Array(o.length),r=null;o.forEach(function(s,a){t(s,function(h,l){h&&(r=h),e[a]=l,--n===0&&i(r,e)})})}var gf="core-fetch-image",$C=[],qC=function(o){ht(t,o);function t(){return o.call(this,gf)||this}var i=t.prototype;return i.fetchImage=function(e,r){var s={url:e};this.send(s,$C,r)},t}(pf),Fs=function(o){ht(t,o);function t(n){var e;return e=o.call(this)||this,e.layer=n,e._painted=!1,e._drawTime=0,jt.decodeImageInWorker&&(n.options.renderer==="gl"||!jt.safari)&&(e._resWorkerConn=new qC),e.setToRedraw(),e}var i=t.prototype;return i.render=function(e){this.prepareRender(),!(!this.getMap()||!this.layer.isVisible())&&(this.resources||(this.resources=new Sr),this.checkAndDraw(this._tryToDraw,e))},i.checkAndDraw=function(e){var r=this;this._toRedraw=!1;for(var s=arguments.length,a=new Array(s>1?s-1:0),h=1;h<s;h++)a[h-1]=arguments[h];if(this.checkResources){var l=this.checkResources();l.length>0?(this._loadingResource=!0,this.loadResources(l).then(function(){r._loadingResource=!1,r.layer&&(r.layer.fire("resourceload"),r.setToRedraw())})):e.call.apply(e,[this].concat(a))}else e.call.apply(e,[this].concat(a))},i.testIfNeedRedraw=function(){var e=this.getMap();return this._loadingResource?!1:this._toRedraw?!0:e.isInteracting()&&!this.drawOnInteracting?!1:!!this.needToRedraw()},i.needToRedraw=function(){var e=this.getMap();return e.isInteracting()||e.getRenderer().isViewChanged()?!(!e.getPitch()&&e.isMoving()&&!e.isZooming()&&!e.isRotating()&&!this.layer.options.forceRenderOnMoving):!1},i.onSkipDrawOnInteracting=function(){},i.isLoadingResource=function(){return this._loadingResource},i.isRenderComplete=function(){return!!this._renderComplete},i.mustRenderOnInteracting=function(){return!this._painted},i.setToRedraw=function(){return this._toRedraw=!0,this},i.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},i.isCanvasUpdated=function(){return!!this._canvasUpdated},i.remove=function(){this.onRemove(),delete this._loadingResource,delete this.southWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,delete this.layer},i.onRemove=function(){},i.onAdd=function(){},i.getMap=function(){return this.layer?this.layer.getMap():null},i.getCanvasImage=function(){var e=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==e.getZoom()||!this.canvas||!this._extent2D||this.isBlank()||this.layer.isEmpty&&this.layer.isEmpty())return null;var r=e._pointToContainerPoint(this.southWest)._add(0,-e.height);return{image:this.canvas,layer:this.layer,point:r}},i.clear=function(){this.clearCanvas()},i.isBlank=function(){return!this._painted},i.show=function(){this.setToRedraw()},i.hide=function(){this.clear(),this.setToRedraw()},i.setZIndex=function(){this.setToRedraw()},i.hitDetect=function(e){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var r=this.getMap(),s=r.getDevicePixelRatio(),a=r.getSize();if(e.x<0||e.x>a.width*s||e.y<0||e.y>a.height*s)return!1;var h=this.getImageData&&this.getImageData();if(h){var l=Math.round(s*e.x),c=Math.round(s*e.y),u=c*h.width*4+l*4;return h.data[u+3]>0}try{var f=this.context.getImageData(s*e.x,s*e.y,1,1).data;if(f[3]>0)return!0}catch{return this._errorThrown||(this._errorThrown=!0),!1}return!1},i.loadResources=function(e){this.resources||(this.resources=new Sr);var r=this.resources,s=[];if(ee(e))for(var a={},h=e.length-1;h>=0;h--){var l=e[h];!l||!l.length||a[l.join("-")]||(a[l.join("-")]=1,r.isResourceLoaded(l,!0)||s.push(new qp(this._promiseResource(l))))}return qp.all(s)},i.prepareRender=function(){delete this._renderComplete;var e=this.getMap();this._renderZoom=e.getZoom(),this.canvasExtent2D=this._extent2D=e._get2DExtent(),this.southWest=e._containerPointToPoint(new W(0,e.height))},i.createCanvas=function(){if(!this.canvas){var e=this.getMap(),r=e.getSize(),s=e.getDevicePixelRatio(),a=Math.round(s*r.width),h=Math.round(s*r.height);if(this.layer._canvas){var l=this.layer._canvas;l.width=a,l.height=h,l.style&&(l.style.width=r.width+"px",l.style.height=r.height+"px"),this.canvas=this.layer._canvas}else this.canvas=ot.createCanvas(a,h,e.CanvasClass);this.onCanvasCreate()}},i.onCanvasCreate=function(){},i.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=this.canvas.getContext("2d"),!!this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var e=this.getMap().getDevicePixelRatio();e!==1&&this.context.scale(e,e)}},i.resetCanvasTransform=function(){if(!!this.context){var e=this.getMap().getDevicePixelRatio();this.context.setTransform(e,0,0,e,0,0)}},i.resizeCanvas=function(e){var r=this.canvas;if(!!r){var s=e||this.getMap().getSize(),a=this.getMap().getDevicePixelRatio(),h=Ju(s,a),l=h.width,c=h.height,u=h.cssWidth,f=h.cssHeight;this.layer._canvas&&(r.style.width!==u||r.style.height!==f)&&(r.style.width=u,r.style.height=f),!(r.width===l&&r.height===c)&&(r.height=c,r.width=l,a!==1&&this.context&&this.context.scale(a,a))}},i.clearCanvas=function(){if(!(!this.context||!this.getMap())){var e=this.getMap().getDevicePixelRatio(),r=1/e,s=this.canvas.width*r,a=this.canvas.height*r;ot.clearRect(this.context,0,0,Math.max(s,this.canvas.width),Math.max(a,this.canvas.height))}},i.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var e=this.layer.getMask();if(!e)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var r=this._maskExtent=e._getMaskPainter().get2DExtent();return r.intersects(this._extent2D)?(this.layer.fire("renderstart",{context:this.context,gl:this.gl}),r):(this.layer.fire("renderstart",{context:this.context,gl:this.gl}),r)},i.clipCanvas=function(e){var r=this.layer.getMask();if(!r)return!1;var s=this.southWest,a=this.getMap();this.southWest=a._containerPointToPoint(new W(0,a.height)),e.save();var h=a.getDevicePixelRatio();if(h!==1&&(e.save(),e.scale(h,h)),r.getGeometries){e.isMultiClip=!0;var l=r.getGeometries()||[];e.beginPath(),l.forEach(function(u){var f=u._getMaskPainter();f.paint(null,e)}),e.stroke(),delete e.isMultiClip}else{var c=r._getMaskPainter();c.paint(null,e)}return h!==1&&e.restore(),e.clip(),this.southWest=s,!0},i.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this.southWest}},i.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},i.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},i.onZoomStart=function(){},i.onZoomEnd=function(){this.setToRedraw()},i.onZooming=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){this.setToRedraw()},i.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},i.onDragRotateStart=function(){},i.onDragRotating=function(){},i.onDragRotateEnd=function(){this.setToRedraw()},i.onSpatialReferenceChange=function(){},i.getDrawTime=function(){return this._drawTime},i._tryToDraw=function(e){if(this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()){this._renderComplete=!0;return}this._drawAndRecord(e)},i._drawAndRecord=function(e){if(!!this.getMap()){var r=this._painted;this._painted=!0;var s=me();this.draw(e),s=me()-s,this._drawTime=r?s:s/2,r&&this.layer&&this.layer.options.logDrawTime}},i._promiseResource=function(e){var r=this,s=this.resources,a=this.layer.options.crossOrigin,h=this.layer.options.renderer||"";return function(l){if(s.isResourceLoaded(e,!0)){l(e);return}if(!gr(e[0])&&r._resWorkerConn){var c=qu(e[0]);r._resWorkerConn.fetchImage(c,function(f,d){if(f){l(e);return}$u(d,function(p){r._cacheResource(e,p),l(e)})})}else{var u=new Image;H(a)?h!=="canvas"&&(u.crossOrigin=""):u.crossOrigin=a,gr(e[0])&&!De&&(e[1]&&(e[1]*=2),e[2]&&(e[2]*=2)),u.onload=function(){r._cacheResource(e,u),l(e)},u.onabort=function(f){l(e)},u.onerror=function(f){s.markErrorResource(e),l(e)},Po(u,e)}}},i._cacheResource=function(e,r){if(!(!this.layer||!this.resources)){var s=e[1],a=e[2];if(this.layer.options.cacheSvgOnCanvas&&gr(e[0])===1&&(jt.edge||jt.ie)){H(s)&&(s=r.width||this.layer.options.defaultIconSize[0]),H(a)&&(a=r.height||this.layer.options.defaultIconSize[1]);var h=ot.createCanvas(s,a);ot.image(h.getContext("2d"),r,0,0,s,a),r=h}this.resources.addResource(e,r)}},t}(wi),Sr=function(){function o(){this.resources={},this._errors={}}var t=o.prototype;return t.addResource=function(n,e){var r=this;if(this.resources[n[0]]={image:e,width:+n[1],height:+n[2],refCnt:0},e&&!e.close&&jt.imageBitMap&&!jt.safari){if(e.src&&gr(e.src))return;createImageBitmap(e).then(function(s){!r.resources[n[0]]||(r.resources[n[0]].image=s)})}},t.isResourceLoaded=function(n,e){if(!n)return!1;var r=this._getImgUrl(n);if(this._errors[r])return!0;var s=this.resources[r];return!(!s||e&&gr(n[0])&&(+n[1]>s.width||+n[2]>s.height))},t.login=function(n){var e=this.resources[n];e&&e.refCnt++},t.logout=function(n){var e=this.resources[n];e&&e.refCnt--<=0&&delete this.resources[n]},t.getImage=function(n){var e=this._getImgUrl(n);return!this.isResourceLoaded(n)||this._errors[e]?null:this.resources[e].image},t.markErrorResource=function(n){this._errors[this._getImgUrl(n)]=1},t.merge=function(n){if(!n)return this;for(var e in n.resources){var r=n.resources[e];this.addResource([e,r.width,r.height],r.image)}return this},t.forEach=function(n){if(!this.resources)return this;for(var e in this.resources)Is(this.resources,e)&&n(e,this.resources[e]);return this},t._getImgUrl=function(n){return Array.isArray(n)?n[0]:n},t.remove=function(){for(var n in this.resources){var e=this.resources[n];e&&e.image&&e.image.close&&e.image.close()}this.resources={}},o}(),ms={markerWidth:10,markerHeight:10,markerLineWidth:1};function Nv(){return .5}var JC=new W(0,0);function mf(o,t,i,n,e,r,s){var a=JC.set(t,i),h=o.set(a.x,a.y,a.x+r,a.y+s);return h._add(e),n&&QC(h,n),h}var YC=[];function Bv(o,t,i){i=i||Vv(YC,t);var n=Uv(t,i[0],i[1]);return mf(o,t.markerDx||0,t.markerDy||0,qh(t),n,i[0],i[1])}function Gv(o){return o==="rectangle"?"right":"middle"}function Hv(o){return o==="bar"||o==="pie"||o==="pin"?"top":o==="rectangle"?"bottom":"middle"}var vs=new Pe(0,0);function Uv(o,t,i){var n=Nv(),e=2*(o.shadowBlur||0),r=e+n;vs.width=t,vs.height=i;var s=o.markerType,a=Hn(vs,o.markerHorizontalAlignment||Gv(s),o.markerVerticalAlignment||Hv(s));return a.x!==-t/2&&(a.x-=Ie(a.x+t/2)*r),a.y!==-i/2&&(a.y-=Ie(a.y+i/2)*r),a}function Vv(o,t){var i=Nv(),n=Tt(t.markerWidth,ms.markerWidth),e=Tt(t.markerHeight,ms.markerHeight),r=Tt(t.markerLineWidth,ms.markerLineWidth),s=2*((t.shadowBlur||0)+Math.max(Math.abs(t.shadowOffsetX||0)+Math.abs(t.shadowOffsetY||0))),a=Math.round(n+r+s+i*2),h=Math.round(e+r+s+i*2);return o[0]=a,o[1]=h,o}var ng=new Vt;function QC(o,t){var i=o.xmin,n=o.ymin,e=o.xmax,r=o.ymax;return ng.set(i,n,e,r),ng.convertTo(function(s){return s._rotate(t)},o)}function qh(o,t){t===void 0&&(t="markerRotation");var i=o[t];return St(i)?-i*Math.PI/180:0}function vu(o,t,i){var n=t.markerFile,e=i?i.getImage(n):null,r=t.markerWidth||(e?e.width:0),s=t.markerHeight||(e?e.height:0);vs.width=r,vs.height=s;var a=Hn(vs,t.markerHorizontalAlignment||"middle",t.markerVerticalAlignment||"top");return mf(o,t.markerDx||0,t.markerDy||0,qh(t),a,r,s)}function Wv(o,t,i){var n=i.size,e=Hn(n,t.textHorizontalAlignment,t.textVerticalAlignment);if(t.textHaloRadius){var r=t.textHaloRadius;n=n.add(r*2,r*2)}return mf(o,t.textDx||0,t.textDy||0,qh(t,"textRotation"),e,n.width,n.height)}var Fa=new Vt;function _u(o,t,i,n){var e=o||new Vt;if(Array.isArray(t)){for(var r=t,s=0;s<r.length;s++)_u(e,r[s],i,n[s]);return e}return Sh(t)&&e._combine(Wv(Fa,t,n)),vf(t)&&e._combine(vu(Fa,t,i)),Ch(t)&&e._combine(Bv(Fa,t)),_f(t)&&e._combine(vu(Fa,t)),e}function Sh(o){return o?!H(o.textName):!1}function vf(o){return o?!H(o.markerFile):!1}function Ch(o){return o?!!(H(o.markerFile)&&!H(o.markerType)&&o.markerType!=="path"):!1}function _f(o){return o?!!(H(o.markerFile)&&o.markerType==="path"):!1}var Cc=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation"],Tc=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY"];function ah(o,t,i,n){for(var e=[],r=0,s,a=0,h=o.length;a<h-1;a++)s=KC(o[a],o[a+1],t,a,i,n),s&&(e[r]=e[r]||[],e[r].push({point:s[0],index:a}),(s[1]!==o[a+1]||a===h-2)&&(e[r].push({point:s[1],index:a+1}),r++));return e}var rg;function KC(o,t,i,n,e,r){var s=n?rg:_s(o,i),a=_s(t,i),h,l,c;for(rg=a;;){if(!(s|a))return[o,t];if(s&a)return!1;if(r)return[o,t];h=s||a,l=yu(o,t,h,i,e),c=_s(l,i),h===s?(o=l,s=c):(t=l,a=c)}}function hh(o,t,i){var n=[1,4,2,8],e,r,s,a,h,l,c,u,f;for(r=0,c=o.length;r<c;r++)o[r]._code=_s(o[r],t);for(a=0;a<4;a++){for(u=n[a],e=[],r=0,c=o.length,s=c-1;r<c;s=r++)h=o[r],l=o[s],h._code&u?l._code&u||(f=yu(l,h,u,t,i),f._code=_s(f,t),e.push(f)):(l._code&u&&(f=yu(l,h,u,t,i),f._code=_s(f,t),e.push(f)),e.push(h));o=e}return o}function yu(o,t,i,n,e){var r=t.x-o.x,s=t.y-o.y,a=n.getMin(),h=n.getMax(),l,c;i&8?(l=o.x+r*(h.y-o.y)/s,c=h.y):i&4?(l=o.x+r*(a.y-o.y)/s,c=a.y):i&2?(l=h.x,c=o.y+s*(h.x-o.x)/r):i&1&&(l=a.x,c=o.y+s*(a.x-o.x)/r);var u=new W(l,c);return e&&u._round(),u}function _s(o,t){var i=0;return o.x<t.getMin().x?i|=1:o.x>t.getMax().x&&(i|=2),o.y<t.getMin().y?i|=4:o.y>t.getMax().y&&(i|=8),i}function jv(o,t,i,n){o=new W(o);var e=Math.abs(i.x-t.x),r=Math.abs(i.y-t.y),s=Math.sqrt(Math.abs(e*e-r*r)),a=e>=r,h,l,c;return a?(h=new W(t.x-s,t.y),l=new W(t.x+s,t.y),c=e*2):(h=new W(t.x,t.y-s),l=new W(t.x,t.y+s),c=r*2),o.distanceTo(h)+o.distanceTo(l)<=c+2*n}var tT=function(){function o(){}var t=o.prototype;return t.getMap=function(){return this.geometry.getMap()},t.getPainter=function(){return this.painter},t.isDynamicSize=function(){return!1},o.testColor=function(n){return!n||!Xt(n)?!1:US.indexOf(n)>=0},o}(),Zv=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i._prepareContext=function(e){if(Ae(this.symbol.opacity)?this._opacityFn||(this._opacityFn=rv(this.symbol.opacity)):delete this._opacityFn,St(this.symbol.opacity))e.globalAlpha!==this.symbol.opacity&&(e.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var r=this.getMap();e.globalAlpha=this._opacityFn(r.getZoom())}else e.globalAlpha!==1&&(e.globalAlpha=1)},i.prepareCanvas=function(e,r,s){e.setLineDash&&ee(r.lineDasharray)&&e.setLineDash(r.lineDasharray);var a=this.getPainter().isHitTesting();ot.prepareCanvas(e,r,s,a)},i.remove=function(){},i.setZIndex=function(){},i.show=function(){},i.hide=function(){},i._defineStyle=function(e){return _h(e,this.geometry)},t}(tT);function eT(o,t){var i=o&&o.getImage(t);return i||null}function Xv(o,t,i,n){var e=$v(i),r=i,s=r.markerType.toLowerCase(),a=qv(s,r.markerWidth,r.markerHeight),h=e.lineOpacity,l=e.polygonOpacity,c=hn(e.polygonFill);if(c){var u;hn(e.polygonFill)&&(u||(u=iT(t,r.markerWidth,r.markerHeight)),e.polygonGradientExtent=u)}ot.prepareCanvas(o,e,n);var f=r.markerWidth,d=r.markerHeight,p=r.markerLineWidth/2;if(s==="ellipse")ot.ellipse(o,t,f/2,d/2,d/2,h,l);else if(s==="cross"||s==="x"){for(var g=a.length-1;g>=0;g--)a[g]._add(t);ot.path(o,a.slice(0,2),h),ot.path(o,a.slice(2,4),h)}else if(s==="diamond"||s==="bar"||s==="square"||s==="rectangle"||s==="triangle"){s==="bar"?t=t.add(0,-p):s==="rectangle"&&(t=t.add(p,p));for(var m=a.length-1;m>=0;m--)a[m]._add(t);ot.polygon(o,a,h,l)}else if(s==="pin"){t=t.add(0,-p);for(var v=a.length-1;v>=0;v--)a[v]._add(t);var x=o.lineCap;o.lineCap="round",ot.bezierCurveAndFill(o,a,h,l),o.lineCap=x}else if(s==="pie"){t=t.add(0,-p);var _=Math.atan(f/2/d)*180/Math.PI,y=o.lineCap;o.lineCap="round",ot.sector(o,t,d,[90-_,90+_],h,l),o.lineCap=y}else throw new Error("unsupported markerType: "+s);return o.canvas}function iT(o,t,i){var n=new Vt;return n._combine(o),n.xmin+=-t/2,n.ymin+=-i/2,n.xmax+=t/2,n.ymax+=i/2,n}function $v(o){var t={lineColor:o.markerLineColor,linePatternFile:o.markerLinePatternFile,lineWidth:o.markerLineWidth,lineOpacity:o.markerLineOpacity,lineDasharray:o.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:o.markerFill,polygonPatternFile:o.markerFillPatternFile,polygonOpacity:o.markerFillOpacity};return t.lineWidth===0&&(t.lineOpacity=0),t}function qv(o,t,i){var n=i/2,e=t/2,r=0,s=0,a,h,l,c;if(o==="triangle")return a=new W(r,s-n),h=new W(r-e,s+n),l=new W(r+e,s+n),[a,h,l];if(o==="cross")return a=new W(r-e,s),h=new W(r+e,s),l=new W(r,s-n),c=new W(r,s+n),[a,h,l,c];if(o==="diamond")return a=new W(r-e,s),h=new W(r,s-n),l=new W(r+e,s),c=new W(r,s+n),[a,h,l,c];if(o==="square")return a=new W(r-e,s+n),h=new W(r+e,s+n),l=new W(r+e,s-n),c=new W(r-e,s-n),[a,h,l,c];if(o==="rectangle")return a=new W(r,s),h=a.add(t,0),l=a.add(t,i),c=a.add(0,i),[a,h,l,c];if(o==="x")return a=new W(r-e,s+n),h=new W(r+e,s-n),l=new W(r+e,s+n),c=new W(r-e,s-n),[a,h,l,c];if(o==="bar")return a=new W(r-e,s-i),h=new W(r+e,s-i),l=new W(r+e,s),c=new W(r-e,s),[a,h,l,c];if(o==="pin"||o==="pie"){var u=i*Math.atan(e/n);return a=new W(r,s),h=new W(r-u,s-i),l=new W(r+u,s-i),c=new W(r,s),[a,h,l,c]}return[]}var nT=new W(0,0),rT=new W(0,0),sT=new W(0,0),oT=new W(0,0),Ns=function(o){ht(t,o);function t(n,e,r){var s;return s=o.call(this)||this,s.symbol=n,s.geometry=e,s.painter=r,s}var i=t.prototype;return i.get2DExtent=function(){for(var e=this.getMap(),r=e.getGLRes(),s=new Vt,a=this._getRenderPoints()[0],h=a.length-1;h>=0;h--)a[h]&&s._combine(e._pointAtResToPoint(a[h],r));return s},i.isDynamicSize=function(){var e=this.symbol;return Ae(e.markerWidth)||Ae(e.markerHeight)||Ae(e.textSize)},i._rotateExtent=function(e,r){return e.convertTo(function(s){return s._rotate(r)})},i._getRenderPoints=function(){var e=this.getPainter(),r=e.isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(r)},i._getRenderContainerPoints=function(e){var r=this.getPainter();if(r.isSpriting())return this._getRenderPoints()[0];var s=this.geometry,a=this.getDxDy(),h;if(s._cPoint&&!e){var l=e?sT:oT;l.set(s._cPoint.x,s._cPoint.y);var c=r.containerOffset;l._sub(c);var u=a.x,f=a.y;(u||f)&&l._add(u||0,f||0),h=[l]}else{var d=this._getRenderPoints()[0];h=this.painter._pointContainerPoints(d,a.x,a.y,e,!0,this.getPlacement())}if(!h||!Array.isArray(h[0]))return h;for(var p=[],g=0,m=h.length;g<m;g++)for(var v=0,x=h[g].length;v<x;v++)p.push(h[g][v]);return p},i.getPlacement=function(){return this.symbol.markerPlacement},i.getRotation=function(){return qh(this.style)},i.getDxDy=function(){var e=this.style,r=e.markerDx,s=e.markerDy;return new W(r,s)},i._getRotationAt=function(e){var r=this.getRotation();r||(r=0);var s=this._getRenderPoints()[1];if(!s||!s[e])return r;var a=this.getMap(),h=s[e][0],l=s[e][1];if(a.isTransforming()){var c=a.getGLRes();return h=a._pointAtResToContainerPoint(s[e][0],c,0,nT),l=a._pointAtResToContainerPoint(s[e][1],c,0,rT),r+mh(h.x,h.y,l.x,l.y)}else return r+-mh(h.x,h.y,l.x,l.y)},i._rotate=function(e,r,s){if(s){var a=this.getDxDy(),h=r.sub(a);return e.save(),e.translate(h.x,h.y),e.rotate(s),a}return null},t}(Zv),aT=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.getPlacement=function(){return"point"},i.getDxDy=function(){return new W(0,0)},i.symbolize=function(e){var r=this.geometry,s=r.getLayer();if(!(!r.options.debug&&s&&!s.options.debug)){var a=this.getMap();if(!(!a||a.isZooming())){var h=s.options.debugOutline,l=1;e.strokeStyle=h,e.fillStyle=h;var c=r.getContainerExtent().toArray();ot.polygon(e,[c],l,0);for(var u=this._getRenderContainerPoints(),f=this.geometry.getId(),d=qv("cross",10,10),p=0;p<u.length;p++){var g=u[p];H(f)||ot.fillText(e,f,g.add(8,-4),h);for(var m=[],v=0;v<d.length;v++)m.push(d[v].add(g));ot.path(e,m.slice(0,2),l),ot.path(e,m.slice(2,4),l)}}}},t}(Ns),Pc=new Pe(1,1),yf=function(o){ht(t,o),t.test=function(e){return vf(e)};function t(n,e,r){var s;return s=o.call(this,n,e,r)||this,s.style=s._defineStyle(s.translate()),s}var i=t.prototype;return i.symbolize=function(e,r){var s=this.style;if(!(!this.painter.isHitTesting()&&(s.markerWidth===0||s.markerHeight===0||s.markerOpacity===0))){var a=this._getRenderContainerPoints();if(!!ee(a)){var h=this._getImage(r);if(!!h){this._prepareContext(e);var l=s.markerWidth,c=s.markerHeight;if(!St(l)||!St(c)){l=h.width,c=h.height,s.markerWidth=l,s.markerHeight=c;var u=s.markerFile;r.isResourceLoaded(u)||r.addResource(u,h);var f=this.getPainter();f.isSpriting()||f.removeCache()}var d;this.symbol.markerType!=="path"&&St(s.markerOpacity)&&s.markerOpacity<1&&(d=e.globalAlpha,e.globalAlpha*=s.markerOpacity),Pc.width=l,Pc.height=c;for(var p=Hn(Pc,s.markerHorizontalAlignment,s.markerVerticalAlignment),g=0,m=a.length;g<m;g++){var v=a[g],x=this.getRotation()?this._rotate(e,v,this._getRotationAt(g)):null;x&&(v=x),ot.image(e,h,v.x+p.x,v.y+p.y,l,c),x&&e.restore()}d!==void 0&&(e.globalAlpha=d)}}}},i._getImage=function(e){return eT(e,this.style.markerFile)},i.getFixedExtent=function(e){return this._fixedExtent=this._fixedExtent||new Vt,vu(this._fixedExtent,this.style,e)},i.translate=function(){var e=this.symbol;return{markerFile:e.markerFile,markerOpacity:Tt(e.markerOpacity,1),markerWidth:Tt(e.markerWidth,null),markerHeight:Tt(e.markerHeight,null),markerRotation:Tt(e.markerRotation,0),markerDx:Tt(e.markerDx,0),markerDy:Tt(e.markerDy,0),markerHorizontalAlignment:Tt(e.markerHorizontalAlignment,"middle"),markerVerticalAlignment:Tt(e.markerVerticalAlignment,"top")}},t}(Ns),hT=new q(0,0),lT=new q(0,0),Jv=function(o){ht(t,o),t.test=function(e,r){if(!e||r&&r.type==="Point")return!1;for(var s in e){var a=s.slice(0,4);if(a==="line"||a==="poly")return!0}return!1};function t(n,e,r){var s;return s=o.call(this)||this,s.symbol=n,s.geometry=e,s.painter=r,e.type==="Point"?ze(s):(s.style=s._defineStyle(s.translate()),s)}var i=t.prototype;return i.symbolize=function(e,r){var s=this.style;if(!(s.polygonOpacity===0&&s.lineOpacity===0&&!this.painter.isHitTesting())){var a=this._getPaintParams();if(!!a){this._prepareContext(e);var h=hn(s.lineColor),l=this.geometry.getJSONType()==="Polygon"||this.geometry.type==="LineString";h&&(s.lineColor.places||!l)&&(s.lineGradientExtent=this.geometry.getContainerExtent()._expand(s.lineWidth)),hn(s.polygonFill)&&(s.polygonGradientExtent=this.geometry.getContainerExtent());var c=a[0],u=this.geometry.getJSONType()==="Polygon"&&c.length>0&&Array.isArray(c[0][0])||this.geometry.type==="LineString"&&c.length>0&&Array.isArray(c[0]);if(u)for(var f=0;f<c.length;f++){this.prepareCanvas(e,s,r),h&&l&&!s.lineColor.places&&this._createGradient(e,c[f],s.lineColor);var d=[e,c[f]];a.length>1&&d.push.apply(d,a.slice(1)),d.push(s.lineOpacity,s.polygonOpacity,s.lineDasharray),this.geometry._paintOn.apply(this.geometry,d)}else{this.prepareCanvas(e,s,r),h&&l&&!s.lineColor.places&&this._createGradient(e,c,s.lineColor);var p=[e];p.push.apply(p,a),p.push(s.lineOpacity,s.polygonOpacity,s.lineDasharray),this.geometry._paintOn.apply(this.geometry,p)}e.setLineDash&&Array.isArray(s.lineDasharray)&&e.setLineDash([])}}},i.get2DExtent=function(){var e=this.getMap(),r=this.geometry._getPrjExtent();if(!r)return null;(!this._extMin||!this._extMax)&&(this._extMin=new q(0,0),this._extMax=new q(0,0)),this._extMin.x=r.xmin,this._extMin.y=r.ymin,this._extMax.x=r.xmax,this._extMax.y=r.ymax;var s=e._prjToPoint(this._extMin,void 0,hT),a=e._prjToPoint(this._extMax,void 0,lT);return this._pxExtent?this._pxExtent.set(Math.min(s.x,a.x),Math.min(s.y,a.y),Math.max(s.x,a.x),Math.max(s.y,a.y)):this._pxExtent=new Vt(s,a),this._pxExtent},i.getFixedExtent=function(){var e=this.style.lineWidth/2;return new Vt(-e,-e,e,e)},i._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},i.translate=function(){var e=this.symbol,r={lineColor:Tt(e.lineColor,"#000"),lineWidth:Tt(e.lineWidth,2),lineOpacity:Tt(e.lineOpacity,1),lineDasharray:Tt(e.lineDasharray,[]),lineCap:Tt(e.lineCap,"butt"),lineJoin:Tt(e.lineJoin,"miter"),linePatternFile:Tt(e.linePatternFile,null),lineDx:Tt(e.lineDx,0),lineDy:Tt(e.lineDy,0),polygonFill:Tt(e.polygonFill,null),polygonOpacity:Tt(e.polygonOpacity,1),polygonPatternFile:Tt(e.polygonPatternFile,null),polygonPatternDx:Tt(e.polygonPatternDx,0),polygonPatternDy:Tt(e.polygonPatternDy,0),linePatternDx:Tt(e.linePatternDx,0),linePatternDy:Tt(e.linePatternDy,0)};return r.lineWidth===0&&(r.lineOpacity=0),this.geometry.type==="LineString"&&!r.polygonFill&&(r.polygonFill=r.lineColor),r},i._createGradient=function(e,r,s){if(!(!Array.isArray(r)||!r.length)){var a=r.length,h=e.createLinearGradient(r[0].x,r[0].y,r[a-1].x,r[a-1].y);s.colorStops.forEach(function(l){h.addColorStop.apply(h,l)}),e.strokeStyle=h}},t}(Zv),cT=function(o){ht(t,o),t.test=function(e){return Sh(e)};function t(n,e,r){var s;s=o.call(this,n,e,r)||this;var a=s.translate();return s._dynamic=nv(a),s.style=s._defineStyle(a),s.style.textWrapWidth===0?ze(s):(s.strokeAndFill=s._defineStyle(s.translateLineAndFill(s.style)),s)}var i=t.prototype;return i.symbolize=function(e,r){if(!(!this.painter.isHitTesting()&&(this.style.textSize===0||!this.style.textOpacity&&(!this.style.textHaloRadius||!this.style.textHaloOpacity)||this.style.textWrapWidth===0))){var s=this._getRenderContainerPoints();if(!!ee(s)){var a=this.style,h=this.strokeAndFill,l=xh(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var c=this._textDesc=this._textDesc||wh(l,this.style);this._prepareContext(e),this.prepareCanvas(e,h,r),ot.prepareCanvasFont(e,a);for(var u=0,f=s.length;u<f;u++){var d=s[u],p=this.getRotation()?this._rotate(e,d,this._getRotationAt(u)):null;p&&(d=p),ot.text(e,l,d,a,c),p&&e.restore()}}}},i.getPlacement=function(){return this.symbol.textPlacement},i.getRotation=function(){var e=this.style.textRotation;return St(e)?-e*Math.PI/180:null},i.getDxDy=function(){var e=this.style;return new W(e.textDx,e.textDy)},i.getFixedExtent=function(){var e=this.geometry.getTextDesc();return Array.isArray(e)&&(e=e[this._index]),this._fixedExtent=this._fixedExtent||new Vt,e?Wv(this._fixedExtent,this.style,e):this._fixedExtent},i.translate=function(){var e=this.symbol,r={textName:e.textName,textFaceName:Tt(e.textFaceName,"monospace"),textWeight:Tt(e.textWeight,"normal"),textStyle:Tt(e.textStyle,"normal"),textSize:Tt(e.textSize,Wm),textFont:Tt(e.textFont,null),textFill:Tt(e.textFill,"#000"),textOpacity:Tt(e.textOpacity,1),textHaloFill:Tt(e.textHaloFill,"#ffffff"),textHaloRadius:Tt(e.textHaloRadius,0),textHaloOpacity:Tt(e.textHaloOpacity,1),textWrapWidth:Tt(e.textWrapWidth,null),textWrapCharacter:Tt(e.textWrapCharacter,`
`),textLineSpacing:Tt(e.textLineSpacing,0),textDx:Tt(e.textDx,0),textDy:Tt(e.textDy,0),textHorizontalAlignment:Tt(e.textHorizontalAlignment,"middle"),textVerticalAlignment:Tt(e.textVerticalAlignment,"middle"),textAlign:Tt(e.textAlign,"center"),textRotation:Tt(e.textRotation,0),textMaxWidth:Tt(e.textMaxWidth,0),textMaxHeight:Tt(e.textMaxHeight,0)};return r.textMaxWidth>0&&(!r.textWrapWidth||r.textWrapWidth>r.textMaxWidth)&&(r.textWrapWidth||(r.textMaxHeight=1),r.textWrapWidth=r.textMaxWidth),r},i.translateLineAndFill=function(e){return{lineColor:e.textHaloRadius?e.textHaloFill:e.textFill,lineWidth:e.textHaloRadius,lineOpacity:e.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:e.textFill,polygonOpacity:e.textOpacity}},t}(Ns),uT=[],Yv=function(o){ht(t,o),t.test=function(e){return Ch(e)};function t(n,e,r){var s;s=o.call(this,n,e,r)||this;var a=s.translate();return s._dynamic=nv(a),s.style=s._defineStyle(a),s.strokeAndFill=s._defineStyle($v(s.style)),s.padding=0,s}var i=t.prototype;return i.symbolize=function(e,r){var s=this.style;if(!(!this.painter.isHitTesting()&&(s.markerWidth===0||s.markerHeight===0||s.polygonOpacity===0&&s.lineOpacity===0))){var a=this._getRenderContainerPoints();!ee(a)||(this._prepareContext(e),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||this.geometry.getLayer().options.cacheVectorOnCanvas===!1?this._drawMarkers(e,a,r):this._drawMarkersWithCache(e,a,r))}},i._drawMarkers=function(e,r,s){for(var a=r.length-1;a>=0;a--){var h=r[a],l=this.getRotation()?this._rotate(e,h,this._getRotationAt(a)):null;l&&(h=l),this._drawVectorMarker(e,h,s),l&&e.restore()}},i._drawMarkersWithCache=function(e,r,s){var a=this._stampSymbol(),h=s.getImage(a);h||(h=this._createMarkerImage(e,s),s.addResource([a,h.width,h.height],h));for(var l=Uv(this.style,h.width,h.height),c=r.length-1;c>=0;c--){var u=r[c],f=this.getRotation()?this._rotate(e,u,this._getRotationAt(c)):null;f&&(u=f),ot.image(e,h,u.x+l.x,u.y+l.y),f&&e.restore()}},i._createMarkerImage=function(e,r){var s=e.canvas.constructor,a=Vv(uT,this.style),h=ot.createCanvas(a[0],a[1],s),l=this._getCacheImageAnchor(a[0],a[1]),c=h.getContext("2d");return this._drawVectorMarker(c,l,r),h},i._stampSymbol=function(){return this._stamp||(this._stamp=sf([this.style.markerType,hn(this.style.markerFill)?du(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,hn(this.style.markerLineColor)?du(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},i._getCacheImageAnchor=function(e,r){var s=2*(this.symbol.shadowBlur||0),a=s+this.padding,h=this.style.markerType;return h==="bar"||h==="pie"||h==="pin"?new W(e/2,r-a):h==="rectangle"?new W(a,a):new W(e/2,r/2)},i._getGraidentExtent=function(e){var r=new Vt,s=this.getDxDy(),a=this.getFixedExtent();if(Array.isArray(e))for(var h=e.length-1;h>=0;h--)r._combine(e[h]);else r._combine(e);return r.xmin+=a.xmin-s.x,r.ymin+=a.ymin-s.y,r.xmax+=a.xmax-s.x,r.ymax+=a.ymax-s.y,r},i._drawVectorMarker=function(e,r,s){Xv(e,r,this.style,s)},i.getFixedExtent=function(){var e=this.isDynamicSize(),r=this.style.markerWidth,s=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new Vt,Bv(this._fixedExtent,this.style,e?[128,128*s/r]:null)},i.translate=function(){var e=this.symbol,r={markerType:Tt(e.markerType,"ellipse"),markerFill:Tt(e.markerFill,"#00f"),markerFillOpacity:Tt(e.markerFillOpacity,1),markerFillPatternFile:Tt(e.markerFillPatternFile,null),markerLineColor:Tt(e.markerLineColor,"#000"),markerLineWidth:Tt(e.markerLineWidth,ms.markerLineWidth),markerLineOpacity:Tt(e.markerLineOpacity,1),markerLineDasharray:Tt(e.markerLineDasharray,[]),markerLinePatternFile:Tt(e.markerLinePatternFile,null),markerDx:Tt(e.markerDx,0),markerDy:Tt(e.markerDy,0),markerWidth:Tt(e.markerWidth,ms.markerWidth),markerHeight:Tt(e.markerHeight,ms.markerHeight),markerRotation:Tt(e.markerRotation,0),shadowBlur:Tt(e.shadowBlur,0),shadowOffsetX:Tt(e.shadowOffsetX,0),shadowOffsetY:Tt(e.shadowOffsetY,0)},s=r.markerType,a=Gv(s),h=Hv(s);return r.markerHorizontalAlignment=Tt(e.markerHorizontalAlignment,a),r.markerVerticalAlignment=Tt(e.markerVerticalAlignment,h),St(e.markerOpacity)&&(St(e.markerFillOpacity)&&(r.markerFillOpacity*=e.markerOpacity),St(e.markerLineOpacity)&&(r.markerLineOpacity*=e.markerOpacity)),r},t}(Ns),Qv=function(o){ht(t,o),t.test=function(e){return _f(e)};function t(n,e,r){var s;H(n.markerWidth)&&(n.markerWidth=80),H(n.markerHeight)&&(n.markerHeight=80),s=o.call(this,n,e,r)||this,n=dt(n,s.translate());var a=s.style=s._defineStyle(n);return jt.gecko?s._url=[Ao(a,a.markerWidth,a.markerHeight),a.markerWidth,a.markerHeight]:s._url=[Ao(a),a.markerWidth,a.markerHeight],s}var i=t.prototype;return i._prepareContext=function(){},i._getImage=function(e){var r=this;if(e&&e.isResourceLoaded(this._url))return e.getImage(this._url);var s=this.painter,a=new Image;return a.onload=function(){var h=s.getLayer()&&s.getLayer().getRenderer();h&&h.setToRedraw()},a.onerror=function(h){e.markErrorResource(r._url)},a.src=this._url[0],e&&e.addResource(this._url,a),a},t}(yf),fT={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},dT=function(o){ht(t,o),t.test=function(e,r){var s=r.getLayer();if(!s)return!1;var a=r.getJSONType();return a==="Marker"||a==="LineString"};function t(n,e,r){var s;return s=o.call(this,n,e,r)||this,s.style=e.getLayer().options.drawAltitude,(!s.style||!yi(s.style))&&(s.style={lineWidth:2}),s.style.lineWidth||(s.style.lineWidth=0),s.dxdy=s._defineStyle({dx:n.textDx||n.markerDx,dy:n.textDy||n.markerDy}),s}var i=t.prototype;return i.symbolize=function(e){var r=this.geometry.getLayer();if(!!r.options.drawAltitude){var s=this.geometry.getProperties();if(!(!s||!s[r.options.altitudeProperty])){var a=this._getStyle();if(this._prepareContext(e),this.geometry.type==="LineString"){var h=this._getPaintParams(a.lineDx,a.lineDy,!1,!0);if(!h)return;var l=this.getPainter().getPaintParams(a.lineDx,a.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(e,h[0],l)}else{var c=this._getRenderContainerPoints(),u=this._getRenderContainerPoints(!0);if(!c||c.length===0)return;this._drawMarkerAltitude(e,c[0],u[0])}}}},i.getDxDy=function(){var e=this.dxdy;return new W(e.dx||0,e.dy||0)},i.get2DExtent=function(){return this.geometry.type==="LineString"?Jv.prototype.get2DExtent.apply(this):o.prototype.get2DExtent.call(this)},i.getPlacement=function(){return"point"},i._getPaintParams=function(e,r){return this.getPainter().getPaintParams(e||0,r||0,null,!0,"_altpt")},i._drawMarkerAltitude=function(e,r,s){var a=this._getStyle();this.prepareCanvas(e,a),ot.path(e,[r,s],a.lineOpacity,null,a.lineDasharray)},i._drawLineAltitude=function(e,r,s){var a=this._getStyle(),h=r.length>0&&Array.isArray(r[0]);if(h)for(var l=0;l<r.length;l++)this._drawLine(e,r[l],s[l]);else this._drawLine(e,r,s);e.setLineDash&&Array.isArray(a.lineDasharray)&&e.setLineDash([])},i._drawLine=function(e,r,s){var a=this._getStyle();this.prepareCanvas(e,a);for(var h=0,l=r.length-1;h<l;h++)ot.polygon(e,[r[h],r[h+1],s[h+1],s[h]],a.lineOpacity,a.polygonOpacity,a.lineDasharray)},i._getStyle=function(){var e=this.geometry.getLayer().options.drawAltitude;return yi(e)||(e=fT),e.lineWidth||(e.lineWidth=0,e.lineOpacity=0),e},t}(Ns),pT=[dT,Jv,yf,Qv,Yv,cT],er,sg=new W(0,0),gT=new Vt,Na=new Vt,ui=new Vt,mT=new Vt,wn=new Vt,vT={},Qs={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},xf=function(o){ht(t,o);function t(n){var e;return e=o.call(this)||this,e.geometry=n,e.symbolizers=e._createSymbolizers(),e._altAtGL=e._getGeometryAltitude(),e}var i=t.prototype;return i.getMap=function(){return this.geometry.getMap()},i.getLayer=function(){return this.geometry.getLayer()},i._createSymbolizers=function(){var e=this.getSymbol(),r=[],s=pT,a=e;Array.isArray(e)||(a=[e]);for(var h=a.length-1;h>=0;h--)for(var l=a[h],c=s.length-1;c>=0;c--)if(s[c].test(l,this.geometry)){var u=new s[c](l,this.geometry,this);u._index=h,r.push(u),u instanceof Ns&&(this._hasPoint=!0)}if(!r.length&&console)var f=this.geometry.getId();return this._debugSymbolizer=new aT(e,this.geometry,this),r},i.hasPoint=function(){return!!this._hasPoint},i.getRenderPoints=function(e){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),e||(e="center"),this._renderPoints[e]||(this._renderPoints[e]=this.geometry._getRenderPoints(e)),this._renderPoints[e]},i.getPaintParams=function(e,r,s,a,h){h===void 0&&(h="_pt");var l=this.getLayer()._getRenderer(),c=l.mapStateCache,u,f,d,p,g,m=this.getMap();c&&!this._hitPoint?(u=c.resolution,f=c.pitch,d=c.bearing,p=c.glScale,g=c.containerExtent):(u=m.getResolution(),f=m.getPitch(),d=m.getBearing(),p=m.getGLScale(),g=m.getContainerExtent());var v=this.geometry,x=u,_=f!==0,y=d!==0,b=this._cachedParams,M=v._paintAsPath&&v._paintAsPath();if(M&&this._unsimpledParams&&x<=this._unsimpledParams._res)b=this._unsimpledParams;else if(!b||b._res!==u||this._pitched!==_&&v._redrawWhenPitch()||this._rotated!==y&&v._redrawWhenRotate()){if(b=v._getPaintParams(),!b)return null;b._res=x,!v._simplified&&M&&(this._unsimpledParams||(this._unsimpledParams=b),x>this._unsimpledParams._res&&(this._unsimpledParams._res=x)),this._cachedParams=b}if(!b)return null;this._pitched=_,this._rotated=y;var C=p,w=[],S=b[0],P=g,O=this._pointContainerPoints(S,e,r,s,a||this._hitPoint&&!P.contains(this._hitPoint),null,h);if(!O)return null;w.push(O);for(var D=1,L=b.length;D<L;D++)St(b[D])||b[D]instanceof Pe?St(b[D])?w.push(b[D]/C):w.push(b[D].multi(1/C)):w.push(b[D]);return w},i._pointContainerPoints=function(e,r,s,a,h,l,c){if(c===void 0&&(c="_pt"),this._aboveCamera())return null;var u=this.getLayer()._getRenderer(),f=u.mapStateCache,d=this.getMap(),p=this.geometry,g=this.containerOffset,m,v;f?(m=f.glRes,v=f.containerExtent):(m=d.getGLRes(),v=d.getContainerExtent());var x,_=this.getLayer().options.roundPoint,y=1/0,b=1/0,M=-1/0,C=-1/0,w=!h,S=u.layer.options.clipBBoxBufferSize||3,P=this.symbolizers;function O(pt,xt){pt===void 0&&(pt=[]),xt===void 0&&(xt=[]);var ut=Eo(pt,c);ut=d._pointsAtResToContainerPoints(pt,m,xt,ut);for(var ft=0,kt=ut.length;ft<kt;ft++){var J=ut[ft];J._sub(g),(r||s)&&J._add(r||0,s||0),_&&(J.x=Math.ceil(J.x),J.y=Math.ceil(J.y)),y=Math.min(J.x,y),b=Math.min(J.y,b),M=Math.max(J.x,M),C=Math.max(J.y,C)}if(w&&mv(P)){if(wn.ymin=v.ymin,wn.ymin<S&&(wn.ymin=v.ymin-S),wn.xmin=v.xmin-S,wn.xmax=v.xmax+S,wn.ymax=v.ymax+S,p.getShell&&p.getHoles)return hh(ut,wn);var Q=ah(ut,wn,!1);if(Q.length){var lt=[];return Q.forEach(function(Ct){for(var at=0,Ft=Ct.length;at<Ft;at++)lt.push(Ct[at].point)}),lt}}return ut}var D=this.getAltitude();if(Array.isArray(e)){var L=this.geometry,T;!h&&L.options.enableClip?(T=this._clip(e,D),T.inView&&(w=!1)):T={points:e,altitude:D};var A=T.points;D=T.altitude,a&&(D=0);var N=D;x=[];for(var B=[],F=St(D),I=0,z=A.length;I<z;I++){var Z=A[I];if(Array.isArray(Z)){if(F){var j=O(Z,D);x.push(j);continue}for(var K=[],et=0,st=Z.length;et<st;et++)Array.isArray(D)&&(D[I]?N=D[I][et]:N=0),K.push(N);var V=O(Z,K);x.push(V)}else Array.isArray(D)&&(l==="vertex-last"?N=D[D.length-1-I]:l==="line"?N=(D[I]+D[I+1])/2:N=D[I]),B.push(N)}B.length&&(x=O(A,B))}else e instanceof W&&(a&&(D=0),x=d._pointAtResToContainerPoint(e,m,D)._sub(g),(r||s)&&x._add(r,s));return Qs.minx=y,Qs.miny=b,Qs.maxx=M,Qs.maxy=C,this._containerBbox=Qs,x},i._clip=function(e,r){if(St(r)&&r!==0)return{points:e,altitude:r};if(Array.isArray(r)){for(var s=!1,a=0,h=r.length;a<h;a++)if(r[a]!==0){s=!0;break}if(s)return{points:e,altitude:r}}var l=this.getMap(),c=this.geometry,u=this.getSymbol().lineWidth;St(u)||(u=4);var f=this.getLayer()._getRenderer(),d=f.mapStateCache,p,g,m;d?(p=d._2DExtent,g=d.glExtent,m=d.pitch):(p=l._get2DExtent(),g=l._get2DExtentAtRes(l.getGLRes()),m=l.getPitch());var v=p._expand(u);if(m>0&&r){var x=l.cameraLookAt,_=l.cameraPosition;sg.set(_.x,_.y),v=v._combine(sg._add(Ie(x[0]-_[0]),Ie(x[1]-_[1])))}var y=this.get2DExtent(null,mT),b=e;if(y.within(v))return{points:b,altitude:r,inView:!0};var M=g._expand(u*l._glScale);ui.xmin=M.xmin,ui.xmax=M.xmax,ui.ymin=M.ymin,ui.ymax=M.ymax;var C=c.options.smoothness;if(c.getShell&&this.geometry.getHoles&&!C){var w=M.xmin,S=M.ymin,P=M.xmax,O=M.ymax,D=Math.abs(P-w),L=Math.abs(O-S),T=Math.sqrt(D*D+L*L),A=(T-D)/2,N=(T-L)/2;if(ui.xmin=M.xmin-A,ui.xmax=M.xmax+A,ui.ymin=M.ymin-N,ui.ymax=M.ymax+N,!Array.isArray(e[0]))b=hh(e,ui);else{b=[];for(var B=0;B<e.length;B++){var F=hh(e[B],ui);F.length&&b.push(F)}}}else if(c.getJSONType()==="LineString"&&!C){if(!Array.isArray(e[0]))b=ah(e,ui,!1,!!C);else{b=[];for(var I=0;I<e.length;I++)Ar(b,ah(e[I],ui,!1,!!C))}return this._interpolateSegAlt(b,e,r)}return{points:b,altitude:r}},i._interpolateSegAlt=function(e,r,s){if(!Array.isArray(s)){var a=function(u){return u.point};return{points:e.map(function(c){return Array.isArray(c)?c.map(a):c.point}),altitude:s}}var h=Kv(e,r,s);s=[];var l=h.map(function(c){if(Array.isArray(c)){var u=[],f=c.map(function(d){return u.push(d.altitude),d.point});return s.push(u),f}return s.push(c.altitude),c.point});return{points:l,altitude:s}},i.getSymbol=function(){return this.geometry._getInternalSymbol()},i.paint=function(e,r,s){if(!!this.symbolizers){var a=this.getLayer(),h=a._getRenderer();if(!(!h||!h.context&&!r)){var l=h.mapStateCache||{};if(!(!this.geometry._isCheck&&e&&!e.intersects(this.get2DExtent(h.resources,gT)))){var c=this.getMap(),u=this.getMinAltitude(),f=c.getFrustumAltitude();if(!(u&&f&&f<u)){this.containerOffset=s||l.offset||c._pointToContainerPoint(h.southWest)._add(0,-c.height),this._beforePaint();for(var d=r||h.context,p=[d,h.resources],g=this.symbolizers.length-1;g>=0;g--)(d.shadowBlur||this.symbolizers[g].symbol.shadowBlur)&&this._prepareShadow(d,this.symbolizers[g].symbol),this.symbolizers[g].symbolize.apply(this.symbolizers[g],p);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||a.options.debug)&&this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,p)}}}}},i.getSprite=function(e,r){if(this.geometry.type!=="Point")return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var s=new Vt;this.symbolizers.forEach(function(g){var m=g.getFixedExtent(e);s._combine(m)});var a=s.getMin().multi(-1),h=r||(this.getMap()?this.getMap().CanvasClass:null),l=ot.createCanvas(s.getWidth(),s.getHeight(),h),c;this._renderPoints&&(c=this._renderPoints);for(var u=l.getContext("2d"),f=[u,e],d=this.symbolizers.length-1;d>=0;d--){var p=this.symbolizers[d].getDxDy();this._renderPoints={center:[[a.add(p)]]},this._prepareShadow(u,this.symbolizers[d].symbol),this.symbolizers[d].symbolize.apply(this.symbolizers[d],f)}c&&(this._renderPoints=c),this._sprite={canvas:l,offset:s.getCenter()}}return this._spriting=!1,this._sprite},i.isSpriting=function(){return!!this._spriting},i.hitTest=function(e,r){if((!r||r<.5)&&(r=.5),this._hitPoint=e.sub(r,r),!er){var s=this.getMap()?this.getMap().CanvasClass:null;er=ot.createCanvas(1,1,s)}ot.setHitTesting(!0),er.width=er.height=2*r;var a=er.getContext("2d");try{this.paint(null,a,this._hitPoint)}catch(u){throw u}finally{ot.setHitTesting(!1)}delete this._hitPoint;for(var h=a.getImageData(0,0,er.width,er.height).data,l=3,c=h.length;l<c;l+=4)if(h[l]>0)return!0;return!1},i.isHitTesting=function(){return!!this._hitPoint},i._prepareShadow=function(e,r){r.shadowBlur?(e.shadowBlur=this.isHitTesting()?0:r.shadowBlur,e.shadowColor=r.shadowColor||"#000",e.shadowOffsetX=r.shadowOffsetX||0,e.shadowOffsetY=r.shadowOffsetY||0):e.shadowBlur&&(e.shadowBlur=null,e.shadowColor=null,e.shadowOffsetX=null,e.shadowOffsetY=null)},i._eachSymbolizer=function(e,r){if(!!this.symbolizers){r||(r=this);for(var s=this.symbolizers.length-1;s>=0;s--)e.apply(r,[this.symbolizers[s]])}},i.get2DExtent=function(e,r){this._verifyProjection();var s=this.getMap();e=e||this.getLayer()._getRenderer().resources;var a=s.getZoom(),h=this._isDynamicSize();if((!this._extent2D||this._extent2D._zoom!==a||!this._fixedExtent)&&(this._extent2D&&this._extent2D._zoom!==a&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new Vt),this._extent2D._zoom=a),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(e,new Vt)))),!this._extent2D)return h&&delete this._fixedExtent,null;var l=this._fixedExtent,c=l.xmin,u=l.ymin,f=l.xmax,d=l.ymax;return h&&delete this._fixedExtent,Na.set(c,-d,f,-u),r?(r.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),r._add(Na),r):this._extent2D.add(Na)},i._computeExtent2D=function(e){for(var r=this.symbolizers.length-1;r>=0;r--){var s=this.symbolizers[r];e._combine(s.get2DExtent())}return e},i._computeFixedExtent=function(e,r){for(var s=this.symbolizers.length-1;s>=0;s--){var a=this.symbolizers[s];a.getFixedExtent&&r._combine(a.getFixedExtent(e))}return r},i._isDynamicSize=function(){for(var e=this.symbolizers.length-1;e>=0;e--){var r=this.symbolizers[e];if(r.isDynamicSize())return!0}return!1},i._aboveCamera=function(){var e=this.getMinAltitude(),r=this.getMap(),s=r.getFrustumAltitude();return e&&s&&s<e},i.getFixedExtent=function(){var e=this.getMap(),r=e.getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new Vt):((!this._extent2D||this._extent2D._zoom!==r)&&this.get2DExtent(null,Na),this._fixedExtent)},i.setZIndex=function(e){this._eachSymbolizer(function(r){r.setZIndex(e)})},i.show=function(){if(this._painted)this.removeCache(),this._eachSymbolizer(function(r){r.show()});else{var e=this.getLayer();e.isCanvasRender()||this.paint()}},i.hide=function(){this._eachSymbolizer(function(e){e.hide()})},i.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var e=this.getLayer();if(!!e){var r=e.getRenderer();!r||!r.setToRedraw()||r.setToRedraw()}},i.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},i.remove=function(){this.removeCache(),this._removeSymbolizers()},i._removeSymbolizers=function(){this._eachSymbolizer(function(e){delete e.painter,e.remove()}),delete this.symbolizers},i.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},i.getAltitude=function(){var e=this.geometry.getAltitude();return e!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},i.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},i.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},i._getGeometryAltitude=function(){var e=this,r=this.getMap();if(!r)return 0;var s=this.geometry.getAltitude();if(this._propAlt=s,!s)return this.minAltitude=this.maxAltitude=0,0;var a=this.geometry.getCenter();return a?Array.isArray(s)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,s.map(function(h){var l=e._meterToPoint(a,h);return l<e.minAltitude&&(e.minAltitude=l),l>e.maxAltitude&&(e.maxAltitude=l),l})):(this.minAltitude=this.maxAltitude=this._meterToPoint(a,s),this.minAltitude):0},i._meterToPoint=function(e,r){var s=this.getMap(),a=s.getGLRes();return s.altitudeToPoint(r,a)*Ie(r)},i._verifyProjection=function(){var e=this.geometry._getProjection()||vT;this._projCode&&this._projCode!==e.code&&this.removeCache(),this._projCode=e.code},i._beforePaint=function(){},i._afterPaint=function(){},t}(wi);function Kv(o,t,i){if(!Array.isArray(i))return o;for(var n=[],e=0,r=o.length;e<r;e++)if(Array.isArray(o[e]))n.push(Kv(o[e],t,i));else{var s=o[e];if(s.point.equals(t[s.index]))s.altitude=i[s.index],n.push(s);else{var a=void 0,h=void 0;s.index===0?(a=s.index,h=s.index+1):(a=s.index-1,h=s.index);var l=s.point.distanceTo(t[h]),c=l/(l+t[a].distanceTo(s.point)),u=ph(i[a],i[h],1-c);s.altitude=u,n.push(s)}}return n}var _T=new Vt,t_=function(o){ht(t,o);function t(n,e){var r;return r=o.call(this)||this,r.geometry=n,r.isMask=e,r}var i=t.prototype;return i._eachPainter=function(e){for(var r=this.geometry.getGeometries(),s,a=0,h=r.length;a<h&&(s=this.isMask?r[a]._getMaskPainter():r[a]._getPainter(),!(!!s&&s&&e.call(this,s)===!1));a++);},i.paint=function(e){!this.geometry||this._eachPainter(function(r){r.paint(e)})},i.get2DExtent=function(e,r){r&&r.set(null,null,null,null);var s=r||new Vt;return this._eachPainter(function(a){s=s._combine(a.get2DExtent(e,_T))}),s},i.remove=function(){var e=arguments;this._eachPainter(function(r){r.remove.apply(r,e)})},i.setZIndex=function(){var e=arguments;this._eachPainter(function(r){r.setZIndex.apply(r,e)})},i.show=function(){var e=arguments;this._eachPainter(function(r){r.show.apply(r,e)})},i.hide=function(){var e=arguments;this._eachPainter(function(r){r.hide.apply(r,e)})},i.repaint=function(){var e=arguments;this._eachPainter(function(r){r.repaint.apply(r,e)})},i.refreshSymbol=function(){var e=arguments;this._eachPainter(function(r){r.refreshSymbol.apply(r,e)})},i.hasPoint=function(){var e=!1;return this._eachPainter(function(r){return r.hasPoint()?(e=!0,!1):!0}),e},i.getMinAltitude=function(){var e=!0,r=0;return this._eachPainter(function(s){var a=s.getMinAltitude();(e||a<r)&&(e=!1,r=a)}),r},i.getMaxAltitude=function(){var e=0;return this._eachPainter(function(r){var s=r.getMaxAltitude();s>e&&(e=s)}),e},t}(wi),Ks=23,us={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var o=[],t=12756274*Math.PI,i=0;i<Ks;i++)o[i]=t/(256*Math.pow(2,i));return o}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var o=[],t=0;t<Ks;t++)o[t]=180/(Math.pow(2,t)*128);return o}()},BAIDU:{projection:"baidu",resolutions:function(){for(var o=Math.pow(2,18),t=[],i=0;i<Ks;i++)t[i]=o,o*=.5;return t}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var o=Math.pow(2,8),t=[],i=0;i<Ks;i++)t[i]=o,o*=.5;return t}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var o=[],t=6378137*Math.PI,i=0;i<Ks;i++)o[i]=t/(256*Math.pow(2,i));return o}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}}};us["EPSG:4490"]=us["EPSG:4326"];var zi=function(){function o(i){i===void 0&&(i={}),this.options=i,this._initSpatialRef()}o.getPreset=function(n){return us[n.toUpperCase()]},o.getAllPresets=function(){return Object.keys(us)},o.getProjectionInstance=function(n){if(!n)return null;if(yi(n))return n.locate||(n=dt({},n),n.measure==="identity"?dt(n,wc.getInstance("IDENTITY")):dt(n,wc.getInstance("EPSG:4326"))),n;n=(n+"").toLowerCase();for(var e in za)if(Is(za,e)){var r=za[e].code;if(r&&r.toLowerCase()===n)return za[e]}return null},o.equals=function(n,e){if(Xt(n)||Xt(e))return n===e;if(!n&&!e)return!0;if(!n||!e||n.projection!==e.projection)return!1;var r=n.fullExtent,s=e.fullExtent;if(r&&!s||!r&&s||r&&s&&(r.top!==s.top||r.bottom!==s.bottom||r.left!==s.left||r.right!==s.right))return!1;var a=n.resolutions,h=e.resolutions;if(a&&h){if(a.length!==h.length)return!1;for(var l=0;l<a.length;l++)if(a[l]!==h[l])return!1}else if(a||h)return!1;return!0};var t=o.prototype;return t._initSpatialRef=function(){var n=this.options.projection;if(n?n=o.getProjectionInstance(n):n=kv,!n)throw new Error("must provide a valid projection in map's spatial reference.");n=dt({},zs,n),n.measureLength||dt(n,wc.DEFAULT),this._projection=n;var e,r=this.options.resolutions;if(!r&&(n.code&&(e=us[n.code.toUpperCase()],e&&(r=e.resolutions,this.isEPSG=n.code!=="IDENTITY")),!r))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=r,this._pyramid=!0,this._pyramid){for(var s=0;s<r.length;s++)if(r[s]&&r[s-1]&&r[s-1]/r[s]!==2){this._pyramid=!1;break}}var a=this.options.fullExtent;if(!a&&(n.code&&(e=us[n.code.toUpperCase()],e&&(a=e.fullExtent)),!a))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(H(a.left)?(this._fullExtent=new oe(a),a.left=a.xmin,a.right=a.xmax,a.top=a.ymax,a.bottom=a.ymin):this._fullExtent=new oe(new q(a.left,a.top),new q(a.right,a.bottom)),H(a.top)||H(a.bottom)||H(a.left)||H(a.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");dt(this._fullExtent,a),this._projection.fullExtent=a;var h=a.right>=a.left?1:-1,l=a.top>=a.bottom?-1:1;this._transformation=new Av([h,l,0,0])},t.getResolutions=function(){return this._resolutions||[]},t.getResolution=function(n){var e=n|0;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var r=this._resolutions[e];if(e!==n&&n>0&&e<this._resolutions.length-1){var s=this._resolutions[e+1];return r+(s-r)*(n-e)}return r},t.getProjection=function(){return this._projection},t.getFullExtent=function(){return this._fullExtent},t.getTransformation=function(){return this._transformation},t.getMinZoom=function(){for(var n=0;n<this._resolutions.length;n++)if(!H(this._resolutions[n]))return n;return 0},t.getMaxZoom=function(){for(var n=this._resolutions.length-1;n>=0;n--)if(!H(this._resolutions[n]))return n;return this._resolutions.length-1},t.getZoomDirection=function(){return Ie(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},t.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},t.isPyramid=function(){return this._pyramid},o}(),Ec=new W(0,0),og=new Vt,yT={id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"},Jt=function(o){ht(t,o);function t(n){var e,r=dt({},n),s=r.symbol,a=r.properties,h=r.id;return delete r.symbol,delete r.id,delete r.properties,e=o.call(this,r)||this,s?e.setSymbol(s):e._genSizeSymbol(),a&&e.setProperties(a),H(h)||e.setId(h),e}var i=t.prototype;return i.getFirstCoordinate=function(){if(this.type==="GeometryCollection"){var e=this.getGeometries();return e.length?e[0].getFirstCoordinate():null}var r=this.getCoordinates();if(!Array.isArray(r))return r;do r=r[0];while(Array.isArray(r)&&r.length>0);return r},i.getLastCoordinate=function(){if(this.type==="GeometryCollection"){var e=this.getGeometries();return e.length?e[e.length-1].getLastCoordinate():null}var r=this.getCoordinates();if(!Array.isArray(r))return r;do r=r[r.length-1];while(Array.isArray(r)&&r.length>0);return r},i.addTo=function(e,r){return e.addGeometry(this,r),this},i.getLayer=function(){return this._layer?this._layer:null},i.getMap=function(){return this._layer?this._layer.getMap():null},i.getId=function(){return this._id},i.setId=function(e){var r=this.getId();return this._id=e,this._fireEvent("idchange",{old:r,new:e}),this},i.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},i.setProperties=function(e){var r=this.properties;return this.properties=yi(e)?dt({},e):e,this._repaint(),this._fireEvent("propertieschange",{old:r,new:e}),this},i.getType=function(){return this.type},i.getSymbol=function(){var e=this._symbol;return e?Array.isArray(e)?Ai(e):dt({},e):null},i.setSymbol=function(e){return this._symbolUpdated=e,this._symbol=this._prepareSymbol(e),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},i.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=jo(this._symbolUpdated)),this._symbolHash},i.updateSymbol=function(e){if(!e)return this;var r=this._getSymbol();if(Array.isArray(r)){if(!Array.isArray(e))throw new Error("Parameter of updateSymbol is not an array.");for(var s=0;s<e.length;s++)Sh(e[s])&&delete this._textDesc,r[s]&&e[s]&&(r[s]=Ai(r[s],e[s]))}else{if(Array.isArray(e))throw new Error("Geometry's symbol is not an array to update.");Sh(r)&&delete this._textDesc,r?r=Ai(r,e):r=Ai(this._getInternalSymbol(),e)}return this._eventSymbolProperties=e,delete this._compiledSymbol,this.setSymbol(r)},i.getTextContent=function(){var e=this._getInternalSymbol();if(Array.isArray(e)){for(var r=[],s=!1,a=0;a<e.length;a++)r[a]=xh(e[a]&&e[a].textName,this.getProperties()),H(r[a])||(s=!0);return s?r:null}return xh(e&&e.textName,this.getProperties())},i.getTextDesc=function(){if(!this._textDesc){var e=this.getTextContent(),r=this._sizeSymbol,s=Array.isArray(e);Array.isArray(r)?this._textDesc=r.map(function(a,h){return wh(s?e[h]:"",a)}):this._textDesc=wh(e,r)}return this._textDesc},i.getCenter=function(){return this._computeCenter(this._getMeasurer())},i.getExtent=function(){var e=this._getPrjExtent(),r=this._getProjection();if(e&&r){var s=r.unproject(new q(e.xmin,e.ymin)),a=r.unproject(new q(e.xmax,e.ymax));return new oe(s,a,r)}else return this._computeExtent(this._getMeasurer())},i.getContainerExtent=function(e){var r=this.get2DExtent();if(!r||!r.isValid())return null;var s=this.getMap(),a=s.getGLRes(),h=this.getMinAltitude(),l=s.altitudeToPoint(h,a)*Ie(h),c=r.convertTo(function(m){return s._pointAtResToContainerPoint(m,a,l,Ec)},e),u=this.getMaxAltitude();if(u!==h){u=s.altitudeToPoint(u,a)*Ie(u);var f=r.convertTo(function(m){return s._pointAtResToContainerPoint(m,a,u,Ec)},og);c._combine(f)}var d=this.getLayer();if(d&&this.type==="LineString"&&u&&d.options.drawAltitude){var p=r.convertTo(function(m){return s._pointAtResToContainerPoint(m,a,0,Ec)},og);c._combine(p)}c&&c._add(this._getFixedExtent());var g=this.options.smoothness;return g&&c._expand(c.getWidth()*.15),c},i._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new Vt);var e=this._sizeSymbol,r=(e&&e.lineWidth||1)/2;this._fixedExtent.set(-r,-r,r,r);var s=e&&e.lineDx||0;this._fixedExtent._add([s,0]);var a=e&&e.lineDy||0;return this._fixedExtent._add([0,a]),this._fixedExtent},i.get2DExtent=function(){var e=this.getMap();if(!e)return null;if(this._extent2d)return this._extent2d;var r=this._getPrjExtent();if(!r||!r.isValid())return null;var s=r.getMin(),a=r.getMax(),h=e.getGLRes();return e._prjToPointAtRes(s,h,s),e._prjToPointAtRes(a,h,a),this._extent2d=new Vt(s,a),this._extent2d.z=e.getZoom(),this._extent2d},i.getSize=function(){var e=this.getContainerExtent();return e?e.getSize():null},i.containsPoint=function(e,r){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return e instanceof q&&(e=this.getMap().coordToContainerPoint(e)),this._containsPoint(e,r)},i._containsPoint=function(e,r){var s=this._getPainter();return s?(r=r||0,this._hitTestTolerance&&(r+=this._hitTestTolerance()),s.hitTest(e,r)):!1},i.show=function(){if(this.options.visible=!0,this.getMap()){var e=this._getPainter();e&&e.show(),this._fireEvent("show")}return this},i.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var e=this._getPainter();e&&e.hide(),this._fireEvent("hide")}return this},i.isVisible=function(){if(!this.options.visible)return!1;var e=this._getInternalSymbol();if(!e)return!0;if(Array.isArray(e)){if(!e.length)return!0;for(var r=0,s=e.length;r<s;r++)if(H(e[r].opacity)||e[r].opacity>0)return!0;return!1}else return H(e.opacity)||yi(e.opacity)||St(e.opacity)&&e.opacity>0},i.getZIndex=function(){return this.options.zIndex||0},i.setZIndex=function(e){var r=this.options.zIndex;return this.options.zIndex=e,this._fireEvent("zindexchange",{old:r,new:e}),this},i.setZIndexSilently=function(e){return this.options.zIndex=e,this},i.bringToFront=function(){var e=this.getLayer();if(!e||!e.getGeoMaxZIndex)return this;var r=e.getGeoMaxZIndex();return this.setZIndex(r+1),this},i.bringToBack=function(){var e=this.getLayer();if(!e||!e.getGeoMinZIndex)return this;var r=e.getGeoMinZIndex();return this.setZIndex(r-1),this},i.translate=function(e,r){if(H(e))return this;var s=new q(e,r);if(s.x===0&&s.y===0)return this;var a=this.getCoordinates();if(this._silence=!0,a)if(Array.isArray(a)){var h=Mr(a,function(l){return l.add(s)});this.setCoordinates(h)}else this.setCoordinates(a.add(s));return this._silence=!1,this._fireEvent("positionchange"),this},i.flash=function(e,r,s,a){return Xu.call(this,e,r,s,a)},i.copy=function(){var e=this.toJSON(),r=t.fromJSON(e);return r.options.visible=!0,r},i.remove=function(){var e=this.getLayer();return e?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},i.toGeoJSONGeometry=function(){var e=this._exportGeoJSONGeometry();return e},i.toGeoJSON=function(e){e||(e={});var r={type:"Feature",geometry:null};if(H(e.geometry)||e.geometry){var s=this._exportGeoJSONGeometry();r.geometry=s}var a=this.getId();H(a)||(r.id=a);var h;return(H(e.properties)||e.properties)&&(h=this._exportProperties()),r.properties=h,r},i.toJSON=function(e){e||(e={});var r=this._toJSON(e),s=this._exportGraphicOptions(e);return dt(r,s),r},i.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},i.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},i.rotate=function(e,r){if(this.type==="GeometryCollection"){var s=this.getGeometries();return s.forEach(function(c){return c.rotate(e,r)}),this}r?r=new q(r):r=this.getCenter();var a=this._getMeasurer(),h=this.getCoordinates();if(!Array.isArray(h)){if(r.x!==h.x||r.y!==h.y){var l=a._rotate(h,r,e);this.setCoordinates(l)}return this}return Mr(h,function(c){return a._rotate(c,r,e)}),this.setCoordinates(h),this},i._getConnectPoints=function(){return[this.getCenter()]},i._initOptions=function(e){var r=dt({},e),s=r.symbol,a=r.properties,h=r.id;delete r.symbol,delete r.id,delete r.properties,this.setOptions(r),s&&this.setSymbol(s),a&&this.setProperties(a),H(h)||this.setId(h)},i._bindLayer=function(e){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=e,this._clearCache(),this._bindInfoWindow(),this._bindMenu()},i._prepareSymbol=function(e){if(Array.isArray(e)){for(var r=[],s=0;s<e.length;s++)r.push(yh(this._checkAndCopySymbol(e[s])));return r}else if(e)return e=this._checkAndCopySymbol(e),yh(e);return null},i._checkAndCopySymbol=function(e){var r={};for(var s in e)HS[s]&&Xt(e[s])?r[s]=+e[s]:r[s]=e[s];return r},i._getSymbol=function(){return this._symbol},i._setExternSymbol=function(e){return this._eventSymbolProperties=e,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(e),this.onSymbolChanged(),this},i._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},i._getPrjExtent=function(){var e=this._getProjection();return this._verifyProjection(),!this._extent&&e&&(this._extent=this._computePrjExtent(e)),this._extent},i._unbind=function(){var e=this.getLayer();!e||(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),e.onRemoveGeometry&&e.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},i._getInternalId=function(){return this._internalId},i._setInternalId=function(e){this._internalId=e},i._getMeasurer=function(){return this._getProjection()?this._getProjection():zi.getProjectionInstance(this.options.defaultProjection)},i._getProjection=function(){var e=this.getMap();return e?e.getProjection():null},i._verifyProjection=function(){var e=this._getProjection();this._projCode&&e&&this._projCode!==e.code&&this._clearProjection(),this._projCode=e?e.code:this._projCode},i._getExternalResources=function(){var e=this._getInternalSymbol();return Wo(e)},i._getPainter=function(){var e=this.getLayer();if(!this._painter&&e){if(Um.indexOf(this.type)!==-1){if(e.constructor.getCollectionPainterClass){var r=e.constructor.getCollectionPainterClass();r&&(this._painter=new r(this))}}else if(e.constructor.getPainterClass){var s=e.constructor.getPainterClass();s&&(this._painter=new s(this))}}return this._painter},i._getMaskPainter=function(){return this._maskPainter?this._maskPainter:(this._maskPainter=this.getGeometries&&this.getGeometries()?new t_(this,!0):new xf(this),this._maskPainter)},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},i._paint=function(e){if(this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var r=this._getProjection();r&&(this._pcenter=r.project(this._coordinates),this._clearCache())}this._painter.paint(e)}},i._clearCache=function(){delete this._extent,delete this._extent2d},i._clearProjection=function(){delete this._extent,delete this._extent2d},i._repaint=function(){this._painter&&this._painter.repaint()},i.onHide=function(){this.closeMenu(),this.closeInfoWindow()},i.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},i.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},i.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var e={};this._eventSymbolProperties?(e.properties=dt({},this._eventSymbolProperties),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",e)},i._genSizeSymbol=function(){var e=this._getInternalSymbol();if(!e){delete this._sizeSymbol;return}if(Array.isArray(e)){this._sizeSymbol=[];for(var r=!1,s=0;s<e.length;s++){var a=this._sizeSymbol[s]=this._getSizeSymbol(e[s]);!r&&a&&a._dynamic&&(r=!0)}this._sizeSymbol._dynamic=r}else this._sizeSymbol=this._getSizeSymbol(e)},i._getSizeSymbol=function(e){var r=_h({lineWidth:e.lineWidth,lineDx:e.lineDx,lineDy:e.lineDy},this);return(Ae(e.lineWidth)||Ae(e.lineDx)||Ae(e.lineDy))&&(r._dynamic=!0),r},i._getCompiledSymbol=function(){return this._compiledSymbol?this._compiledSymbol:(this._compiledSymbol=_h(this._getInternalSymbol(),this),this._compiledSymbol)},i.onConfig=function(e){var r;e.properties&&(r=e.properties,delete e.properties);var s=!1;for(var a in e)if(e.hasOwnProperty(a)){var h=a.slice(0,5);if(h==="arrow"||h==="smoot"){s=!0;break}}r?(this.setProperties(r),this._repaint()):s&&this._repaint()},i._setParent=function(e){e&&(this._parent=e)},i._getParent=function(){return this._parent},i._fireEvent=function(e,r){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(r||(r={}),r.type=e,r.target=this,this.getLayer()._onGeometryEvent(r)),this.fire(e,r))},i._toJSON=function(e){return{feature:this.toGeoJSON(e)}},i._exportGraphicOptions=function(e){var r={};return(H(e.options)||e.options)&&(r.options=this.config()),(H(e.symbol)||e.symbol)&&(r.symbol=this.getSymbol()),(H(e.infoWindow)||e.infoWindow)&&this._infoWinOptions&&(r.infoWindow=this._infoWinOptions),r},i._exportGeoJSONGeometry=function(){var e=this.getCoordinates(),r=q.toNumberArrays(e);return{type:this.getType(),coordinates:r}},i._exportProperties=function(){var e=null,r=this.getProperties();return H(r)||(yi(r)?e=dt({},r):e=r),e},i._hitTestTolerance=function(){var e=this.getLayer();return e&&e.options.geometryEventTolerance||0},i.getAltitude=function(){var e=this.getLayer();if(!e)return 0;var r=e.options,s=this.getProperties(),a=r.enableAltitude&&s?s[r.altitudeProperty]:0,h=e.getAltitude?e.getAltitude():0;return Array.isArray(a)?a.map(function(l){return l+h}):a+h},i._genMinMaxAlt=function(){var e=this,r=this.getAltitude();Array.isArray(r)?(this._minAlt=Number.MAX_VALUE,this._maxAlt=Number.MIN_VALUE,r.forEach(function(s){var a=s;a<e._minAlt&&(e._minAlt=a),a>e._maxAlt&&(e._maxAlt=a)})):this._minAlt=this._maxAlt=r},i.getMinAltitude=function(){return this._minAlt===void 0&&this._genMinMaxAlt(),this._minAlt?this._minAlt:0},i.getMaxAltitude=function(){return this._maxAlt===void 0&&this._genMinMaxAlt(),this._maxAlt?this._maxAlt:0},t}(Pv(Ui(cf(wi))));Jt.mergeOptions(yT);var xT={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:function(){return!jt.mobile}()},Je=function(o){ht(t,o);function t(n,e){var r,s;return e&&(s=e.canvas,delete e.canvas),r=o.call(this,e)||this,r._canvas=s,r.setId(n),e&&(r.setZIndex(e.zIndex),e.mask&&r.setMask(Jt.fromJSON(e.mask))),r}var i=t.prototype;return i.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var e=this.getZIndex();H(e)||(this._renderer.setZIndex(e),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},i.getId=function(){return this._id},i.setId=function(e){var r=this._id;return H(e)||(e=e+""),this._id=e,this.fire("idchange",{old:r,new:e}),this},i.addTo=function(e){return e.addLayer(this),this},i.setZIndex=function(e){return this._zIndex=e,H(e)?delete this.options.zIndex:this.options.zIndex=e,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(e),this},i.getZIndex=function(){return this._zIndex||0},i.getMinZoom=function(){var e=this.getMap(),r=this.options.minZoom;return e?Math.max(e.getMinZoom(),r||0):r},i.getMaxZoom=function(){var e=this.getMap(),r=this.options.maxZoom;return e?Math.min(e.getMaxZoom(),H(r)?1/0:r):r},i.getOpacity=function(){return this.options.opacity},i.setOpacity=function(e){return this.config("opacity",e),this},i.isCanvasRender=function(){var e=this._getRenderer();return e&&e instanceof Fs},i.getMap=function(){return this.map?this.map:null},i.getProjection=function(){var e=this.getMap();return e?e.getProjection():null},i.bringToFront=function(){var e=this._getLayerList();if(!e.length)return this;var r=e[e.length-1];if(e.length===1||r===this)return this;var s=r.getZIndex();return this.setZIndex(s+1),this},i.bringToBack=function(){var e=this._getLayerList();if(!e.length)return this;var r=e[0];if(e.length===1||r===this)return this;var s=r.getZIndex();return this.setZIndex(s-1),this},i.show=function(){var e=this;if(!this.options.visible){this.options.visible=!0;var r=this.getRenderer();r&&r.show();var s=this.getMap();r&&s?s.once("renderend",function(){e.fire("show")}):this.fire("show")}return this},i.hide=function(){var e=this;if(this.options.visible){this.options.visible=!1;var r=this.getRenderer();r&&r.hide();var s=this.getMap();r&&s?s.once("renderend",function(){e.fire("hide")}):this.fire("hide")}return this},i.isVisible=function(){if(St(this.options.opacity)&&this.options.opacity<=0)return!1;var e=this.getMap();if(e){var r=e.getZoom();if(!H(this.options.maxZoom)&&this.options.maxZoom<r||!H(this.options.minZoom)&&this.options.minZoom>r)return!1}return H(this.options.visible)&&(this.options.visible=!0),this.options.visible},i.remove=function(){return this.map&&this.map.removeLayer(this),this},i.getMask=function(){return this._mask},i.setMask=function(e){if(!(e.type==="Point"&&e._isVectorMarker()||e.type==="Polygon"||e.type==="MultiPolygon"))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(e._bindLayer(this),e.type==="Point"?e.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):e.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=e,this.options.mask=e.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var r=this._getRenderer();return r&&r.setToRedraw&&this._getRenderer().setToRedraw(),this},i.removeMask=function(){if(delete this._mask,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},i.onLoad=function(){return!0},i.onLoadEnd=function(){},i.isLoaded=function(){return!!this._loaded},i.getCollisionIndex=function(){if(this.options.collisionScope==="layer")return this._collisionIndex||(this._collisionIndex=new Ev),this._collisionIndex;var e=this.getMap();return e?e.getCollisionIndex():null},i.clearCollisionIndex=function(){return this.options.collisionScope==="layer"&&this._collisionIndex&&this._collisionIndex.clear(),this},i.getRenderer=function(){return this._getRenderer()},i.onConfig=function(e){if(St(e.opacity)||e.cssFilter){var r=this.getRenderer();r&&r.setToRedraw()}},i.onAdd=function(){},i.onRendererCreate=function(){},i.onCanvasCreate=function(){},i.onRemove=function(){},i._bindMap=function(e,r){!e||(this.map=e,H(r)||this.setZIndex(r),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},i._initRenderer=function(){var e=this.options.renderer;if(!!this.constructor.getRendererClass){var r=this.constructor.getRendererClass(e);if(!r)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+e);this._renderer=new r(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},i._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},i._switchEvents=function(e,r){r&&r.getEvents&&this.getMap()&&this.getMap()[e](r.getEvents(),r)},i._getRenderer=function(){return this._renderer},i._getLayerList=function(){return this.map?this.map._layers:[]},i._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var e=this._mask._getMaskPainter();return e?e.get2DExtent():null},t}(Pv(Ui(df(wi))));Je.mergeOptions(xT);var wT=Je.prototype.fire;Je.prototype.fire=function(o,t){return o==="layerload"&&(this._loaded=!0),this.map&&(t||(t={}),t.type=o,t.target=this,this.map._onLayerEvent(t)),wT.apply(this,arguments)};var MT=new q(0,0),bT={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:function(){return!De}(),zoomAnimationDuration:330,panAnimation:function(){return!De}(),panAnimationDuration:600,rotateAnimation:function(){return!De}(),zoomable:!0,enableInfoWindow:!0,hitDetect:function(){return!jt.mobile}(),hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0},Bt=function(o){ht(t,o);function t(n,e){var r;if(!e)throw new Error("Invalid options when creating map.");if(!e.center)throw new Error("Invalid center when creating map.");var s=dt({},e),a=s.zoom;delete s.zoom;var h=new q(s.center);delete s.center;var l=s.baseLayer;delete s.baseLayer;var c=s.layers;return delete s.layers,r=o.call(this,s)||this,r.VERSION=t.VERSION,Object.defineProperty(ze(ze(r)),"id",{value:Xn(),writable:!1}),r._loaded=!1,r._initContainer(n),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=a,r._center=h,r.setSpatialReference(s.spatialReference||s.view),r._mapViewPoint=new W(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),l&&r.setBaseLayer(l),c&&r.addLayer(c),r.setMaxExtent(s.maxExtent),r._Load(),r}t.addOnLoadHook=function(e){var r=Array.prototype.slice.call(arguments,1),s=typeof e=="function"?e:function(){this[e].apply(this,r)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(s),this};var i=t.prototype;return i.isLoaded=function(){return!!this._loaded},i.getContainer=function(){return this._containerDOM},i.getSpatialReference=function(){return this._spatialReference},i.setSpatialReference=function(e){var r=this.options.spatialReference;return this._loaded&&zi.equals(r,e)?this:(this._updateSpatialReference(e,r),this)},i._updateSpatialReference=function(e,r){if(Xt(e)&&(e=zi.getPreset(e)),e=dt({},e),this._center=this.getCenter(),this.options.spatialReference=e,this._spatialReference=new zi(e),this.options.spatialReference&&ne(this.options.spatialReference.projection)){var s=this._spatialReference.getProjection();this.options.spatialReference.projection=s.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:r,new:dt({},this.options.spatialReference)}),this},i.onConfig=function(e){var r=e.spatialReference||e.view;return H(r)||this._updateSpatialReference(r,null),this},i.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},i.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},i.setCursor=function(e){return delete this._cursor,this._trySetCursor(e),this._cursor=e,this},i.resetCursor=function(){return this.setCursor(null)},i.getCenter=function(){if(!this._loaded||!this._prjCenter)return this._center;var e=this.getProjection();return e.unproject(this._prjCenter)},i.setCenter=function(e){if(!e)return this;e=new q(e);var r=this.getProjection(),s=r.project(e);return this._verifyExtent(s)?this._loaded?(this.onMoveStart(),this._setPrjCenter(s),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=e,this):this},i.getSize=function(){return H(this.width)||H(this.height)?this._getContainerDomSize():new Pe(this.width,this.height)},i.getContainerExtent=function(){var e=this.height,r=this.getPitch(),s=this.options.maxVisualPitch;return s&&r>s&&(e=this._getVisualHeight(s)),new Vt(0,this.height-e,this.width,this.height)},i._getVisualHeight=function(e){e=e||.01;var r=(90-this.getPitch())*Math.PI/180,s=this.getFov()*Math.PI/180;e*=Math.PI/180;var a=this.cameraCenterDistance/this.getGLScale(),h=Math.tan(s/2),l=Math.tan(e),c=a*h/(1/l-h)/Math.sin(e),u=a*(Math.sin(r)*c/(a+Math.cos(r)*c));return this.height/2+u},i.getExtent=function(){return this._pointToExtent(this._get2DExtent())},i.getProjExtent=function(){var e=this._get2DExtent();return new oe(this._pointToPrj(e.getMin()),this._pointToPrj(e.getMax()))},i.getPrjExtent=function(){return this.getProjExtent()},i.getMaxExtent=function(){return this.options.maxExtent?new oe(this.options.maxExtent,this.getProjection()):null},i.setMaxExtent=function(e){if(e){var r=new oe(e,this.getProjection());this.options.maxExtent=r;var s=this.getProjection();this._prjMaxExtent=r.convertTo(function(a){return s.project(a)}),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=s.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},i.getZoom=function(){return this._zoomLevel},i.getZoomForScale=function(e,r,s){var a=this.getZoom();if(H(r)&&(r=a),e===1&&r===a)return a;var h=this._getResolution(r),l=h/e,c=this.getZoomFromRes(l);if(s)return c;var u=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(c-u):Math.floor(c+u)},i.getZoomFromRes=function(e){var r=this._getResolutions(),s=this._getResolution(this.getMinZoom()),a=this._getResolution(this.getMaxZoom());if(s<=a){if(e<=s)return this.getMinZoom();if(e>=a)return this.getMaxZoom()}else{if(e>=s)return this.getMinZoom();if(e<=a)return this.getMaxZoom()}for(var h=r.length,l=0;l<h-1;l++)if(!!r[l]){var c=r[l+1]-r[l],u=e-r[l];if(Ie(c)===Ie(u)&&Math.abs(c)>=Math.abs(u))return l+u/c}return h-1},i.setZoom=function(e,r){return r===void 0&&(r={animation:!0}),isNaN(e)||H(e)?this:(e=+e,this._loaded&&this.options.zoomAnimation&&r.animation?this._zoomAnimation(e):this._zoom(e),this)},i.getMaxZoom=function(){return H(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},i.setMaxZoom=function(e){var r=this.getMaxNativeZoom();return e>r&&(e=r),e!==null&&e<this._zoomLevel&&(this.setZoom(e),e=+e),this.options.maxZoom=e,this},i.getMinZoom=function(){return H(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},i.setMinZoom=function(e){if(e!==null){e=+e;var r=this._spatialReference.getMinZoom();e<r&&(e=r),e>this._zoomLevel&&this.setZoom(e)}return this.options.minZoom=e,this},i.getMaxNativeZoom=function(){var e=this.getSpatialReference();return e?e.getMaxZoom():null},i.getGLRes=function(){if(this._glRes)return this._glRes;var e=this.getSpatialReference().getFullExtent();return this._glRes=(e.right-e.left)/Math.pow(2,19),this._glRes},i.getGLScale=function(e){return H(e)&&(e=this.getZoom()),this._getResolution(e)/this.getGLRes()},i.zoomIn=function(){return this.setZoom(this.getZoom()+1)},i.zoomOut=function(){return this.setZoom(this.getZoom()-1)},i.isZooming=function(){return!!this._zooming},i.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},i.setCenterAndZoom=function(e,r){return!H(r)&&this._zoomLevel!==r?(this.setCenter(e),this.setZoom(r,{animation:!1})):this.setCenter(e),this},i.getFitZoom=function(e,r){var s=this;if(!e||!(e instanceof oe))return this._zoomLevel;if(e.xmin===e.xmax&&e.ymin===e.ymax)return this.getMaxZoom();var a=this.getSize(),h=e.convertTo(function(g){return s.coordToPoint(g)}),l=h.getWidth(),c=h.getHeight(),u=a.width/l,f=a.height/c,d=this.getSpatialReference().getZoomDirection()<0?Math.max(u,f):Math.min(u,f),p=this.getZoomForScale(d,null,r);return p},i.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},i.setView=function(e){return e?(e.center&&this.setCenter(e.center),e.zoom!==null&&!isNaN(+e.zoom)&&this.setZoom(+e.zoom,{animation:!1}),e.pitch!==null&&!isNaN(+e.pitch)&&this.setPitch(+e.pitch),e.pitch!==null&&!isNaN(+e.bearing)&&this.setBearing(+e.bearing),this):this},i.getResolution=function(e){return this._getResolution(e)},i.getScale=function(e){var r=H(e)?this.getZoom():e,s=this._getResolution(this.getMaxNativeZoom()),a=this._getResolution(r);return a/s},i.fitExtent=function(e,r,s,a){if(s===void 0&&(s={}),!e)return this;e=new oe(e,this.getProjection());var h=this.getFitZoom(e)+(r||0),l=e.getCenter();return typeof s.animation>"u"||s.animation?this._animateTo({center:l,zoom:h},{duration:s.duration||this.options.zoomAnimationDuration,easing:s.easing||"out"},a):this.setCenterAndZoom(l,h)},i.getBaseLayer=function(){return this._baseLayer},i.setBaseLayer=function(e){var r=!1;if(this._baseLayer&&(r=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!e)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;this._baseLayer=e,e._bindMap(this,-1);function s(){this._fireEvent("baselayerload"),r&&(r=!1,this._fireEvent("baselayerchangeend"))}return this._baseLayer.on("layerload",s,this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},i.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},i.getLayers=function(e){return this._getLayers(function(r){return r===this._baseLayer||r.getId().indexOf(Vo)>=0?!1:e?e(r):!0})},i.getLayer=function(e){if(!e)return null;var r=this._layerCache?this._layerCache[e]:null;if(r)return r;var s=this.getBaseLayer();return s&&s.getId()===e?s:null},i.addLayer=function(e){if(!e)return this;if(!Array.isArray(e))return e=Array.prototype.slice.call(arguments,0),this.addLayer(e);this._layerCache||(this._layerCache={});for(var r=this._layers,s=0,a=e.length;s<a;s++){var h=e[s],l=h.getId();if(H(l))throw new Error("Invalid id for the layer: "+l);if(h.getMap()!==this){if(this._layerCache[l])throw new Error("Duplicate layer id in the map: "+l);this._layerCache[l]=h,h._bindMap(this),r.push(h),this._loaded&&h.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:e}),this},i.removeLayer=function(e){if(!e)return this;if(!Array.isArray(e))return this.removeLayer([e]);for(var r=[],s=0,a=e.length;s<a;s++){var h=e[s];if(h instanceof Je||(h=this.getLayer(h)),!!h){var l=h.getMap();if(!(!l||l!==this)){r.push(h),this._removeLayer(h,this._layers),this._loaded&&h._doRemove();var c=h.getId();this._layerCache&&delete this._layerCache[c]}}}if(r.length>0){var u=this.getRenderer();u&&u.setLayerCanvasUpdated(),this.once("frameend",function(){r.forEach(function(f){f.fire("remove")})})}return this._fireEvent("removelayer",{layers:e}),this},i.sortLayers=function(e){if(!e||!Array.isArray(e))return this;for(var r=[],s=Number.MAX_VALUE,a=0,h=e.length;a<h;a++){var l=e[a];if(Xt(e[a])&&(l=this.getLayer(l)),!(l instanceof Je)||!l.getMap()||l.getMap()!==this)throw new Error("It must be a layer added to this map to order.");l.getZIndex()<s&&(s=l.getZIndex()),r.push(l)}for(var c=0,u=r.length;c<u;c++)r[c].setZIndex(s+c);return this},i.toDataURL=function(e){e||(e={});var r=e.mimeType;r||(r="image/png");var s=e.save,a=this._getRenderer();if(a&&a.toDataURL){var h=e.fileName;h||(h="export");var l=a.toDataURL(r,e.quality||.92);if(s&&l){var c;if(typeof Blob<"u"&&typeof atob<"u"){var u=Qm(l.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),r);c=URL.createObjectURL(u)}else c=l;var f=document.createElement("a");f.download=h,f.href=c,document.body.appendChild(f),f.click(),document.body.removeChild(f)}return l}return null},i.coordToPoint=function(e,r,s){return this.coordinateToPoint(e,r,s)},i.coordToPointAtRes=function(e,r,s){return this.coordinateToPointAtRes(e,r,s)},i.pointToCoord=function(e,r,s){return this.pointToCoordinate(e,r,s)},i.pointAtResToCoord=function(e,r,s){return this.pointAtResToCoordinate(e,r,s)},i.coordToViewPoint=function(e,r,s){return this.coordinateToViewPoint(e,r,s)},i.viewPointToCoord=function(e,r){return this.viewPointToCoordinate(e,r)},i.coordToContainerPoint=function(e,r,s){return this.coordinateToContainerPoint(e,r,s)},i.containerPointToCoord=function(e,r){return this.containerPointToCoordinate(e,r)},i.containerPointToViewPoint=function(e,r){return r?r.set(e.x,e.y):r=e.copy(),r._sub(this.getViewPoint())},i.viewPointToContainerPoint=function(e,r){return r?r.set(e.x,e.y):r=e.copy(),r._add(this.getViewPoint())},i.checkSize=function(e){var r=me()-this._initTime<1500&&this.width===0||this.height===0,s=this._getContainerDomSize(),a=this.height,h=this.width;if(!e&&s.width===h&&s.height===a)return this;Zo(this._containerDOM);var l=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(s);else{var c=this._getVisualHeight(this.getPitch()),u=new W(0,this.height-c),f=this._containerPointToPrj(u);this._updateMapSize(s);var d=this._getVisualHeight(this.getPitch()),p=new W(0,this.height-d);this._setPrjCoordAtContainerPoint(f,p),this._mapViewCoord=this._getPrjCenter()}var g=s.width===0||s.height===0||h===0||a===0;return(r||g)&&(this._eventSilence=!0,this.setCenter(l),delete this._eventSilence),this._fireEvent("resize"),this},i.locate=function(e,r,s){return this.getProjection()._locate(new q(e),r,s)},i.getMainPanel=function(){return this._getRenderer().getMainPanel()},i.getPanels=function(){return this._panels},i.remove=function(){var e=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var r=this.getLayers(),s=0;s<r.length;s++)r[s].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter(function(a){return a.className==="maptalks-wrapper"}).forEach(function(a){return e._containerDOM.removeChild(a)}),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),jt.removeDPRListening&&jt.removeDPRListening(this),this},i.isRemoved=function(){return!this._containerDOM},i.isMoving=function(){return!!this._moving},i.onMoveStart=function(e){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var r=this._getPrjCenter();(!this._originCenter||this._verifyExtent(r))&&(this._originCenter=r),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(e?e.domEvent:null,"movestart"))},i.onMoving=function(e){this._fireEvent("moving",this._parseEvent(e?e.domEvent:null,"moving"))},i.onMoveEnd=function(e){if(this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",e&&e.domEvent?this._parseEvent(e.domEvent,"moveend"):e),!this._verifyExtent(this._getPrjCenter())&&this._originCenter){var r=this._originCenter;this._panTo(r)}},i.onDragRotateStart=function(e){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(e?e.domEvent:null,"dragrotatestart"))},i.onDragRotating=function(e){this._fireEvent("dragrotating",this._parseEvent(e?e.domEvent:null,"dragrotating"))},i.onDragRotateEnd=function(e){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(e?e.domEvent:null,"dragrotateend"))},i.isDragRotating=function(){return!!this._dragRotating},i.isOffscreen=function(e,r){r===void 0&&(r=0);var s=this.width,a=this.height,h=s+r,l=a+r,c=e.xmin,u=e.ymin,f=e.xmax,d=e.ymax;return Array.isArray(e)&&(c=e[0],u=e[1],f=e[2],d=e[3]),f<r||c>=h||d<r||u>l},i.getRenderer=function(){return this._getRenderer()},i.getDevicePixelRatio=function(){return this.options.devicePixelRatio||jt.devicePixelRatio||1},i.setDevicePixelRatio=function(e){return St(e)&&e>0&&e!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=e,this.checkSize(!0)),this},i._initContainer=function(e){if(Xt(e)){if(this._containerDOM=document.getElementById(e),!this._containerDOM)throw new Error("Invalid container when creating map: '"+e+"'")}else this._containerDOM=e,De&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&this._containerDOM.childNodes[0].className==="maptalks-wrapper")throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},i._trySetCursor=function(e){return!this._cursor&&!this._priorityCursor&&(e||(e="default"),this._setCursorToPanel(e)),this},i._setPriorityCursor=function(e){if(e)this._priorityCursor=e,this._setCursorToPanel(e);else{var r=!1;this._priorityCursor&&(r=!0),delete this._priorityCursor,r&&this.setCursor(this._cursor)}return this},i._setCursorToPanel=function(e){var r=this.getMainPanel();r&&r.style&&r.style.cursor!==e&&(r.style.cursor=e)},i._removeLayer=function(e,r){if(!(!e||!r)){var s=r.indexOf(e);s>-1&&r.splice(s,1)}},i._sortLayersByZIndex=function(){if(!!this._layers){for(var e=0,r=this._layers.length;e<r;e++)this._layers[e]._order=e,this._layers[e].sortLayersByZIndex&&this._layers[e].sortLayersByZIndex();this._layers.sort(function(s,a){var h=s.getZIndex()-a.getZIndex();return h===0?s._order-a._order:h})}},i._fireEvent=function(e,r){this._eventSilence||(this.fire("_"+e,r),this.fire(e,r))},i._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=me()},i._initRenderer=function(){var e=this.options.renderer,r=t.getRendererClass(e);this._renderer=new r(this),this._renderer.load()},i._getRenderer=function(){return this._renderer},i._loadAllLayers=function(){function e(r){r&&r.load()}this._baseLayer&&this._baseLayer.load(),this._eachLayer(e,this.getLayers())},i._getLayers=function(e){for(var r=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,s=[],a=0;a<r.length;a++)(!e||e.call(this,r[a]))&&s.push(r[a]);return s},i._eachLayer=function(e){if(!(arguments.length<2)){var r=Array.prototype.slice.call(arguments,1);r&&!Array.isArray(r)&&(r=[r]);for(var s=[],a=0,h=r.length;a<h;a++)s=s.concat(r[a]);for(var l=0,c=s.length;l<c;l++)e.call(e,s[l])}},i._onLayerEvent=function(e){!e||e.type==="idchange"&&(delete this._layerCache[e.old],this._layerCache[e.new]=e.target)},i._resetMapStatus=function(){var e=this.getMaxZoom(),r=this.getMinZoom(),s=this._spatialReference.getMaxZoom(),a=this._spatialReference.getMinZoom();(H(e)||e===-1||e>s)&&this.setMaxZoom(s),(H(r)||r===-1||r<a)&&this.setMinZoom(a),e=this.getMaxZoom(),r=this.getMinZoom(),e<r&&this.setMaxZoom(r),(H(this._zoomLevel)||this._zoomLevel>e)&&(this._zoomLevel=e),this._zoomLevel<r&&(this._zoomLevel=r),delete this._prjCenter;var h=this.getProjection();this._prjCenter=h.project(this._center),this._calcMatrices();var l=this._getRenderer();l&&l.resetContainer()},i._getContainerDomSize=function(){if(!this._containerDOM)return null;var e=this._containerDOM,r,s;if(this._containerDomContentRect)return r=this._containerDomContentRect.width,s=this._containerDomContentRect.height,new Pe(r,s);if(!H(e.width)&&!H(e.height)){r=e.width,s=e.height;var a=this.getDevicePixelRatio();a!==1&&e.layer&&(r/=a,s/=a)}else if(!H(e.clientWidth)&&!H(e.clientHeight))r=parseInt(e.clientWidth,0),s=parseInt(e.clientHeight,0);else throw new Error("can not get size of container");return new Pe(r,s)},i._updateMapSize=function(e){return this.width=e.width,this.height=e.height,this._getRenderer().updateMapSize(e),this._calcMatrices(),this},i._getPrjCenter=function(){return this._prjCenter},i._setPrjCenter=function(e){this._prjCenter=e,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=e),this._calcMatrices()},i._setPrjCoordAtContainerPoint=function(e,r){if(r.x===this.width/2&&r.y===this.height/2)return this;var s=this._containerPointToPoint(r)._sub(this._prjToPoint(this._getPrjCenter())),a=this._pointToPrj(this._prjToPoint(e).sub(s));return this._setPrjCenter(a),this},i._verifyExtent=function(e){if(!e)return!1;var r=this._prjMaxExtent;return r?r.contains(e):!0},i._offsetCenterByPixel=function(e){var r=new W(this.width/2-e.x,this.height/2-e.y),s=this._containerPointToPrj(r);return this._setPrjCenter(s),s},i.offsetPlatform=function(e){return e?(this._getRenderer().offsetPlatform(e),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(e),this):this._mapViewPoint},i.getViewPoint=function(){var e=this._getViewPointFrameOffset(),r=this.offsetPlatform();return e&&(r=r.add(e)),r},i._resetMapViewPoint=function(){this._mapViewPoint=new W(0,0),this._mapViewCoord=this._getPrjCenter()},i._getResolution=function(e){return(e===void 0||e===this._zoomLevel)&&this._mapRes!==void 0?this._mapRes:(H(e)&&(e=this._zoomLevel),this._spatialReference.getResolution(e))},i._getResolutions=function(){return this._spatialReference.getResolutions()},i._prjToPoint=function(e,r,s){r=H(r)?this.getZoom():r;var a=this._getResolution(r);return this._prjToPointAtRes(e,a,s)},i._prjToPointAtRes=function(e,r,s){return this._spatialReference.getTransformation().transform(e,r,s)},i._prjsToPointsAtRes=function(e,r,s){s===void 0&&(s=[]);for(var a=this._spatialReference.getTransformation(),h=[],l=0,c=e.length;l<c;l++){var u=a.transform(e[l],r,s[l]);h.push(u)}return h},i._pointToPrj=function(e,r,s){r=H(r)?this.getZoom():r;var a=this._getResolution(r);return this._pointToPrjAtRes(e,a,s)},i._pointToPrjAtRes=function(e,r,s){return this._spatialReference.getTransformation().untransform(e,r,s)},i._pointToPoint=function(e,r,s){return H(r)?(s?(s.x=e.x,s.y=e.y):s=e.copy(),s):this._pointAtResToPoint(e,this._getResolution(r),s)},i._pointAtResToPoint=function(e,r,s){return s?(s.x=e.x,s.y=e.y):s=e.copy(),s._multi(r/this._getResolution())},i._pointToPointAtRes=function(e,r,s){return s?(s.x=e.x,s.y=e.y):s=e.copy(),s._multi(this._getResolution()/r)},i._containerPointToPrj=function(e,r){return this._pointToPrj(this._containerPointToPoint(e,void 0,r),void 0,r)},i._callOnLoadHooks=function(){var e=t.prototype;if(!!e._onLoadHooks)for(var r=0,s=e._onLoadHooks.length;r<s;r++)e._onLoadHooks[r].call(this)},i._fixPrjOnWorldWide=function(e){var r=this.getProjection();if(r&&r.fullExtent&&e){var s=r.fullExtent||{},a=s.left,h=s.bottom,l=s.top,c=s.right;St(a)&&(e.x=Math.max(a,e.x)),St(c)&&(e.x=Math.min(c,e.x)),St(h)&&(e.y=Math.max(h,e.y)),St(l)&&(e.y=Math.min(l,e.y))}return this},t}(cf(Ui(df(wi))));Bt.include({coordinateToPoint:function(t,i,n){var e=this._getResolution(i);return this.coordinateToPointAtRes(t,e,n)},coordinateToPointAtRes:function(){var o=new q(0,0);return function(t,i,n){var e=this.getProjection().project(t,o);return this._prjToPointAtRes(e,i,n)}}(),pointToCoordinate:function(){var o=new q(0,0);return function(t,i,n){var e=this._pointToPrj(t,i,o);return this.getProjection().unproject(e,n)}}(),pointAtResToCoordinate:function(){var o=new q(0,0);return function(t,i,n){var e=this._pointToPrjAtRes(t,i,o);return this.getProjection().unproject(e,n)}}(),coordinateToViewPoint:function(){var o=new q(0,0);return function(t,i,n){return this._prjToViewPoint(this.getProjection().project(t,o),i,n)}}(),viewPointToCoordinate:function(){var o=new q(0,0);return function(t,i){return this.getProjection().unproject(this._viewPointToPrj(t,o),i)}}(),coordinateToContainerPoint:function(t,i,n){var e=this._getResolution(i);return this.coordinateToContainerPointAtRes(t,e,n)},coordinateToContainerPointAtRes:function(){var o=new q(0,0);return function(t,i,n){var e=this.getProjection().project(t,o);return this._prjToContainerPointAtRes(e,i,n)}}(),coordinatesToContainerPoints:function(t,i){var n=this._getResolution(i);return this.coordinatesToContainerPointsAtRes(t,n)},coordinatesToContainerPointsAtRes:function(){return function(o,t){for(var i=[],n=this._spatialReference.getTransformation(),e=t/this._getResolution(),r=this.getProjection(),s=new q(0,0),a=this.isTransforming(),h=this._prjToPoint(this._getPrjCenter(),void 0,MT),l=0,c=o.length;l<c;l++){var u=r.project(o[l],s),f=n.transform(u,t);f=f._multi(e),this._toContainerPoint(f,a,e,0,h),i.push(f)}return i}}(),containerPointToCoordinate:function(){var o=new q(0,0);return function(t,i){var n=this._containerPointToPrj(t,o);return this.getProjection().unproject(n,i)}}(),containerToExtent:function(){var o=new W(0,0),t=new W(0,0);return function(i){var n=new Vt(this._containerPointToPoint(i.getMin(o),void 0,o),this._containerPointToPoint(i.getMax(t),void 0,t));return this._pointToExtent(n)}}(),distanceToPixel:function(){var o=new W(0,0),t=new W(0,0);return function(i,n,e){var r=this.getProjection();if(!r)return null;var s=this.getScale()/this.getScale(e),a=this.getCenter(),h=r.locate(a,i,n),l=this.coordToContainerPoint(a,void 0,o),c=this.coordToContainerPoint(h,void 0,t);return c._sub(l)._multi(s)._abs(),new Pe(c.x,c.y)}}(),distanceToPoint:function(t,i,n,e){var r=this._getResolution(n);return this.distanceToPointAtRes(t,i,r,e)},distanceToPointAtRes:function(){var o=new W(0,0),t=new q(0,0);return function(i,n,e,r,s){var a=this.getProjection();if(!a)return null;var h=r||this.getCenter(),l=a.locate(h,i,n,t),c=this.coordToPointAtRes(h,e,o),u=this.coordToPointAtRes(l,e,s);return u._sub(c)._abs(),u}}(),altitudeToPoint:function(){var o=new q(0,40),t=new W(0,0);return function(i,n,e){i===void 0&&(i=0);var r=this.distanceToPointAtRes(i,i,n,e||o,t);i<0&&r.x>0&&(r.x=-r.x);var s=this.options.heightFactor;return s&&s!==1&&(r.x*=s,r.y*=s),r.x}}(),pointAtResToAltitude:function(){var o=new q(0,40);return function(t,i,n){t===void 0&&(t=0);var e=this.pointAtResToDistance(t,0,i,n||o);return e}}(),pixelToDistance:function(){var o=new q(0,0),t=new q(0,0);return function(i,n){var e=this.getProjection();if(!e)return null;var r=this.getFullExtent(),s=r.top>r.bottom?-1:1,a=o.set(this.width/2+i,this.height/2+s*n),h=this.containerPointToCoord(a,t);return e.measureLength(this.getCenter(),h)}}(),pointToDistance:function(t,i,n){var e=this.getResolution(n);return this.pointAtResToDistance(t,i,e)},pointAtResToDistance:function(){var o=new W(0,0),t=new q(0,0),i=new q(0,0),n=new q(0,0);return function(e,r,s,a){var h=this.getProjection();if(!h)return null;var l=a?h.project(a,t):this._getPrjCenter(),c=this._prjToPointAtRes(l,s,o);c._add(e,r);var u=this.pointAtResToCoord(c,s,i),f=a||h.unproject(l,n);return h.measureLength(f,u)}}(),locateByPoint:function(){var o=new W(0,0);return function(t,i,n){var e=this.coordToContainerPoint(t,void 0,o);return this.containerPointToCoord(e._add(i,n))}}(),_get2DExtent:function(t,i){var n;if((t===void 0||t===this._zoomLevel)&&this._mapExtent2D&&(n=this._mapExtent2D),n)return i?(i.set(n.xmin,n.ymin,n.xmax,n.ymax),i):n.copy();var e=this._getResolution(t);return this._get2DExtentAtRes(e,i)},_get2DExtentAtRes:function(){var o=new W(0,0);return function(t,i){var n=this;if(t===this._mapGlRes&&this._mapGlExtent2D)return this._mapGlExtent2D;var e=this.getContainerExtent();return e.convertTo(function(r){return n._containerPointToPointAtRes(r,t,o)},i)}}(),_pointToExtent:function(){var o=new q(0,0),t=new q(0,0);return function(i){var n=i.getMin(),e=i.getMax(),r=this.getFullExtent(),s=!r||r.left<=r.right?[n.x,e.x]:[e.x,n.x],a=s[0],h=s[1],l=!r||r.top>r.bottom?[e.y,n.y]:[n.y,e.y],c=l[0],u=l[1],f=n.set(a,u),d=e.set(h,c);return new oe(this.pointToCoord(f,void 0,o),this.pointToCoord(d,void 0,t),this.getProjection())}}(),_getViewPointFrameOffset:function(){var o=new W(0,0);return function(){if(this.isZooming())return null;var t=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(t)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(t,void 0,o)):null}}(),_viewPointToPrj:function(){var o=new W(0,0);return function(t,i){return this._containerPointToPrj(this.viewPointToContainerPoint(t,o),i)}}(),_prjToContainerPoint:function(t,i,n,e){var r=this._getResolution(i);return this._prjToContainerPointAtRes(t,r,n,e)},_prjToContainerPointAtRes:function(){var o=new W(0,0);return function(t,i,n,e){return this._pointAtResToContainerPoint(this._prjToPointAtRes(t,i,o),i,e||0,n)}}(),_prjToViewPoint:function(){var o=new W(0,0);return function(t,i,n){var e=this._prjToContainerPoint(t,void 0,o,n);return this.containerPointToViewPoint(e,i)}}(),_viewPointToPoint:function(){var o=new W(0,0);return function(t,i,n){return this._containerPointToPoint(this.viewPointToContainerPoint(t,o),i,n)}}(),_pointToViewPoint:function(){var o=new q(0,0);return function(t,i,n){return this._prjToViewPoint(this._pointToPrj(t,i,o),n)}}()});Bt.mergeOptions(bT);var ST=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.addHooks=function(){!this.target||this.target.on("_dblclick",this._onDoubleClick,this)},i.removeHooks=function(){!this.target||this.target.off("_dblclick",this._onDoubleClick,this)},i._onDoubleClick=function(e){var r=this.target;if(r.options.doubleClickZoom){var s=r.getZoom(),a=e.domEvent.shiftKey?Math.ceil(s)-1:Math.floor(s)+1;r._zoomAnimation(a,e.containerPoint)}},t}(Li);Bt.mergeOptions({doubleClickZoom:!0});Bt.addOnLoadHook("addHandler","doubleClickZoom",ST);var CT=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.addHooks=function(){var e=this.target;if(!!e){var r=e._panels.mapWrapper||e._containerDOM;this._dragHandler=new ks(r,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},i.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},i._cancelOn=function(e){return!!(this.target.isZooming()||this._ignore(e))},i._ignore=function(e){return e?(e.domEvent&&(e=e.domEvent),this.target._ignoreEvent(e)):!1},i._onMouseDown=function(e){delete this.startDragTime,delete this._mode,e.domEvent.button===2||e.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),ai(e.domEvent)},i._onDragStart=function(e){this.startDragTime=me(),this._mode==="move"?this._moveStart(e):this._mode==="rotatePitch"&&this._rotateStart(e)},i._onDragging=function(e){var r=this.target;r._isEventOutMap(e.domEvent)||(this._mode==="move"?this._moving(e):this._mode==="rotatePitch"&&this._rotating(e))},i._onDragEnd=function(e){this._mode==="move"?this._moveEnd(e):this._mode==="rotatePitch"&&this._rotateEnd(e),delete this.startDragTime,delete this.startBearing},i._start=function(e){this.preX=e.mousePos.x,this.preY=e.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},i._moveStart=function(e){this._start(e);var r=this.target;r.onMoveStart(e);var s=$e(r._getActualEvent(e.domEvent),r.getContainer());this.startPrjCoord=r._containerPointToPrj(s)},i._moving=function(e){if(!!this.startDragTime){var r=this.target,s=$e(r._getActualEvent(e.domEvent),r.getContainer());r._setPrjCoordAtContainerPoint(this.startPrjCoord,s),r.onMoving(e)}},i._moveEnd=function(e){if(!!this.startDragTime){var r=e.domEvent.type==="touchend",s=this.target,a=me()-this.startDragTime,h=e.mousePos.x,l=e.mousePos.y,c=h-this.startX,u=l-this.startY,f=s._getPrjCenter(),d=f.sub(this._startPrjCenter);if(this._clear(),s.options.panAnimation&&!e.interupted&&s._verifyExtent(s._getPrjCenter())&&a<280&&Math.abs(u)+Math.abs(c)>5){a=5*a;var p=r?5:2.8,g=f.add(d._multi(p));s._panTo(g,{duration:r?a*3:a*2,easing:"outExpo"})}else s.onMoveEnd(e)}},i._rotateStart=function(e){this._start(e),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(e),this._db=0},i._rotating=function(e){var r=this.target,s=e.mousePos.x,a=e.mousePos.y,h=r.getPitch(),l=r.getBearing(),c=Math.abs(s-this.preX),u=Math.abs(a-this.preY);if(this._rotateMode||(r.options.dragRotatePitch?this._rotateMode="rotate_pitch":c>u?this._rotateMode="rotate":c<u?this._rotateMode="pitch":this._rotateMode="rotate"),!(this._rotateMode==="pitch"&&h===0&&u<10)){if(this._rotateMode.indexOf("rotate")>=0&&r.options.dragRotate){var f=0;r.options.dragPitch||c>u?f=-.6*(this.preX-s):s>r.width/2?f=.6*(this.preY-a):f=-.6*(this.preY-a);var d=r.getBearing()+f;this._db=this._db||0,this._db+=f,r._setBearing(d)}this._rotateMode.indexOf("pitch")>=0&&r.options.dragPitch&&r._setPitch(r.getPitch()+(this.preY-a)*.4),this.preX=s,this.preY=a,(r.getBearing()!==l||r.getPitch()!==h)&&r.onDragRotating(e)}},i._rotateEnd=function(e){var r=this.target,s=r.getBearing();this._clear();var a=me()-this.startDragTime;if(r.onDragRotateEnd(e),r.options.rotateAnimation&&Math.abs(s-this.startBearing)>20&&(this._rotateMode==="rotate"||this._rotateMode==="rotate_pitch")&&!e.interupted&&a<400){var h=r.getBearing();r._animateTo({bearing:h+this._db/1.5},{easing:"outQuint",duration:1600})}},i._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},t}(Li);Bt.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0});Bt.addOnLoadHook("addHandler","draggable",CT);var ag="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",TT=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.addHooks=function(){var e=this.target,r=e._panels.allLayers||e._containerDOM;we(r,ag,this._identifyGeometryEvents,this)},i.removeHooks=function(){var e=this.target,r=e._panels.allLayers||e._containerDOM;ge(r,ag,this._identifyGeometryEvents)},i._identifyGeometryEvents=function(e,r){var s=this.target;if(s.isInteracting()||s._ignoreEvent(e))return;var a=null,h=r||e.type,l=h==="mousedown"||h==="touchstart"&&e.touches&&e.touches.length===1;if(l)this._mouseDownTime=me();else if((h==="click"||h==="touchend")&&this._mouseDownTime){var c=this._mouseDownTime;delete this._mouseDownTime;var u=me();if(u-c>300){if(h==="click")return}else h==="touchend"&&(a="click")}var f=e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e;if(!f)return;var d=$e(f,s._containerDOM);h==="touchstart"&&ai(e);for(var p=null,g=this.target.getRenderer().getTopElements(),m=l&&e.button!==2,v=0;v<g.length;v++)if(g[v].hitTest(d)){var x=g[v].options.cursor;if(x&&(p=x),m||g[v].events&&g[v].events.indexOf(h)>=0){var _={target:s,type:h,domEvent:e,containerPoint:d};if(m){s._setPriorityCursor(p),g[v].mousedown(_);return}else g[v].onEvent(_)}}var y=s._getLayers(function(w){return!!(w.identify&&w.options.geometryEvents)});if(s._setPriorityCursor(p),!y.length)return;var b={includeInternals:!0,filter:function(S){if(!(S instanceof Jt))return!1;var P=S._getEventTypeToFire(e);if(h==="mousemove"){if(!p&&S.options.cursor&&(p=S.options.cursor),!S.listens("mousemove")&&!S.listens("mouseover")&&!S.listens("mouseenter"))return!1}else if(!S.listens(P)&&!S.listens(a))return!1;return!0},count:1,containerPoint:d,onlyVisible:s.options.onlyVisibleGeometryEvents,layers:y},M=C.bind(this);h==="mousemove"||h==="touchmove"?this._queryIdentifyTimeout=s.getRenderer().callInNextFrame(function(){s.isInteracting()||s.identifyAtPoint(b,M)}):s.identifyAtPoint(b,M);function C(w){var S=!0;if(h==="mousemove"){var P={};if(w.length>0)for(var O=w.length-1;O>=0;O--){var D=w[O];if(D instanceof Jt){var L=D._getInternalId();P[L]=D,D._onEvent(e),(!this._prevOverGeos||!this._prevOverGeos.geomap[L])&&D._onEvent(e,"mouseenter"),S=D._onEvent(e,"mouseover")}}s._setPriorityCursor(p);var T=this._prevOverGeos&&this._prevOverGeos.geos;if(this._prevOverGeos={geos:w,geomap:P},T&&T.length>0)for(var A=T.length-1;A>=0;A--){var N=T[A];if(N instanceof Jt){var B=T[A]._getInternalId();P[B]||(S=N._onEvent(e,"mouseout"))}}}else{if(!w||!w.length)return;for(var F=w.length-1;F>=0;F--)if(w[F]instanceof Jt){S=w[F]._onEvent(e),a&&w[F]._onEvent(e,a);break}}S===!1&&ni(e)}},t}(Li);Bt.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0});Bt.addOnLoadHook("addHandler","geometryEvents",TT);var hg=4.000244140625,PT=1/100,ET=1/450,AT=2,LT=function(o){ht(t,o);function t(n){var e;return e=o.call(this,n)||this,e._thisScrollZoom=e._scrollZoom.bind(ze(ze(e))),e._wheelZoomRate=ET,e._defaultZoomRate=PT,e._delta=0,e}var i=t.prototype;return i.addHooks=function(){on(this.target._containerDOM,"wheel",this._onWheelScroll,this)},i.removeHooks=function(){$n(this.target._containerDOM,"wheel",this._onWheelScroll)},i._onWheelScroll=function(e){ai(e),ni(e);var r=this.target;if(r._ignoreEvent(e)||!r.options.zoomable)return!1;var s=r._containerDOM,a=r._checkZoomOrigin($e(e,s));return r.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(e,a)):this._interval(e,a)},i._seamless=function(e,r){var s=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?e.deltaY*60:e.deltaY;if(s%hg!==0&&(this._ensureTrackpad||(Math.abs(s)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(s*=14)),e.shiftKey&&s&&(s=s/4),this._lastWheelEvent=e,this._delta-=s,!this._zooming&&this._delta){var a=this.target;this._zoomOrigin=r,a.onZoomStart(null,r)}this._start()},i._start=function(){if(!!this._delta){this._zooming=!0;var e=this.target;this._active||(e.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0)}},i._scrollZoom=function(){var e=this;if(this._active=!1,!!this._delta){var r=Math.abs(this._delta)>hg?this._wheelZoomRate:this._defaultZoomRate,s=AT/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&s!==0&&(s=1/s);var a=this.target,h=a.getZoom(),l=a.getZoomForScale(s,h,!0);this._delta=0,a.onZooming(l,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){e._zooming=!1,delete e._timeout,a.onZoomEnd(a.getZoom(),e._zoomOrigin)},210)}},i._interval=function(e,r){var s=this,a=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var h=(e.deltaY?e.deltaY*-1:e.wheelDelta?e.wheelDelta:e.detail)>0?1:-1;e.detail&&(h*=-1);var l=a.getZoom(),c=l+h;if(c=a._checkZoom(h>0?Math.ceil(c):Math.floor(c)),c===l)return!1;this._zooming=!0,this._delta||(a.onZoomStart(null,r),this._origin=r,this._delta=h,this._startZoom=a.getZoom());var u=90;return a._animateTo({zoom:c-this._delta*1/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:u,wheelZoom:!0},function(f){if(f.state.playState!=="finished"){f.state.playState!=="running"&&(delete s._zooming,delete s._requesting);return}s._requesting<1||Math.abs(c-s._startZoom)>2||c===a.getMaxZoom()||c===a.getMinZoom()?(a._animateTo({zoom:c,around:s._origin},{continueOnViewChanged:!0,duration:100},function(d){d.state.playState!=="running"&&(delete s._zooming,delete s._requesting)}),delete s._startZoom,delete s._origin,delete s._delta,s._requesting=0):H(s._requesting)||(delete s._zooming,s._onWheelScroll(e))}),!1},t}(Li);Bt.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0});Bt.addOnLoadHook("addHandler","scrollWheelZoom",LT);var RT=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.addHooks=function(){on(this.target.getContainer(),"touchstart",this._onTouchStart,this)},i.removeHooks=function(){$n(this.target.getContainer(),"touchstart",this._onTouchStart)},i._onTouchStart=function(e){var r=this.target;if(!(!e.touches||e.touches.length<2)){var s=r.getContainer(),a=$e(e.touches[0],s),h=$e(e.touches[1],s);this.preY=a.y,this._startP1=a,this._startP2=h,this._startDist=a.distanceTo(h),this._startVector=a.sub(h),this._startZoom=r.getZoom(),this._startBearing=r.getBearing(),ge(document,"touchmove",this._onTouchMove),ge(document,"touchend",this._onTouchEnd),on(document,"touchmove",this._onTouchMove,this),on(document,"touchend",this._onTouchEnd,this),ai(e),r._fireEvent("touchactstart")}},i._onTouchMove=function(e){var r=this.target;if(!(!e.touches||e.touches.length<2)){var s=r.getContainer(),a=$e(e.touches[0],s),h=$e(e.touches[1],s),l=a.sub(this._startP1),c=h.sub(this._startP2),u=a.sub(h),f=a.distanceTo(h)/this._startDist,d=u.angleWith(this._startVector)*180/Math.PI,p=this.preY||a.y,g=(p-a.y)*.4;this.preY=a.y;var m={domEvent:e,mousePos:[a,h]};if(this.mode||(r.options.touchRotate&&Math.abs(d)>8?this.mode=r.options.touchZoomRotate?"rotate_zoom":"rotate":r.options.touchPitch&&l.y*c.y>0&&Math.abs(l.y)>10&&Math.abs(c.y)>10?this.mode="pitch":r.options.zoomable&&r.options.touchZoom&&Math.abs(1-f)>.15&&(this.mode=r.options.touchZoomRotate&&r.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(m)),this.mode==="zoom"||this.mode==="rotate_zoom"){this._scale=f;var v=r._getResolution(this._startZoom)/f,x=r.getZoomFromRes(v);r.onZooming(x,this._Origin)}this.mode==="rotate"||this.mode==="rotate_zoom"?(r._setBearing(this._startBearing+d),r.onDragRotating(m)):this.mode==="pitch"&&(r._setPitch(r.getPitch()+g),r.onDragRotating(m)),r._fireEvent("touchactinging")}},i._startTouching=function(e){var r=this.target;if(this.mode==="zoom"||this.mode==="rotate_zoom"){var s=r.getSize();this._Origin=new W(s.width/2,s.height/2),r.onZoomStart(null,this._Origin)}(this.mode==="rotate"||this.mode==="pitch"||this.mode==="rotate_zoom")&&r.onDragRotateStart(e)},i._onTouchEnd=function(e){delete this.preY;var r=this.target;if(ge(document,"touchmove",this._onTouchMove),ge(document,"touchend",this._onTouchEnd),this.mode==="zoom"||this.mode==="rotate_zoom"){var s=this._scale,a=r._getResolution(this._startZoom)/s,h=r.getZoomFromRes(a);r.onZoomEnd(h,this._Origin)}(this.mode==="pitch"||this.mode==="rotate"||this.mode==="rotate_zoom")&&r.onDragRotateEnd({domEvent:e}),delete this.mode,r._fireEvent("touchactend")},t}(Li);Bt.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1});Bt.addOnLoadHook("addHandler","touchGesture",RT);var Ba="__anim_player",vr={outExpo:function(t){return t===1?1:1-Math.pow(2,-10*t)},outQuint:function(t){return 1-Math.pow(1-t,5)},in:function(t){return Math.pow(t,2)},out:function(t){return 1-vr.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?vr.inAndOut(2*t):1-vr.inAndOut(2*(t-.5))}},e_=function(t,i){this.state=t,this.styles=i},wf=function(t,i,n,e){this._animation=t,this.options=i,this._onFrame=n,this.playState="idle",this.ready=!0,this.finished=!1,this.target=e},Ue={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function i(u){if(!Array.isArray(u))return Ue._resolveStyles(u);for(var f=[],d=[],p=[],g=0;g<u.length;g++){var m=Ue._resolveStyles(u[g]);m&&(f.push(m[0]),d.push(m[1]),p.push(m[2]))}return f.length?[f,d,p]:null}function n(u){var f=u,d;Array.isArray(u)||(St(u)?f=[0,u]:u instanceof W||u instanceof q?(d=u.constructor,f=[new d(0,0),u]):f=[u,u]);var p=f[0],g=f[1];return St(p)&&St(g)?p===g?null:[p,g-p,g]:Array.isArray(p)&&St(p[0])||p instanceof q||p instanceof W?(Array.isArray(p)?(p=new q(p),g=new q(g)):(d=p.constructor,p=new d(p),g=new d(g)),p.equals(g)?null:[p,g.sub(p),g]):[p,g,g]}function e(u){return!Array.isArray(u)&&u.constructor===Object?!0:!!(Array.isArray(u)&&u[0].constructor===Object)}var r={},s={},a={};for(var h in t)if(t.hasOwnProperty(h)){var l=t[h];if(l){if(Array.isArray(l)&&(H(l[0])||H(l[1])))continue}else continue;var c=void 0;e(l)?c=i(l):c=n(l),c&&(s[h]=c[0],r[h]=c[1],a[h]=c[2])}return[s,r,a]},framing:function(t,i){i||(i={});var n=i.easing?vr[i.easing]:vr.linear;n||(n=vr.linear);var e,r,s;t=Ue._resolveStyles(t),t&&(r=t[0],e=t[1],s=t[2]);var a=function h(l,c,u){if(!c||!u)return null;var f={};for(var d in u)if(u.hasOwnProperty(d)){if(c[d]===s[d]){f[d]=c[d];continue}var p=c[d],g=u[d];if(St(g))f[d]=p+l*g;else if(Array.isArray(g)){for(var m=[],v=0;v<g.length;v++)m.push(h(l,p[v],g[v]));f[d]=m}else{var x=g.constructor;x===Object?f[d]=h(l,p,g):p instanceof W||p instanceof q?f[d]=p.add(g.multi(l)):f[d]=g}}return f};return function(h,l){var c,u;if(h<0)c={playState:"idle",delta:0},u=r;else if(h<l){var f=n(h/l);c={playState:"running",delta:f},u=a(f,r,e)}else c={playState:"finished",delta:1},u=s;return c.startStyles=r,c.destStyles=s,c.progress=h,c.remainingMs=l-h,new e_(c,u)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=Fi(Ue._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var i=0,n=t.length;i<n;i++)t[i]();this._frameQueue.length?this._animationFrameId=Fi(Ue._frameFn):delete this._animationFrameId}},animate:function(t,i,n,e){i||(i={});var r=Ue.framing(t,i),s=new wf(r,i,n,e);return s}};Ue._frameFn=Ue._run.bind(Ue);dt(wf.prototype,{_prepare:function(){var t=this.options,i=t.speed||t.duration;Xt(i)&&(i=Ue.speed[i],i||(i=+i)),i||(i=Ue.speed.normal),this.duration=i,this._framer=t.framer||Ue._requestAnimFrame.bind(Ue)},play:function(){if(this.playState!=="idle"&&this.playState!=="paused"||this.target&&this.target[Ba])return this;this.target&&(this.target[Ba]=1),this.playState==="idle"&&(this.currentTime=0,this._prepare());var t=me();if(!this.startTime){var i=this.options;this.startTime=i.startTime?i.startTime:t}return this._playStartTime=Math.max(t,this.startTime),this.playState==="paused"&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return this.playState==="paused"?this:(this.playState="paused",this._run(),this)},cancel:function(){return this.playState==="idle"?this:(this.playState="idle",this.finished=!1,this._run(),this)},finish:function(){return this.playState==="finished"?this:(this.playState="finished",this.finished=!0,this._run(),this)},reverse:function(){},_run:function(){var t=this,i=this._onFrame,n=me(),e=n-this._playStartTime;if(this.options.repeat&&e>=this.duration&&(this._playStartTime=n,e=0),this.playState!=="running"){if(this.target&&delete this.target[Ba],i){this.playState==="finished"?e=this.duration:this.playState==="idle"&&(e=0);var r=this._animation(e,this.duration);r.state.playState=this.playState,i(r)}return}var s=this._animation(e,this.duration);this.playState=s.state.playState,this.playState!=="running"&&this.target&&delete this.target[Ba],this.playState==="idle"?this.startTime>n&&setTimeout(this._run.bind(this),this.startTime-n):this.playState==="running"?this._framer(function(){t.playState==="running"&&(t.currentTime=e,i&&i(s),t._run())}):this.playState==="finished"&&(this.finished=!0,i&&i(s))}});var OT=Object.freeze({Animation:Ue,Easing:vr,Player:wf,Frame:e_}),DT={smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}},Jh=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.animateShow=function(e,r){var s=this;e===void 0&&(e={}),this._showPlayer&&this._showPlayer.finish(),ne(e)&&(e={},r=e);var a=this.getCoordinates();if(a.length===0)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var h=!!this.getShell,l=h?this.getShell().concat(this.getShell()[0]):a,c=this._getProjection(),u=c.projectCoords(l,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=c.unproject(this._prjAniShowCenter);var f=e.duration||1e3,d=e.easing||"out";this.setCoordinates([]);var p=0;u.length&&(u[0]._distance=0);for(var g=1;g<u.length;g++){var m=u[g].distanceTo(u[g-1]);u[g]._distance=m,p+=m}this._tempCoord=new q(0,0),this._tempPrjCoord=new W(0,0);var v=this._showPlayer=Ue.animate({t:f},{duration:f,easing:d},function(x){if(!s.getMap()){if(v.playState!=="finished"&&(v.finish(),r)){var _=s.getCoordinates();r(x,_[_.length-1])}return}var y=s._drawAnimShowFrame(x.styles.t,f,p,l,u);x.state.playState==="finished"&&(delete s._showPlayer,delete s._aniShowCenter,delete s._prjAniShowCenter,delete s._animIdx,delete s._animLenSoFar,delete s._animTailRatio,delete s._tempCoord,delete s._tempPrjCoord,s.setCoordinates(a)),r&&r(x,y)},this);return v.play(),v},i._drawAnimShowFrame=function(e,r,s,a,h){if(e===0)return a[0];var l=e/r*s,c=0,u,f;for(u=this._animIdx+1,f=h.length;u<f&&(c=h[u]._distance,!(this._animLenSoFar+c>l));u++)this._animLenSoFar+=c;if(this._animIdx=u-1,this._animIdx>=f-1)return this.setCoordinates(a),a[a.length-1];var d=this._animIdx,p=h[d],g=h[d+1],m=l-this._animLenSoFar,v=m/c;this._animTailRatio=v;var x=p.x+(g.x-p.x)*v,_=p.y+(g.y-p.y)*v;this._tempPrjCoord.x=x,this._tempPrjCoord.y=_;var y=this._tempPrjCoord,b=a[d],M=a[d+1],C=b.x+(M.x-b.x)*v,w=b.y+(M.y-b.y)*v;this._tempCoord.x=C,this._tempCoord.y=w;var S=this._tempCoord,P=!!this.getShell;if(!P&&this.options.smoothness>0){for(var O=[],D=[],L=0;L<=this._animIdx;L++)O.push(a[L]),D.push(h[L]);O.push(S,S),D.push(y,y),this.setCoordinates(O),this._setPrjCoordinates(D)}else{var T=a.slice(0,this._animIdx+1);T.push(S);var A=h.slice(0,this._animIdx+1);A.push(y),P?(this.setCoordinates([this._aniShowCenter].concat(T)),this._setPrjCoordinates([this._prjAniShowCenter].concat(A))):(this.setCoordinates(T),this._setPrjCoordinates(A))}return S},i._getCenterInExtent=function(e,r,s){var a=this.getExtent();if(!e.intersects(a))return null;var h=s(r,e);if(h.length===0)return null;var l=0,c=0,u=0;h.forEach(function(d){Array.isArray(d)?d.forEach(function(p){p.point&&(p=p.point),l+=p.x,c+=p.y,u++}):(d.point&&(d=d.point),l+=d.x,c+=d.y,u++)});var f=new q(l,c)._multi(1/u);return f.count=u,f},i._getPath2DPoints=function(e,r,s){if(!ee(e))return[];var a=this.getMap(),h=!r&&this._shouldSimplify(),l=this.options.simplifyTolerance*a._getResolution(),c=Array.isArray(e[0]);if(delete this._simplified,h&&!c){var u=e.length;e=kS(e,l,!1),this._simplified=e.length<u}if(s||(s=a._getResolution()),Array.isArray(e)){var f=[],d="_glPt";if(!Array.isArray(e[0]))return f=Eo(e,d),a._prjsToPointsAtRes(e,s,f);for(var p=[],g=0,m=e.length;g<m;g++){var v=e[g];f=Eo(v,d);var x=a._prjsToPointsAtRes(v,s,f);p.push(x)}return p}else return a._prjToPointAtRes(e,s)},i._shouldSimplify=function(){var e=this.getLayer(),r=this.getProperties(),s=r&&e.options.enableAltitude&&!H(r[e.options.altitudeProperty])&&r[e.options.altitudeProperty]!==0;return e&&e.options.enableSimplify&&!s&&this.options.enableSimplify&&!this._showPlayer},i._setPrjCoordinates=function(e){this._prjCoords=e,this.onShapeChanged()},i._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},i._updateCache=function(){this._clearCache();var e=this._getProjection();!e||this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},i._clearProjection=function(){this._prjCoords=null,o.prototype._clearProjection.call(this)},i._projectCoords=function(e){var r=this._getProjection();return r?r.projectCoords(e,this.options.antiMeridian):[]},i._unprojectCoords=function(e){var r=this._getProjection();return r?r.unprojectCoords(e):[]},i._computeCenter=function(){var e=this._coordinates;if(!ee(e))return null;for(var r=0,s=0,a=0,h=e.length,l=0;l<h;l++)e[l]&&St(e[l].x)&&St(e[l].y)&&(r+=e[l].x,s+=e[l].y,a++);return new q(r/a,s/a)},i._computeExtent=function(){var e=this._coordinates;if(!ee(e))return null;var r=[e];return this.hasHoles&&this.hasHoles()&&r.push.apply(r,this.getHoles()),this._coords2Extent(r,this._getProjection())},i._computePrjExtent=function(){var e=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this._getPrjHoles()),this._coords2Extent(e)},i._get2DLength=function(){for(var e=this._getPath2DPoints(this._getPrjCoordinates(),!0),r=0,s=1,a=e.length;s<a;s++)r+=e[s].distanceTo(e[s-1]);return r},i._hitTestTolerance=function(){var e=this._getInternalSymbol(),r;if(Array.isArray(e)){r=0;for(var s=0;s<e.length;s++)St(e[s].lineWidth)&&e[s].lineWidth>r&&(r=e[s].lineWidth)}else r=e.lineWidth;return o.prototype._hitTestTolerance.call(this)+(St(r)?r/2:1.5)},i._coords2Extent=function(e,r){if(!e||e.length===0||Array.isArray(e[0])&&e[0].length===0)return null;for(var s=new oe(r),a=0,h=e.length;a<h;a++)for(var l=0,c=e[a].length;l<c;l++)s._combine(e[a][l]);return s},t}(Jt);Jh.mergeOptions(DT);var i_="Polygon",ie=function(o){ht(t,o);function t(n,e){var r;return r=o.call(this,e)||this,r.type="Polygon",n&&r.setCoordinates(n),r}var i=t.prototype;return i.getOutline=function(){var e=this._getPainter();if(!e)return null;var r=this.getExtent();return new t(r.toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}})},i.setCoordinates=function(e){if(!e)return this._coordinates=null,this._holes=null,this._projectRings(),this;var r=q.toCoordinates(e),s=r.length;if(!Array.isArray(r[0]))this._coordinates=this._trimRing(r);else if(this._coordinates=this._trimRing(r[0]),s>1){for(var a=[],h=1;h<s;h++)!r[h]||a.push(this._trimRing(r[h]));this._holes=a}return this._projectRings(),this},i.getCoordinates=function(){if(!this._coordinates)return[];for(var e=this.getHoles(),r=[this._copyAndCloseRing(this._coordinates)],s=0,a=e.length;s<a;s++)r.push(this._copyAndCloseRing(e[s]));return r},i.getCenterInExtent=function(e){return this._getCenterInExtent(e,this.getShell(),hh)},i.getShell=function(){return this._coordinates||[]},i.getHoles=function(){return this._holes||[]},i.hasHoles=function(){return this.getHoles().length>0},i._projectRings=function(){if(!this.getMap()){this.onShapeChanged();return}this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()},i._setPrjCoordinates=function(e){this._prjCoords=e,this.onShapeChanged()},i._cleanRing=function(e){for(var r=e.length-1;r>=0;r--)e[r]||e.splice(r,1)},i._checkRing=function(e){if(this._cleanRing(e),!e||!ee(e))return!1;var r=e[e.length-1],s=!0;return(e[0].x!==r.x||e[0].y!==r.y)&&(s=!1),s},i._trimRing=function(e){var r=this._checkRing(e);return ee(e)&&r&&e.splice(e.length-1,1),e},i._copyAndCloseRing=function(e){e=e.slice(0);var r=this._checkRing(e);return ee(e)&&!r&&e.push(e[0].copy()),e},i._getPrjShell=function(){return this.getJSONType()===i_?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this.getShell())),this._prjShell)},i._getPrjHoles=function(){var e=this._getProjection();return this._verifyProjection(),e&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},i._computeGeodesicLength=function(e){var r=this.getCoordinates();if(!ee(r))return 0;for(var s=0,a=0,h=r.length;a<h;a++)s+=e.measureLength(r[a]);return s},i._computeGeodesicArea=function(e){var r=this.getCoordinates();if(!ee(r))return 0;for(var s=e.measureArea(r[0]),a=1,h=r.length;a<h;a++)s-=e.measureArea(r[a]);return s},i._updateCache=function(){o.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},i._clearCache=function(){return delete this._prjShell,o.prototype._clearCache.call(this)},i._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),o.prototype._clearProjection.call(this)},t}(Jh);ie.registerJSONType(i_);function Mf(o){return function(t){ht(i,t);function i(){return t.apply(this,arguments)||this}var n=i.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(r){var s=r instanceof q?r:new q(r);if(s.equals(this._coordinates))return this;if(this._coordinates=s,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var a=this._getProjection();return this._setPrjCoordinates(a.project(this._coordinates)),this},n._getCenter2DPoint=function(r){var s=this.getMap();if(!s)return null;var a=this._getPrjCoordinates();return a?(r||(r=s._getResolution()),s._prjToPointAtRes(a,r)):null},n._getPrjCoordinates=function(){var r=this._getProjection();return this._verifyProjection(),!this._pcenter&&r&&this._coordinates&&(this._pcenter=r.project(this._coordinates)),this._pcenter},n._setPrjCoordinates=function(r){this._pcenter=r,this.onPositionChanged()},n._updateCache=function(){this._clearCache();var r=this._getProjection();this._pcenter&&r&&(this._coordinates=r.unproject(this._pcenter))},n._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},n._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},i}(o)}var lg=new Vt,IT={symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1},Ce=function(o){ht(t,o);function t(n,e){var r;return r=o.call(this,e)||this,r.type="Point",n&&r.setCoordinates(n),r}var i=t.prototype;return i.getOutline=function(){var e=this.getCoordinates(),r=this.getContainerExtent(),s=this.getMap().coordToContainerPoint(e);return new t(e,{symbol:{markerType:"square",markerWidth:r.getWidth(),markerHeight:r.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:r.xmin-(s.x-r.getWidth()/2),markerDy:r.ymin-(s.y-r.getHeight()/2)}})},i.setSymbol=function(){var e;delete this._fixedExtent;for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return(e=o.prototype.setSymbol).call.apply(e,[this].concat(s))},i._getSizeSymbol=function(e){for(var r={},s=!1,a=!1,h=0;h<Cc.length;h++){var l=e[Cc[h]];H(l)||(!s&&Ae(l)&&(s=!0,a=!0),r[Cc[h]]=l)}for(var c=0;c<Tc.length;c++){var u=e[Tc[c]];H(u)||(!s&&Ae(u)&&(s=!0),r[Tc[c]]=u)}var f;return s?(f=_h(r,this),a&&(f._dynamic=!0)):f=r,f},i._setExternSymbol=function(e){return this._symbol||delete this._fixedExtent,o.prototype._setExternSymbol.call(this,e)},i._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},i._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new Vt,this._fixedExtent.set(null,null,null,null);var e=this._sizeSymbol;if(!e)return this._fixedExtent;var r=this.getLayer()&&this.getLayer().getRenderer(),s=r&&r.resources,a=this.getTextDesc();if(Array.isArray(e)){lg.set(1/0,1/0,-1/0,-1/0);for(var h=0;h<e.length;h++)!e[h]||this._fixedExtent._combine(_u(lg,e[h],s,a&&a[h]))}else this._fixedExtent=_u(this._fixedExtent,e,s,a);return this._fixedExtent},i._isVectorMarker=function(){var e=this._getInternalSymbol();return Array.isArray(e)?!1:Ch(e)},i._canEdit=function(){var e=this._getInternalSymbol();return Array.isArray(e)?!1:Ch(e)||_f(e)||vf(e)},i._containsPoint=function(e,r){var s=this.getContainerExtent();return r&&(s=s.expand(r)),s.contains(e)?this.options.hitTestForEvent?o.prototype._containsPoint.call(this,e,r):!0:!1},i._computeExtent=function(){return cg.call(this,"getCenter")},i._computePrjExtent=function(){return cg.call(this,"_getPrjCoordinates")},i._computeGeodesicLength=function(){return 0},i._computeGeodesicArea=function(){return 0},i._getSprite=function(e,r){return this._getPainter()?this._getPainter().getSprite(e,r):new xf(this).getSprite(e,r)},t}(Mf(Jt));Ce.mergeOptions(IT);Ce.registerJSONType("Marker");function cg(o){var t=this[o]();return t?new oe(t,t,this._getProjection()):null}var kT={arrowStyle:null,arrowPlacement:"vertex-last"},fe=function(o){ht(t,o);function t(n,e){var r;return r=o.call(this,e)||this,r.type="LineString",n&&r.setCoordinates(n),r}var i=t.prototype;return i.getOutline=function(){return ie.prototype.getOutline.call(this)},i.setCoordinates=function(e){return e?(this._coordinates=q.toCoordinates(e),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},i.getCoordinates=function(){return this._coordinates||[]},i.getCenterInExtent=function(e){return this._getCenterInExtent(e,this.getCoordinates(),ah)},i._computeGeodesicLength=function(e){return e.measureLength(this.getCoordinates())},i._computeGeodesicArea=function(){return 0},t}(Jh);fe.mergeOptions(kT);fe.registerJSONType("LineString");var zT=new Vt,Th=function(o){ht(t,o);function t(n,e){var r;return r=o.call(this,e)||this,r.type="GeometryCollection",r.setGeometries(n),r}var i=t.prototype;return i.getContainerExtent=function(e){var r=e||new Vt;return this.forEach(function(s){r._combine(s.getContainerExtent(zT))}),r},i.setGeometries=function(e){for(var r=this._checkGeometries(e||[]),s=this._getSymbol(),a=this.config(),h=r.length-1;h>=0;h--)r[h]._initOptions(a),r[h]._setParent(this),r[h]._setEventParent(this),s&&r[h].setSymbol(s);return this._geometries=r,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},i.getGeometries=function(){return this._geometries||[]},i.forEach=function(e,r){for(var s=this.getGeometries(),a=0,h=s.length;a<h;a++)!s[a]||(r?e.call(r,s[a],a):e(s[a],a));return this},i.filter=function(e,r){if(!e)return new t;var s=[],a=ne(e),h=a?e:Ku(e);return this.forEach(function(l){var c=a?l:uu(l);(r?h.call(r,c):h(c))&&s.push(l)},this),new t(s)},i.translate=function(e){if(!e)return this;if(this.isEmpty())return this;var r=arguments;return this.forEach(function(s){s&&s.translate&&s.translate.apply(s,r)}),this},i.isEmpty=function(){return!ee(this.getGeometries())},i.remove=function(){return this.forEach(function(e){e._unbind()}),Jt.prototype.remove.apply(this,arguments)},i.show=function(){return this.options.visible=!0,this.forEach(function(e){e.show()}),this},i.hide=function(){return this.options.visible=!1,this.forEach(function(e){e.hide()}),this},i.onConfig=function(e){this.forEach(function(r){r.config(e)})},i.getSymbol=function(){var e=o.prototype.getSymbol.call(this);if(!e){var r=[],s=!1;this.forEach(function(a){var h=a.getSymbol();h&&!s&&(s=!0),r.push(a.getSymbol())}),s&&(e={children:r})}return e},i.setSymbol=function(e){if(e&&e.children)this._symbol=null,this.forEach(function(s,a){s.setSymbol(e.children[a])});else{var r=this._prepareSymbol(e);this._symbol=r,this.forEach(function(s){s.setSymbol(r)})}return this.onSymbolChanged(),this},i._setExternSymbol=function(e){return e=this._prepareSymbol(e),this._externSymbol=e,this.forEach(function(r){r._setExternSymbol(e)}),this.onSymbolChanged(),this},i._bindLayer=function(){o.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},i._bindGeometriesToLayer=function(){var e=this.getLayer();this.forEach(function(r){r._bindLayer(e)})},i._checkGeometries=function(e){var r="The geometry added to collection is invalid.";if(e&&!Array.isArray(e)){if(e instanceof Jt)return[e];throw new Error(r)}else{for(var s=0,a=e.length;s<a;s++)if(!this._checkGeo(e[s]))throw new Error(r+" Index: "+s);return e}},i._checkGeo=function(e){return e instanceof Jt},i._updateCache=function(){this._clearCache(),!this.isEmpty()&&this.forEach(function(e){e&&e._updateCache&&e._updateCache()})},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach(function(e){e._removePainter()})},i._computeCenter=function(e){if(!e||this.isEmpty())return null;for(var r=0,s=0,a=0,h=this.getGeometries(),l=0,c=h.length;l<c;l++)if(!!h[l]){var u=h[l]._computeCenter(e);u&&(r+=u.x,s+=u.y,a++)}return a===0?null:new q(r/a,s/a)},i._containsPoint=function(e,r){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var s=this.getGeometries(),a=0,h=s.length;a<h;a++)if(s[a]._containsPoint(e,r))return this._pickGeometryIndex=a,!0;return!1},i._computeExtent=function(e){return ug.call(this,e,"_computeExtent")},i._computePrjExtent=function(e){return ug.call(this,e,"_computePrjExtent")},i._computeGeodesicLength=function(e){if(!e||this.isEmpty())return 0;for(var r=this.getGeometries(),s=0,a=0,h=r.length;a<h;a++)!r[a]||(s+=r[a]._computeGeodesicLength(e));return s},i._computeGeodesicArea=function(e){if(!e||this.isEmpty())return 0;for(var r=this.getGeometries(),s=0,a=0,h=r.length;a<h;a++)!r[a]||(s+=r[a]._computeGeodesicArea(e));return s},i._exportGeoJSONGeometry=function(){var e=[];if(!this.isEmpty())for(var r=this.getGeometries(),s=0,a=r.length;s<a;s++)!r[s]||e.push(r[s]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:e}},i._toJSON=function(e){var r={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter(function(h){return h&&h._toJSON}).map(function(h){var l=h._toJSON();return l.subType?l:h._exportGeoJSONGeometry()})}},s=this.getId();H(s)||(r.id=s);var a;return(H(e.properties)||e.properties)&&(a=this._exportProperties()),r.properties=a,e.feature=r,e},i._clearProjection=function(){if(!this.isEmpty())for(var e=this.getGeometries(),r=0,s=e.length;r<s;r++)!e[r]||e[r]._clearProjection()},i._getConnectPoints=function(){var e=this.getExtent(),r=[new q(e.xmin,e.ymax),new q(e.xmax,e.ymin),new q(e.xmin,e.ymin),new q(e.xmax,e.ymax)];return r},i._getExternalResources=function(){if(this.isEmpty())return[];for(var e=this.getGeometries(),r=[],s={},a,h,l,c=0,u=e.length;c<u;c++)if(!!e[c]){a=e[c]._getInternalSymbol(),h=Wo(a);for(var f=0,d=h.length;f<d;f++)l=h[f].join(),s[l]||(r.push(h[f]),s[l]=1)}return r},i.startEdit=function(e){var r=this;if(this.isEmpty())return this;e||(e={}),e.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(e.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var s=this.getGeometries(),a=0,h=s.length;a<h;a++)s[a].startEdit(e);return this._editing=!0,this.hide(),setTimeout(function(){r.fire("editstart")},1),this},i.endEdit=function(){if(this.isEmpty())return this;for(var e=this.getGeometries(),r=0,s=e.length;r<s;r++)e[r].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},i.isEditing=function(){return!!this._editing},t}(Jt);Th.registerJSONType("GeometryCollection");function ug(o,t){if(this.isEmpty())return null;for(var i=new oe,n=this.getGeometries(),e=0,r=n.length;e<r;e++)if(!!n[e]){var s=n[e][t](o);s&&i._combine(s)}return i}var n_=function(o){ht(t,o);function t(n,e,r,s){var a;return a=o.call(this,null,s)||this,a.GeometryType=n,a.type=e,a._initData(r),a}var i=t.prototype;return i.getCoordinates=function(){for(var e=[],r=this.getGeometries(),s=0,a=r.length;s<a;s++){var h=r[s];e.push(h.getShell&&h.getJSONType()!=="Polygon"?[h.getShell()]:h.getCoordinates())}return e},i.setCoordinates=function(e){e=e||[];for(var r=[],s=0,a=e.length;s<a;s++){var h=new this.GeometryType(e[s],this.config());r.push(h)}return this.setGeometries(r),this},i._initData=function(e){e=e||[],e.length&&(e[0]instanceof this.GeometryType?this.setGeometries(e):this.setCoordinates(e))},i._checkGeo=function(e){return e instanceof this.GeometryType},i._exportGeoJSONGeometry=function(){var e=this.getCoordinates(),r=q.toNumberArrays(e);return{type:this.getType(),coordinates:r}},i._toJSON=function(e){return{feature:this.toGeoJSON(e)}},t}(Th),Ph=function(o){ht(t,o);function t(n,e){return o.call(this,Ce,"MultiPoint",n,e)||this}var i=t.prototype;return i.findClosest=function(e){if(!e)return null;var r=this.getCoordinates(),s=null,a=1/0;return r.forEach(function(h){var l=FT(h,e);l<a&&(s=h,a=l)}),s},t}(n_);Ph.registerJSONType("MultiPoint");function FT(o,t){var i=t.x-o.x,n=t.y-o.y;return Math.sqrt(i*i+n*n)}var r_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.getCenterInExtent=function(e){var r=this.getGeometries(),s=0,a=0,h=0;return r.forEach(function(l){var c=l.getCenterInExtent(e);c&&(s+=c.x*c.count,a+=c.y*c.count,h+=c.count)}),h===0?null:new q(s,a)._multi(1/h)},t}(n_),Lo=function(o){ht(t,o);function t(i,n){return o.call(this,fe,"MultiLineString",i,n)||this}return t}(r_);Lo.registerJSONType("MultiLineString");var Es=function(o){ht(t,o);function t(i,n){return o.call(this,ie,"MultiPolygon",i,n)||this}return t}(r_);Es.registerJSONType("MultiPolygon");var NT={Marker:Ce,LineString:fe,Polygon:ie,MultiPoint:Ph,MultiLineString:Lo,MultiPolygon:Es},An={toGeometry:function(t,i){if(Xt(t)&&(t=Uh(t)),Array.isArray(t)){for(var n=[],e=0,r=t.length;e<r;e++){var s=An._convert(t[e],i);Array.isArray(s)?Ar(n,s):n.push(s)}return n}else{var a=An._convert(t,i);return a}},_convert:function(t,i){if(!t||H(t.type))return null;var n=t.type;if(n==="Feature"){var e=t.geometry,r=An._convert(e);return r?(r.setId(t.id),r.setProperties(t.properties),i&&i(r),r):null}else if(n==="FeatureCollection"){var s=t.features;return s?An.toGeometry(s,i):null}else if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(n)>=0){var a=n==="Point"?"Marker":n,h=new NT[a](t.coordinates);return i&&i(h),h}else if(n==="GeometryCollection"){var l=t.geometries;if(!ee(l)){var c=new Th;return i&&i(c),c}for(var u=[],f=l.length,d=0;d<f;d++)l[d].subType?u.push(Jt.getJSONClass(l[d].subType).fromJSON(l[d])):u.push(An._convert(l[d]));var p=new Th(u);return i&&i(p),p}return null}},BT={numberOfShellPoints:60},Ni=function(o){ht(t,o),t.fromJSON=function(e){var r=e.feature,s=new t(e.coordinates,e.radius,e.options);return s.setProperties(r.properties),s};function t(n,e,r){var s;return s=o.call(this,null,r)||this,n&&s.setCoordinates(n),s._radius=e,s}var i=t.prototype;return i.getRadius=function(){return this._radius},i.setRadius=function(e){return this._radius=e,this.onShapeChanged(),this},i.getShell=function(){for(var e=this._getMeasurer(),r=this.getCoordinates(),s=this.options.numberOfShellPoints,a=this.getRadius(),h=[],l,c,u,f=0,d=s-1;f<d;f++){l=360*f/d*Math.PI/180,c=a*Math.cos(l),u=a*Math.sin(l);var p=e.locate(r,c,u);h.push(p)}return h.push(h[0]),h},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(e,r){var s=this.getMap();if(s.getPitch())return o.prototype._containsPoint.call(this,e,r);var a=s._pointToContainerPoint(this._getCenter2DPoint()),h=this.getSize(),l=H(r)?this._hitTestTolerance():r,c=a.add(h.width/2,h.height/2);return jv(e,a,c,l)},i._computePrjExtent=function(e){var r=this._getMinMax(e);if(!r)return null;var s=this._getPrjCoordinates(),a=r.map(function(f){return e.project(f)}),h=a[0].x-s.x,l=a[1].x-s.x,c=a[2].y-s.y,u=a[3].y-s.y;return new oe(s.add(h,c),s.add(l,u))},i._computeExtent=function(e){var r=this._getMinMax(e);return r?new oe(r[0].x,r[2].y,r[1].x,r[3].y,this._getProjection()):null},i._getMinMax=function(e){if(!e||!this._coordinates||H(this._radius))return null;var r=this._radius,s=e.locate(this._coordinates,-r,0),a=e.locate(this._coordinates,r,0),h=e.locate(this._coordinates,0,r),l=e.locate(this._coordinates,0,-r);return[s,a,h,l]},i._computeGeodesicLength=function(){return H(this._radius)?0:Math.PI*2*this._radius},i._computeGeodesicArea=function(){return H(this._radius)?0:Math.PI*Math.pow(this._radius,2)},i._exportGeoJSONGeometry=function(){var e=q.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:e}},i._toJSON=function(e){var r=this.getCenter(),s=dt({},e);s.geometry=!1;var a=this.toGeoJSON(s);return a.geometry={type:"Polygon"},{feature:a,subType:"Circle",coordinates:[r.x,r.y],radius:this.getRadius()}},t}(Mf(ie));Ni.mergeOptions(BT);Ni.registerJSONType("Circle");var GT={numberOfShellPoints:80},ln=function(o){ht(t,o),t.fromJSON=function(e){var r=e.feature,s=new t(e.coordinates,e.width,e.height,e.options);return s.setProperties(r.properties),s};function t(n,e,r,s){var a;return a=o.call(this,null,s)||this,n&&a.setCoordinates(n),a.width=e,a.height=r,a}var i=t.prototype;return i.getWidth=function(){return this.width},i.setWidth=function(e){return this.width=e,this.onShapeChanged(),this},i.getHeight=function(){return this.height},i.setHeight=function(e){return this.height=e,this.onShapeChanged(),this},i.getShell=function(){for(var e=this._getMeasurer(),r=this.getCoordinates(),s=this.options.numberOfShellPoints,a=this.getWidth(),h=this.getHeight(),l=[],c=Math.pow(a/2,2)*Math.pow(h/2,2),u=Math.pow(a/2,2),f=Math.pow(h/2,2),d,p,g,m,v=0;v<s;v++){d=360*v/s,p=d*Math.PI/180,g=Math.sqrt(c/(u*Math.pow(Math.tan(p),2)+f)),m=Math.sqrt(c/(f*Math.pow(1/Math.tan(p),2)+u)),d>90&&d<270&&(g*=-1),d>180&&d<360&&(m*=-1);var x=e.locate(r,g,m);l.push(x)}return l},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(e,r){var s=this.getMap();if(s.isTransforming())return o.prototype._containsPoint.call(this,e,r);var a=s.getProjection(),h=H(r)?this._hitTestTolerance():r,l=a.projectCoords([this._coordinates,s.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian),c=s._prjToContainerPoint(l[0]),u=s._prjToContainerPoint(l[1]);return jv(e,c,u,h)},i._computePrjExtent=function(){return Ni.prototype._computePrjExtent.apply(this,arguments)},i._computeExtent=function(){return Ni.prototype._computeExtent.apply(this,arguments)},i._getMinMax=function(e){if(!e||!this._coordinates||H(this.width)||H(this.height))return null;var r=this.getWidth(),s=this.getHeight(),a=e.locate(this._coordinates,-r/2,0),h=e.locate(this._coordinates,r/2,0),l=e.locate(this._coordinates,0,-s/2),c=e.locate(this._coordinates,0,s/2);return[a,h,l,c]},i._computeGeodesicLength=function(){if(H(this.width)||H(this.height))return 0;var e=this.width>this.height?this.width:this.height;return 2*Math.PI*e/2-4*Math.abs(this.width-this.height)},i._computeGeodesicArea=function(){return H(this.width)||H(this.height)?0:Math.PI*this.width*this.height/4},i._exportGeoJSONGeometry=function(){var e=q.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:e}},i._toJSON=function(e){var r=dt({},e),s=this.getCenter();r.geometry=!1;var a=this.toGeoJSON(r);return a.geometry={type:"Polygon"},{feature:a,subType:"Ellipse",coordinates:[s.x,s.y],width:this.getWidth(),height:this.getHeight()}},t}(Mf(ie));ln.mergeOptions(GT);ln.registerJSONType("Ellipse");var _r=function(o){ht(t,o),t.fromJSON=function(e){var r=e.feature,s=new t(e.coordinates,e.width,e.height,e.options);return s.setProperties(r.properties),s};function t(n,e,r,s){var a;return a=o.call(this,null,s)||this,n&&a.setCoordinates(n),a._width=e,a._height=r,a}var i=t.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(e){if(this._coordinates=e instanceof q?e:new q(e),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var r=this._getProjection();return this._setPrjCoordinates(r.project(this._coordinates)),this},i.getWidth=function(){return this._width},i.setWidth=function(e){return this._width=e,this.onShapeChanged(),this},i.getHeight=function(){return this._height},i.setHeight=function(e){return this._height=e,this.onShapeChanged(),this},i.getShell=function(){var e=this._getMeasurer(),r=this._coordinates,s=this.getMap(),a=1,h=-1;if(s){var l=s.getFullExtent();l.left>l.right&&(a=-1),l.bottom>l.top&&(h=1)}var c=[];return c.push(r),c.push(e.locate(r,a*this._width,0)),c.push(e.locate(r,a*this._width,h*this._height)),c.push(e.locate(r,0,h*this._height)),c.push(r),c},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pnw&&e&&this._coordinates&&(this._pnw=e.project(this._coordinates)),this._pnw},i._setPrjCoordinates=function(e){this._pnw=e,this.onPositionChanged()},i._getPrjShell=function(){var e=o.prototype._getPrjShell.call(this),r=this._getProjection();if(!r.isSphere())return e;for(var s=r.getSphereExtent(),a=s.sx,h=s.sy,l=this._getProjection().getCircum(),c=e[0],u=1,f=e.length;u<f;u++){var d=e[u],p=0,g=0;a*(c.x-d.x)>0&&(p=l.x*a),h*(c.y-d.y)<0&&(g=l.y*h),e[u]._add(p,g)}return e},i._updateCache=function(){this._clearCache();var e=this._getProjection();this._pnw&&e&&(this._coordinates=e.unproject(this._pnw))},i._clearProjection=function(){this._pnw=null,o.prototype._clearProjection.call(this)},i._computeCenter=function(e){return e.locate(this._coordinates,this._width/2,-this._height/2)},i._containsPoint=function(e,r){var s=this.getMap();if(s.isTransforming())return o.prototype._containsPoint.call(this,e,r);var a=H(r)?this._hitTestTolerance():r,h=s._getResolution()*a,l=this._getPrjExtent().expand(h),c=s._containerPointToPrj(e);return l.contains(c)},i._computePrjExtent=function(e){var r=this._getSouthEast(e);if(!r)return null;var s=e.projectCoords([new q(this._coordinates.x,r.y),new q(r.x,this._coordinates.y)],this.options.antiMeridian);return new oe(s[0],s[1])},i._computeExtent=function(e){var r=this._getSouthEast(e);return r?new oe(this._coordinates,r,this._getProjection()):null},i._getSouthEast=function(e){if(!e||!this._coordinates||H(this._width)||H(this._height))return null;var r=this.getWidth(),s=this.getHeight(),a=r,h=-s;if(e.fullExtent){var l=e.fullExtent,c=l.right>l.left?1:-1,u=l.top>l.bottom?1:-1;a*=c,h*=u}var f=e.locate(this._coordinates,a,0),d=e.locate(this._coordinates,0,h);return f.y=d.y,f},i._computeGeodesicLength=function(){return H(this._width)||H(this._height)?0:2*(this._width+this._height)},i._computeGeodesicArea=function(){return H(this._width)||H(this._height)?0:this._width*this._height},i._exportGeoJSONGeometry=function(){var e=q.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:e}},i._toJSON=function(e){var r=dt({},e),s=this.getCoordinates();r.geometry=!1;var a=this.toGeoJSON(r);return a.geometry={type:"Polygon"},{feature:a,subType:"Rectangle",coordinates:[s.x,s.y],width:this.getWidth(),height:this.getHeight()}},t}(ie);_r.registerJSONType("Rectangle");var HT={numberOfShellPoints:60},Bs=function(o){ht(t,o),t.fromJSON=function(e){var r=e.feature,s=new t(e.coordinates,e.radius,e.startAngle,e.endAngle,e.options);return s.setProperties(r.properties),s};function t(n,e,r,s,a){var h;return h=o.call(this,n,e,a)||this,h.startAngle=r,h.endAngle=s,h}var i=t.prototype;return i.getStartAngle=function(){return this.startAngle},i.setStartAngle=function(e){return this.startAngle=e,this.onShapeChanged(),this},i.getEndAngle=function(){return this.endAngle},i.setEndAngle=function(e){return this.endAngle=e,this.onShapeChanged(),this},i.getShell=function(){for(var e=this._getMeasurer(),r=this.getCoordinates(),s=this.options.numberOfShellPoints-2,a=this.getRadius(),h=[r.copy()],l=this.getStartAngle(),c=this.getEndAngle()-l,u,f,d,p=0;p<s;p++){u=(c*p/(s-1)+l)*Math.PI/180,f=a*Math.cos(u),d=a*Math.sin(u);var g=e.locate(r,f,d);h.push(g)}return h.push(r.copy()),h},i._containsPoint=function(e,r){var s=this.getMap();if(s.isTransforming())return o.prototype._containsPoint.call(this,e,r);var a=s._pointToContainerPoint(this._getCenter2DPoint()),h=H(r)?this._hitTestTolerance():r,l=this.getSize(),c=a,u=e,f=u.x-c.x,d=c.y-u.y,p=Math.atan2(d,f),g=p<0?(p+2*Math.PI)*360/(2*Math.PI):p*360/(2*Math.PI),m=this.startAngle%360,v=this.endAngle%360,x=!1;return m>v?x=!(g>v&&g<m):x=g>=m&&g<=v,u.distanceTo(c)<=l.width/2+h&&x},i._computeGeodesicLength=function(){return H(this._radius)?0:Math.PI*2*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},i._computeGeodesicArea=function(){return H(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},i._toJSON=function(e){var r=dt({},e),s=this.getCenter();r.geometry=!1;var a=this.toGeoJSON(r);return a.geometry={type:"Polygon"},{feature:a,subType:"Sector",coordinates:[s.x,s.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},t}(Ni);Bs.mergeOptions(HT);Bs.registerJSONType("Sector");var UT={enableSimplify:!1,enableClip:!1},Xo=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i._arc=function(e,r,s){for(var a=this.options.arcDegree*Math.PI/180,h=1,l=r.length;h<l;h++){var c=ot._arcBetween(e,r[h-1],r[h],a),u=[r[h-1].x+r[h].x-c[0],r[h-1].y+r[h].y-c[1]];r[h-1].nextCtrlPoint=u,r[h].prevCtrlPoint=u,ot._stroke(e,s)}},i._quadraticCurve=function(e,r){if(r.length<=2){ot._path(e,r);return}var s,a;for(s=2,a=r.length;s<a;s+=2)e.quadraticCurveTo(r[s-1].x,r[s-1].y,r[s].x,r[s].y);if(s-=1,s<a)for(;s<a;s++)e.lineTo(r[s].x,r[s].y)},i._bezierCurve=function(e,r){if(r.length<=3){ot._path(e,r);return}var s,a;for(s=1,a=r.length;s+2<a;s+=3)e.bezierCurveTo(r[s].x,r[s].y,r[s+1].x,r[s+1].y,r[s+2].x,r[s+2].y);if(s<a)for(;s<a;s++)e.lineTo(r[s].x,r[s].y)},i._getCurveArrowPoints=function(e,r,s,a,h,l){var c=r.length,u;for(u=l;u<c;u+=l){var f=this._getArrowShape(r[u-1],r[u],s,a,h);f&&e.push(f)}if(u-=l,u<c-1)for(u+=1;u<c;u++){var d=this._getArrowShape(r[u-1],r[u],s,a,h);d&&e.push(d)}},t}(fe);Xo.mergeOptions(UT);var VT={arcDegree:90},Yh=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"ArcCurve"}},i._paintOn=function(e,r,s){e.beginPath(),this._arc(e,r,s),ot._stroke(e,s),this._paintArrow(e,r,s)},t.fromJSON=function(e){var r=e.feature,s=new t(r.geometry.coordinates,e.options);return s.setProperties(r.properties),s},t}(Xo);Yh.registerJSONType("ArcCurve");Yh.mergeOptions(VT);var s_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}t.fromJSON=function(e){var r=e.feature,s=new t(r.geometry.coordinates,e.options);return s.setProperties(r.properties),s};var i=t.prototype;return i._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"CubicBezierCurve"}},i._paintOn=function(e,r,s){e.beginPath(),e.moveTo(r[0].x,r[0].y),this._bezierCurve(e,r),ot._stroke(e,s),this._paintArrow(e,r,s)},i._getArrowPoints=function(e,r,s,a,h){return this._getCurveArrowPoints(e,r,s,a,h,3)},t}(Xo);s_.registerJSONType("CubicBezierCurve");var o_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}t.fromJSON=function(e){var r=e.feature,s=new t(r.geometry.coordinates,e.options);return s.setProperties(r.properties),s};var i=t.prototype;return i._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"QuadBezierCurve"}},i._paintOn=function(e,r,s){e.beginPath(),e.moveTo(r[0].x,r[0].y),this._quadraticCurve(e,r,s),ot._stroke(e,s),this._paintArrow(e,r,s)},i._getArrowPoints=function(e,r,s,a,h){return this._getCurveArrowPoints(e,r,s,a,h,2)},t}(Xo);o_.registerJSONType("QuadBezierCurve");var WT={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:`
`,textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},jT={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},bf=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.getContent=function(){return this._content},i.setContent=function(e){var r=this._content;return this._content=Wh(e),this._refresh(),this._fireEvent("contentchange",{old:r,new:e}),this},i.onAdd=function(){this._refresh()},i.toJSON=function(){var e=o.prototype.toJSON.call(this);return delete e.symbol,e},i.setSymbol=function(e){if(this._refreshing||!e)return o.prototype.setSymbol.call(this,e);var r=this._parseSymbol(e);if(this.setTextStyle){var s=this.getTextStyle()||{};s.symbol=r[0],this.setTextStyle(s)}else this.setTextSymbol&&this.setTextSymbol(r[0]);if(this.setBoxStyle){var a=this.getBoxStyle()||{};a.symbol=r[1],this.setBoxStyle(a)}else this.setBoxSymbol&&this.setBoxSymbol(r[1]);return this},i._parseSymbol=function(e){var r={},s={};for(var a in e)Is(e,a)&&(a.indexOf("text")===0?r[a]=e[a]:s[a]=e[a]);return[r,s]},i._getTextSize=function(e){return rf(this._content,e).size},i._getInternalSymbol=function(){return this._symbol},i._getDefaultTextSymbol=function(){return dt({},WT)},i._getDefaultBoxSymbol=function(){return dt({},jT)},i._getDefaultPadding=function(){return[12,8]},t}(Ce),ZT={textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null},Eh=function(o){ht(t,o);function t(n,e,r,s,a){var h;return a===void 0&&(a={}),h=o.call(this,e,a)||this,h._content=Wh(n),h._width=H(r)?100:r,h._height=H(s)?40:s,a.boxSymbol&&h.setBoxSymbol(a.boxSymbol),a.textStyle&&h.setTextStyle(a.textStyle),h._refresh(),h}var i=t.prototype;return i.getWidth=function(){return this._width},i.setWidth=function(e){return this._width=e,this._refresh(),this},i.getHeight=function(){return this._height},i.setHeight=function(e){return this._height=e,this._refresh(),this},i.getBoxSymbol=function(){return dt({},this.options.boxSymbol)},i.setBoxSymbol=function(e){return this.options.boxSymbol=e&&dt({},e),this.getSymbol()&&this._refresh(),this},i.getTextStyle=function(){return this.options.textStyle?dt({},this.options.textStyle):null},i.setTextStyle=function(e){return this.options.textStyle=e&&dt({},e),this.getSymbol()&&this._refresh(),this},t.fromJSON=function(e){var r=e.feature,s=new t(e.content,r.geometry.coordinates,e.width,e.height,e.options);return s.setProperties(r.properties),s.setId(r.id),e.symbol&&s.setSymbol(e.symbol),s},i._toJSON=function(e){return{feature:this.toGeoJSON(e),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},i._refresh=function(){var e=this.getTextStyle()||{},r=e.padding||[12,8],s=this._width-2*r[0],a=this._height-2*r[1],h=dt({},e.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:s,textMaxHeight:a});e.wrap&&!h.textWrapWidth&&(h.textWrapWidth=s);var l=e.horizontalAlignment;h.textDx=h.markerDx||0;var c=h.markerWidth/2-r[0];l==="left"?(h.textHorizontalAlignment="right",h.textDx=h.textDx-c):l==="right"&&(h.textHorizontalAlignment="left",h.textDx=h.textDx+c);var u=e.verticalAlignment;h.textDy=h.markerDy||0;var f=h.markerHeight/2-r[1];u==="top"?(h.textVerticalAlignment="bottom",h.textDy-=f):u==="bottom"&&(h.textVerticalAlignment="top",h.textDy+=f),this._refreshing=!0,this.updateSymbol(h),delete this._refreshing},t}(bf);Eh.mergeOptions(ZT);Eh.registerJSONType("TextBox");var XT={boxStyle:null,textSymbol:null},ys=function(o){ht(t,o);function t(n,e,r){var s;return r===void 0&&(r={}),s=o.call(this,e,r)||this,r.textSymbol&&s.setTextSymbol(r.textSymbol),r.boxStyle&&s.setBoxStyle(r.boxStyle),s._content=Wh(n),s._refresh(),s}var i=t.prototype;return i.getBoxStyle=function(){return this.options.boxStyle?dt({},this.options.boxStyle):null},i.setBoxStyle=function(e){return this.options.boxStyle=e&&dt({},e),this._refresh(),this},i.getTextSymbol=function(){return dt({},this._getDefaultTextSymbol(),this.options.textSymbol)},i.setTextSymbol=function(e){return this.options.textSymbol=e&&dt({},e),this._refresh(),this},t.fromJSON=function(e){var r=e.feature,s=new t(e.content,r.geometry.coordinates,e.options);return s.setProperties(r.properties),s.setId(r.id),e.symbol&&s.setSymbol(e.symbol),s},i._canEdit=function(){return!1},i._toJSON=function(e){return{feature:this.toGeoJSON(e),subType:"Label",content:this._content}},i._refresh=function(){var e=dt({},this.getTextSymbol(),{textName:this._content}),r=this.getBoxStyle();if(r){dt(e,r.symbol);var s=this._getBoxSize(e),a=s[1],h=r.padding||this._getDefaultPadding(),l=s[0];e.markerWidth=l.width,e.markerHeight=l.height;var c=e.textDx||0,u=e.textDy||0,f=Hn(a,e.textHorizontalAlignment,e.textVerticalAlignment)._add(c,u),d=r.horizontalAlignment||"middle";e.markerDx=f.x,d==="left"?e.markerDx+=e.markerWidth/2-h[0]:d==="right"?e.markerDx-=e.markerWidth/2-a.width-h[0]:e.markerDx+=a.width/2;var p=r.verticalAlignment||"middle";e.markerDy=f.y,p==="top"?e.markerDy+=e.markerHeight/2-h[1]:p==="bottom"?e.markerDy-=e.markerHeight/2-a.height-h[1]:e.markerDy+=a.height/2}this._refreshing=!0,this.updateSymbol(e),delete this._refreshing},i._getBoxSize=function(e){e.markerType||(e.markerType="square");var r=this.getBoxStyle(),s=this._getTextSize(e),a,h,l=r.padding||this._getDefaultPadding();return a=s.width+l[0]*2,h=s.height+l[1]*2,r.minWidth&&(!a||a<r.minWidth)&&(a=r.minWidth),r.minHeight&&(!h||h<r.minHeight)&&(h=r.minHeight),[new Pe(a,h),s]},t}(bf);ys.mergeOptions(XT);ys.registerJSONType("Label");var a_=function(t){return function(i){ht(n,i);function n(){return i.apply(this,arguments)||this}n._hasConnectors=function(s){return!H(s.__connectors)&&s.__connectors.length>0},n._getConnectors=function(s){return s.__connectors};var e=n.prototype;return e.getConnectSource=function(){return this._connSource},e.setConnectSource=function(s){var a=this._connTarget;return this.onRemove(),this._connSource=s,this._connTarget=a,this.onAdd(),this},e.getConnectTarget=function(){return this._connTarget},e.setConnectTarget=function(s){var a=this._connSource;return this.onRemove(),this._connSource=a,this._connTarget=s,this._updateCoordinates(),this._registerEvents(),this},e._updateCoordinates=function(){var s=this.getMap();if(!s&&this._connSource&&(s=this._connSource.getMap()),!s&&this._connTarget&&(s=this._connTarget.getMap()),!!s&&!(!this._connSource||!this._connTarget)){for(var a=this._connSource._getConnectPoints(),h=this._connTarget._getConnectPoints(),l=0,c=this.getCoordinates(),u,f,d=0,p=a.length;d<p;d++)for(var g=a[d],m=0,v=h.length;m<v;m++){var x=h[m],_=s.computeLength(g,x);d===0&&m===0?(u=g,f=x,l=_):_<l&&(u=g,f=x)}(!ee(c)||!c[0].equals(u)||!c[1].equals(f))&&this.setCoordinates([u,f])}},e.onAdd=function(){this._registerEvents(),this._updateCoordinates()},e.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&dh(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(dh(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof Jt)||!(this._connTarget instanceof Jt)){var s=this.getMap();s&&s.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},e._showConnect=function(){!this._connSource||!this._connTarget||this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},e._registerEvents=function(){if(!(!this._connSource||!this._connTarget)){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var s=this.options.showOn;if(this.hide(),s==="moving"?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):s==="click"?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):s==="mouseover"?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof Jt)||!(this._connTarget instanceof Jt)){var a=this.getMap();a&&a.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},n}(t)},h_={showOn:"always"},Ah=function(o){ht(t,o);function t(i,n,e){var r;return r=o.call(this,null,e)||this,arguments.length===1&&(e=i,i=null,n=null),r._connSource=i,r._connTarget=n,r}return t}(a_(fe));Ah.mergeOptions(h_);Ah.registerJSONType("ConnectorLine");var l_=function(o){ht(t,o);function t(i,n,e){var r;return r=o.call(this,null,e)||this,arguments.length===1&&(e=i,i=null,n=null),r._connSource=i,r._connTarget=n,r}return t}(a_(Yh));l_.mergeOptions(h_);l_.registerJSONType("ArcConnectorLine");var $T={drawImmediate:!1},c_=function(o){ht(t,o);function t(n,e,r){var s;e&&!(e instanceof Jt)&&!Array.isArray(e)&&BS.indexOf(e.type)<0&&(r=e,e=null),s=o.call(this,n,r)||this,s._maxZIndex=0,s._minZIndex=0,s._initCache(),e&&s.addGeometry(e);var a=s.options.style;return a&&s.setStyle(a),s}var i=t.prototype;return i.getGeometryById=function(e){return H(e)||e===""||!this._geoMap[e]?null:this._geoMap[e]},i.getGeometries=function(e,r){if(!e)return this._geoList.slice(0);for(var s=[],a,h,l=0,c=this._geoList.length;l<c;l++)a=this._geoList[l],r?h=e.call(r,a):h=e(a),h&&s.push(a);return s},i.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},i.getLastGeometry=function(){var e=this._geoList.length;return e===0?null:this._geoList[e-1]},i.getCount=function(){return this._geoList.length},i.getExtent=function(){if(this.getCount()===0)return null;var e=new oe(this.getProjection());return this.forEach(function(r){e._combine(r.getExtent())}),e},i.forEach=function(e,r){for(var s=this._geoList.slice(0),a=0,h=s.length;a<h;a++)r?e.call(r,s[a],a):e(s[a],a);return this},i.filter=function(e,r){var s=[],a=ne(e),h=a?e:Ku(e);return this.forEach(function(l){var c=a?l:uu(l);(r?h.call(r,c):h(c))&&s.push(l)},this),s},i.isEmpty=function(){return!this._geoList.length},i.addGeometry=function(e,r){if(!e)return this;if(e.type==="FeatureCollection")return this.addGeometry(An.toGeometry(e),r);if(Array.isArray(e)){if(e.length===0)return this}else{var s=arguments.length,a=arguments[s-1];return e=Array.prototype.slice.call(arguments,0,s-1),r=a,a&&yi(a)&&("type"in a||a instanceof Jt)&&(e.push(a),r=!1),this.addGeometry(e,r)}this._initCache();var h;r&&(h=new oe),this._toSort=this._maxZIndex>0;for(var l=[],c=0,u=e.length;c<u;c++){var f=e[c];if(!f)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+c);if(!(f instanceof Jt)&&(f=Jt.fromJSON(f),Array.isArray(f)))for(var d=0,p=f.length;d<p;d++)this._add(f[d],h,c),l.push(f[d]);Array.isArray(f)||(this._add(f,h,c),l.push(f))}var g=this.getMap();if(g&&(this._getRenderer().onGeometryAdd(l),h&&!H(h.xmin))){var m=h.getCenter(),v=g.getFitZoom(h);if(yi(r)){var x=ne(r.step)?r.step:function(){};g.animateTo({center:m,zoom:v},dt({duration:g.options.zoomAnimationDuration,easing:"out"},r),x)}else r===!0&&g.setCenterAndZoom(m,v)}return this.fire("addgeo",{geometries:e}),this},i.getGeoMinZIndex=function(){return this._minZIndex},i.getGeoMaxZIndex=function(){return this._maxZIndex},i._add=function(e,r,s){this._toSort||(this._toSort=e.getZIndex()!==0),this._updateZIndex(e.getZIndex());var a=e.getId();if(!H(a)){if(!H(this._geoMap[a]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+a+", at index:"+s);this._geoMap[a]=e}var h=Xn();e._setInternalId(h),this._geoList.push(e),this.onAddGeometry(e),e._bindLayer(this),e.onAdd&&e.onAdd(),r&&r._combine(e.getExtent()),e._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(e)},i.removeGeometry=function(e){if(!Array.isArray(e))return this.removeGeometry([e]);for(var r=e.length-1;r>=0;r--)e[r]instanceof Jt||(e[r]=this.getGeometryById(e[r])),!(!e[r]||this!==e[r].getLayer())&&e[r].remove();return this.fire("removegeo",{geometries:e}),this},i.clear=function(){this._clearing=!0,this.forEach(function(s){s.remove()}),this._geoMap={};var e=this._geoList;this._geoList=[];var r=this._getRenderer();return r&&(r.onGeometryRemove(e),r.clearImageData&&r.clearImageData()),this._clearing=!1,this.fire("clear"),this},i.onRemoveGeometry=function(e){if(!(!e||this._clearing)&&this===e.getLayer()){var r=e._getInternalId();if(!H(r)){var s=e.getId();H(s)||delete this._geoMap[s];var a=this._findInList(e);a>=0&&this._geoList.splice(a,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([e])}}},i.getStyle=function(){return this.options.style?this.options.style:null},i.setStyle=function(e){return this.options.style=e,e=dv(e),this._cookedStyles=hv(e),this.forEach(function(r){this._styleGeometry(r)},this),this.fire("setstyle",{style:e}),this},i._styleGeometry=function(e){if(!this._cookedStyles)return!1;for(var r=uu(e),s=0,a=this._cookedStyles.length;s<a;s++)if(this._cookedStyles[s].filter(r)===!0)return e._setExternSymbol(this._cookedStyles[s].symbol),!0;return!1},i.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach(function(e){e._setExternSymbol(null)},this),this.fire("removestyle"),this):this},i.onAddGeometry=function(e){var r=this.getStyle();r&&this._styleGeometry(e)},i.hide=function(){for(var e=0,r=this._geoList.length;e<r;e++)this._geoList[e].onHide();return Je.prototype.hide.call(this)},i._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},i._updateZIndex=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,r)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,r))},i._sortGeometries=function(){var e=this;!this._toSort||(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort(function(r,s){return e._updateZIndex(r.getZIndex(),s.getZIndex()),e._compare(r,s)}),this._toSort=!1)},i._compare=function(e,r){return e.getZIndex()===r.getZIndex()?e._getInternalId()-r._getInternalId():e.getZIndex()-r.getZIndex()},i._findInList=function(e){var r=this._geoList.length;if(r===0)return-1;this._sortGeometries();for(var s=0,a=r-1,h;s<=a;){if(h=Math.floor((s+a)/2),this._geoList[h]===e)return h;this._compare(this._geoList[h],e)>0?a=h-1:s=h+1}return-1},i._onGeometryEvent=function(e){if(!(!e||!e.target)){var r=e.type;r==="idchange"?this._onGeometryIdChange(e):r==="zindexchange"?this._onGeometryZIndexChange(e):r==="positionchange"?this._onGeometryPositionChange(e):r==="shapechange"?this._onGeometryShapeChange(e):r==="symbolchange"?this._onGeometrySymbolChange(e):r==="show"?this._onGeometryShow(e):r==="hide"?this._onGeometryHide(e):r==="propertieschange"&&this._onGeometryPropertiesChange(e)}},i._onGeometryIdChange=function(e){if(!(e.new===e.old&&this._geoMap[e.old]&&this._geoMap[e.old]===e.target)){if(!H(e.new)){if(this._geoMap[e.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+e.new);this._geoMap[e.new]=e.target}!H(e.old)&&e.new!==e.old&&delete this._geoMap[e.old]}},i._onGeometryZIndexChange=function(e){e.old!==e.new&&(this._updateZIndex(e.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(e))},i._onGeometryPositionChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(e)},i._onGeometryShapeChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(e)},i._onGeometrySymbolChange=function(e){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(e)},i._onGeometryShow=function(e){this._getRenderer()&&this._getRenderer().onGeometryShow(e)},i._onGeometryHide=function(e){this._getRenderer()&&this._getRenderer().onGeometryHide(e)},i._onGeometryPropertiesChange=function(e){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(e)},t}(Je);c_.mergeOptions($T);var qT=new Vt,JT={debug:!1,enableSimplify:!0,geometryEvents:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:jt.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,geometryEventTolerance:1},Bi=function(o){ht(t,o);function t(n,e,r){return o.call(this,n,e,r)||this}var i=t.prototype;return i.onConfig=function(e){if(o.prototype.onConfig.call(this,e),e.enableAltitude||e.drawAltitude||e.altitudeProperty){var r=this.getRenderer();r&&r.setToRedraw&&r.setToRedraw()}},i.identify=function(e,r){r===void 0&&(r={});var s=this.getRenderer();e instanceof q||(e=new q(e));var a=this.getMap().coordToContainerPoint(e);return r.onlyVisible&&s&&s.identifyAtPoint?s.identifyAtPoint(a,r):this._hitGeos(this._geoList,a,r)},i.identifyAtPoint=function(e,r){r===void 0&&(r={});var s=this.getRenderer();return e instanceof W||(e=new W(e)),r.onlyVisible&&s&&s.identifyAtPoint?s.identifyAtPoint(e,r):this._hitGeos(this._geoList,e,r)},i._hitGeos=function(e,r,s){s===void 0&&(s={});var a=s.filter,h=[],l=s.tolerance,c=this.getMap(),u=this.getRenderer(),f=u&&u.getImageData&&u.getImageData();if(f){for(var d=0,p=e.length-1;p>=0;p--){var g=e[p]._hitTestTolerance()+(l||0);g>d&&(d=g)}var m=c.getDevicePixelRatio();f.r=m;for(var v=!1,x=r.x-d,_=r.y-d,y=-d;y<=d;y++){for(var b=-d;b<=d;b++){var M=Math.round((x+y)*m),C=Math.round((_+b)*m),w=C*f.width*4+M*4;if(f.data[w+3]>0){v=!0;break}}if(v)break}if(!v)return h}for(var S=e.length-1;S>=0;S--){var P=e[S];if(!(!P||!P.isVisible()||!P._getPainter()||!P.options.interactive)){if(!(P instanceof fe)||!P._getArrowStyle()&&!(P instanceof Xo)){var O=P.getContainerExtent(qT);if(l&&(O=O._expand(l)),!O||!O.contains(r))continue}if(P._containsPoint(r,l)&&(!a||a(P))&&(h.push(P),s.count&&h.length>=s.count))break}}return h},i.getAltitude=function(){return this.options.altitude||0},i.toJSON=function(e){e||(e={});var r={type:this.getJSONType(),id:this.getId(),options:this.config()};if(H(e.geometries)||e.geometries){var s;if(e.clipExtent){var a=this.getMap(),h=a?a.getProjection():null;s=new oe(e.clipExtent,h)}for(var l=[],c=this.getGeometries(),u=0,f=c.length;u<f;u++){var d=c[u],p=d.getExtent();if(!(!p||s&&!s.intersects(p))){var g=d.toJSON(e.geometries);l.push(g)}}r.geometries=l}return r},t.fromJSON=function(e){if(!e||e.type!=="VectorLayer")return null;for(var r=new t(e.id,e.options),s=e.geometries,a=[],h=0;h<s.length;h++){var l=Jt.fromJSON(s[h]);l&&a.push(l)}return r.addGeometry(a),r},t.getPainterClass=function(){return xf},t.getCollectionPainterClass=function(){return t_},t}(c_);Bi.mergeOptions(JT);Bi.registerJSONType("VectorLayer");var Ga="_map_tool",fg=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.addTo=function(e){return e?(this._map=e,e[Ga]&&e[Ga].disable(),this.onAdd&&this.onAdd(),this.enable(),e[Ga]=this,this._fireEvent("add"),this):this},i.getMap=function(){return this._map},i.enable=function(){var e=this._map;return!e||this._enabled?this:(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable"),this)},i.disable=function(){return!this._enabled||!this._map?this:(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this)},i.isEnabled=function(){return!!this._enabled},i.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[Ga],delete this._map),this._fireEvent("remove"),this):this},i._registerEvents=function(){this._switchEvents("on")},i._switchEvents=function(e){var r=this.getEvents();r&&this._map[e](r,this)},i._fireEvent=function(e,r){r||(r={}),this.fire(e,r)},t}(Ui(wi)),YT={symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1},dg={},We=function(o){ht(t,o),t.registerMode=function(e,r){dg[e.toLowerCase()]=r},t.getRegisterMode=function(e){return dg[e.toLowerCase()]};function t(n){var e;return e=o.call(this,n)||this,e._checkMode(),e._events={click:e._clickHandler,"mousemove touchmove":e._mouseMoveHandler,dblclick:e._doubleClickHandler,"mousedown touchstart":e._mouseDownHandler,"mouseup touchend":e._mouseUpHandler,mousemove:e._mouseMoveHandler,mousedown:e._mouseDownHandler,mouseup:e._mouseUpHandler},e}var i=t.prototype;return i.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},i.setMode=function(e){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=e,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},i.getSymbol=function(){var e=this.options.symbol;return Ai(e||this.options.symbol)},i.setSymbol=function(e){return e?(this.options.symbol=e,this._geometry&&this._geometry.setSymbol(e),this):this},i.getCurrentGeometry=function(){return this._geometry},i.onAdd=function(){this._checkMode()},i.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var e=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=e.options.autoPanAtEdge,this._mapAutoPanAtEdge||e.config({autoPanAtEdge:!0})),this._geometryEvents=e.options.geometryEvents,this.options.blockGeometryEvents&&e.config("geometryEvents",!1),this},i.onDisable=function(){var e=this.getMap();return this._restoreMapCfg(),this.endDraw(),this._map&&(e.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||e.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&e.config("geometryEvents",this._geometryEvents),this},i.undo=function(){var e=this._getRegisterMode(),r=e.action;if(!this._shouldRecordHistory(r)||!this._historyPointer)return this;var s=this._clickCoords.slice(0,--this._historyPointer);return e.update(this.getMap().getProjection(),s,this._geometry),this},i.redo=function(){var e=this._getRegisterMode(),r=e.action;if(!this._shouldRecordHistory(r)||H(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var s=this._clickCoords.slice(0,++this._historyPointer);return e.update(this.getMap().getProjection(),s,this._geometry),this},i._shouldRecordHistory=function(e){return Array.isArray(e)&&e[0]==="click"&&e[1]==="mousemove"&&e[2]==="dblclick"},i._checkMode=function(){this._getRegisterMode()},i._saveMapCfg=function(){var e=this.getMap();this._mapDoubleClickZoom=e.options.doubleClickZoom,e.config({doubleClickZoom:this.options.doubleClickZoom});for(var r=this._getRegisterMode().action,s=!1,a=0;a<r.length;a++)if(r[a].indexOf("mousedown")>=0||r[a].indexOf("touchstart")>=0){s=!0;break}if(s){var h=this.getMap();this._mapDraggable=h.options.draggable,h.config({draggable:!1})}},i._restoreMapCfg=function(){var e=this.getMap();e.config({doubleClickZoom:this._mapDoubleClickZoom}),H(this._mapDraggable)||e.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},i._loadResources=function(){var e=this.getSymbol(),r=Wo(e);r.length>0&&this._drawToolLayer._getRenderer().loadResources(r)},i._getProjection=function(){return this._map.getProjection()},i._getRegisterMode=function(){var e=this.getMode(),r=t.getRegisterMode(e);if(!r)throw new Error(e+" is not a valid mode of DrawTool.");return r},i.getEvents=function(){var e=this._getRegisterMode().action,r={};if(Array.isArray(e)){for(var s=0;s<e.length;s++)r[e[s]]=this._events[e[s]];return r}return null},i._mouseDownHandler=function(e){this._createGeometry(e)},i._mouseUpHandler=function(e){this.endDraw(e)},i._clickHandler=function(e){var r=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var s=this._clickCoords.length,a=this.getMap()._pointToPrj(e.point2d);if(this._clickCoords[s-1].equals(a))return}if(!this._geometry)this._createGeometry(e);else{var h=this.getMap()._pointToPrj(e.point2d),l=this._geometry.snapTo;if(l&&ne(l)){var c=this._geometry.snapTo(e.containerPoint)||e.containerPoint;h=this.getMap()._containerPointToPrj(c)}if(H(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer)),this._clickCoords.push(h),this._historyPointer=this._clickCoords.length,e.drawTool=this,r.update(this.getMap().getProjection(),this._clickCoords,this._geometry,e),this.getMode()==="point"){this.endDraw(e);return}this._clickCoords.length<=1?this._fireEvent("drawstart",e):this._fireEvent("drawvertex",e),r.clickLimit&&r.clickLimit===this._historyPointer&&this.endDraw(e)}},i._createGeometry=function(e){var r=this.getMode(),s=this._getRegisterMode(),a=this.getMap()._pointToPrj(e.point2d),h=this.getSymbol();this._geometry||(this._clickCoords=[a],e.drawTool=this,this._geometry=s.create(this.getMap().getProjection(),this._clickCoords,e),h&&r!=="point"?this._geometry.setSymbol(h):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",e)),r==="point"&&e.type!=="mousemove"&&this.endDraw(e)},i._mouseMoveHandler=function(e){var r=this.getMap();if(!(!r||r.isInteracting())){if(this.getMode()==="point"&&!this._geometry){this._createGeometry(e);return}if(!!this._geometry){var s=this._getMouseContainerPoint(e);if(!!this._isValidContainerPoint(s)){var a=this.getMap()._pointToPrj(e.point2d);this._geometry.snapTo&&(s=this._geometry.snapTo(s)||s,a=r._containerPointToPrj(s));var h=r.getProjection();e.drawTool=this;var l=this._getRegisterMode();if(this._shouldRecordHistory(l.action)){var c=this._clickCoords.slice(0,this._historyPointer);if(c&&c.length>0&&a.equals(c[c.length-1]))return;l.update(h,c.concat([a]),this._geometry,e)}else l.update(h,a,this._geometry,e);this._fireEvent("mousemove",e)}}}},i._doubleClickHandler=function(e){if(!!this._geometry){var r=this._getMouseContainerPoint(e);if(!!this._isValidContainerPoint(r)){var s=this._getRegisterMode(),a=this._clickCoords;if(!(a.length<2)){var h=this.getMode();if(!(h&&h.indexOf("polygon")>-1&&a.length<3)){for(var l=this.getMap().getProjection(),c=[a[0]],u=1,f=a.length;u<f;u++)(a[u].x!==a[u-1].x||a[u].y!==a[u-1].y)&&c.push(a[u]);c.length<2||this._geometry&&this._geometry instanceof ie&&c.length<3||(e.drawTool=this,s.update(l,c,this._geometry,e),this.endDraw(e))}}}}},i._addGeometryToStage=function(e){var r=this._getDrawLayer();r.addGeometry(e)},i.endDraw=function(e){if(!this._geometry||this._ending)return this;this._ending=!0;var r=this._geometry;return this._clearStage(),e=e||{},this._geometry=r,this._fireEvent("drawend",e),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},i._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},i._getMouseContainerPoint=function(e){var r=this._getRegisterMode().action;return(r[0].indexOf("mousedown")>=0||r[0].indexOf("touchstart")>=0)&&ni(e.domEvent),e.containerPoint},i._isValidContainerPoint=function(e){var r=this._map.getSize(),s=r.width,a=r.height;return e.x<0||e.y<0?!1:!(e.x>s||e.y>a)},i._getDrawLayer=function(){var e=Vo+"drawtool",r=this._map.getLayer(e);return r||(r=new Bi(e,{enableSimplify:!1,enableAltitude:this.options.enableAltitude}),this._map.addLayer(r)),r},i._fireEvent=function(e,r){r||(r={}),r=dt({},r),this._geometry&&(r.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),r.tempGeometry=this._geometry),fg.prototype._fireEvent.call(this,e,r)},t}(fg);We.mergeOptions(YT);var QT=function(o){ht(t,o);function t(n){var e;return e=o.call(this,n)||this,e.drawTool=new We({mode:"boxZoom",ignoreMouseleave:!1}),e}var i=t.prototype;return i.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},i.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},i._onMouseDown=function(e){!this.target.options.boxZoom||e.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},i._boxZoom=function(e){var r=this.target;this.drawTool.remove();var s=e.geometry,a=s.getCenter(),h=s.getSymbol(),l=h.markerWidth,c=h.markerHeight,u=new oe(a,r.locateByPoint(a,l,c),r.getProjection()),f=r.getFitZoom(u);r._animateTo({center:u.getCenter(),zoom:f})},t}(Li);Bt.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}});Bt.addOnLoadHook("addHandler","boxZoom",QT);var Mn=30,KT=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.addHooks=function(){!this.target||this.target.on("_mousemove",this._onMouseMove,this)},i.removeHooks=function(){!this.target||this.target.off("_mousemove",this._onMouseMove,this)},i._onMouseMove=function(e){var r=this.target;if(r.options.autoPanAtEdge){var s=e.containerPoint,a=r.getContainerExtent();if(a){var h=s.x,l=s.y,c=a.xmax,u=a.ymax,f;h<Mn&&(f=[Math.abs(h-Mn),0]),l<Mn&&(f=[0,Math.abs(l-Mn)]),h+Mn>c&&(f=[-Math.abs(h+Mn-c),0]),l+Mn>u&&(f=[0,-Math.abs(l+Mn-u)]),f&&r.panBy(f,{duration:1})}}},t}(Li);Bt.mergeOptions({autoPanAtEdge:!1});Bt.addOnLoadHook("addHandler","autoPanAtEdge",KT);Bt.include({animateTo:function(t,i,n){var e=this;i===void 0&&(i={}),ne(i)&&(n=i,i={});var r=this.getProjection(),s=this.getView(),a={},h=!0;for(var l in t)if(Is(t,l)&&!H(t[l])&&(l==="prjCenter"||!H(s[l])))if(h=!1,l==="center"){var c=new q(s[l]),u=new q(t[l]);c.equals(u)||(a.center=[c,u])}else if(l==="prjCenter"){var f=new q(this._getPrjCenter()),d=new q(t[l]);f.equals(d)||(a.prjCenter=[f,d])}else s[l]!==t[l]&&l!=="around"&&(a[l]=[s[l],t[l]]);if(h)return null;this._animPlayer&&(this._isInternalAnimation?this._animPlayer.playState==="running"&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var p=t.around||new W(this.width/2,this.height/2),g=this._getRenderer(),m=function(_){g.callInNextFrame(_)},v=this._animPlayer=Ue.animate(a,{easing:i.easing||"out",duration:i.duration||this.options.zoomAnimationDuration,framer:m,repeat:i.repeat},function(x){if(e.isRemoved()){v.finish();return}if(v.playState==="running"){if(x.styles.center){var _=x.styles.center;e._setPrjCenter(r.project(_)),e.onMoving(e._parseEventFromCoord(e.getCenter()))}else if(x.styles.prjCenter){var y=x.styles.prjCenter;e._setPrjCenter(y),e.onMoving(e._parseEventFromCoord(e.getCenter()))}H(x.styles.zoom)||e.onZooming(x.styles.zoom,p),H(x.styles.pitch)||e._setPitch(x.styles.pitch),H(x.styles.bearing)||e._setBearing(x.styles.bearing),e._fireEvent("animating")}else(v.playState!=="paused"||v===e._mapAnimPlayer)&&(v._interupted||(a.center?e._setPrjCenter(r.project(a.center[1])):a.prjCenter&&e._setPrjCenter(a.prjCenter[1]),H(a.pitch)||e._setPitch(a.pitch[1]),H(a.bearing)||e._setBearing(a.bearing[1])),e._endAnim(v,a,p,i));n&&n(x)},this);return this._startAnim(a,p),v},_animateTo:function(t,i,n){return i===void 0&&(i={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(t,i,n),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(t,i,n){var e=this;i===void 0&&(i={}),this._animPlayer&&(this._isInternalAnimation?this._animPlayer.playState==="running"&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),ne(i)&&(n=i,i={}),i=dt({curve:1.42},i);var r=this;function s(st,V){return r.getResolution(V)/r.getResolution(st)}var a=t.around||new W(this.width/2,this.height/2),h=this.getMinZoom(),l=this.getMaxZoom(),c=this.getProjection(),u=this.getView(),f=u.zoom,d=u.bearing,p=u.pitch,g="zoom"in t?gh(+t.zoom,h,l):f,m="bearing"in t?+t.bearing:d,v="pitch"in t?+t.pitch:p,x=c.project(t.center&&new q(t.center)||this.getCenter()),_=s(g,f),y=c.project(this.getCenter()),b=x.sub(y),M=i.curve,C=Math.max(this.width,this.height),w=C/_,S=b.mag();if("minZoom"in i){var P=gh(Math.min(i.minZoom,f,g),h,l),O=C/s(P,f);M=Math.sqrt(O/S*2)}var D=M*M;function L(st){var V=(w*w-C*C+(st?-1:1)*D*D*S*S)/(2*(st?w:C)*D*S);return Math.log(Math.sqrt(V*V+1)-V)}function T(st){return(Math.exp(st)-Math.exp(-st))/2}function A(st){return(Math.exp(st)+Math.exp(-st))/2}function N(st){return T(st)/A(st)}var B=L(0),F=function(V){return A(B)/A(B+M*V)},I=function(V){return C*((A(B)*N(B+M*V)-T(B))/D)/S},z=(L(1)-B)/M;if(Math.abs(S)<1e-6||!isFinite(z)){if(Math.abs(C-w)<1e-6)return this.animateTo(t,i,n);var Z=w<C?-1:1;z=Math.abs(Math.log(w/C))/M,I=function(){return 0},F=function(V){return Math.exp(Z*M*V)}}var j=this._getRenderer(),K=function(V){j.callInNextFrame(V)},et=this._animPlayer=Ue.animate({k:[0,1]},{easing:i.easing||"out",duration:i.duration||8,framer:K},function(st){if(e.isRemoved()){et.finish();return}var V=st.styles.k,pt=V*z,xt=1/F(pt),ut={};if(t.center){var ft=V===1?x:y.add(b.multi(I(pt)));ut.prjCenter=[x,ft]}if(f!==g){var kt=V===1?g:e.getZoomForScale(xt,f,!0);ut.zoom=[f,kt]}if(p!==v){var J=pg(p,v,V);ut.pitch=[v,J]}if(d!==m){var Q=pg(d,m,V);ut.bearing=[m,Q]}if(et.playState==="running"){if(ut.prjCenter){var lt=ut.prjCenter;e._setPrjCenter(lt[1]),e.onMoving(e._parseEventFromCoord(e.getCenter()))}ut.zoom&&e.onZooming(ut.zoom[1],a),ut.pitch&&e._setPitch(ut.pitch[1]),ut.bearing&&e._setBearing(ut.bearing[1]),e._fireEvent("animating")}else(et.playState!=="paused"||et===e._mapAnimPlayer)&&(et._interupted||(ut.prjCenter&&e._setPrjCenter(ut.prjCenter[1]),ut.pitch&&e._setPitch(ut.pitch[1]),ut.bearing&&e._setBearing(ut.bearing[1])),e._endAnim(et,ut,a,i));n&&n(st)});return this._startAnim({center:t.center,zoom:t.zoom!==f,pitch:v!==p,bearing:m!==d},a),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,i,n,e){delete this._animRotating;var r=t._interupted?"animateinterrupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer,i.center){var s;t._interupted?s=this.getCenter():s=i.center[1],this.onMoveEnd(this._parseEventFromCoord(s))}else if(i.prjCenter){var a;t._interupted?a=this._getPrjCenter():a=i.prjCenter[1];var h=this._parseEventFromCoord(this.getProjection().unproject(a));h.point2d=this._prjToPoint(a),this.onMoveEnd(h)}H(i.zoom)||(t._interupted?this.onZoomEnd(this.getZoom(),n):e.wheelZoom?this.onZooming(i.zoom[1],n):this.onZoomEnd(i.zoom[1],n)),r&&this._fireEvent(r),!H(i.pitch)&&!this.getPitch()&&this.getRenderer().setToRedraw(),e.wheelZoom||this._resumePrev(t)},_startAnim:function(t,i){!this._animPlayer||(t.center&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],i),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){!t||(delete this._animRotating,t.playState!=="finished"&&(t._interupted=!0,t.cancel()),t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(t){if(!!this._prevAnimPlayer){var i=this._prevAnimPlayer;i.playState!=="paused"&&delete this._prevAnimPlayer,t!==i&&(this._animPlayer=i,i.play())}}});function pg(o,t,i){return o*(1-i)+t*i}var gg="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";Bt.include({_registerDomEvents:function(){var t=this._panels.mapWrapper||this._containerDOM;on(t,gg,this._handleDOMEvent,this)},_removeDomEvents:function(){var t=this._panels.mapWrapper||this._containerDOM;$n(t,gg,this._handleDOMEvent)},_handleDOMEvent:function(t){var i=this.options.clickTimeThreshold,n=t.type,e=n==="mousedown"||n==="touchstart"&&(!t.touches||t.touches.length===1);e&&(this._domMouseDownTime=me(),this._domMouseDownView=this.getView());var r=n==="contextmenu"&&tP(this);if(n==="contextmenu"){ai(t);var s=this._domMouseDownTime,a=me();a-s<=i&&!r&&this._fireDOMEvent(this,t,"dom:"+t.type)}else this._fireDOMEvent(this,t,"dom:"+t.type);if(!this._ignoreEvent(t)){var h=!1;if(e)this._mouseDownTime=me();else if(n==="click"||n==="touchend"||n==="contextmenu")if(this._mouseDownTime){var l=this._mouseDownTime;delete this._mouseDownTime;var c=me();if(c-l>i){if(n==="click"||n==="contextmenu")return}else if(n==="contextmenu"){if(r)return}else n==="touchend"&&(h=!0)}else return;var u;h&&(this._clickTime&&me()-this._clickTime<=i?(delete this._clickTime,u="dblclick",this._fireDOMEvent(this,t,"dom:dblclick")):(this._clickTime=me(),u="click",this._fireDOMEvent(this,t,"dom:click"))),!this._ignoreEvent(t)&&(this._fireDOMEvent(this,t,n),u&&this._fireDOMEvent(this,t,u))}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;if(this._isEventOutMap(t))return!0;var i=t.srcElement||t.target,n;if(i)for(;i&&i!==this._containerDOM;){if(i.className&&i.className.indexOf&&(i.className.indexOf("maptalks-control")>=0||i.className.indexOf("maptalks-ui")>=0&&n&&!n.eventsPropagation))return!0;n=i,i=i.parentNode}return!1},_isEventOutMap:function(t){if(this.getPitch()>this.options.maxVisualPitch){var i=this._getActualEvent(t),n=$e(i,this._containerDOM);if(!this.getContainerExtent().contains(n))return!0}return!1},_parseEvent:function(t,i){if(!t)return null;var n={domEvent:t};if(i!=="keypress"){var e=this._getActualEvent(t);if(e&&e.clientX!==void 0){var r=$e(e,this._containerDOM);n=dt(n,{containerPoint:r,viewPoint:this.containerPointToViewPoint(r)});var s=this.options.maxVisualPitch;(this.getPitch()<=s||r.y>=this.height-this._getVisualHeight(s))&&(n=dt(n,{coordinate:this.containerPointToCoord(r),point2d:this._containerPointToPoint(r)}))}}return n},_parseEventFromCoord:function(t){var i=this.coordToContainerPoint(t),n=this.containerPointToViewPoint(i),e={coordinate:t,containerPoint:i,viewPoint:n,point2d:this.coordToPoint(t)};return e},_getActualEvent:function(t){return t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t},_fireDOMEvent:function(t,i,n){if(!this.isRemoved()){var e=this._parseEvent(i,n);this._fireEvent(n,e)}},_getEventParams:function(t){var i=this,n={domEvent:t},e=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(e){var r=$e(e,i._containerDOM);n.coordinate=i.containerPointToCoordinate(r),n.containerPoint=r,n.viewPoint=i.containerPointToViewPoint(r),n.pont2d=i._containerPointToPoint(r)}return n}});Bt.addOnLoadHook("_registerDomEvents");function tP(o){if(!o._domMouseDownView)return!0;var t=o.getView(),i=o._domMouseDownView;return t.bearing!==i.bearing||t.pitch!==i.pitch}Bt.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullscreen)t.requestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var i="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45),n=window.open(location.href,"_blank",i);n!==null&&(window.opener=null,window.close())}},_cancelFullScreen:function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else{var t="fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes",i=window.open(location.href,"_blank",t);i!==null&&(window.opener=null,window.close())}}});Bt.include({panTo:function(t,i,n){if(i===void 0&&(i={}),!t)return this;if(ne(i)&&(n=i,i={}),t=new q(t),typeof i.animation>"u"||i.animation){var e=this.getProjection().project(t);return this._panAnimation(e,i.duration,n)}else this.setCenter(t);return this},_panTo:function(t,i){return i===void 0&&(i={}),typeof i.animation>"u"||i.animation?this._panAnimation(t,i.duration):(this.onMoveStart(),this._setPrjCenter(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(t,i,n){if(i===void 0&&(i={}),!t)return this;ne(i)&&(n=i,i={}),t=new W(t);var e=this.getContainerExtent(),r=e.ymin;if(r>0&&t.y>30){var s=t.y;t.y=30,t.x=t.x*30/s}if(this.onMoveStart(),typeof i.animation>"u"||i.animation){t=t.multi(-1);var a=this._containerPointToPrj(new W(this.width/2+t.x,this.height/2+t.y));this._panAnimation(a,i.duration,n)}else this._offsetCenterByPixel(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter()));return this},_panAnimation:function(t,i,n){return this._animateTo({prjCenter:t},{duration:i||this.options.panAnimationDuration},n)}});Jt.fromJSON=function(o){if(Array.isArray(o)){for(var t=[],i=0,n=o.length;i<n;i++){var e=Jt.fromJSON(o[i]);Array.isArray(o)?t=t.concat(e):t.push(e)}return t}if(o&&!o.feature)return An.toGeometry(o);var r;return o.subType?(r=Jt.getJSONClass(o.subType).fromJSON(o),H(o.feature.id)||r.setId(o.feature.id)):(r=An.toGeometry(o.feature),o.options&&r.config(o.options)),o.symbol&&r.setSymbol(o.symbol),o.infoWindow&&r.setInfoWindow(o.infoWindow),r};Je.fromJSON=function(o){if(!o)return null;var t=o.type,i=Je.getJSONClass(t);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+t);return i.fromJSON(o)};Bt.include({JSON_VERSION:"1.0",toJSON:function(t){t||(t={});var i={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};i.options=this.config(),i.options.center=this.getCenter(),i.options.zoom=this.getZoom(),i.options.bearing=this.getBearing(),i.options.pitch=this.getPitch();var n=this.getBaseLayer();(H(t.baseLayer)||t.baseLayer)&&n&&(i.baseLayer=n.toJSON(t.baseLayer));var e={};t.clipExtent&&(t.clipExtent===!0?e.clipExtent=this.getExtent():e.clipExtent=t.clipExtent);var r=[];if(H(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var s=this.getLayers(),a=0,h=s.length;a<h;a++)if(!!s[a].toJSON){var l=dt({},yi(t.layers)?t.layers:{},e);r.push(s[a].toJSON(l))}i.layers=r}else if(ee(t.layers)){for(var c=t.layers,u=0;u<c.length;u++){var f=c[u],d=this.getLayer(f.id);if(!!d.toJSON){var p=dt({},f.options,e);r.push(d.toJSON(p))}}i.layers=r}else i.layers=[];return i}});Bt.fromJSON=function(o,t,i){if(!o||!t)return null;i||(i={});var n=new Bt(o,t.options);if(H(i.baseLayer)||i.baseLayer){var e=Je.fromJSON(t.baseLayer);e&&n.setBaseLayer(e)}if(H(i.layers)||i.layers){for(var r=[],s=t.layers,a=0;a<s.length;a++){var h=Je.fromJSON(s[a]);r.push(h)}n.addLayer(r)}return n};Bt.include({computeLength:function(t,i){if(!this.getProjection())return null;var n=new q(t),e=new q(i);return n.equals(e)?0:this.getProjection().measureLength(n,e)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,i){t=t||{};var n=new q(t.coordinate);return this._identify(t,i,function(e){return e.identify(n,t)})},identifyAtPoint:function(t,i){t=t||{};var n=new W(t.containerPoint),e=this.containerPointToCoord(n);return this._identify(t,i,function(r){return r.identifyAtPoint?r.identifyAtPoint(n,t):e?r.identify(e,t):[]})},_identify:function(t,i,n){var e=t.layers;if(!ee(e))return this;for(var r=[],s=0,a=e.length;s<a;s++)Xt(e[s])?r.push(this.getLayer(e[s])):r.push(e[s]);for(var h=[],l=r.length-1;l>=0&&!(t.count&&h.length>=t.count);l--){var c=r[l];if(!(!c||!c.getMap()||!t.includeInvisible&&!c.isVisible()||!t.includeInternals&&c.getId().indexOf(Vo)>=0)){var u=n(c);u&&(Array.isArray(u)?Ar(h,u):h.push(u))}}return i.call(this,h),this}});Bt.include({_zoom:function(t,i){!this.options.zoomable||this.isZooming()||(i=this._checkZoomOrigin(i),t=this._checkZoom(t),this.onZoomStart(t,i),this._frameZoom=this.getZoom(),this.onZoomEnd(t,i))},_zoomAnimation:function(t,i,n){!this.options.zoomable||this.isZooming()||(t=this._checkZoom(t),this.getZoom()!==t&&(i=this._checkZoomOrigin(i),this._startZoomAnim(t,i,n)))},_checkZoomOrigin:function(t){return(!t||this.options.zoomInCenter)&&(t=new W(this.width/2,this.height/2)),this.options.zoomOrigin&&(t=new W(this.options.zoomOrigin)),t},_startZoomAnim:function(t,i,n){H(n)&&(n=1);var e=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(e-n)/Math.abs(e-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:t,around:i},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,i){!this.options.zoomable||this.isZooming()||(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(i),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,i,n){if(!!this.options.zoomable){var e=this._frameZoom;if(e!==t){H(n)&&(n=1),this._zoomTo(t,i);var r=this.getResolution(t),s=this.getResolution(this._startZoomVal),a=s/r/n,h=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),l=this.getViewPoint();if(!this.isRotating()&&!h.equals(i)&&a!==1){var c=this.getPitch(),u=h._sub(i)._multi(1/(1-a));c&&(u.y/=Math.cos(c*Math.PI/180)),i=i.add(u)}var f={view:[a,0,0,a,(i.x-l.x)*(1-a),(i.y-l.y)*(1-a)]},d=this.getDevicePixelRatio();d!==1&&(i=i.multi(d)),f.container=[a,0,0,a,i.x*(1-a),i.y*(1-a)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:i,matrix:f}),this._frameZoom=t}}},onZoomEnd:function(t,i){if(!!this.options.zoomable){var n=this._startZoomVal;this._zoomTo(t,i),this._zooming=!1,this._getRenderer().onZoomEnd(),this._fireEvent("zoomend",{from:n,to:t}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(t,i){this._zoomLevel=t,this._calcMatrices(),i&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,i)},_checkZoom:function(t){var i=this.getMaxZoom(),n=this.getMinZoom();return t<n&&(t=n),t>i&&(t=i),t}});function mg(o,t,i,n,e){var r=1/Math.tan(t/2),s=1/(n-e);return o[0]=r/i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(e+n)*s,o[11]=-1,o[12]=0,o[13]=0,o[14]=2*e*n*s,o[15]=0,o}function u_(o,t,i){var n=i[0],e=i[1],r=i[2],s,a,h,l,c,u,f,d,p,g,m,v;return t===o?(o[12]=t[0]*n+t[4]*e+t[8]*r+t[12],o[13]=t[1]*n+t[5]*e+t[9]*r+t[13],o[14]=t[2]*n+t[6]*e+t[10]*r+t[14],o[15]=t[3]*n+t[7]*e+t[11]*r+t[15]):(s=t[0],a=t[1],h=t[2],l=t[3],c=t[4],u=t[5],f=t[6],d=t[7],p=t[8],g=t[9],m=t[10],v=t[11],o[0]=s,o[1]=a,o[2]=h,o[3]=l,o[4]=c,o[5]=u,o[6]=f,o[7]=d,o[8]=p,o[9]=g,o[10]=m,o[11]=v,o[12]=s*n+c*e+p*r+t[12],o[13]=a*n+u*e+g*r+t[13],o[14]=h*n+f*e+m*r+t[14],o[15]=l*n+d*e+v*r+t[15]),o}function xu(o,t,i){var n=i[0],e=i[1],r=i[2];return o[0]=t[0]*n,o[1]=t[1]*n,o[2]=t[2]*n,o[3]=t[3]*n,o[4]=t[4]*e,o[5]=t[5]*e,o[6]=t[6]*e,o[7]=t[7]*e,o[8]=t[8]*r,o[9]=t[9]*r,o[10]=t[10]*r,o[11]=t[11]*r,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}function eP(o,t,i){var n=Math.sin(i),e=Math.cos(i),r=t[4],s=t[5],a=t[6],h=t[7],l=t[8],c=t[9],u=t[10],f=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=r*e+l*n,o[5]=s*e+c*n,o[6]=a*e+u*n,o[7]=h*e+f*n,o[8]=l*e-r*n,o[9]=c*e-s*n,o[10]=u*e-a*n,o[11]=f*e-h*n,o}function iP(o,t,i){var n=Math.sin(i),e=Math.cos(i),r=t[0],s=t[1],a=t[2],h=t[3],l=t[4],c=t[5],u=t[6],f=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=r*e+l*n,o[1]=s*e+c*n,o[2]=a*e+u*n,o[3]=h*e+f*n,o[4]=l*e-r*n,o[5]=c*e-s*n,o[6]=u*e-a*n,o[7]=f*e-h*n,o}function mo(o,t,i){var n=t[0],e=t[1],r=t[2],s=t[3],a=t[4],h=t[5],l=t[6],c=t[7],u=t[8],f=t[9],d=t[10],p=t[11],g=t[12],m=t[13],v=t[14],x=t[15],_=i[0],y=i[1],b=i[2],M=i[3];return o[0]=_*n+y*a+b*u+M*g,o[1]=_*e+y*h+b*f+M*m,o[2]=_*r+y*l+b*d+M*v,o[3]=_*s+y*c+b*p+M*x,_=i[4],y=i[5],b=i[6],M=i[7],o[4]=_*n+y*a+b*u+M*g,o[5]=_*e+y*h+b*f+M*m,o[6]=_*r+y*l+b*d+M*v,o[7]=_*s+y*c+b*p+M*x,_=i[8],y=i[9],b=i[10],M=i[11],o[8]=_*n+y*a+b*u+M*g,o[9]=_*e+y*h+b*f+M*m,o[10]=_*r+y*l+b*d+M*v,o[11]=_*s+y*c+b*p+M*x,_=i[12],y=i[13],b=i[14],M=i[15],o[12]=_*n+y*a+b*u+M*g,o[13]=_*e+y*h+b*f+M*m,o[14]=_*r+y*l+b*d+M*v,o[15]=_*s+y*c+b*p+M*x,o}function vg(o,t){var i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],a=t[5],h=t[6],l=t[7],c=t[8],u=t[9],f=t[10],d=t[11],p=t[12],g=t[13],m=t[14],v=t[15],x=i*a-n*s,_=i*h-e*s,y=i*l-r*s,b=n*h-e*a,M=n*l-r*a,C=e*l-r*h,w=c*g-u*p,S=c*m-f*p,P=c*v-d*p,O=u*m-f*g,D=u*v-d*g,L=f*v-d*m,T=x*L-_*D+y*O+b*P-M*S+C*w;return T?(T=1/T,o[0]=(a*L-h*D+l*O)*T,o[1]=(e*D-n*L-r*O)*T,o[2]=(g*C-m*M+v*b)*T,o[3]=(f*M-u*C-d*b)*T,o[4]=(h*P-s*L-l*S)*T,o[5]=(i*L-e*P+r*S)*T,o[6]=(m*y-p*C-v*_)*T,o[7]=(c*C-f*y+d*_)*T,o[8]=(s*D-a*P+l*w)*T,o[9]=(n*P-i*D-r*w)*T,o[10]=(p*M-g*y+v*x)*T,o[11]=(u*y-c*M-d*x)*T,o[12]=(a*S-s*O-h*w)*T,o[13]=(i*O-n*S+e*w)*T,o[14]=(g*_-p*b-m*x)*T,o[15]=(c*b-u*_+f*x)*T,o):null}function Sf(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function _g(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}function di(o,t,i,n){return o[0]=t,o[1]=i,o[2]=n,o}function nP(o,t,i){return o[0]=t[0]+i[0],o[1]=t[1]+i[1],o[2]=t[2]+i[2],o}function lh(o,t,i){return o[0]=t[0]-i[0],o[1]=t[1]-i[1],o[2]=t[2]-i[2],o}function yg(o){var t=o[0],i=o[1],n=o[2];return Math.sqrt(t*t+i*i+n*n)}function ch(o,t){var i=t[0],n=t[1],e=t[2],r=i*i+n*n+e*e;return r>0&&(r=1/Math.sqrt(r),o[0]=t[0]*r,o[1]=t[1]*r,o[2]=t[2]*r),o}function rP(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}function sP(o,t,i){return o[0]=t[0]*i,o[1]=t[1]*i,o[2]=t[2]*i,o}function Ac(o,t,i){var n=t[0],e=t[1],r=t[2],s=i[0],a=i[1],h=i[2];return o[0]=e*h-r*a,o[1]=r*s-n*h,o[2]=n*a-e*s,o}function Lh(o,t){var i=t[0]-o[0],n=t[1]-o[1],e=t[2]-o[2];return Math.hypot?Math.hypot(i,n,e):aP(i,n,e)}function oP(o,t,i){var n=t[0],e=t[1],r=t[2],s=i[3]*n+i[7]*e+i[11]*r+i[15];return s=s||1,o[0]=(i[0]*n+i[4]*e+i[8]*r+i[12])/s,o[1]=(i[1]*n+i[5]*e+i[9]*r+i[13])/s,o[2]=(i[2]*n+i[6]*e+i[10]*r+i[14])/s,o}function aP(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)}function Lc(o,t,i){var n=t[0],e=t[1],r=t[2],s=1/(i[3]*n+i[7]*e+i[11]*r+i[15]);return o[0]=(i[0]*n+i[4]*e+i[8]*r+i[12])*s,o[1]=(i[1]*n+i[5]*e+i[9]*r+i[13])*s,o[2]=(i[2]*n+i[6]*e+i[10]*r+i[14])*s,o}function hP(o,t){var i=t[0],n=t[4],e=t[8],r=t[1],s=t[5],a=t[9],h=t[2],l=t[6],c=t[10],u=i+s+c,f;return u>0?(f=.5/Math.sqrt(u+1),o.w=.25/f,o.x=(l-a)*f,o.y=(e-h)*f,o.z=(r-n)*f):i>s&&i>c?(f=2*Math.sqrt(1+i-s-c),o.w=(l-a)/f,o.x=.25*f,o.y=(n+r)/f,o.z=(e+h)/f):s>c?(f=2*Math.sqrt(1+s-i-c),o.w=(e-h)/f,o.x=(n+r)/f,o.y=.25*f,o.z=(a+l)/f):(f=2*Math.sqrt(1+c-i-s),o.w=(r-n)/f,o.x=(e+h)/f,o.y=(a+l)/f,o.z=.25*f),this}function lP(o,t){var i=o,n=t.x,e=t.y,r=t.z,s=t.w,a=n+n,h=e+e,l=r+r,c=n*a,u=n*h,f=n*l,d=e*h,p=e*l,g=r*l,m=s*a,v=s*h,x=s*l;return i[0]=1-(d+g),i[4]=u-x,i[8]=f+v,i[1]=u+x,i[5]=1-(c+g),i[9]=p-m,i[2]=f-v,i[6]=p+m,i[10]=1-(c+d),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function cP(o,t){var i=o;return i[12]=t[0],i[13]=t[1],i[14]=t[2],o}function uP(o,t,i,n){var e=[0,0,0],r=[0,0,0],s=[0,0,0];return lh(s,t,i),yg(s)===0&&(s[2]=1),ch(s,s),Ac(e,n,s),yg(s)===0&&(Math.abs(n[2])===1?s[0]+=1e-4:s[2]+=1e-4,ch(s,s),Ac(e,n,s)),ch(e,e),Ac(r,s,e),o[0]=e[0],o[4]=r[0],o[8]=s[0],o[1]=e[1],o[5]=r[1],o[9]=s[1],o[2]=e[2],o[6]=r[2],o[10]=s[2],o}var bn=Math.PI/180,fP=.6435011087932844,xg=new q(0,0);Bt.include({getFov:function(){return this._fov||(this._fov=fP),this._fov/bn},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var i=this.getFov();return this._fov=t*bn,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:i,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/bn:0},setBearing:function(t){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(t)},_setBearing:function(t){if(jt.ie9)throw new Error("map can't rotate in IE9.");var i=-Gn(t,-180,180)*bn;if(this._angle===i)return this;var n=this.getBearing();return this._fireEvent("rotatestart",{from:n,to:i}),this._angle=i,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:n,to:i}),this._fireEvent("rotateend",{from:n,to:i}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(t)},_setPitch:function(t){if(jt.ie9)throw new Error("map can't tilt in IE9.");var i=gh(t,0,this.options.maxPitch)*bn;if(this._pitch===i)return this;var n=this.getPitch();return this._fireEvent("pitchstart",{from:n,to:i}),this._pitch=i,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:n,to:i}),this._fireEvent("pitchend",{from:n,to:i}),this},isTransforming:function(){return!!(this._pitch||this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var t=90-this.getPitch(),i=this.getFov()/2,n=this.cameraPosition?this.cameraPosition[2]:0;if(i<=t)return n;i=Math.PI*i/180;var e=new W(this.cameraPosition).distanceTo(new W(this.cameraLookAt)),r=n*Math.tan(i*2),s=Math.tan(i)*(e+r);return n+s},_pointToContainerPoint:function(t,i,n,e){n===void 0&&(n=0);var r=this._getResolution(i);return this._pointAtResToContainerPoint(t,r,n,e)},_pointAtResToContainerPoint:function(t,i,n,e){n===void 0&&(n=0),e||(e=new W(0,0)),t=this._pointAtResToPoint(t,i,e);var r=this.isTransforming(),s=i/this._getResolution(),a;return!r&&!n&&(a=this._prjToPoint(this._getPrjCenter(),void 0,xg)),this._toContainerPoint(e,r,s,n,a),e},_pointsAtResToContainerPoints:function(t,i,n,e){n===void 0&&(n=[]),e===void 0&&(e=[]);var r=this.getPitch(),s=this.getBearing();if(r===0&&s===0){var a=this._get2DExtent(),h=a.xmin,l=a.ymin,c=a.xmax,u=a.ymax;if(c>h&&u>l){for(var f=i/this._getResolution(),d=this.getSize(),p=d.width,g=d.height,m=(c-h)/p,v=(u-l)/g,x=0,_=t.length;x<_;x++){if(!t[x]){e[x]=null;continue}var y=e[x];y.x=t[x].x,y.y=t[x].y,y._multi(f),y.x=(y.x-h)*m,y.y=g-(y.y-l)*v}return e}}for(var b=Array.isArray(n),M=this.isTransforming(),C=i/this._getResolution(),w=this._prjToPoint(this._getPrjCenter(),void 0,xg),S=0,P=t.length;S<P;S++){if(!t[S]){e[S]=null;continue}var O=e[S];O.x=t[S].x,O.y=t[S].y,O._multi(C);var D=b?n[S]||0:n;this._toContainerPoint(O,M,C,D,w)}return e},_toContainerPoint:function(){var o=[0,0,0];return function(t,i,n,e,r){var s=this.width/2,a=this.height/2;if(i||e){e*=n;var h=this._glScale;di(o,t.x*h,t.y*h,e*h);var l=this._projIfBehindCamera(o,this.cameraPosition,this.cameraForward);Lc(l,l,this.projViewMatrix),t.x=l[0]*s+s,t.y=-(l[1]*a)+a}else t._sub(r.x,r.y),t.set(t.x,-t.y),t._add(s,a)}}(),_projIfBehindCamera:function(){var o=new Array(3),t=new Array(3),i=new Array(3);return function(n,e,r){lh(o,n,e);var s=rP(r,o);return s<=0&&(sP(t,r,s*1.01),nP(n,e,lh(i,o,t))),n}}(),_containerPointToPoint:function(t,i,n){var e=this._getResolution(i);return this._containerPointToPointAtRes(t,e,n)},_containerPointToPointAtRes:function(){var o=[0,0,0],t=[0,0,0,1],i=[0,0,0,1];return function(n,e,r){if(this.isTransforming()){var s=this.width/2||1,a=this.height/2||1;di(o,(n.x-s)/s,(a-n.y)/a,0),di(t,o[0],o[1],0),di(i,o[0],o[1],1),t[3]=i[3]=1,Lc(t,t,this.projViewMatrixInverse),Lc(i,i,this.projViewMatrixInverse);var h=t[0],l=i[0],c=t[1],u=i[1],f=t[2],d=i[2],p=f===d?0:(0-f)/(d-f),g=ph(h,l,p),m=ph(c,u,p);return r?(r.x=g,r.y=m):r=new W(g,m),r._multi(1/this._glScale),this._getResolution()===e?r:this._pointToPointAtRes(r,e,r)}var v=this._prjToPointAtRes(this._getPrjCenter(),e,r),x=this._getResolution()/e,_=x*(n.x-this.width/2),y=x*(n.y-this.height/2);return v._add(_,-y)}}(),_calcMatrices:function(){var o=fi();return function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var t=this.getSize(),i=t.width||1,n=t.height||1;this._glScale=this.getGLScale();var e=this._getCameraWorldMatrix(),r=this.getFov()*Math.PI/180,s=this._getCameraFar(r,this.getPitch());this.cameraFar=s,this.cameraNear=this.cameraCenterDistance/20;var a=this.projMatrix||fi();mg(a,r,i/n,this.cameraNear,s),this.projMatrix=a,this.viewMatrix=vg(this.viewMatrix||fi(),e),this.projViewMatrix=mo(this.projViewMatrix||fi(),a,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=mo(this.projViewMatrixInverse||fi(),e,vg(o,a)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtentAtRes(this._mapGlRes)}}(),_getCameraFar:function(t,i){var n=this.cameraCenterDistance=Lh(this.cameraPosition,this.cameraLookAt),e=n,r=(this.options.cameraInfiniteFar?10:4)*n;if(i>0&&(i=i*Math.PI/180,2/Math.PI-i>t/2)){var s=Math.tan(t/2),a=Math.tan(i);r=Math.max(n*s/(1/a-s),r)}return e+=r,e+1},_calcCascadeMatrixes:function(){var o=fi();function t(i,n,e){var r=this.width,s=this.height,a=this.getFov()*Math.PI/180,h=this._getCameraFar(a,n),l=this.cameraCenterDistance;h=l+(h-l)/Math.cos((90-n)*Math.PI/180)*Math.cos((90-i)*Math.PI/180),mg(o,a,r/s,.1,h);var c=this.viewMatrix;return mo(e,o,c)}return function(){var i=this.getPitch(),n=this.options.cascadePitches[0],e=this.options.cascadePitches[1],r=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||fi(),s=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||fi();i>n?t.call(this,i,n,r):_g(this.cascadeFrustumMatrix0,this.projViewMatrix),i>e?t.call(this,i,e,s):_g(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var o=fi(),t=fi(),i=[1,-1,1],n=[0,0,0];return function(){var e=this.width||1,r=this.height||1,s=.5/Math.tan(this._fov/2)*r;return xu(o,this.projMatrix,i),u_(o,o,di(n,0,0,-s)),this._pitch&&eP(o,o,this._pitch),this._angle&&iP(o,o,this._angle),Sf(t),xu(t,t,di(n,e/2,-r/2,1)),mo(this.domCssMatrix||fi(),t,o)}}(),_getFovZ:function(t){var i=this.getGLScale(t),n=this._getFovRatio();return i*(this.height||1)/2/n},_getCameraWorldMatrix:function(){var o={};return function(){var t=this.getGLRes(),i=this._prjToPointAtRes(this._prjCenter,t);this.cameraLookAt=di(this.cameraLookAt||[0,0,0],i.x,i.y,0);var n=this.getPitch()*bn,e=this.getBearing()*bn,r=this._getFovZ(),s=r*Math.cos(n),a=Math.sin(n)*r,h=i.x-a*Math.sin(e),l=i.y-a*Math.cos(e);this.cameraPosition=di(this.cameraPosition||[0,0,0],h,l,s),this.cameraToCenterDistance=Lh(this.cameraPosition,this.cameraLookAt);var c=a||1,u=this.cameraUp=di(this.cameraUp||[0,0,0],Math.sin(e)*c,Math.cos(e)*c,0),f=this.cameraWorldMatrix=this.cameraWorldMatrix||fi();uP(f,this.cameraPosition,this.cameraLookAt,u);var d=this.cameraForward||[0,0,0];return lh(d,this.cameraLookAt,this.cameraPosition),this.cameraForward=ch(d,d),hP(o,f),lP(f,o),cP(f,this.cameraPosition),f}}(),_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*bn)},_renderLayers:function(){if(!this.isInteracting()){var t=this._getLayers();t.forEach(function(i){if(!!i){var n=i._getRenderer();n&&n.setToRedraw&&n.setToRedraw()}})}}});function fi(){return Sf(new Array(16))}Bt.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var i=this._getCurrentView(),n=this._viewHistory.length-1;n>=0;n--)if(vh(t,this._viewHistory[n])){this._viewHistoryPointer=n,this._fireViewChange(i,t);return}this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var e=this.options.viewHistoryCount;e>0&&this._viewHistory.length>e&&this._viewHistory.splice(0,this._viewHistory.length-e),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(i,t)},zoomToPreviousView:function(t){if(t===void 0&&(t={}),!this.hasPreviousView())return null;var i=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(i,t),i},hasPreviousView:function(){return!(!this._viewHistory||this._viewHistoryPointer===0)},zoomToNextView:function(t){if(t===void 0&&(t={}),!this.hasNextView())return null;var i=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(i,t),i},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(t,i){var n=this,e=this.getView();i.animation?this._animateTo(t,{duration:i.duration},function(r){r.state.playState==="finished"&&n._fireViewChange(e,t)}):(this.setView(t),this._fireViewChange(e,t))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,i){this._fireEvent("viewchange",{old:t,new:i})},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}});Bt.mergeOptions({viewHistory:!0,viewHistoryCount:10});Bt.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new Ev,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this}});var dP={mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]},f_=function(o){ht(t,o);function t(n){var e;return e=o.call(this,n)||this,e.on("enable",e._afterEnable,ze(ze(e))).on("disable",e._afterDisable,ze(ze(e))),e._measureLayers=[],e}var i=t.prototype;return i.clear=function(){if(ee(this._measureLayers))for(var e=0;e<this._measureLayers.length;e++)this._measureLayers[e].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},i.getMeasureLayers=function(){return this._measureLayers},i.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},i.undo=function(){o.prototype.undo.call(this);var e=this._historyPointer;if(e!==this._vertexes.length)for(var r=e;r<this._vertexes.length;r++)this._vertexes[r].label&&this._vertexes[r].label.remove(),this._vertexes[r].marker.remove();return this},i.redo=function(){o.prototype.redo.call(this);var e=this._historyPointer-1;return this._vertexes[e]&&(this._vertexes[e].marker.getLayer()||(this._vertexes[e].label&&this._vertexes[e].label.addTo(this._measureMarkerLayer),this._vertexes[e].marker.addTo(this._measureMarkerLayer))),this},i._measure=function(e){var r=this.getMap(),s;e instanceof Jt?s=r.computeGeometryLength(e):Array.isArray(e)&&(s=r.getProjection().measureLength(e)),this._lastMeasure=s;var a;this.options.language==="zh-CN"?a=[" \u7C73"," \u516C\u91CC"," \u82F1\u5C3A"," \u82F1\u91CC"]:a=[" m"," km"," feet"," mile"];var h="";return this.options.metric&&(h+=s<1e3?s.toFixed(0)+a[0]:(s/1e3).toFixed(2)+a[1]),this.options.imperial&&(s*=3.2808399,h.length>0&&(h+=`
`),h+=s<5280?s.toFixed(0)+a[2]:(s/5280).toFixed(2)+a[3]),h},i._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},i._afterEnable=function(){this._registerMeasureEvents()},i._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},i._msOnDrawStart=function(e){var r=this.getMap(),s=r._pointToPrj(e.point2d),a=Xn(),h="distancetool_"+a,l="distancetool_markers_"+a;r.getLayer(h)?(this._measureLineLayer=r.getLayer(h),this._measureMarkerLayer=r.getLayer(l)):(this._measureLineLayer=new Bi(h).addTo(r),this._measureMarkerLayer=new Bi(l).addTo(r)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer);var c=new Ce(e.coordinate,{symbol:this.options.vertexSymbol});c._setPrjCoordinates(s);var u=this.options.language==="zh-CN"?"\u8D77\u70B9":"start",f=new ys(u,e.coordinate,this.options.labelOptions);f._setPrjCoordinates(s),this._lastVertex=f,this._addVertexMarker(c,f)},i._msOnMouseMove=function(e){var r=this._measure(this._msGetCoordsToMeasure(e));if(!this._tailMarker){var s=Ai(this.options.vertexSymbol);s.markerWidth/=2,s.markerHeight/=2,this._tailMarker=new Ce(e.coordinate,{symbol:s}).addTo(this._measureMarkerLayer),this._tailLabel=new ys(r,e.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var a=this._geometry._getPrjCoordinates(),h=a[a.length-1];this._tailMarker.setCoordinates(e.coordinate),this._tailMarker._setPrjCoordinates(h),this._tailLabel.setContent(r),this._tailLabel.setCoordinates(e.coordinate),this._tailLabel._setPrjCoordinates(h)},i._msGetCoordsToMeasure=function(e){return e.geometry.getCoordinates().concat([e.coordinate])},i._msOnDrawVertex=function(e){var r=this._geometry._getPrjCoordinates(),s=r[r.length-1],a=e.geometry,h=new Ce(e.coordinate,{symbol:this.options.vertexSymbol}),l=this._measure(a),c=new ys(l,e.coordinate,this.options.labelOptions);this._addVertexMarker(h,c),c._setPrjCoordinates(s),h._setPrjCoordinates(s),this._lastVertex=c},i._addVertexMarker=function(e,r){this._vertexes||(this._vertexes=[]),this._historyPointer!==void 0&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:r,marker:e}),this._measureMarkerLayer.addGeometry(e),r&&this._measureMarkerLayer.addGeometry(r)},i._msOnDrawEnd=function(e){if(this._clearTailMarker(),e.geometry._getPrjCoordinates().length<2){this._lastMeasure=0,this._clearMeasureLayers();return}var r=this._lastVertex.getSize();r||(r=new Pe(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),r.width);var s=e.geometry.copy();s._setPrjCoordinates(e.geometry._getPrjCoordinates()),s.addTo(this._measureLineLayer),this._lastMeasure=s.getLength()},i._addClearMarker=function(e,r,s){var a=this.options.clearButtonSymbol,h={markerDx:(a.markerDx||0)+s,textDx:(a.textDx||0)+s};Array.isArray(a)&&(h=a.map(function(f){return f?{markerDx:(f.markerDx||0)+s,textDx:(f.textDx||0)+s}:null})),a=Ai(a,h);var l=new Ce(e,{symbol:a}),c=this._measureLineLayer,u=this._measureMarkerLayer;l.on("click",function(){return c.remove(),u.remove(),!1},this),l.addTo(this._measureMarkerLayer),l._setPrjCoordinates(r)},i._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},i._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},t}(We);f_.mergeOptions(dP);var pP={mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}},gP=function(o){ht(t,o);function t(n){var e;return e=o.call(this,n)||this,e._measureLayers=[],e}var i=t.prototype;return i._measure=function(e){var r=this.getMap(),s;e instanceof Jt?s=r.computeGeometryArea(e):Array.isArray(e)&&(s=r.getProjection().measureArea(e)),this._lastMeasure=s;var a;this.options.language==="zh-CN"?a=[" \u5E73\u65B9\u7C73"," \u5E73\u65B9\u516C\u91CC"," \u5E73\u65B9\u82F1\u5C3A"," \u5E73\u65B9\u82F1\u91CC"]:a=[" sq.m"," sq.km"," sq.ft"," sq.mi"];var h="";if(this.options.metric&&(h+=s<1e6?s.toFixed(0)+a[0]:(s/1e6).toFixed(2)+a[1]),this.options.imperial){s*=3.2808399,h.length>0&&(h+=`
`);var l=5280*5280;h+=s<l?s.toFixed(0)+a[2]:(s/l).toFixed(2)+a[3]}return h},i._msGetCoordsToMeasure=function(e){return e.geometry.getShell().concat([e.coordinate])},i._msOnDrawVertex=function(e){var r=this.getMap()._pointToPrj(e.point2d),s=new Ce(e.coordinate,{symbol:this.options.vertexSymbol});s._setPrjCoordinates(r),this._measure(e.geometry),this._lastVertex=s,this._addVertexMarker(s)},i._msOnDrawEnd=function(e){this._clearTailMarker();var r;if(e.point2d)r=this.getMap()._pointToPrj(e.point2d);else{var s=e.geometry._getPrjCoordinates();s=s.slice(0,s.length-1),e.geometry._setPrjCoordinates(s),r=s[s.length-1]}if(e.geometry._getPrjCoordinates().length<3){this._lastMeasure=0,this._clearMeasureLayers();return}var a=this._measure(e.geometry),h=this.getMap().getProjection(),l=h.unproject(r),c=new ys(a,l,this.options.labelOptions).addTo(this._measureMarkerLayer);c._setPrjCoordinates(r);var u=c.getSize();u||(u=new Pe(10,10)),this._addClearMarker(l,r,u.width);var f=e.geometry.copy();f._setPrjCoordinates(e.geometry._getPrjCoordinates()),f.addTo(this._measureLineLayer),this._lastMeasure=f.getArea()},t}(f_);gP.mergeOptions(pP);var d_={create:function(t,i){var n=t.unproject(i[0]),e=new Ni(n,0);return e._setPrjCoordinates(i[0]),e},update:function(t,i,n){var e=n.getMap(),r=Array.isArray(i)?i[i.length-1]:i,s=t.unproject(r),a=e.computeLength(n.getCenter(),s);n.setRadius(a)},generate:function(t){return t}};We.registerMode("circle",dt({clickLimit:2,action:["click","mousemove","click"]},d_));We.registerMode("freeHandCircle",dt({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},d_));var p_={create:function(t,i){var n=t.unproject(i[0]),e=new ln(n,0,0);return e._setPrjCoordinates(i[0]),e},update:function(t,i,n){var e=n.getMap(),r=n.getCenter(),s=Array.isArray(i)?i[i.length-1]:i,a=t.unproject(s),h=e.computeLength(r,new q({x:a.x,y:r.y})),l=e.computeLength(r,new q({x:r.x,y:a.y}));n.setWidth(h*2),n.setHeight(l*2)},generate:function(t){return t}};We.registerMode("ellipse",dt({clickLimit:2,action:["click","mousemove","click"]},p_));We.registerMode("freeHandEllipse",dt({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},p_));var g_={create:function(t,i){var n=new ie([]);return n._firstClick=i[0],n},update:function(t,i,n,e){var r=n.getMap(),s=e.containerPoint,a=r._prjToContainerPoint(n._firstClick),h=[[a.x,a.y],[s.x,a.y],[s.x,s.y],[a.x,s.y]];n.setCoordinates(h.map(function(l){return r.containerPointToCoord(new W(l))})),n._setPrjCoordinates(h.map(function(l){return r._containerPointToPrj(new W(l))}))},generate:function(t){return t}};We.registerMode("rectangle",dt({clickLimit:2,action:["click","mousemove","click"]},g_));We.registerMode("freeHandRectangle",dt({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},g_));We.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(t,i){var n=t.unproject(i[0]),e=new Ce(n);return e._setPrjCoordinates(i[0]),e},generate:function(t){return t},update:function(t,i,n){if(Array.isArray(i)&&(i=i[i.length-1]),!i)return n;var e=t.unproject(i);return n.setCoordinates(e),n}});var m_={create:function(t,i){var n=i.map(function(r){return t.unproject(r)}),e=new fe(n);return e._setPrjCoordinates(i),e},update:function(t,i,n){var e=n.getSymbol(),r;Array.isArray(i)?r=i:(r=n._getPrjCoordinates(),r.push(i));var s=r.map(function(c){return t.unproject(c)});n.setCoordinates(s),n._setPrjCoordinates(r);var a=n.getLayer();if(a){var h=a.getGeometryById("polygon");if(!h&&r.length>=3){if(h=new ie([s],{id:"polygon"}),e){var l=Ai(e,{lineOpacity:0});h.setSymbol(l)}h.addTo(a)}h&&h._setPrjCoordinates(r)}},generate:function(t){var i=new ie(t.getCoordinates(),{symbol:t.getSymbol()});return i._setPrjCoordinates(t._getPrjCoordinates()),i._projCode=t._projCode,i}};We.registerMode("polygon",dt({action:["click","mousemove","dblclick"]},m_));We.registerMode("freeHandPolygon",dt({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},m_));var $o={create:function(t,i){var n=i.map(function(r){return t.unproject(r)}),e=new fe(n);return e._setPrjCoordinates(i),e},update:function(t,i,n){var e;Array.isArray(i)?e=i:(e=n._getPrjCoordinates(),e.push(i));var r=e.map(function(s){return t.unproject(s)});n.setCoordinates(r),n._setPrjCoordinates(e)},generate:function(t){return t}};We.registerMode("linestring",dt({action:["click","mousemove","dblclick"]},$o));We.registerMode("freeHandLinestring",dt({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},$o));We.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t,i){var n=i.map(function(r){return t.unproject(r)}),e=new Yh(n);return e._setPrjCoordinates(i),e},update:$o.update,generate:function(t){return t}});We.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,i){var n=i.map(function(r){return t.unproject(r)}),e=new o_(n);return e._setPrjCoordinates(i),e},update:$o.update,generate:function(t){return t}});We.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,i){var n=i.map(function(r){return t.unproject(r)}),e=new s_(n);return e._setPrjCoordinates(i),e},update:$o.update,generate:function(t){return t}});We.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t,i){i=i[0];var n=t.unproject(i),e=new Ce(n);return e._firstClick=i,e},update:function(t,i,n,e){var r=n.getMap(),s=r._prjToContainerPoint(n._firstClick),a=e.containerPoint;i=r._containerPointToPrj(new q(Math.min(s.x,a.x),Math.min(s.y,a.y)));var h=t.unproject(i);n.setCoordinates(h)._setPrjCoordinates(i),n.updateSymbol({markerWidth:Math.abs(s.x-a.x),markerHeight:Math.abs(s.y-a.y)})},generate:function(t){return t}});function wg(o){for(var t=o.tileInfo,i=[t.cols,t.rows],n=[],e=t.lods,r=0,s=e.length;r<s;r++)n.push(e[r].resolution);var a=o.fullExtent,h=t.origin,l=[1,-1,h.x,h.y];return delete a.spatialReference,{spatialReference:{resolutions:n,fullExtent:a},tileSystem:l,tileSize:i}}zi.loadArcgis=function(o,t,i){if(i===void 0&&(i={jsonp:!0}),Xt(o)&&o.substring(0,1)!=="{")Ke.getJSON(o,function(e,r){if(e){t(e);return}var s=wg(r);t(null,s)},i);else{Xt(o)&&(o=Uh(o));var n=wg(o);t(null,n)}return this};function mP(o){for(var t="",i=o.split(""),n=i.length,e=n-1;e>=0&&!isNaN(i[e]);e--)t=i[e]+t;return t}function vP(o){var t=o.indexOf("EPSG")>-1?o:"EPSG:"+o;return t=v_(t,[["4490","4326"],["102100","3857"],["900913","3857"]]),t}function v_(o,t){return t===void 0&&(t=[]),t.forEach(function(i){var n=i[0],e=i[1];o=o.replace(n,e)}),o}function _P(o){var t=o.projection,i=o.isArcgis,n=o.isGeoServer,e=o.isSuperMap,r=.0002645833333333333;return(i||n||e)&&(r=28e-5),t&&t.indexOf("4326")>-1&&(r=23767925226029154e-25,(i||e)&&(r=2518101729011901e-24),n&&(r=251528279553466e-23)),r}var yP="wmts";function Ln(o,t){var i=o.getElementsByTagName(t);if(i&&i.length)return i;var n=yP+":"+t;return o.getElementsByTagName(n)}function xP(o,t){for(var i=0;i<o.length;i++){var n=o[i];if(n=n.getElementsByTagName("ows:Identifier")[0],n&&n.textContent===t)return o[i]}return null}function wP(o,t,i){i.isArcgis==null&&(i.isArcgis=o.indexOf("arcgis")>-1),i.isSuperMap==null&&(i.isSuperMap=o.indexOf("supermap")>-1);var n=new DOMParser,e=n.parseFromString(o,"text/xml"),r=e.querySelectorAll("Contents")[0];if(!r)return[];var s=Ln(r,"Layer");if(!s.length)return[];for(var a=[],h=0,l=r.childNodes.length;h<l;h++)r.childNodes[h].localName==="TileMatrixSet"&&a.push(r.childNodes[h]);if(!a.length)return[];for(var c=[],u=0,f=s.length;u<f;u++){var d=s[u],p=d.querySelectorAll("Style")[0];p&&(p=p.getElementsByTagName("ows:Identifier")[0],p&&(p=p.textContent));var g=d.getElementsByTagName("ows:Identifier")[0];g&&(g=g.textContent);var m=Ln(d,"TileMatrixSetLink");if(m.length!==0)for(var v=0,x=m.length;v<x;v++){var _=m[v];_=Ln(_,"TileMatrixSet")[0],_&&(_=_.textContent);var y=xP(a,_);if(!!y){var b=d.querySelectorAll("ResourceURL")[0],M="";b&&(M=b.attributes.template.value);var C=MP(y,i),w=C.resolutions,S=C.tileSize,P=C.tileSystem,O=C.projection,D=C.TileMatrixSet,L=C.isGeoServer,T=C.levelStr;M.length||(M=t.substr(0,t.lastIndexOf("?")),M+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var A=v_(M,[["{LAYER}",g],["{Layer}",g],["{layer}",g],["{STYLE}",p],["{Style}",p],["{style}",p],["{TileMatrixSet}",D],["{TileMatrix}",L?T+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",L?"image/png":"tiles"]]);c.push({tileSize:S,tileSystem:P,spatialReference:{resolutions:w,projection:O},urlTemplate:A,info:{layerName:g,TileMatrixSet:D,style:p,tileSize:S,tileSystem:P,resolutions:w,projection:O,urlTemplate:A}})}}}return c}function MP(o,t){t===void 0&&(t={});var i=Ln(o,"TileMatrix"),n=[],e=[],r=[],s,a,h=!1,l;if(!s){var c=o.getElementsByTagName("ows:SupportedCRS")[0];c&&(s=c.textContent,s=s.split("EPSG")[1],s=mP(s),s=vP(s))}a||(a=o.getElementsByTagName("ows:Identifier")[0],a&&(a=a.textContent)),t.projection=s;for(var u=1/0,f=0;f<i.length;f++){var d=i[f],p=d.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(p))?(l=p.substr(0,p.lastIndexOf(":")),p=p.split(":"),p=p[p.length-1],p=parseInt(p),h=!0,t.isGeoServer=!0):p=parseInt(p),u=Math.min(u,p);var g=Ln(d,"ScaleDenominator")[0].textContent,m=Ln(d,"TopLeftCorner")[0].textContent,v=Ln(d,"TileWidth")[0].textContent,x=Ln(d,"TileHeight")[0].textContent;if(r.length===0&&r.push(parseInt(v),parseInt(x)),e.length===0){var _=m.split(" ").filter(function(P){return P!==""}).map(function(P){return parseFloat(P)}),y=_[0],b=_[1];y>0?e.push(1,-1,b,y):e.push(1,-1,y,b)}var M=_P(t),C=parseFloat(g)*M;n.push(C)}if(u>0)for(var w=n[0],S=u-1;S>=0;S--)w=w*2,n.splice(0,0,w);return{resolutions:n,tileSize:r,tileSystem:e,projection:s,TileMatrixSet:a,isGeoServer:h,levelStr:l}}zi.loadWMTS=function(o,t,i){return i===void 0&&(i={jsonp:!0}),Xt(o)&&Ke.get(o,function(n,e){if(n){t(n);return}var r=wP(e,o,i);t(null,r)},i),this};var bP={eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1},Un=function(o){ht(t,o);function t(n){return o.call(this,n)||this}var i=t.prototype;return i.addTo=function(e){return this._owner=e,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},i.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},i.show=function(e){var r=this.getMap();if(!r)return this;this.options.visible=!0,e=e||this._coordinate||this._owner.getCenter();var s=this.isVisible();this._showBySymbolChange||this.fire("showstart");var a=this._getUIContainer();this._coordinate=e,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var h=this.__uiDOM=this.buildOn(r);if(h.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(h),!h)return this._showBySymbolChange||this.fire("showend"),this;this._measureSize(h),this._singleton()&&(h._uiComponent=this,r[this._uiDomKey()]=h),this._setPosition(),h.style[fo]=null,a.appendChild(h);var l=this._getAnimation();if(s&&(l.ok=!1),l.ok&&(l.fade&&(h.style.opacity=0),l.scale)){if(this.getTransformOrigin){var c=this.getTransformOrigin();h.style[vv]=c}h.style[Ei]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(h.style.display=""),this.options.eventsToStop&&we(h,this.options.eventsToStop,ni),this.options.autoPan&&this._autoPan();var u=l.transition;return l.ok&&u&&(h.offsetHeight,u&&(h.style[fo]=u),l.fade&&(h.style.opacity=1),l.scale&&(h.style[Ei]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this},i.hide=function(){var e=this;if(!this.getDOM())return this;this.options.visible=!1;var r=this._getAnimation(),s=this.getDOM();return this.options.animationOnHide||(r.ok=!1),r.ok?(s.offsetHeight,s.style[fo]=r.transition,setTimeout(function(){s.style.display="none",e.fire("hide")},this.options.animationDuration)):(s.style.display="none",this.fire("hide")),r.fade&&(s.style.opacity=0),r.scale&&(s.style[Ei]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this},i.isVisible=function(){if(!this.options.visible)return!1;var e=this.getDOM();return this.getMap()&&e&&e.parentNode&&e.style.display!=="none"},i.remove=function(){return delete this._mapEventsOn,this._owner?(this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this):this},i.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},i.getOwner=function(){return this._owner},i.getDOM=function(){return this.__uiDOM},i._roundPoint=function(e){return this.options.roundPoint&&(e=e._round()),e},i.getPosition=function(){if(!this.getMap())return null;var e=this._roundPoint(this._getViewPoint());if(this.getOffset){var r=this._roundPoint(this.getOffset());r&&e._add(r)}return e},i._getAnimation=function(){for(var e={fade:!1,scale:!1},r=this.options.animation?this.options.animation.split(","):[],s=0;s<r.length;s++){var a=tf(r[s]);a==="fade"?e.fade=!0:a==="scale"&&(e.scale=!0)}var h=null;return e.fade&&(h="opacity "+this.options.animationDuration+"ms"),e.scale&&(h=h?h+",":"",h+=Ei+" "+this.options.animationDuration+"ms"),e.transition=h,e.ok=h!==null,e},i._getViewPoint=function(){var e=0,r=this._coordinate||{};St(r.z)?e=r.z:this._owner&&this._owner.getAltitude&&(e=this._owner.getAltitude()||0);var s=this._meterToPoint(this._coordinate,e);return this.getMap().coordToViewPoint(this._coordinate,void 0,s)._add(this.options.dx,this.options.dy)},i._meterToPoint=function(e,r){var s=this.getMap();return s.altitudeToPoint(r,s._getResolution())*Ie(r)},i._autoPan=function(){var e=this.getMap(),r=this.getDOM();if(!e.isMoving()){var s=this._getViewPoint()._round(),a=e.width,h=e.height,l=e.viewPointToContainerPoint(s),c=this.getOffset(),u=l.add(c),f=e._viewPointToPrj(s),d=parseInt(r.clientWidth),p=parseInt(r.clientHeight),g=50,m=0,v=0;if(u.x<0?m=-u.x+g:u.x+d>a&&(m=-(u.x+d-a)-g),u.y-p<0?v=Math.abs(u.y-p)+g:u.y+p>h&&(v=h-(u.y+p)-g),d>=a&&(m=a/2-l.x),v!==0||m!==0){var x=l.add(m,v),_=e._containerPointToPoint(x)._sub(e._prjToPoint(e._getPrjCenter())),y=e._pointToPrj(e._prjToPoint(f).sub(_));e._panAnimation(y)}}},i._measureSize=function(e){var r=this._getUIContainer();e.style.position="absolute";var s=e.style.bottom?"bottom":"top";if(e.style.display="",r.appendChild(e),e.getBoundingClientRect){var a=e.getBoundingClientRect();this._size=new Pe(a.width,a.height)}else this._size=new Pe(e.clientWidth,e.clientHeight);return e.style.display="none",e.style.left="0px",e.style[s]="0px",this._size},i._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var e=this.options.eventsToStop;if(this._singleton()){var r=this.getMap(),s=this._uiDomKey();if(r[s]){e&&ge(r[s],e,ni);var a=r[s]._uiComponent;a&&a!==this&&a.isVisible()&&a.fire("hide"),br(r[s]),a&&!this.hideDom&&a._switchMapEvents("off"),delete r[s]}delete this.__uiDOM}else this.__uiDOM&&(e&&ge(this.__uiDOM,e,ni),br(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},i._uiDomKey=function(){return"__ui_"+this._getClassName()},i._singleton=function(){return this.options.single},i._getUIContainer=function(){return this.getMap()._panels.ui},i._getClassName=function(){return"UIComponent"},i._switchMapEvents=function(e){var r=this.getMap();if(!!r){this._mapEventsOn=e==="on";var s=this._getDefaultEvents();if(this.getEvents&&dt(s,this.getEvents()),s)for(var a in s)s.hasOwnProperty(a)&&r[e](a,s[a],this)}},i._switchEvents=function(e){var r=this._getOwnerEvents();if(this._owner)for(var s in r)r.hasOwnProperty(s)&&this._owner[e](s,r[s],this)},i._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},i._getOwnerEvents=function(){var e={};return this._owner&&this._owner instanceof Jt&&(e.positionchange=this.onGeometryPositionChange,e.symbolchange=this._updatePosition),this.getOwnerEvents&&dt(e,this.getOwnerEvents()),e},i.onGeometryPositionChange=function(e){this._owner&&this.isVisible()&&(this._showBySymbolChange=!0,this.show(e.target.getCenter()),delete this._showBySymbolChange)},i.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},i.onEvent=function(){this.isVisible()&&this._updatePosition()},i.onZoomEnd=function(){this.isVisible()&&this._setPosition()},i.onResize=function(){this.isVisible()&&this._setPosition()},i.onDomSizeChange=function(){this.isVisible()&&this._setPosition()},i._updatePosition=function(){if(!this.getMap())return this;var e=this.getMap()._getRenderer();return e.callInNextFrame(this._setPosition.bind(this)),this},i._setPosition=function(){var e=this.getDOM();if(!!e){e.style[fo]=null;var r=this.getPosition();this._pos=r,e.style[Ei]=this._toCSSTranslate(r)+" scale(1)"}},i._toCSSTranslate=function(e){if(!e)return"";if(jt.any3d){var r=this.getMap(),s=r?r.getBearing():0,a=r?r.getPitch():0,h="";return this.options.pitchWithMap&&a&&(h+=" rotateX("+Math.round(a)+"deg)"),this.options.rotateWithMap&&s&&(h+=" rotateZ("+Math.round(-s)+"deg)"),"translate3d("+e.x+"px,"+e.y+"px, 0px)"+h}else return"translate("+e.x+"px,"+e.y+"px)"},i._observerDomSize=function(e){var r=this;return!e||!jt.resizeObserver||this._resizeObserver?this:(this._resizeObserver=new ResizeObserver(function(s){s.length?r._domContentRect=s[0].contentRect:delete r._domContentRect,r.onDomSizeChange&&r.onDomSizeChange()}),this._resizeObserver.observe(e),this)},i.isSupportZoomFilter=function(){return!1},t.isSupport=function(e){return!!(e&&ne(e.on)&&ne(e.off)&&ne(e.getCenter))},t}(Ui(wi));Un.mergeOptions(bP);var SP={containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null},Mg="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",Qh=function(o){ht(t,o);function t(n,e){var r;return r=o.call(this,e)||this,r._markerCoord=new q(n),r}var i=t.prototype;return i._getClassName=function(){return"UIMarker"},i.setCoordinates=function(e){return this._markerCoord=e,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition()),this},i.getCoordinates=function(){return this._markerCoord},i.getCenter=function(){return this.getCoordinates()},i.getAltitude=function(){var e=this.getCoordinates()||{};return St(e.z)?e.z:this.options.altitude||0},i.setContent=function(e){var r=this.options.content;return this.options.content=e,this.fire("contentchange",{old:r,new:e}),this.isVisible()&&this.show(),this},i.getContent=function(){return this.options.content},i.onAdd=function(){this.show()},i.show=function(){return o.prototype.show.call(this,this._markerCoord)},i.flash=function(e,r,s,a){return Xu.call(this,e,r,s,a)},i.buildOn=function(){var e,r=this.options.content,s=Xt(r);return s||ne(r)?(e=Et("div"),s?e.innerHTML=this.options.content:r.bind(this)(e)):e=this.options.content,this.options.containerClass&&(e.className=this.options.containerClass),this._registerDOMEvents(e),e},i.getOffset=function(){var e=this.getSize();return new W(-e.width/2,-e.height/2)},i.getTransformOrigin=function(){return"center center"},i.onDomRemove=function(){var e=this.getDOM();this._removeDOMEvents(e)},i.isDragging=function(){return this.draggable?this.draggable.isDragging():!1},i._registerDOMEvents=function(e){we(e,Mg,this._onDomEvents,this)},i._onDomEvents=function(e){var r=this.getMap()._parseEvent(e,e.type),s=e.type;if(s==="mousedown"&&(this._mousedownEvent=e),s==="mouseup"&&(this._mouseupEvent=e),!(s==="click"&&this._mouseClickPositionIsChange())&&(s==="touchstart"&&(this._touchstartTime=me()),this.fire(e.type,r),s==="touchend"&&jt.touch)){var a=this.getMap().options.clickTimeThreshold||280;me()-this._touchstartTime<a&&this._onDomEvents(dt({},e,{type:"click"}))}},i._removeDOMEvents=function(e){ge(e,Mg,this._onDomEvents)},i._mouseClickPositionIsChange=function(){var e=this._mousedownEvent||{},r=e.x,s=e.y,a=this._mouseupEvent||{},h=a.x,l=a.y;return r!==h||s!==l},i._getConnectPoints=function(){var e=this.getMap(),r=e.coordToContainerPoint(this.getCoordinates()),s=this.getSize(),a=s.width,h=s.height,l=[e.containerPointToCoordinate(r.add(-a/2,0)),e.containerPointToCoordinate(r.add(a/2,0)),e.containerPointToCoordinate(r.add(0,h/2)),e.containerPointToCoordinate(r.add(0,-h/2))];return l},i._getViewPoint=function(){var e=0;if(this._owner){var r=this.getAltitude();r>0&&(e=this._meterToPoint(this._coordinate,r))}return this.getMap().coordToViewPoint(this._coordinate,void 0,e)._add(this.options.dx,this.options.dy)},i._getDefaultEvents=function(){return dt({},o.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},i._setPosition=function(){this.onZoomFilter(),o.prototype._setPosition.call(this)},i.onZoomFilter=function(){var e=this.getDOM();!e||(!this.isVisible()&&e.style.display!=="none"?e.style.display="none":this.isVisible()&&e.style.display==="none"&&(e.style.display=""))},i.isVisible=function(){var e=this.getMap();if(!e||!this.options.visible)return!1;var r=e.getZoom(),s=this.options,a=s.minZoom,h=s.maxZoom;if(!H(a)&&r<a||!H(h)&&r>h)return!1;var l=this.getDOM();return l&&!0},i.isSupportZoomFilter=function(){return!0},t}(cf(Un));Qh.mergeOptions(SP);var bg=jt.touch?"touchstart mousedown":"mousedown",CP=function(o){ht(t,o);function t(n){return o.call(this,n)||this}var i=t.prototype;return i.addHooks=function(){this.target.on(bg,this._startDrag,this)},i.removeHooks=function(){this.target.off(bg,this._startDrag,this)},i._startDrag=function(e){var r=e.domEvent;r.touches&&r.touches.length>1||r.button===2||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=e.coordinate,this._lastPoint=e.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(e.domEvent),this.target.fire("dragstart",e))},i._prepareDragHandler=function(){this._dragHandler=new ks(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},i._cancelOn=function(e){var r=e.srcElement||e.target,s=r.tagName.toLowerCase();return s==="button"||s==="input"||s==="select"||s==="option"||s==="textarea"},i._onMouseDown=function(e){ni(e.domEvent)},i._dragging=function(e){var r=this.target,s=r.getMap(),a=s._parseEvent(e.domEvent),h=a.domEvent;if(!(h.touches&&h.touches.length>1)){if(!this._isDragging){this._isDragging=!0;return}var l=a.coordinate,c=a.containerPoint;this._lastCoord||(this._lastCoord=l),this._lastPoint||(this._lastPoint=c);var u=l.sub(this._lastCoord),f=c.sub(this._lastPoint);this._lastCoord=l,this._lastPoint=c,this.target.setCoordinates(this.target.getCoordinates().add(u)),a.coordOffset=u,a.pointOffset=f,r.fire("dragging",a)}},i._endDrag=function(e){var r=this.target,s=r.getMap();if(this._dragHandler&&(r.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,!!s){var a=s._parseEvent(e.domEvent);r&&r._mouseClickPositionIsChange&&r._mouseClickPositionIsChange()&&r.fire("dragend",a)}},i.isDragging=function(){return!!this._isDragging},t}(Li);Qh.addInitHook("addHandler","draggable",CP);var TP=/\{ *([\w_]+) *\}/g,__={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},PP=new Pe(0,0),Rh=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i._getClassName=function(){return"InfoWindow"},i.addTo=function(e){return e instanceof Jt&&(e.getInfoWindow()&&e.getInfoWindow()!==this&&e.removeInfoWindow(),e._infoWindow=this),o.prototype.addTo.call(this,e)},i.setContent=function(e){var r=this.options.content;return this.options.content=e,this.fire("contentchange",{old:r,new:e}),this.isVisible()&&this.show(this._coordinate),this},i.getContent=function(){return this.options.content},i.setTitle=function(e){var r=e;return this.options.title=e,this.fire("contentchange",{old:r,new:e}),this.isVisible()&&this.show(this._coordinate),this},i.getTitle=function(){return this.options.title},i.buildOn=function(){var e=ne(this.options.content),r=Xt(this.options.content);if(this.options.custom)if(r||e){var s=Et("div");return r?(s.innerHTML=this.options.content,this._replaceTemplate(s)):this.options.content.bind(this)(s),s}else return this._replaceTemplate(this.options.content),this.options.content;var a=Et("div");this.options.containerClass&&(a.className=this.options.containerClass);var h=this._getWindowWidth();a.style.width=St(h)?h+"px":"auto",a.style.bottom="0px";var l='<em class="maptalks-ico"></em>';this.options.title&&(l+="<h2>"+this.options.title+"</h2>"),l+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',a.innerHTML=l,this._replaceTemplate(a);var c=a.querySelector(".maptalks-msgContent");r||e?r?c.innerHTML=this.options.content:this.options.content.bind(this)(c):c.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this);var u=a.querySelector(".maptalks-close");return on(u,"click touchend",this._onCloseBtnClick),e||this._replaceTemplate(c),a},i._replaceTemplate=function(e){if(this.options.enableTemplate&&this._owner&&this._owner.getProperties&&e&&e.innerHTML){var r=this._owner.getProperties()||{};if(yi(r)){var s=e.innerHTML;e.innerHTML=s.replace(TP,function(a,h){return r[h]})}}return this},i.getTransformOrigin=function(){var e=this.getSize();return e.width/2+"px bottom"},i.getOffset=function(){var e=this.getSize(),r=new W(-e.width/2,0);this.options.custom?r._sub(0,e.height):r._sub(4,12);var s=this.getOwner();if(s instanceof Ce||s instanceof Ph){var a,h;if(s instanceof Ce)a=s._getPainter(),h=s.getSize();else{var l=s.getGeometries();if(!l||!l.length)return r;a=l[0]._getPainter(),h=l[0].getSize()}if(h||(h=PP),a){var c=a.getFixedExtent();r._add(c.xmax-h.width/2,c.ymin)}else r._add(0,-h.height)}return r},i.show=function(e){return this.getMap()?this.getMap().options.enableInfoWindow?o.prototype.show.call(this,e):this:this},i.getEvents=function(){if(!this.options.autoCloseOn)return null;var e={};return e[this.options.autoCloseOn]=this.hide,e},i.getOwnerEvents=function(){var e=this.getOwner();if(!this.options.autoOpenOn||!e)return null;var r={};return r[this.options.autoOpenOn]=this._onAutoOpen,r},i.onRemove=function(){this.onDomRemove()},i.onDomRemove=function(){if(this._onCloseBtnClick){var e=this.getDOM(),r=e.childNodes[2];$n(r,"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick}},i._onAutoOpen=function(e){var r=this,s=this.getOwner();setTimeout(function(){s instanceof Ce||s instanceof Un?r.show(s.getCoordinates()):s instanceof Ph?r.show(s.findClosest(e.coordinate)):((s instanceof fe||s instanceof Lo)&&r.getMap().getScale()>=8&&(e.coordinate=r._rectifyMouseCoordinte(s,e.coordinate)),r.show(e.coordinate))},1)},i._rectifyMouseCoordinte=function(e,r){var s=this;return e instanceof fe?this._rectifyLineStringMouseCoordinate(e,r).coordinate:e instanceof Lo?e.getGeometries().map(function(a){return s._rectifyLineStringMouseCoordinate(a,r)}).sort(function(a,h){return a.dis-h.dis})[0].coordinate:r},i._rectifyLineStringMouseCoordinate=function(e,r){for(var s=this,a=e.getCoordinates().map(function(j){return s.getMap().coordToContainerPoint(j)}),h=this.getMap().coordToContainerPoint(r),l=1/0,c=-1,u=0,f=a.length;u<f;u++){var d=a[u],p=h.distanceTo(d);p<l&&(l=p,c=u)}var g=[];c===0?g.push(a[0],a[1]):c===a.length-1?g.push(a[c-1],a[c]):g.push(a[c-1],a[c],a[c+1]);for(var m=[],v=this.getMap().getSize(),x=v.width,_=v.height,y=0,b=g.length-1;y<b;y++){var M=g[y],C=g[y+1];if(M.x===C.x)for(var w=Math.max(0,Math.min(M.y,C.y)),S=Math.min(_,Math.max(M.y,C.y)),P=w;P<=S;P++)m.push(new W(M.x,P));else for(var O=(C.y-M.y)/(C.x-M.x),D=Math.max(0,Math.min(M.x,C.x)),L=Math.min(x,Math.max(M.x,C.x)),T=D;T<=L;T++){var A=O*(T-M.x)+M.y;m.push(new W(T,A))}}for(var N=1/0,B=-1,F=0,I=m.length;F<I;F++){var z=m[F],Z=h.distanceTo(z);Z<N&&(N=Z,B=F)}return{dis:N,coordinate:B<0?r:this.getMap().containerPointToCoord(m[B])}},i._getWindowWidth=function(){var e=__.width,r=this.options.width;return r||(r=e),r},t}(Un);Rh.mergeOptions(__);var Sg="remove hide shapechange positionchange dragend animatestart",EP={width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400},y_=function(o){ht(i,o);var t=i.prototype;t._getClassName=function(){return"ToolTip"};function i(n,e){var r;return e===void 0&&(e={}),r=o.call(this,e)||this,r._content=n,r}return t.addTo=function(e){if(i.isSupport(e))return e.on("mousemove",this.onMouseMove,this),e.on("mouseout",this.onMouseOut,this),e.on(Sg,this.hideDom,this),o.prototype.addTo.call(this,e);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},t.setStyle=function(e){return this.options.containerClass=e,this},t.getStyle=function(){return this.options.containerClass},t.getContent=function(){return this._content},t.buildOn=function(){var e=Et("div"),r=this.options||{};r.height&&(e.style.height=r.height+"px"),r.width&&(e.style.width=r.width+"px");var s=r.containerClass||r.cssName;return!s&&r.height&&(e.style.lineHeight=r.height+"px"),ne(this._content)?this._content.bind(this)(e):e.innerHTML='<div class="'+s+'">'+this._content+"</div>",e},t.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},t.onMouseMove=function(e){var r=this;clearTimeout(this._timeout);var s=this.getMap();if(!!s){var a=s.locateByPoint(e.coordinate,-5,25);this.options.showTimeout===0?this.show(a):this._timeout=setTimeout(function(){s&&r.show(a)},this.options.showTimeout)}},t.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(Sg,this.hideDom,this))},t.hideDom=function(){return this.hide()},t.onEvent=function(){return o.prototype.onEvent.call(this),this.hideDom(),this},t._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},i}(Un);y_.mergeOptions(EP);var AP={containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]},Cf=function(o){ht(t,o);function t(n){return o.call(this,n)||this}var i=t.prototype;return i._getClassName=function(){return"Menu"},i.addTo=function(e){return e._menu&&e._menu!==this&&e.removeMenu(),e._menu=this,this._owner=e,Un.prototype.addTo.apply(this,arguments)},i.setItems=function(e){return this.options.items=e,this},i.getItems=function(){return this.options.items||[]},i.buildOn=function(){if(this.options.custom)if(Xt(this.options.items)){var e=Et("div");return e.innerHTML=this.options.items,e}else return this.options.items;else{var r=Et("div");this.options.containerClass&&mr(r,this.options.containerClass),r.style.width=this._getMenuWidth()+"px";var s=this._createMenuItemDom();return r.appendChild(s),we(r,"contextmenu",ai),r}},i.getOffset=function(){if(!this.getMap())return null;var e=this.getMap().getSize(),r=this.getMap().viewPointToContainerPoint(this._getViewPoint()),s=this.getSize(),a=0,h=0;return r.x+s.width>e.width&&(a=-s.width),r.y+s.height>e.height&&(h=-s.height),new W(a,h)},i.getTransformOrigin=function(){var e=this.getOffset()._multi(-1);return e.x+"px "+e.y+"px"},i.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},i._createMenuItemDom=function(){var e=this,r=this.getMap(),s=Et("ul");mr(s,"maptalks-menu-items");var a=this.getItems();function h(g){return function(m){var v=r._parseEvent(m,"click");v.target=e,v.owner=e._owner,v.index=g;var x=this._callback(v);x!==!1&&(e.hide(),e._owner&&e._owner.fire("closemenu"))}}for(var l,c,u=0,f=a.length;u<f;u++){if(l=a[u],l==="-"||l==="_")c=Et("li"),mr(c,"maptalks-menu-splitter");else{c=Et("li");var d=l.item;ne(d)&&(d=d({owner:this._owner,index:u})),c.innerHTML=d,c._callback=l.click,we(c,"click",h(u))}s.appendChild(c)}var p=this.options.maxHeight||0;return p>0&&Zh(s,"max-height: "+p+"px; overflow-y: auto;"),s},i._getMenuWidth=function(){var e=160,r=this.options.width||e;return r},t}(Un);Cf.mergeOptions(AP);var Tf={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(t){var i=this instanceof Bt?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&i&&(this._bindMenu(),this._menu.show(t)),this.fire("openmenu",{coordinate:t}),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions?this._menuOptions.items||[]:[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new Cf(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return this.openMenu(t.coordinate),!1}};Bt.include(Tf);Jt.include(Tf);var Oh=Object.freeze({UIComponent:Un,UIMarker:Qh,InfoWindow:Rh,ToolTip:y_,Menuable:Tf,Menu:Cf}),cn=function(o){ht(t,o);function t(n){return n&&n.position&&!Xt(n.position)&&(n.position=dt({},n.position)),o.call(this,n)||this}var i=t.prototype;return i.addTo=function(e){if(this.remove(),!e.options.control)return this;this._map=e;var r=e._panels.control;return this.__ctrlContainer=Et("div"),Zh(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),r.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:r}),this},i.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},i.getMap=function(){return this._map},i.getPosition=function(){return dt({},this._parse(this.options.position))},i.setPosition=function(e){return Xt(e)?this.options.position=e:this.options.position=dt({},e),this._updatePosition(),this},i.getContainerPoint=function(){var e=this.getPosition(),r=this.getMap().getSize(),s,a;return H(e.left)?H(e.right)||(s=r.width-parseInt(e.right)):s=parseInt(e.left),H(e.top)?H(e.bottom)||(a=r.height-parseInt(e.bottom)):a=parseInt(e.top),new W(s,a)},i.getContainer=function(){return this.__ctrlContainer},i.getDOM=function(){return this._controlDom},i.show=function(){return this.__ctrlContainer.style.display="",this},i.hide=function(){return this.__ctrlContainer.style.display="none",this},i.isVisible=function(){return this.__ctrlContainer&&this.__ctrlContainer.style.display===""},i.remove=function(){return this._map?(br(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},i._parse=function(e){var r=e;return Xt(e)&&(r=t.positions[r]),r},i._updatePosition=function(){var e=this.getPosition();e||(e={top:20,left:20});for(var r in e)e.hasOwnProperty(r)&&(e[r]=parseInt(e[r]),this.__ctrlContainer.style[r]=e[r]+"px");this.fire("positionchange",{position:dt({},e)})},t}(Ui(wi));cn.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}};Bt.mergeOptions({control:!0});Bt.include({addControl:function(t){return this._containerDOM.getContext?this:(t.addTo(this),this)},removeControl:function(t){return!t||t.getMap()!==this?this:(t.remove(),this)}});var LP={position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'},Cg="addlayer removelayer setbaselayer baselayerremove",x_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.buildOn=function(){return this._attributionContainer=Et("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},i.onAdd=function(){this.getMap().on(Cg,this._update,this)},i.onRemove=function(){this.getMap().off(Cg,this._update,this)},i._update=function(){var e=this.getMap();if(!!e){var r=e._getLayers(function(a){return a.options.attribution}).reverse().map(function(a){return a.options.attribution}),s=this.options.content+(r.length>0?" - "+r.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+s+"</span>"}},t}(cn);x_.mergeOptions(LP);Bt.mergeOptions({attribution:!0});Bt.addOnLoadHook(function(){var o=this.options.attribution||this.options.attributionControl;o&&(this.attributionControl=new x_(o),this.addControl(this.attributionControl))});var RP={position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"},w_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.buildOn=function(){var e=this.container=Et("div",this.options.containerClass),r=this.panel=Et("div","panel"),s=this.button=Et("button");return e.appendChild(s),e.appendChild(r),e},i.onAdd=function(){we(this.button,"mouseover",this._show,this),we(this.panel,"mouseleave",this._hide,this),we(this.getMap(),"click",this._hide,this)},i.onRemove=function(){this.panel&&(ge(this.button,"mouseover",this._show),ge(this.panel,"mouseleave",this._hide),ge(this.getMap(),"click",this._hide),br(this.panel),br(this.button),delete this.panel,delete this.button,delete this.container)},i._show=function(){hf(this.container,"shown")||(mr(this.container,"shown"),this._createPanel())},i._hide=function(e){this.panel.contains(e.toElement||e.relatedTarget)||Xh(this.container,this.options.containerClass)},i._createPanel=function(){this.panel.innerHTML="";var e=Et("ul");this.panel.appendChild(e),this._renderLayers(this.getMap(),e)},i._renderLayers=function(e,r){var s=this,a=e.getBaseLayer(),h=e.getLayers(),l=h.length;if(a){var c=a.layers||[a],u=Et("li","group"),f=Et("ul"),d=Et("label");d.innerHTML=this.options.baseTitle,u.appendChild(d);for(var p=0,g=c.length;p<g;p++){var m=c[p];this._isExcluded(m)&&(f.appendChild(this._renderLayer(c[p],!0)),u.appendChild(f),r.appendChild(u))}}if(l){var v=Et("li","group"),x=Et("ul"),_=Et("label"),y=Et("input");y.type="checkbox",y.checked=!0,_.innerHTML=this.options.overlayTitle,v.appendChild(y),v.appendChild(_);for(var b=function(S){var P=S.target.checked,O=S.target.parentNode;if(!!O){var D=O.getElementsByTagName("ul")[0];if(!!D){var L=function(N){var B=N._layer;B&&B[P?"show":"hide"]()},T=function(N){var B=N._layer,F=N.childNodes[0];F&&(F.checked=P),B&&B[P?"show":"hide"]()};L(O),D.childNodes.forEach(function(A){T(A);var N=A.getElementsByTagName("ul")[0];!N||(L(A),N.childNodes.forEach(function(B){T(B)}))})}}},M=0;M<l;M++){var C=h[M];this._isExcluded(C)&&(C.getLayers?function(){var w=Et("li","group"),S=Et("ul"),P=Et("label"),O=Et("input");P.innerHTML=C.getId(),O.type="checkbox",O.checked=C.isVisible(),O.onchange=b,w.appendChild(O),w.appendChild(P),w.appendChild(S),w._layer=C,x.appendChild(w);var D=C.getLayers()||[];D.forEach(function(L){S.appendChild(s._renderLayer(L,!1,O.checked))})}():x.appendChild(this._renderLayer(C)),C&&!C.isVisible()&&(y.checked=!1))}v.appendChild(x),r.appendChild(v),y.onchange=b}},i._isExcluded=function(e){var r=e.getId(),s=this.options.excludeLayers;return!(s.length&&s.indexOf(r)>=0)},i._renderLayer=function(e,r,s){var a=this;s===void 0&&(s=!0);var h=Et("li","layer"),l=Et("label"),c=Et("input"),u=this.getMap(),f=e.options.visible;e.options.visible=!0;var d=e.isVisible();return e.options.visible=f,h.className="layer",r?(c.type="radio",c.name="base"):c.type="checkbox",c.checked=f&&d,s||(c.checked=!1),d||c.setAttribute("disabled","disabled"),c.onchange=function(p){if(p.target.type==="radio"){var g=u.getBaseLayer(),m=g.layers;if(m)for(var v=0,x=m.length;v<x;v++){var _=m[v];_[_===e?"show":"hide"]()}else g.isVisible()||g.show();u._fireEvent("setbaselayer")}else e[p.target.checked?"show":"hide"]();a.fire("layerchange",{target:e})},h.appendChild(c),l.innerHTML=e.getId(),h.appendChild(l),h._layer=e,h},t}(cn);w_.mergeOptions(RP);Bt.mergeOptions({layerSwitcherControl:!1});Bt.addOnLoadHook(function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new w_(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))});var OP={level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"},M_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.buildOn=function(){var e=this.options.size;this.options.maximize||(e=[0,0]);var r=Et("div"),s=this.mapContainer=Et("div");s.style.width=e[0]+"px",s.style.height=e[1]+"px",s.className=this.options.containerClass;var a=this.button=Et("div");return a.className=this.options.buttonClass,r.appendChild(s),r.appendChild(a),r},i.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),we(this.button,"click",this._onButtonClick,this),this._updateButtonText()},i.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),ge(this.button,"click",this._onButtonClick)},i.maxmize=function(){var e=this.options.size,r=this.mapContainer;return r.style.width=e[0]+"px",r.style.height=e[1]+"px",this._createOverview(),this},i.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var e=this.mapContainer;return e.style.width=0+"px",e.style.height=0+"px",this},i.getOverviewMap=function(){return this._overview},i._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},i._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},i._createOverview=function(){var e=this.getMap(),r=this.mapContainer,s=e.config();dt(s,{center:e.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new Bt(r,s),this._updateBaseLayer(),this._perspective=new ie(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new Bi("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},i._getOverviewZoom=function(){var e=this.getMap(),r=e.getZoom(),s=e.getMinZoom(),a=this.options.level;if(a>0){for(var h=a;h>0;h--)if(r-h>=s)return r-h}else for(var l=a;l<0;l++)if(r-l>=s)return r-l;return r},i._onDragEnd=function(){var e=this._perspective.getCenter();this._overview.setCenter(e),this.getMap().panTo(e)},i._getPerspectiveCoords=function(){var e=this.getMap(),r=e.getProjection();return e.getContainerExtent().toArray().map(function(s){if(r){var a=e._containerPointToPrj(s);return e._fixPrjOnWorldWide(a),r.unproject(a)}return e.containerPointToCoordinate(s)})},i._update=function(){if(!!this._overview){Zo(this._overview._containerDOM);var e=this._getPerspectiveCoords();this._perspective.setCoordinates(e),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},i._updateSpatialReference=function(){if(!!this._overview){var e=this.getMap(),r=e.options.spatialReference;this._overview.setSpatialReference(r)}},i._updateBaseLayer=function(){if(!!this._overview){var e=this.getMap(),r=e.getBaseLayer();if(!r){this._overview.setBaseLayer(null);return}var s=r.layers,a=0;if(s)for(var h=0,l=s.length;h<l;h++){var c=s[h];if(c.isVisible()){a=h;break}}var u=r.toJSON(),f=null;s?(f=u.layers[a].options,f.visible=!0):f=u.options,this._overview.setMinZoom(f.minZoom||null).setMaxZoom(f.maxZoom||null),delete f.minZoom,delete f.maxZoom,delete u.options.canvas,u.options.visible=!0,u.options.renderer="canvas";var d=Je.fromJSON(u);for(var p in r)ne(r[p])&&r.hasOwnProperty(p)&&r[p]!==r.constructor.prototype[p]&&(d[p]=r[p]);this._overview.setBaseLayer(d)}},t}(cn);M_.mergeOptions(OP);Bt.mergeOptions({overviewControl:!1});Bt.addOnLoadHook(function(){this.options.overviewControl&&(this.overviewControl=new M_(this.options.overviewControl),this.addControl(this.overviewControl))});var DP={position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0},IP=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.buildOn=function(){var e;if(this.options.custom)Xt(this.options.content)?(e=Et("div"),e.innerHTML=this.options.content):e=this.options.content;else{if(e=Et("div","maptalks-panel"),this.options.closeButton){var r=Et("a","maptalks-close");r.href="javascript:;",r.onclick=function(){e.style.display="none"},e.appendChild(r)}var s=Et("div","maptalks-panel-content");s.innerHTML=this.options.content,e.appendChild(s)}return this.draggable=new ks(e,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),e},i.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),cn.prototype.update.call(this)},i.setContent=function(e){var r=this.options.content;return this.options.content=e,this.fire("contentchange",{old:r,new:e}),this.isVisible()&&this.update(),this},i.getContent=function(){return this.options.content},i._cancelOn=function(e){var r=e.srcElement||e.target,s=r.tagName.toLowerCase();return s==="button"||s==="input"||s==="select"||s==="option"||s==="textarea"},i._onDragStart=function(e){this._startPos=e.mousePos,this._startPosition=dt({},this.getPosition()),this.fire("dragstart",e)},i._onDragging=function(e){var r=e.mousePos,s=r.sub(this._startPos),a=this._startPosition,h=this.getPosition();H(h.top)||(h.top=parseInt(a.top)+s.y),H(h.bottom)||(h.bottom=parseInt(a.bottom)-s.y),H(h.left)||(h.left=parseInt(a.left)+s.x),H(h.right)||(h.right=parseInt(a.right)-s.x),this.setPosition(h),this.fire("dragging",e)},i._onDragEnd=function(e){delete this._startPos,delete this._startPosition,this.fire("dragend",e)},i._getConnectPoints=function(){var e=this.getMap(),r=this.getContainerPoint(),s=this.getDOM(),a=parseInt(s.clientWidth),h=parseInt(s.clientHeight),l=[e.containerPointToCoordinate(r.add(a/2,0)),e.containerPointToCoordinate(r.add(a,h/2)),e.containerPointToCoordinate(r.add(a/2,h)),e.containerPointToCoordinate(r.add(0,h/2))];return l},t}(cn);IP.mergeOptions(DP);var kP={position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null},b_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.buildOn=function(e){return this._map=e,this._scaleContainer=Et("div",this.options.containerClass),this._addScales(),e.on("zoomend",this._update,this),this._map._loaded&&this._update(),this._scaleContainer},i.onRemove=function(){this.getMap().off("zoomend",this._update,this)},i._addScales=function(){var e="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=gu("div",this.options.containerClass?null:e,this._scaleContainer)),this.options.imperial&&(this._iScale=gu("div",this.options.containerClass?null:e,this._scaleContainer))},i._update=function(){var e=this._map,r=e.pixelToDistance(this.options.maxWidth,0);this._updateScales(r)},i._updateScales=function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},i._updateMetric=function(e){var r=this._getRoundNum(e),s=r<1e3?r+" m":r/1e3+" km";this._updateScale(this._mScale,s,r/e)},i._updateImperial=function(e){var r=e*3.2808399,s,a,h;r>5280?(s=r/5280,a=this._getRoundNum(s),this._updateScale(this._iScale,a+" mile",a/s)):(h=this._getRoundNum(r),this._updateScale(this._iScale,h+" feet",h/r))},i._updateScale=function(e,r,s){e.style.width=Math.round(this.options.maxWidth*s)+"px",e.innerHTML=r},i._getRoundNum=function(e){var r=Math.pow(10,(Math.floor(e)+"").length-1),s=e/r;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,r*s},t}(cn);b_.mergeOptions(kP);Bt.mergeOptions({scaleControl:!1});Bt.addOnLoadHook(function(){this.options.scaleControl&&(this.scaleControl=new b_(this.options.scaleControl),this.addControl(this.scaleControl))});var zP={height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}},FP=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.buildOn=function(e){this._map=e;var r=Et("div"),s=Et("ul","maptalks-toolbar-hx");r.appendChild(s),this.options.vertical?mr(r,"maptalks-toolbar-vertical"):mr(r,"maptalks-toolbar-horizonal");var a=this;function h(m,v,x,_){var y=a._getItems()[v];return function(b){return ni(b),m({target:y,index:v,childIndex:x,dom:_})}}var l=this.options.items;if(ee(l))for(var c=0,u=l.length;c<u;c++){var f=l[c],d=Et("li");if(this.options.height!==28&&(d.style.lineHeight=this.options.height+"px"),d.style.height=this.options.height+"px",d.style.cursor="pointer",xv(f.item)){d.style.textAlign="center";var p=wv("div",f.item);d.innerHTML='<div style="margin-top:'+(this.options.height-p.height)/2+'px;">'+f.item+"</div>"}else d.innerHTML=f.item;if(f.click&&we(d,"click",h(f.click,c,null,d)),ee(f.children)){var g=this._createDropMenu(c);d.appendChild(g),d._menu=g,we(d,"mouseover",function(){this._menu.style.display=""}),we(d,"mouseout",function(){this._menu.style.display="none"})}s.appendChild(d)}return r},i._createDropMenu=function(e){var r=this;function s(b,M,C){var w=r._getItems()[M].children[C];return function(S){return ni(S),b({target:w,index:M,childIndex:C})}}var a=Et("div","maptalks-dropMenu"),h=this._getItems(),l=h.length,c=Et("ul"),u=h[e].children;e===l-1&&u&&(a.style.cssText="right: 0px;",c.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(c.style.bottom=0)),a.appendChild(Et("em","maptalks-ico"));for(var f=0,d=0,p=u.length;d<p;d++){var g=ef(u[d].item,"12px");g.width>f&&(f=g.width)}for(var m=0,v=u.length;m<v;m++){var x=u[m],_=Et("li");_.innerHTML='<a href="javascript:;">'+x.item+"</a>",_.style.cursor="pointer",_.style.width=f+24+"px",we(_.childNodes[0],"click",s(x.click,e,m)),c.appendChild(_)}if(this.options.vertical){var y=f<95?95:f;this.options.reverseMenu?a.style.right=-(y+10*2)+"px":a.style.left=-(y+10*2)+"px"}else this.options.reverseMenu?a.style.bottom="28px":a.style.top="28px";return a.appendChild(c),a.style.display="none",a},i._getItems=function(){return this.options.items||[]},t}(cn);FP.mergeOptions(zP);var NP={position:"top-left",slider:!0,zoomLevel:!0,seamless:!1},ir=10,S_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.buildOn=function(e){var r=this.options,s=Et("div","maptalks-zoom");if(r.zoomLevel){var a=Et("span","maptalks-zoom-zoomlevel");s.appendChild(a),this._levelDOM=a}var h=Et("div","maptalks-zoom-slider"),l=Et("a","maptalks-zoom-zoomin");if(l.href="javascript:;",l.innerHTML="+",h.appendChild(l),this._zoomInButton=l,r.slider){var c=Et("div","maptalks-zoom-slider-box"),u=Et("div","maptalks-zoom-slider-ruler"),f=Et("span","maptalks-zoom-slider-reading"),d=Et("span","maptalks-zoom-slider-dot");u.appendChild(f),c.appendChild(u),c.appendChild(d),h.appendChild(c),this._sliderBox=c,this._sliderRuler=u,this._sliderReading=f,this._sliderDot=d}var p=Et("a","maptalks-zoom-zoomout");return p.href="javascript:;",p.innerHTML="-",h.appendChild(p),this._zoomOutButton=p,s.appendChild(h),e.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),s},i.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._zoomInButton&&ge(this._zoomInButton,"click",this._onZoomInClick),this._zoomOutButton&&ge(this._zoomOutButton,"click",this._onZoomOutClick),this._sliderRuler&&(ge(this._sliderRuler,"click",this._onClickRuler),this.dotDragger.disable(),delete this.dotDragger)},i._update=function(){var e=this.getMap();if(this._sliderBox){var r=(e.getMaxZoom()-e.getMinZoom())*ir;this._sliderBox.style.height=r+16+"px",this._sliderRuler.style.height=r+8+"px",this._sliderRuler.style.cursor="pointer";var s=(e.getMaxZoom()-e.getZoom())*ir;this._sliderReading.style.height=(e.getZoom()-e.getMinZoom()+1)*ir+"px",this._sliderDot.style.top=s+"px"}this._updateText()},i._updateText=function(){if(this._levelDOM){var e=this.getMap(),r=e.getZoom();en(r)||(r=Math.floor(r*10)/10),this._levelDOM.innerHTML=r}},i._registerDomEvents=function(){this._zoomInButton&&we(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&we(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(we(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger=new ks(this._sliderDot,{ignoreMouseleave:!0}),this.dotDragger.on("dragstart",this._onDotDragstart,this).on("dragging dragend",this._onDotDrag,this).enable())},i._onZoomInClick=function(e){ai(e),this.getMap().zoomIn()},i._onZoomOutClick=function(e){ai(e),this.getMap().zoomOut()},i._onClickRuler=function(e){ai(e);var r=this.getMap(),s=$e(e,this._sliderRuler),a=s.y,h=r.getMaxZoom(),l=Math.floor(h-a/ir);r.setZoom(l)},i._onDotDragstart=function(e){ai(e.domEvent);var r=this.getMap(),s=r.getSize().toPoint()._multi(1/2);r.onZoomStart(r.getZoom(),s)},i._onDotDrag=function(e){ai(e.domEvent);var r=this.getMap(),s=r.getSize().toPoint()._multi(1/2),a=$e(e.domEvent,this._sliderRuler),h=r.getMaxZoom(),l=r.getMinZoom(),c=a.y,u=h-c/ir;h<u?(u=h,c=0):l>u&&(u=l,c=(h-l)*ir),e.type==="dragging"?r.onZooming(u,s,1):e.type==="dragend"&&(this.options.seamless?r.onZoomEnd(u,s):r.onZoomEnd(Math.round(u),s)),this._sliderDot.style.top=c+"px",this._sliderReading.style.height=(r.getZoom()-l+1)*ir+"px",this._updateText()},t}(cn);S_.mergeOptions(NP);Bt.mergeOptions({zoomControl:!1});Bt.addOnLoadHook(function(){this.options.zoomControl&&(this.zoomControl=new S_(this.options.zoomControl),this.addControl(this.zoomControl))});var Rn=function(){function o(t,i,n,e){Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:i},this.origin={x:n,y:e})}return o.getDefault=function(i){return i.code.toLowerCase()==="baidu"?"baidu":i.code.toLowerCase()==="EPSG:4326".toLowerCase()?"tms-global-geodetic":i.code.toLowerCase()==="identity"?[1,-1,0,0]:"web-mercator"},o}(),Ha=6378137*Math.PI;dt(Rn,{"web-mercator":new Rn([1,-1,-Ha,Ha]),"tms-global-mercator":new Rn([1,1,-Ha,-Ha]),"tms-global-geodetic":new Rn([1,1,-180,-90]),baidu:new Rn([1,1,0,0])});var Tg=function(){function o(i,n,e,r){this.map=i,this.tileSize=r,this.fullExtent=e,this.prepareTileInfo(n,e),this._xScale=e.right>=e.left?1:-1,this._yScale=e.top>=e.bottom?1:-1;var s=i.getGLRes();this._pointOrigin=i._prjToPointAtRes(new W(this.tileSystem.origin),s),this._glRes=s}var t=o.prototype;return t.prepareTileInfo=function(n,e){if(Xt(n)?n=Rn[n.toLowerCase()]:Array.isArray(n)&&(n=new Rn(n)),!n)throw new Error("Invalid TileSystem");this.tileSystem=n;var r=e.right>e.left?1:-1,s=e.top>e.bottom?-1:1,a=n.origin.x,h=n.origin.y;this.transformation=new Av([r,s,a,h])},t._getTileNum=function(n,e){var r=this.tileSystem,s=this.tileSize,a=1e-7,h=Math.floor(a*r.scale.x+n.x/(s.width*e)),l=Math.ceil(a*r.scale.y+n.y/(s.height*e));return{x:r.scale.x*h,y:r.scale.y*l}},t.getTileIndex=function(n,e,r){var s=this.tileSystem,a=this.transformation.transform(n,1),h=this._getTileNum(a,e);return s.scale.x<0&&(h.x-=1),s.scale.y>0&&(h.y-=1),this.getNeighorTileIndex(h.x,h.y,0,0,e,r)},t.getNeighorTileIndex=function(n,e,r,s,a,h){var l=this.tileSystem,c=n+l.scale.x*r,u=e-l.scale.y*s,f=!1,d=c,p=u,g=this._getTileFullIndex(a);return h&&((h===!0||h==="x")&&(g.xmax===g.xmin?c=g.xmin:c<g.xmin?(c=g.xmax-(g.xmin-c)%(g.xmax-g.xmin),c===g.xmax&&(c=g.xmin)):c>=g.xmax&&(c=g.xmin+(c-g.xmin)%(g.xmax-g.xmin))),(h===!0||h==="y")&&(g.ymax===g.ymin?u=g.ymin:u>=g.ymax?u=g.ymin+(u-g.ymin)%(g.ymax-g.ymin):u<g.ymin&&(u=g.ymax-(g.ymin-u)%(g.ymax-g.ymin),u===g.ymax&&(u=g.ymin)))),(c<g.xmin||c>g.xmax||u>g.ymax||u<g.ymin)&&(f=!0),{x:c,y:u,idx:d,idy:p,out:f}},t._getTileFullIndex=function(n){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[n])return this._tileFullIndex[n];var e=this.fullExtent,r=this.transformation,s=this._getTileNum(r.transform(new q(e.left,e.top),1),n),a=this._getTileNum(r.transform(new q(e.right,e.bottom),1),n),h=this.tileSystem;return h.scale.x<0&&(s.x-=1,a.x-=1),h.scale.y>0&&(s.y-=1,a.y-=1),this._tileFullIndex[n]=new oe(s,a),this._tileFullIndex[n]},t.getTilePrjNW=function(n,e,r){var s=this.tileSystem,a=this.tileSize,h=s.origin.y+this._yScale*s.scale.y*(e+(s.scale.y===1?1:0))*r*a.height,l=s.origin.x+this._xScale*s.scale.x*(n+(s.scale.x===1?0:1))*r*a.width;return new q(l,h)},t.getTilePointNW=function(n,e,r){var s=this._glRes/r,a=this.tileSystem,h=this.tileSize,l=this._pointOrigin.y*s+this._yScale*a.scale.y*(e+(a.scale.y===1?1:0))*h.height,c=this._pointOrigin.x*s+this._xScale*a.scale.x*(n+(a.scale.x===1?0:1))*h.width;return new W(c,l)},t.getTilePrjSE=function(n,e,r){var s=this.tileSystem,a=this.tileSize,h=s.origin.y+this._yScale*s.scale.y*(e+(s.scale.y===1?0:1))*r*a.height,l=s.origin.x+this._xScale*s.scale.x*(n+(s.scale.x===1?1:0))*r*a.width;return new q(l,h)},t.getTilePointSE=function(n,e,r){var s=this._glRes/r,a=this.tileSystem,h=this.tileSize,l=this._pointOrigin.y*s+this._yScale*a.scale.y*(e+(a.scale.y===1?0:1))*h.height,c=this._pointOrigin.x*s+this._xScale*a.scale.x*(n+(a.scale.x===1?1:0))*h.width;return new W(c,l)},t.getTilePrjExtent=function(n,e,r){var s=this.getTilePrjNW(n,e,r),a=this.getTilePrjSE(n,e,r);return new oe(s,a)},o}(),BP=1,to=new W(0,0),GP=32,Ua=typeof Set<"u",Pg=function(){function o(){this._table=Ua?new Set:{}}var t=o.prototype;return t.add=function(n){Ua?this._table.add(n):this._table[n]=!0},t.has=function(n){return Ua?this._table.has(n):this._table[n]},t.reset=function(){Ua?this._table.clear():this._table={}},o}(),HP={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,backgroundZoomDiff:6,loadingLimitOnInteracting:3,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!De,debug:!1,spatialReference:null,maxCacheSize:256,renderer:function(){return jt.webgl?"gl":"canvas"}(),clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,backZoomOffset:0},UP=/\{ *([\w_]+) *\}/g,VP=new W(0,0),Va=new W(0,0),eo=new W(0,0),Sn=new W(0,0),WP=new W(0,0),jP=new W(0,0),je=[[0,0,0],[0,0,0]],Rc=[0,0,0],Oc=[0,0,0],Dc=[],vi=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}t.fromJSON=function(e){return!e||e.type!=="TileLayer"?null:new t(e.id,e.options)};var i=t.prototype;return i.getTileSize=function(){if(this._tileSize)return this._tileSize;var e=this.options.tileSize;return St(e)&&(e=[e,e]),this._tileSize=new Pe(e),this._tileSize},i.getTiles=function(e,r){return this._coordCache={},this._isPyramidMode()?this._getPyramidTiles(e,r):this._getCascadeTiles(e,r)},i._isPyramidMode=function(){var e=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&e&&e.isPyramid()},i._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var e=this.getSpatialReference(),r=e.getFullExtent(),s=e.getResolution(0),a=this.getMap();return this._tileFullExtent=r.convertTo(function(h){return a._prjToPointAtRes(h,s,to)}),this._tileFullExtent},i._getRootNodes=function(e){var r=this.getMap();if(this._rootNodes){var s=this._rootNodes,a=s.tiles,h=s.mapWidth,l=s.mapHeight;if(r.width!==h||r.height!==l){for(var c=this._getRootError(),u=0;u<a.length;u++)a[u].error=c;this._rootNodes.mapWidth=r.width,this._rootNodes.mapHeight=r.height}for(var f=0;f<a.length;f++)a[f].offset[0]=e[0],a[f].offset[1]=e[1];return this._rootNodes}var d=this.getSpatialReference(),p=d.getResolution(0),g=this._getTileConfig(),m=d.getFullExtent(),v=g.tileSystem,x=v.origin,_=v.scale,y=g.getTilePrjExtent(0,0,p),b=y.getWidth(),M=y.getHeight(),C=1e-5,w=Math.abs((x.x-m.left)/b);w=Math.ceil(w-C);var S=Math.abs((m.right-x.x)/b);S=Math.ceil(S-C);var P=Math.ceil(Math.abs(m.top-x.y)/M);P=Math.ceil(P-C);var O=Math.ceil(Math.abs(m.bottom-x.y)/M);if(O=Math.ceil(O-C),(S+w)*(O+P)>GP)return{status:0,error:"Too many root nodes"};for(var D=this._getRootError(),L=[],T=0,A=-w;A<S;A++)for(var N=-P;N<O;N++){var B=_.y<0?N:-(N+1);L.push({x:A,y:B,z:T,idx:A,idy:B,res:p,extent2d:g.getTilePrjExtent(A,B,p).convertTo(function(F){return r._prjToPointAtRes(F,p,to)}),id:this._getTileId(A,B,T),url:this.getTileUrl(A,B,T+this.options.zoomOffset),offset:[0,0],error:D,children:[]})}return this._rootNodes={status:1,tiles:L,mapWidth:r.width,mapHeight:r.height},this._getRootNodes(e)},i._getRootError=function(){var e=this.getMap(),r=He(e.getFov()),s=e.width/e.height,a=e.cameraPosition[2],h=a*Math.tan(.5*r),l=h*s,c=Math.sqrt(a*a+h*h+l*l),u=e._getFovZ(0),f=u*(c/a),d=this.getSpatialReference(),p=d.getResolution(0);return f*p/e.getResolution(0)},i._getPyramidTiles=function(e,r){var s=this.getMap();isNaN(+e)&&(e=this._getTileZoom(s.getZoom()));var a=this.getSpatialReference(),h=Math.min(e,this.getMaxZoom()),l=s.projViewMatrix,c=this._getTileFullExtent(),u=this._getTileOffset(0),f;if(this.options.repeatWorld){var d=s.getContainerExtent(),p=this._convertToExtent2d(d),g=a.getResolution(0)/s.getResolution();if(p.within(c.copy()._scale(g))){var M=this._getRootNodes(u);if(M.status!==1)return this._disablePyramid=!0,this.getTiles(e,r);f=M.tiles.concat()}else{var m=s.getPitch(),v=s.options.cascadePitches[1],x=Math.floor(s._getVisualHeight(v)),_=m<=v?d:new Vt(0,s.height-x,s.width,s.height);this._visitedTiles=new Pg;var y=this._getTiles(0,_,2,r&&r.getRenderer(),!0),b=this._getRootError();y.tiles.forEach(function(T){T.error=b}),f=y.tiles}}else{var C=this._getRootNodes(u);if(C.status!==1)return this._disablePyramid=!0,this.getTiles(e,r);f=C.tiles.concat()}for(var w=s.getGLRes(),S={0:u},P=this.options.backZoomOffset+e,O=new Vt,D=[];f.length>0;){var L=f.pop();if(L.z===h){O._combine(L.extent2d),D.push(L);continue}S[L.z+1]||(S[L.z+1]=this._getTileOffset(L.z+1)),this._splitNode(L,l,f,D,O,h,S[L.z+1],r&&r.getRenderer(),w),P<e&&D[D.length-1]!==L&&P===L.z&&D.push(L)}return{tileGrids:[{extent:O,count:D.length,tiles:D,offset:[0,0],zoom:e}],count:D.length}},i._splitNode=function(e,r,s,a,h,l,c,u,f){for(var d=this._getTileConfig().tileSystem,p=d.scale.y,g=e.z+1,m=this.getSpatialReference(),v=e.x,x=e.y,_=e.extent2d,y=e.idx,b=e.idy,M=2,C=_.getWidth()/2*M,w=_.getHeight()/2*M,S=_.xmin*M,P=_.ymax*M,O=_.ymin*M,D=u||this.getRenderer(),L=!1,T=[],A=m.getResolution(g),N=A/f,B=0;B<4;B++){var F=B%2,I=B>>1,z=(v<<1)+F,Z=(x<<1)+I,j=(y<<1)+F,K=(b<<1)+I;e.children||(e.children=[]);var et=e.children[B];et||(et=this._getTileId(j,K,g),e.children[B]=et);var st=D.isTileCachedOrLoading(et),V=void 0,pt=st&&st.info;if(!pt){if(this.tileInfoCache||(this.tileInfoCache=new Tv(this.options.maxCacheSize*4)),pt=this.tileInfoCache.get(et),!pt){if(p<0){var xt=S+F*C,ut=P-I*w;V=new Vt(xt,ut-w,xt+C,ut)}else{var ft=S+F*C,kt=O+I*w;V=new Vt(ft,kt,ft+C,kt+w)}pt={x:z,y:Z,idx:j,idy:K,z:g,extent2d:V,error:e.error/2,res:A,id:et,parentNodeId:e.id,children:[],url:this.getTileUrl(z,Z,g+this.options.zoomOffset),offset:c},this.tileInfoCache.add(et,pt)}u&&(pt.layer=this.getId())}pt.error=e.error/2,pt.offset[0]=c[0],pt.offset[1]=c[1];var J=this._isTileVisible(pt,r,N,l,c);if(J===1)L=!0;else{if(J===-1)continue;if(J===0&&g!==l){a.push(e),h._combine(e.extent2d);return}}T.push(pt)}g===l?L?s.push.apply(s,T):(a.push(e),h._combine(e.extent2d)):s.push.apply(s,T)},i._isTileVisible=function(e,r,s,a,h){if(e.z===0)return 1;if(!this._isTileInFrustum(e,r,s,h))return-1;var l=this.options.maxError;H(l)&&(l=BP);var c=this._getScreenSpaceError(e,s,a,h);return c>=l?1:0},i._isTileInFrustum=function(e,r,s,a){if(!this._zScale){var h=this.getMap(),l=h.getGLRes();this._zScale=h.altitudeToPoint(100,l)/100}var c=e.extent2d,u=c.xmin,f=c.ymin,d=c.xmax,p=c.ymax;return je[0][0]=(u-a[0])*s,je[0][1]=(f-a[1])*s,je[0][2]=(e.minAltitude||0)*this._zScale,je[1][0]=(d-a[0])*s,je[1][1]=(p-a[1])*s,je[1][2]=(e.maxAltitude||0)*this._zScale,ec(r,je)},i._getScreenSpaceError=function(e,r,s,a){var h=e.error,l=this.getMap(),c=e.extent2d,u=c.xmin,f=c.ymin,d=c.xmax,p=c.ymax;Rc[0]=(u-a[0])*r,Rc[1]=(f-a[1])*r,Oc[0]=(d-a[0])*r,Oc[1]=(p-a[1])*r;var g=ZP(Rc,Oc,l.cameraPosition),m=Math.max(Math.abs(g),1e-7),v=Math.abs(e.z-s),x;l.height<1e3?x=1:x=v<=1?1:v<=2?.7:.605;var _=h*x/m;return _},i._getCascadeTiles=function(e,r){var s=this.getMap(),a=s.getPitch(),h=r&&r.getRenderer(),l=s.getContainerExtent(),c=[],u=0,f=this.getMinZoom(),d=s.options.cascadePitches[0],p=s.options.cascadePitches[1],g=Math.floor(s._getVisualHeight(p)),m=H(e)?this._getTileZoom(s.getZoom()):e;if(this._visitedTiles=new Pg,!H(e)||!this.options.cascadeTiles||a<=d||!H(f)&&m<=f){var v=a<=p?l:new Vt(0,s.height-g,s.width,s.height),x=this._getTiles(m,v,2,h);return x&&(u+=x.tiles.length,c.push(x)),{tileGrids:c,count:u}}var _=Math.floor(s._getVisualHeight(d)),y=new Vt(0,s.height-_,s.width,s.height),b=this._getTiles(m,y,0,h);u+=b?b.tiles.length:0,c.push(b);var M=y.ymin,C=s.getSpatialReference().getZoomDirection(),w=C,S;if(a>p){m-w<=f&&(w=0);var P=new Vt(0,s.height-g,s.width,M);S=this._getTiles(m-w,P,1,h),u+=S?S.tiles.length:0,M=P.ymin,w+=4*C,c.push(S)}var O;if(m-w>=f){var D=new Vt(0,l.ymin,s.width,M);O=this._getTiles(m-w,D,2,h),u+=O?O.tiles.length:0,c.push(O)}return S&&O&&(c[1]=O,c[2]=S),{tileGrids:c,count:u}},i.getTileUrl=function(e,r,s){var a=this.options.urlTemplate,h="";if(this.options.subdomains){var l=this.options.subdomains;if(ee(l)){var c=l.length,u=(e+r)%c;u<0&&(u=0),h=l[u]}}if(ne(a))return a(e,r,s,h);var f={x:e,y:r,z:s,s:h};return this.options.token&&(f.token=this.options.token),this.options.customTags&&dt(f,this.options.customTags),a.replace(UP,function(d,p){var g=f[p];if(g===void 0)throw new Error("No value provided for variable "+d);return typeof g=="function"&&(g=g(f)),g})},i.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},i.toJSON=function(){var e={type:this.getJSONType(),id:this.getId(),options:this.config()};return e},i.getSpatialReference=function(){var e=this.getMap();if(e&&(!this.options.spatialReference||zi.equals(this.options.spatialReference,e.options.spatialReference)))return e.getSpatialReference();if(this._sr)return this._sr;var r=this.options.spatialReference;if(Xt(r)&&(r=zi.getPreset(r),!r))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+zi.getAllPresets().join());return this._sr=new zi(r),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==e.getSpatialReference().toJSON().projection,this._sr},i.getMinZoom=function(){var e=this.getSpatialReference();return e!==this.getMap().getSpatialReference()?Math.max(o.prototype.getMinZoom.call(this),this._srMinZoom):o.prototype.getMinZoom.call(this)},i.getMaxZoom=function(){var e=this.getSpatialReference();return e!==this.getMap().getSpatialReference()?Math.min(o.prototype.getMaxZoom.call(this),this._srMaxZoom):o.prototype.getMaxZoom.call(this)},i._getTileZoom=function(e){if(!this._hasOwnSR){var r=this.getMap().getResolution(e),s=this.getSpatialReference().getResolution(e),a=Math.log(s/r)*Math.LOG2E;e+=a}var h=this.options.maxAvailableZoom;return!H(h)&&e>h&&(e=h),en(e)||(e=Math.round(e)),e=Math.max(0,e),e},i._getTiles=function(e,r,s,a,h){var l=this.getMap(),c=e,u=l.projViewMatrix,f=l.getResolution(e)/l.getResolution(e-1)===.5;s<2&&(s===0&&f&&(c-=1),u=s===0?l.cascadeFrustumMatrix0:s===1?l.cascadeFrustumMatrix1:l.projViewMatrix);var d=c+this.options.zoomOffset,p=this._getTileOffset(d),g=p[0]||p[1],m={zoom:c,extent:null,offset:p,tiles:[]};if(d<0||!l||!this.isVisible()||!l.width||!l.height)return m;if(!h){var v=this.getMinZoom(),x=this.getMaxZoom();if(!H(v)&&c<v||!H(x)&&c>x)return m}var _=this._getTileConfig();if(!_)return m;var y={zoom:p},b=this.getSpatialReference(),M=b.getResolution(d),C;this._hasOwnSR?C=l.getGLScale(c):C=M/l.getGLRes();var w=!this._hasOwnSR&&this.options.repeatWorld,S=this._convertToExtent2d(r),P=this._getMask2DExtent();if(P){var O=P.intersection(S);if(!O)return m;r=O.convertTo(function(Dt){return l._pointToContainerPoint(Dt,void 0,0,to)})}var D=l._containerPointToPrj(r.getCenter(),VP),L=l._prjToPoint(D,d,Va),T;g?T=this._project(l._pointToPrj(L._add(p),d,Va),Va):T=this._project(D,Va);var A=l.getGLScale()/l.getGLScale(d);eo.x=S.xmin*A,eo.y=S.ymax*A,Sn.x=S.xmax*A,Sn.y=S.ymin*A;for(var N=this._project(l._pointToPrj(eo._add(p),d,eo),eo),B=this._project(l._pointToPrj(Sn._add(p),d,Sn),Sn),F=_.getTileIndex(T,M,w),I=_.getTileIndex(N,M,w),z=_.getTileIndex(B,M,w),Z=Math.ceil(Math.abs(F.idy-I.idy)),j=Math.ceil(Math.abs(F.idx-I.idx)),K=Math.ceil(Math.abs(F.idy-z.idy)),et=Math.ceil(Math.abs(F.idx-z.idx)),st=(Z+K+1)*(j+et+1),V=this.getTileSize(),pt=this.getRenderer()||a,xt=this._getTileConfig().tileSystem.scale,ut=[],ft=new Vt,kt=new W(0,0),J=-Z;J<=K;J++)for(var Q=-j,lt=-1/0,Ct=!1;Q>=lt&&Q<=et;){var at=_.getNeighorTileIndex(F.idx,F.idy,Q,J,M,w);lt===-1/0?Q++:Q--;var Ft=this._getTileId(at.idx,at.idy,c);if(!(at.out||this._visitedTiles&&this._visitedTiles.has(Ft))){var Pt=pt&&pt.isTileCachedOrLoading(Ft);Pt&&(Pt=Pt.info);var At=void 0;if(Pt){var ce=Pt,re=ce.extent2d;kt.set(re.xmin,re.ymax),At=kt}else if(!this._hasOwnSR)At=_.getTilePointNW(at.x,at.y,M);else{var k=_.getTilePrjNW(at.x,at.y,M);At=l._prjToPoint(this._unproject(k,Sn),c)}var E=void 0,Y=void 0;if(!this._hasOwnSR)E=V.width,Y=V.height;else{var ct=void 0;if(!this._hasOwnSR)ct=_.getTilePointSE(at.x,at.y,M);else{var gt=_.getTilePrjSE(at.x,at.y,M);ct=l._prjToPoint(this._unproject(gt,Sn),c,Sn)}E=Math.ceil(Math.abs(ct.x-At.x)),Y=Math.ceil(Math.abs(ct.y-At.y))}var wt=xt.x*(at.idx-at.x)*E,Gt=xt.y*(at.idy-at.y)*Y;!Pt&&(wt||Gt)&&At._add(wt,Gt);var Mt=Pt&&Pt.extent2d||new Vt(At.x,At.y-Y,At.x+E,At.y);if(st<=4||Ct||this._isTileInExtent(u,Mt,p,C)){var nt=this._hasOwnSR?l._getResolution(c):M;this._visitedTiles&&s===0&&this._visitedTiles.add(Ft),f&&s===0?(this._splitTiles(u,ut,pt,at,c+1,nt,Mt,wt,Gt,y,a),ft._combine(Mt)):(Pt?(Pt.offset[0]=p[0],Pt.offset[1]=p[1]):(Pt={z:c,x:at.x,y:at.y,idx:at.idx,idy:at.idy,extent2d:Mt,offset:p,id:Ft,res:nt,url:this.getTileUrl(at.x,at.y,c)},a&&(Pt.layer=this.getId())),ut.push(Pt),ft._combine(Mt)),lt===-1/0?(lt=Q,Q=et):Ct||(Ct=!0)}}}if(ut.length){var Ot=l._containerPointToPoint(r.getCenter(),c,to)._add(p),Ht=new W(0,0),Rt=new W(0,0);ut.sort(function(Dt,Wt){return Ht.set((Dt.extent2d.xmin+Dt.extent2d.xmax)/2,(Dt.extent2d.ymin+Dt.extent2d.ymax)/2),Rt.set((Wt.extent2d.xmin+Wt.extent2d.xmax)/2,(Wt.extent2d.ymin+Wt.extent2d.ymax)/2),Ht.distanceTo(Ot)-Rt.distanceTo(Ot)})}return{offset:p,zoom:e,extent:ft,tiles:ut}},i._convertToExtent2d=function(e){var r=this,s=this.getMap();return e.convertTo(function(a){var h;if(a.y>0&&a.y<s.height){var l=(a.x===0?0:1)+a.y;r._coordCache[l]||(r._coordCache[l]=s._containerPointToPoint(a)),h=r._coordCache[l]}return h=s._containerPointToPoint(a,void 0,to),h})},i._splitTiles=function(e,r,s,a,h,l,c,u,f,d,p){var g=this._getTileConfig().tileSystem.scale.y,m=this.getMap().getGLScale(h),v=WP.set(c.xmin*2,g<0?c.ymax*2:c.ymin*2),x=c.getWidth(),_=c.getHeight(),y=a.idx*2,b=a.idy*2,M=a.x*2,C=a.y*2,w=this._checkAndAddTile(e,s,y,b,M,C,h,l,0,0,x,_,v,m,d,p);w&&r.push(w),w=this._checkAndAddTile(e,s,y,b,M,C,h,l,0,1,x,_,v,m,d,p),w&&r.push(w),w=this._checkAndAddTile(e,s,y,b,M,C,h,l,1,0,x,_,v,m,d,p),w&&r.push(w),w=this._checkAndAddTile(e,s,y,b,M,C,h,l,1,1,x,_,v,m,d,p),w&&r.push(w)},i._checkAndAddTile=function(e,r,s,a,h,l,c,u,f,d,p,g,m,v,x,_){var y=this._getTileId(s+f,a+d,c);if(this._visitedTiles&&this._visitedTiles.has(y))return null;var b=x[c];b||(b=x[c]=this._getTileOffset(c));var M=this._getTileConfig().tileSystem.scale.y,C=new Vt(m.x+f*p,m.y+M*d*g,m.x+(f+1)*p,m.y+M*(d+1)*g);if(!this._isSplittedTileInExtent(e,C,b,v))return null;var w=u/2,S=r&&r.isTileCachedOrLoading(y);return S?S=S.info:(S={z:c,x:h+f,y:l+d,extent2d:C,id:y,offset:b,res:w,url:this.getTileUrl(h+f,l+d,c+this.options.zoomOffset)},_&&(S.layer=this.getId())),S},i._getTileOffset=function(e){var r=this.options.offset;return ne(r)&&(r=r.call(this,e)),St(r)?[r,r]:r||[0,0]},i._getTileId=function(e,r,s,a){return(a||this.getId())+"_"+r+"_"+e+"_"+s},i._project=function(e,r){if(this._hasOwnSR){var s=this.getMap(),a=s.getProjection(),h=this.getSpatialReference().getProjection();return h.project(a.unproject(e,r),r)}else return e},i._unproject=function(e,r){if(this._hasOwnSR){var s=this.getMap(),a=this.getSpatialReference(),h=s.getProjection(),l=a.getProjection();return h.project(l.unproject(e,r),r)}else return e},i._initTileConfig=function(){var e=this.getMap(),r=this.getTileSize(),s=this.getSpatialReference(),a=s.getProjection(),h=s.getFullExtent();this._defaultTileConfig=new Tg(e,Rn.getDefault(a),h,r),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new Tg(e,this.options.tileSystem,h,r)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},i._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},i._bindMap=function(e){var r=e.getBaseLayer();return r===this&&(r.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),this._onSpatialReferenceChange(),o.prototype._bindMap.apply(this,arguments)},i._isTileInExtent=function(e,r,s,a){var h=this.getMap(),l;if(e!==h.projViewMatrix){var c=r.getCenter(jP)._sub(s[0],s[1])._multi(a);di(Dc,c.x,c.y,0);var u=oP(Dc,Dc,h.projViewMatrix);l=u[1]<0?h.projViewMatrix:e}else l=h.projViewMatrix;return je[0][0]=(r.xmin-s[0])*a,je[0][1]=(r.ymin-s[1])*a,je[1][0]=(r.xmax-s[0])*a,je[1][1]=(r.ymax-s[1])*a,ec(l,je)},i._isSplittedTileInExtent=function(e,r,s,a){var h=this.getMap();return je[0][0]=(r.xmin-s[0])*a,je[0][1]=(r.ymin-s[1])*a,je[1][0]=(r.xmax-s[0])*a,je[1][1]=(r.ymax-s[1])*a,ec(h.projViewMatrix,je)},i.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},i._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var e=this.getRenderer();e&&e.clear()},t}(Je);vi.registerJSONType("TileLayer");vi.mergeOptions(HP);function ZP(o,t,i){var n=Math.max(o[0]-i[0],0,i[0]-t[0]),e=Math.max(o[1]-i[1],0,i[1]-t[1]),r=Math.max(o[2]-i[2],0,i[2]-t[2]);return Math.sqrt(n*n+e*e+r*r)}var XP=`
function (exports) {
    exports.onmessage = function (msg, postResponse) {
        var url = msg.data.url;
        var fetchOptions = msg.data.fetchOptions;
        requestImageOffscreen(url, function (err, data) {
            var buffers = [];
            if (data && data.data && data.data.buffer) {
                buffers.push(data.data.buffer);
            }
            postResponse(err, data, buffers);
        }, fetchOptions);
    };

    var offCanvas, offCtx;
    function requestImageOffscreen(url, cb, fetchOptions) {
        if (!offCanvas) {
            offCanvas = new OffscreenCanvas(2, 2);
            offCtx = offCanvas.getContext('2d');
        }
        fetch(url, fetchOptions ? fetchOptions : {})
            .then(response => response.blob())
            .then(blob => createImageBitmap(blob))
            .then(bitmap => {
                var { width, height } = bitmap;
                offCanvas.width = width;
                offCanvas.height = height;
                offCtx.drawImage(bitmap, 0, 0);
                bitmap.close();
                var imgData = offCtx.getImageData(0, 0, width, height);
                // debugger
                cb(null, { width, height, data: new Uint8Array(imgData.data) });
            }).catch(err => {
                console.warn('error when loading tile:', url);
                console.warn(err);
                cb(err);
            });
    }
}`;function $P(){!jt.decodeImageInWorker||oh(gf,function(){return XP})}$P();var qP={maxCacheSize:1024},JP=new Pe(256,256),io="show hide remove";function Eg(o){return Array.isArray(o)||(o=[o]),o}var Pf=function(o){ht(t,o),t.fromJSON=function(e){if(!e||e.type!=="GroupTileLayer")return null;var r=e.layers.map(function(s){return Je.fromJSON(s)});return new t(e.id,r,e.options)};function t(n,e,r){var s;return s=o.call(this,n,r)||this,s.layers=e||[],s._checkChildren(),s.layerMap={},s._groupChildren=[],s}var i=t.prototype;return i.getLayers=function(){return this.layers},i.addLayer=function(e){var r=this;e===void 0&&(e=[]),e=Eg(e);var s=this.layers.length;return e.forEach(function(a){a instanceof vi&&r.layers.indexOf(a)===-1&&!r.layerMap[a.getId()]&&r.layers.push(a)}),s!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},i.removeLayer=function(e){var r=this;e===void 0&&(e=[]),e=Eg(e);var s=this.layers.length;return e.forEach(function(a){if(a instanceof vi||(a=r.layerMap[a]),a instanceof vi){var h=r.layers.indexOf(a);h>=0&&(r.layers.splice(h,1),a._doRemove(),a.off(io,r._onLayerShowHide,r))}}),s!==this.layers.length&&(this._refresh(),this._renderLayers()),this},i.clearLayers=function(){var e=this;return this.layers.forEach(function(r){r._doRemove(),r.off(io,e._onLayerShowHide,e)}),this.layers=[],this._refresh(),this._renderLayers(),this},i.toJSON=function(){var e={type:this.getJSONType(),id:this.getId(),layers:this.layers.map(function(r){return r.toJSON()}),options:this.config()};return e},i.getTileSize=function(e){var r=this.getLayer(e);return r?r.getTileSize():JP},i.getTiles=function(e,r){for(var s=this.layers,a=[],h=0,l=0,c=s.length;l<c;l++){var u=s[l];if(!(!u||!u.options.visible||!u.isVisible()||!u.getMap())){var f=u.getTiles(e,r||this);!f||f.count===0||(h+=f.count,Ar(a,f.tileGrids))}}return{count:h,tileGrids:a}},i.onAdd=function(){this._sortLayers(),this._refresh(),o.prototype.onAdd.call(this)},i.onRemove=function(){var e=this;this.layers.forEach(function(r){r._doRemove(),r.off(io,e._onLayerShowHide,e)}),this.layerMap={},this._groupChildren=[],o.prototype.onRemove.call(this)},i.getLayer=function(e){return this.getChildLayer(e)},i.getChildLayer=function(e){var r=this.layerMap[e];if(r)return r;for(var s=0;s<this._groupChildren.length;s++){var a=this._groupChildren[s].getChildLayer(e);if(a)return a}return null},i._onLayerShowHide=function(e){var r=e||{},s=r.type,a=r.target;return s==="remove"&&a&&(this.layers.splice(this.layers.indexOf(a),1),a._doRemove(),a.off(io,this._onLayerShowHide,this),this._refresh()),this._renderLayers(),this},i._renderLayers=function(){var e=this.getRenderer();return e&&e.setToRedraw(),this},i._refresh=function(){var e=this,r=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach(function(s){e.layerMap[s.getId()]=s,s.getChildLayer&&e._groupChildren.push(s),s.getMap()||s._bindMap(r),s.on(io,e._onLayerShowHide,e)}),this},i.isVisible=function(){if(!o.prototype.isVisible.call(this))return!1;for(var e=this.layers,r=0,s=e.length;r<s;r++)if(e[r].isVisible())return!0;return!1},i._checkChildren=function(){var e=this,r={};this.layers.forEach(function(s){var a=s.getId();if(r[a])throw new Error("Duplicate child layer id ("+a+") in the GroupTileLayer ("+e.getId()+")");r[a]=1})},i._sortLayers=function(){this.layers.sort(function(e,r){return e.options.zIndex-r.options.zIndex})},t}(vi);Pf.registerJSONType("GroupTileLayer");Pf.mergeOptions(qP);var C_={crs:null,uppercase:!1,detectRetina:!1},YP={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},T_=function(o){ht(t,o);function t(n,e){var r;r=o.call(this,n)||this;var s=dt({},YP);for(var a in e)a in r.options||(s[a]=e[a]);r.setOptions(e),r.setZIndex(e.zIndex);var h=r.getTileSize();return s.width=h.width,s.height=h.height,r.wmsParams=s,r._wmsVersion=parseFloat(s.version),r}var i=t.prototype;return i.onAdd=function(){var e=this.getMap().getDevicePixelRatio(),r=C_.detectRetina?e:1;this.wmsParams.width*=r,this.wmsParams.height*=r;var s=this.options.crs||this.getMap().getProjection().code,a=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[a]=s,o.prototype.onAdd.call(this)},i.getTileUrl=function(e,r,s){var a=this.getSpatialReference().getResolution(s),h=this._getTileConfig(),l=h.getTilePrjExtent(e,r,a),c=l.getMax(),u=l.getMin(),f=(this._wmsVersion>=1.3&&this.wmsParams.crs==="EPSG:4326"?[u.y,u.x,c.y,c.x]:[u.x,u.y,c.x,c.y]).join(","),d=o.prototype.getTileUrl.call(this,e,r,s);return d+QP(this.wmsParams,d,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+f},i.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},t.fromJSON=function(e){return!e||e.type!=="WMSTileLayer"?null:new t(e.id,e.options)},t}(vi);T_.registerJSONType("WMSTileLayer");T_.mergeOptions(C_);function QP(o,t,i){var n=[];for(var e in o)n.push(encodeURIComponent(i?e.toUpperCase():e)+"="+encodeURIComponent(o[e]));return(!t||t.indexOf("?")===-1?"?":"&")+n.join("&")}var Ef=function(o){ht(t,o);function t(n,e){var r;return r=o.call(this,n,e)||this,r.options.hasOwnProperty("forceRenderOnMoving")||(r.options.forceRenderOnMoving=!1),r}var i=t.prototype;return i.drawTile=function(){},i.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},t.fromJSON=function(e){return!e||e.type!=="CanvasTileLayer"?null:new t(e.id,e.options)},t}(vi);Ef.registerJSONType("CanvasTileLayer");function KP(o,t){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},n=["webgl","experimental-webgl"],e=null,r=0;r<n.length;++r){try{e=o.getContext(n[r],t||i)}catch{}if(e)break}return e}function Ag(o,t,i){var n=o.createShader(t);o.shaderSource(n,i),o.compileShader(n);var e=o.getShaderParameter(n,o.COMPILE_STATUS);if(!e){var r=o.getShaderInfoLog(n);throw o.deleteShader(n),new Error("Failed to compile shader: "+r)}return n}function P_(o,t,i){var n=Ag(o,o.VERTEX_SHADER,t),e=Ag(o,o.FRAGMENT_SHADER,i);if(!n||!e)return null;var r=o.createProgram();return r?(o.attachShader(r,n),o.attachShader(r,e),o.linkProgram(r),{program:r,vertexShader:n,fragmentShader:e}):null}function E_(o,t,i){if(Array.isArray(i[0])){for(var n=Float32Array.BYTES_PER_ELEMENT,e=0,r=0;r<i.length;r++)e+=i[r][1]||0;for(var s=0,a=0;a<i.length;a++){var h=o.getAttribLocation(t,i[a][0]);if(h<0)throw new Error("Failed to get the storage location of "+i[a][0]);o.vertexAttribPointer(h,i[a][1],o[i[a][2]||"FLOAT"],!1,n*e,n*s),s+=i[a][1]||0,o.enableVertexAttribArray(h)}}else{var l=o.getAttribLocation(t,i[0]);o.vertexAttribPointer(l,i[1],o[i[2]||"FLOAT"],!1,0,0),o.enableVertexAttribArray(l)}}var Lg={vertexShader:`
        attribute vec2 a_position;

        attribute vec2 a_texCoord;

        uniform mat4 u_matrix;

        varying vec2 v_texCoord;

        void main() {
            gl_Position = u_matrix * vec4(a_position, 0., 1.);

            v_texCoord = a_texCoord;
        }
    `,fragmentShader:`
        precision mediump float;

        uniform sampler2D u_image;

        uniform float u_opacity;
        uniform float u_debug_line;

        varying vec2 v_texCoord;

        void main() {
            if (u_debug_line == 1.) {
                gl_FragColor = vec4(0., 1., 0., 1.);
            } else {
                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
            }
        }
    `},Wa=[0,0],Ic=[0,0,0],tE=new Array(16),eE=new W(20,20),Af=function(t){var i=function(n){ht(e,n);function e(){return n.apply(this,arguments)||this}var r=e.prototype;return r.drawGLImage=function(a,h,l,c,u,f,d,p){this.gl.program!==this.program&&this.useProgram(this.program);var g=this.gl;this.loadTexture(a);var m=this.canvas.gl&&this.canvas.gl.wrap;if(m){var v=this.layer&&this.layer.options.opacity;H(v)&&(v=1),d*=v}Ic[0]=h||0,Ic[1]=l||0;var x=Sf(tE);u_(x,x,Ic),xu(x,x,[f,f,1]),mo(x,this.getMap().projViewMatrix,x),g.uniformMatrix4fv(this.program.u_matrix,!1,x),g.uniform1f(this.program.u_opacity,d),g.uniform1f(this.program.u_debug_line,0);var _=a.glBuffer;_&&(_.width!==c||_.height!==u)&&(this.saveImageBuffer(_),delete a.glBuffer),a.glBuffer?g.bindBuffer(g.ARRAY_BUFFER,_):a.glBuffer=this.bufferTileData(0,0,c,u),Wa[0]="a_position",Wa[1]=2,Wa[2]=a.glBuffer.type,this.enableVertexAttrib(Wa),g.drawArrays(g.TRIANGLE_STRIP,0,4),p&&this.drawDebug(x,0,0,c,u,p)},r.drawDebug=function(a,h,l,c,u,f){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),d.bufferData(d.ARRAY_BUFFER,new Float32Array([h,l,h+c,l,h+c,l-u,h,l-u,h,l]),d.DYNAMIC_DRAW),d.uniformMatrix4fv(this.program.u_matrix,!1,a),d.uniform1f(this.program.u_opacity,1),d.uniform1f(this.program.u_debug_line,1),d.drawArrays(d.LINE_STRIP,0,5);var p=this._debugInfoCanvas;if(!p){var g=this.getMap().getDevicePixelRatio()>1?2:1;p=this._debugInfoCanvas=document.createElement("canvas"),p.width=256*g,p.height=32*g;var m=p.getContext("2d");m.font="20px monospace",m.scale(g,g)}var v=p.getContext("2d");v.clearRect(0,0,p.width,p.height);var x=this.layer.options.debugOutline;ot.fillText(v,f,eE,x),this.loadTexture(p),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,p),c=256;var _=h,y=h+c,b=l-u+32,M=l-u;d.bufferData(d.ARRAY_BUFFER,this.set8(_,b,_,M,y,b,y,M),d.DYNAMIC_DRAW),d.uniform1f(this.program.u_debug_line,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)},r.bufferTileData=function(a,h,l,c,u){var f=a,d=a+l,p=h,g=h-c,m;en(f)&&en(d)&&en(p)&&en(g)?m=this.set8Int(f,p,f,g,d,p,d,g):m=this.set8(f,p,f,g,d,p,d,g);var v=this.loadImageBuffer(m,u);return v.width=l,v.height=c,v.type=m instanceof Int16Array?"SHORT":"FLOAT",v},r.drawTinImage=function(a,h,l,c,u){var f=this.gl;this.loadTexture(a),f.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),f.uniform1f(this.program.u_opacity,u),f.bindBuffer(f.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),f.bufferData(f.ARRAY_BUFFER,new Float32Array(h),f.DYNAMIC_DRAW),f.bindBuffer(f.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),f.bufferData(f.ARRAY_BUFFER,new Float32Array(l),f.DYNAMIC_DRAW),f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),f.DYNAMIC_DRAW),f.drawElements(f.TRIANGLES,c.length,f.UNSIGNED_SHORT,0)},r.createCanvas2=function(){this.canvas2=ot.createCanvas(this.canvas.width,this.canvas.height)},r.createGLContext=function(){this.canvas.gl&&this.canvas.gl.wrap?this.gl=this.canvas.gl.wrap():this.gl=KP(this.canvas2||this.canvas,this.layer.options.glOptions);var a=this.gl;a.clearColor(0,0,0,0),a.disable(a.DEPTH_TEST),a.enable(a.STENCIL_TEST),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(Lg.vertexShader,this.layer.options.fragmentShader||Lg.fragmentShader),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),a.bufferData(a.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),a.STATIC_DRAW),this.enableSampler("u_image"),a.activeTexture(a.TEXTURE0),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},r.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),!!this.canvas2&&(this.canvas2.width!==this.canvas.width||this.canvas2.height!==this.canvas.height)&&(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height)},r.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))},r.disposeImage=function(a){!a||(a.texture&&this.saveTexture(a.texture),a.glBuffer&&this.saveImageBuffer(a.glBuffer),delete a.texture,delete a.glBuffer)},r._createTexture=function(a){var h=this.gl,l=this.getTexture()||h.createTexture();return h.bindTexture(h.TEXTURE_2D,l),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,a),en(cu(a.width))&&en(cu(a.width))&&h.generateMipmap(h.TEXTURE_2D),l},r.getTexture=function(){this._textures||(this._textures=[]);var a=this._textures;return a&&a.length>0?a.pop():null},r.saveTexture=function(a){this._textures.push(a)},r.loadTexture=function(a){var h=this.gl,l=a.texture;return l||(l=this._createTexture(a),a.texture=l),h.bindTexture(h.TEXTURE_2D,l),l},r.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var a=this._imageBuffers;return a&&a.length>0?a.pop():null},r.saveImageBuffer=function(a){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(a)},r.loadImageBuffer=function(a,h){var l=this.gl,c=h||this.createImageBuffer();return l.bindBuffer(l.ARRAY_BUFFER,c),l.bufferData(l.ARRAY_BUFFER,a,l.STATIC_DRAW),c},r.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},r.removeGLCanvas=function(){var a=this.gl;if(!!a){if(this._debugBuffer&&(a.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach(function(c){a.deleteBuffer(c)}),delete this._buffers),this._textures&&(this._textures.forEach(function(c){return a.deleteTexture(c)}),delete this._textures),this._debugInfoCanvas){var h=this._debugInfoCanvas.texture;h&&a.deleteTexture(h),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var l=a.program;a.deleteShader(l.fragmentShader),a.deleteShader(l.vertexShader),a.deleteProgram(l),delete this.gl,delete this.canvas2}},r.createBuffer=function(){var a=this.gl,h=a.createBuffer();if(!h)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(h),h},r.enableVertexAttrib=function(a){E_(this.gl,this.gl.program,a)},r.createProgram=function(a,h){for(var l=this.gl,c=P_(l,a,h),u=c.program,f=c.vertexShader,d=c.fragmentShader,p=l.getProgramParameter(u,35718),g=[],m=0;m<p;++m){var v=l.getActiveUniform(u,m);g.push(v.name)}return u.vertexShader=f,u.fragmentShader=d,this._initUniforms(u,g),u},r.useProgram=function(a){var h=this.gl;return h.useProgram(a),h.program=a,this},r.enableSampler=function(a,h){var l=this.gl,c=this._getUniform(l.program,a);return h||(h=0),l.uniform1i(c,h),c},r._initUniforms=function(a,h){for(var l=0;l<h.length;l++){var c=h[l],u=h[l],f=c.indexOf("[");f>=0&&(c=c.substring(0,f),De||(u=u.substring(0,f))),a[c]=this._getUniform(a,u)}},r._getUniform=function(a,h){var l=this.gl,c=l.getUniformLocation(a,h);if(!c)throw new Error("Failed to get the storage location of "+h);return c},e}(t);return dt(i.prototype,{set8:function(){var n=jt.ie9?null:new Float32Array(8);return function(e,r,s,a,h,l,c,u){return n[0]=e,n[1]=r,n[2]=s,n[3]=a,n[4]=h,n[5]=l,n[6]=c,n[7]=u,n}}(),set8Int:function(){var n=jt.ie9?null:new Int16Array(8);return function(e,r,s,a,h,l,c,u){return n[0]=e,n[1]=r,n[2]=s,n[3]=a,n[4]=h,n[5]=l,n[6]=c,n[7]=u,n}}()}),i},iE={renderer:jt.webgl?"gl":"canvas",crossOrigin:null},nE=new W(0,0),Lf=function(o){ht(t,o);function t(n,e,r){var s;return e&&!Array.isArray(e)&&!e.url&&(r=e,e=null),s=o.call(this,n,r)||this,s._images=e,s}var i=t.prototype;return i.onAdd=function(){this._prepareImages(this._images)},i.setImages=function(e){return this._images=e,this._prepareImages(e),this},i.getImages=function(){return this._images},i._prepareImages=function(e){e=e||[],Array.isArray(e)||(e=[e]);var r=this.getMap(),s=r.getGLRes();this._imageData=e.map(function(h){var l=new oe(h.extent);return dt({},h,{extent:l,extent2d:l.convertTo(function(c){return r.coordToPointAtRes(c,s)})})}),this._images=e;var a=this.getRenderer();a&&a.refreshImages()},t}(Je);Lf.mergeOptions(iE);var rE=[],Rf=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.isDrawable=function(){return!this.getMap().getPitch()},i.checkResources=function(){var e=this;if(this._imageLoaded)return rE;var r=this.layer,s=r._imageData.map(function(l){return[l.url,null,null]});if(this.resources){var a=[],h=new Sr;s.forEach(function(l){if(e.resources.isResourceLoaded(l)){var c=e.resources.getImage(l);h.addResource(l,c)}else a.push(l)}),this.resources.forEach(function(l,c){h.isResourceLoaded(l)||e.retireImage(c.image)}),this.resources=h,s=a}return this._imageLoaded=!0,s},i.retireImage=function(e){e.close&&e.close()},i.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},i.draw=function(){!this.isDrawable()||(this.prepareCanvas(),this._painted=!1,this._drawImages(),this.completeRender())},i._drawImages=function(){var e=this.layer._imageData,r=this.getMap(),s=r._get2DExtentAtRes(r.getGLRes());if(e&&e.length)for(var a=0;a<e.length;a++){var h=e[a].extent2d,l=this.resources&&this.resources.getImage(e[a].url);l&&s.intersects(h)&&(this._painted=!0,this._drawImage(l,h,e[a].opacity||1))}},i._drawImage=function(e,r,s){var a=0,h=this.context;s<1&&(a=h.globalAlpha,h.globalAlpha=s);var l=this.getMap(),c=nE.set(r.xmin,r.ymax),u=l._pointAtResToContainerPoint(c,l.getGLRes()),f=u.x,d=u.y,p=l.getBearing();p&&(h.save(),h.translate(f,d),p&&h.rotate(-p*Math.PI/180),f=d=0);var g=l.getGLScale();h.drawImage(e,f,d,r.getWidth()/g,r.getHeight()/g),p&&h.restore(),a&&(h.globalAlpha=a)},i.drawOnInteracting=function(){this.draw()},t}(Fs),A_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.isDrawable=function(){return!0},i._drawImage=function(e,r,s){this.drawGLImage(e,r.xmin,r.ymax,r.getWidth(),r.getHeight(),1,s)},i.createContext=function(){this.createGLContext()},i.resizeCanvas=function(e){!this.canvas||(o.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},i.clearCanvas=function(){!this.canvas||(o.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.retireImage=function(e){e.close&&e.close(),this.disposeImage(e)},i.onRemove=function(){this.removeGLCanvas(),o.prototype.onRemove.call(this)},t}(Af(Rf));Lf.registerRenderer("canvas",Rf);Lf.registerRenderer("gl",A_);var Of=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.getPrepareParams=function(){return[]},i.getDrawParams=function(){return[]},i.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=ot.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},i.needToRedraw=function(){if(this.layer.options.animation)return!0;var e=this.getMap();return e.isInteracting()&&!this.layer.drawOnInteracting?!1:o.prototype.needToRedraw.call(this)},i.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer.apply(this,arguments)},i.drawOnInteracting=function(){this._drawLayerOnInteracting.apply(this,arguments)},i.getCanvasImage=function(){var e=o.prototype.getCanvasImage.call(this);if(e&&e.image&&this.layer.options.doubleBuffer){var r=e.image;(this.buffer.width!==r.width||this.buffer.height!==r.height)&&(this.buffer.width=r.width,this.buffer.height=r.height);var s=this.buffer.getContext("2d"),a=this.layer.doubleBuffer(s,this.context);(a===void 0||a)&&(ot.image(s,r,0,0),e.image=this.buffer)}return e},i.remove=function(){return delete this._drawContext,o.prototype.remove.call(this)},i.onZoomStart=function(e){this.layer.onZoomStart(e),o.prototype.onZoomStart.call(this,e)},i.onZooming=function(e){this.layer.onZooming(e),o.prototype.onZooming.call(this,e)},i.onZoomEnd=function(e){this.layer.onZoomEnd(e),o.prototype.onZoomEnd.call(this,e)},i.onMoveStart=function(e){this.layer.onMoveStart(e),o.prototype.onMoveStart.call(this,e)},i.onMoving=function(e){this.layer.onMoving(e),o.prototype.onMoving.call(this,e)},i.onMoveEnd=function(e){this.layer.onMoveEnd(e),o.prototype.onMoveEnd.call(this,e)},i.onResize=function(e){this.layer.onResize(e),o.prototype.onResize.call(this,e)},i.prepareDrawContext=function(){if(!this._predrawed){var e=Rg(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(e)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},i._prepareDrawParams=function(){if(!this.getMap())return null;var e=this.getViewExtent();if(e.maskExtent&&!e.extent.intersects(e.maskExtent))return this.completeRender(),null;var r=[this.context,e],s=Rg(this.getDrawParams());return r.push.apply(r,s),r.push.apply(r,this._drawContext),r},i._drawLayer=function(){var e=this._prepareDrawParams();if(!!e){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.layer.draw.apply(this.layer,e.concat(s)),this.completeRender()}},i._drawLayerOnInteracting=function(){if(!!this.layer.drawOnInteracting){var e=this._prepareDrawParams();if(!!e){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.layer.drawOnInteracting.apply(this.layer,e.concat(s)),this.completeRender()}}},t}(Fs);function Rg(o){return o||(o=[]),Array.isArray(o)||(o=[o]),o}var sE={doubleBuffer:!1,animation:!1},Kh=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.isCanvasRender=function(){return!0},i.prepareToDraw=function(){},i.draw=function(){},i.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},i.play=function(){return this.config("animation",!0),this},i.pause=function(){return this.config("animation",!1),this},i.isPlaying=function(){return this.options.animation},i.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},i.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},i.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},i.onCanvasCreate=function(){return this},i.onZoomStart=function(){},i.onZooming=function(){},i.onZoomEnd=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){},i.onResize=function(){},i.doubleBuffer=function(e){return e.clearRect(0,0,e.canvas.width,e.canvas.height),this},t}(Je);Kh.mergeOptions(sE);Kh.registerRenderer("canvas",Of);var oE=new W(0,0),aE={animation:!0},L_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.getParticles=function(){},i.draw=function(e,r){var s=this.getParticles(me());if(!s||s.length===0){var a=this._getRenderer();a&&(this._getRenderer()._shouldClear=!0);return}var h=this.getMap(),l=r.extent;r.maskExtent&&(l=r.extent.intersection(r.maskExtent)),l=l.convertTo(function(m){return h._pointToContainerPoint(m,void 0,0,oE)});for(var c=2*Math.PI,u=0,f=s.length;u<f;u++){var d=s[u].point;if(l.contains(d)){var p=s[u].color||this.options.lineColor||"#fff",g=s[u].r;e.fillStyle!==p&&(e.fillStyle=p),g<=2?e.fillRect(d.x-g/2,d.y-g/2,g,g):(e.beginPath(),e.arc(d.x,d.y,g/2,0,c),e.fill())}}this._fillCanvas(e)},i._fillCanvas=function(e){var r=e.globalCompositeOperation;e.globalCompositeOperation="destination-out";var s=this.options.trail||30;e.fillStyle="rgba(0, 0, 0, "+1/s+")",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation=r},t}(Kh);L_.mergeOptions(aE);L_.registerRenderer("canvas",function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.draw=function(){(!this.canvas||!this.layer.options.animation||this._shouldClear)&&(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},i.onSkipDrawOnInteracting=function(){this._shouldClear=!0},t}(Of));var no=new Sr,ro,so,hE=function(o){ht(t,o);function t(n,e,r){var s;s=o.call(this,r)||this,s.target=n,n.once("remove",s.delete,ze(ze(s)));var a=s.options.symbol,h=a.markerLineWidth||1;return s.w=a.markerWidth+h,s.h=a.markerHeight+h,s.opacity=H(a.opacity)?1:a.opacity,s.map=e,s.events=r.events,s._fetchImage(),s.addTo(e),s}var i=t.prototype;return i.getCursor=function(){return this.options.cursor||"default"},i._fetchImage=function(){var e=this.map,r=this.options.symbol,s=r.markerFile;this.url=s||jo(r);var a=no.getImage(this.url);if(!a){var h=this.w,l=this.h;if(s)a=new Image,a.onload=function(){var f=e.getRenderer();f&&f.setToRedraw()},a.src=this.url;else{var c=document.createElement("canvas");c.width=h,c.height=l;var u=c.getContext("2d");a=Xv(u,{x:h/2,y:l/2},r,no)}no.addResource([this.url,h,l],a)}no.login(this.url),this._img=a},i.setContainerPoint=function(e){this._point=e,this._point._sub(this.w/2,this.h/2)},i.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},i.offset=function(e){this._point._add(e)},i.render=function(e){if(!this._img)return!1;var r=this.options.symbol,s=r.markerDx||0,a=r.markerDy||0,h=this.map,l=this._point,c=l.x,u=l.y,f=this.w,d=this.h;if(c+f>0&&c<h.width&&u+d>0&&u<h.height){var p=h.getDevicePixelRatio();return e.globalAlpha=this.opacity,e.drawImage(this._img,Math.round((c+s)*p),Math.round((u+a)*p),Math.round(f*p),Math.round(d*p)),!0}return!1},i.delete=function(){if(this.map){var e=this.map.getRenderer();e&&e.removeTopElement(this)}no.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},i.hitTest=function(e){var r=this.options.symbol,s=r.markerDx||0,a=r.markerDy||0,h=this.w,l=this.h,c=this._point.x+s,u=this._point.y+a;return e.x>=c&&e.x<=c+h&&e.y>=u&&e.y<=u+l},i.addTo=function(e){this.map=e;var r=e.getRenderer();r.addTopElement(this)},i.onEvent=function(e){this.fire(e.type,e)},i.mousedown=function(e){var r=e.target,s=this.options.cursor;s&&r.setCursor(s),this.onDragstart(e)},i.onDragstart=function(e){var r=e.containerPoint,s=e.target,a=s._panels.mapWrapper||s._containerDOM,h=this._dragger=new ks(a);h.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),h.type="handle",h.onMouseDown(e.domEvent),ro=r.x,so=r.y,this.fire("dragstart",{containerPoint:r})},i.onDragging=function(e){if(!!this._dragger){var r=this.map,s=$e(e.domEvent,r._containerDOM),a={x:s.x-ro,y:s.y-so},h=r.containerPointToCoord(new W(ro,so)),l=r.containerPointToCoord(s);ro=s.x,so=s.y,this.offset(a),this.fire("dragging",{containerPoint:s,coordOffset:l._sub(h)})}},i.onDragend=function(e){if(!!this._dragger){var r=this.map;r.resetCursor();var s=$e(e.domEvent,r._containerDOM),a={x:s.x-ro,y:s.y-so};this.offset(a),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:s})}},t}(Ui(wi)),lE=function(){function o(i,n){this.target=i,i.once("remove",this.delete,this),this.map=n,this.addTo(n)}var t=o.prototype;return t.setPoints=function(n){this.points=n;var e=n.map(function(s){return s.x}),r=n.map(function(s){return s.y});this.xmin=Math.min.apply(Math,e),this.xmax=Math.max.apply(Math,e),this.ymin=Math.min.apply(Math,r),this.ymax=Math.max.apply(Math,r)},t.hitTest=function(){return!1},t.render=function(n){var e=this.map;if(this.xmax<=0||this.xmin>=e.width||this.ymax<=0||this.ymin>=e.height)return;var r=e.getDevicePixelRatio(),s=.5;function a(c){return Math.round(c)*r+s}n.lineWidth=1,n.strokeStyle="#000",n.globalAlpha=1,n.beginPath();var h=this.points;n.moveTo(a(h[0].x),a(h[0].y));for(var l=1;l<this.points.length;l++)n.lineTo(a(h[l].x),a(h[l].y));n.closePath(),n.stroke()},t.addTo=function(n){this.map=n;var e=n.getRenderer();e.addTopElement(this)},t.delete=function(){if(this.map){var n=this.map.getRenderer();n&&n.removeTopElement(this)}},o}(),cE=Vo+"_edit_stage_";function kc(o,t){return{markerType:o,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:t}}var uE={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:kc("ellipse",1),vertexHandleSymbol:kc("square",1),newVertexHandleSymbol:kc("square",.4)},R_=function(o){ht(t,o);function t(n,e){var r;return r=o.call(this,e)||this,r._geometry=n,r._geometry?r:ze(r)}var i=t.prototype;return i.getMap=function(){return this._geometry.getMap()},i.prepare=function(){var e=this.getMap();!e||(e.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},i._prepareEditStageLayer=function(){var e=this._geometry.getLayer();if(e.options.renderer==="canvas"){var r=this.getMap(),s=Xn(),a=cE+s+"_shadow";if(this._shadowLayer=r.getLayer(a),!this._shadowLayer){var h=e.constructor;this._shadowLayer=new h(a),r.addLayer(this._shadowLayer)}}},i.start=function(){if(!(!this._geometry||!this._geometry.getMap()||this._geometry.editing)){this.editing=!0,this.prepare();var e=this._geometry,r,s=this._geometry.getLayer(),a=s.options.renderer==="canvas";this._geometryDraggble=e.options.draggable,a?(e.config("draggable",!1),r=e.copy(),r.setSymbol(e._getInternalSymbol()),r.copyEventListeners(e),e._getParent()&&r.copyEventListeners(e._getParent()),r._setEventTarget(e),r.setId(null).config({draggable:!1}),this._shadow=r,e.hide()):e instanceof Ce&&e.config("draggable",!0),this._switchGeometryEvents("on"),(e instanceof Ce||e instanceof Ni||e instanceof _r||e instanceof ln)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(r),e instanceof Ce?r&&(r.config("draggable",!0),r.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),e instanceof Ce&&this.options.resize!==!1?this.createMarkerEditor():e instanceof Ni?this.createCircleEditor():e instanceof _r?this.createEllipseOrRectEditor():e instanceof ln?this.createEllipseOrRectEditor():e instanceof Bs||(e instanceof ie||e instanceof fe)&&this.createPolygonEditor()}},i.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off");var e=this.getMap();if(!e){this.fire("remove");return}this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")},i.isEditing=function(){return H(this.editing)?!1:this.editing},i._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},i._switchGeometryEvents=function(e){if(this._geometry){var r=this._getGeometryEvents();for(var s in r)this._geometry[e](s,r[s],this)}},i._onGeoSymbolChange=function(e){this._shadow&&this._shadow.setSymbol(e.target._getInternalSymbol())},i._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},i._createOrRefreshOutline=function(){var e=this._geometry,r=this._editOutline;r||(this._editOutline=new lE(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var s=this._editOutline.points;if(e instanceof Ce)this._editOutline.setPoints(e.getContainerExtent().toArray(s));else{var a=this.getMap(),h=e._getPrjExtent();s=h.toArray(s),s.forEach(function(l){return a._prjToContainerPoint(l,null,l)}),this._editOutline.setPoints(s)}return r},i._createCenterHandle=function(){var e=this,r=this.getMap(),s=this.options.centerHandleSymbol,a,h=r.coordToContainerPoint(this._geometry.getCenter()),l=this.createHandle(h,{symbol:s,cursor:"move",onDown:function(){if(e._shadow){a=e._shadow.copy();var u=Mh(a._getInternalSymbol(),.5);a.setSymbol(u).addTo(e._geometry.getLayer())}},onMove:function(u){var f=u.coordOffset;a?a.translate(f):e._geometry.translate(f)},onUp:function(){var u=a||e._geometry;e._update("setCoordinates",q.toNumberArrays(u.getCoordinates())),a&&a.remove()}});this._addRefreshHook(function(){var c=e._geometry.getCenter();l.setContainerPoint(r.coordToContainerPoint(c))})},i._createHandleInstance=function(e,r){var s=this.getMap(),a=Yu(r.symbol,function(){return[s.getZoom(),{"{bearing}":s.getBearing(),"{pitch}":s.getPitch(),"{zoom}":s.getZoom()}]}),h=this.options.removeVertexOn,l=new hE(this,s,{symbol:a,cursor:r.cursor,events:h});return l.setContainerPoint(e),l},i.createHandle=function(e,r){r||(r={});var s=this._createHandleInstance(e,r),a=this;function h(u){return this._updating=!0,r.onDown&&(this._geometry.fire("handledragstart"),r.onDown.call(a,u.containerPoint,u)),!1}function l(u){return a._hideContext(),r.onMove&&(this._geometry.fire("handledragging"),r.onMove.call(a,u)),!1}function c(u){return r.onUp&&(this._geometry.fire("handledragend"),r.onUp.call(a,u)),this._updating=!1,!1}return s.on("dragstart",h,this),s.on("dragging",l,this),s.on("dragend",c,this),r.onRefresh&&(s.refresh=r.onRefresh),s},i._createResizeHandles=function(e,r,s){var a=this,h=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],l=[null,"y",null,"x","x",null,"y",null],c=this._geometry,u=c instanceof Ce;function f(){if(u){var _=c.getContainerExtent();return[new W(_.xmin,_.ymin),new W((_.xmax+_.xmin)/2,_.ymin),new W(_.xmax,_.ymin),new W(_.xmin,(_.ymin+_.ymax)/2),new W(_.xmax,(_.ymin+_.ymax)/2),new W(_.xmin,_.ymax),new W((_.xmax+_.xmin)/2,_.ymax),new W(_.xmax,_.ymax)]}var y=c._getPrjExtent();return[new W(y.xmin,y.ymax),new W((y.xmax+y.xmin)/2,y.ymax),new W(y.xmax,y.ymax),new W(y.xmin,(y.ymax+y.ymin)/2),new W(y.xmax,(y.ymax+y.ymin)/2),new W(y.xmin,y.ymin),new W((y.xmax+y.xmin)/2,y.ymin),new W(y.xmax,y.ymin)]}e||(e=[]);var d=this,p=[],g={},m=this.getMap(),v=this.options.vertexHandleSymbol,x=function(){for(var y=f(),b=function(S){if(Array.isArray(e)){var P=e.some(function(T){return T===S});if(P)return"continue"}var O=y[S],D=u?O:m._prjToContainerPoint(O);if(p.length<y.length-e.length){var L=a.createHandle(D,{symbol:v,cursor:h[S],axis:l[S],onMove:function(T){return function(A){d._updating=!0,r(A.containerPoint,T),c.fire("resizing")}}(S),onUp:function(){d._updating=!1,s()}});g[S]=p.length,p.push(L)}else p[g[S]].setContainerPoint(D)},M=0;M<y.length;M++)var C=b(M)};return x(),this._addRefreshHook(x),p},i.createMarkerEditor=function(){var e=this,r=this._shadow||this._geometry,s=this.getMap();if(!r._canEdit())return;this._history||this._recordHistory(v());var a=r._getInternalSymbol(),h=new W(0,0);St(a.markerDx)&&(h.x=a.markerDx),St(a.markerDy)&&(h.y=a.markerDy);var l=null,c="middle",u="middle";if(Yv.test(a)){var f=a.markerType;f==="pin"||f==="pie"||f==="bar"?(l=[5,6,7],c="bottom"):f==="rectangle"&&(l=[0,1,2,3,5],c="top",u="left")}else(yf.test(a)||Qv.test(a))&&(c="bottom",l=[5,6,7]);var d=[2,1,2,0,0,2,1,2],p;if(this.options.fixAspectRatio){var g=r.getSize();p=g.width/g.height}var m=this._createResizeHandles(l,function(x,_){if(l&&l.indexOf(_)>=0){var y=s.containerPointToCoordinate(x.sub(h)),b=r.getCoordinates();y.x=b.x,r.setCoordinates(y),e._updateCoordFromShadow(!0);var M=m[m.length-1-_],C=M.getContainerPoint();x=C}var w=s.coordToContainerPoint(r.getCoordinates()).add(h),S=r._getInternalSymbol(),P=x.sub(w);c==="bottom"&&x.y>w.y&&(P.y=0);var O=c==="middle"?2:1,D=u==="left"?1:2,L=Math.abs(P.x)*D,T=Math.abs(P.y)*O;p&&(L=Math.max(L,T*p),T=L/p);var A=d[_];r instanceof Eh?((p||A===0||A===2)&&(r.setWidth(L),r!==e._geometry&&e._geometry.setWidth(L)),(p||A===1||A===2)&&(r.setHeight(T),r!==e._geometry&&e._geometry.setHeight(T))):((p||A===0||A===2)&&(S.markerWidth=Math.min(L,e._geometry.options.maxMarkerWidth||1/0)),(p||A===1||A===2)&&(S.markerHeight=Math.min(T,e._geometry.options.maxMarkerHeight||1/0)),r.setSymbol(S),r!==e._geometry&&e._geometry.setSymbol(S))},function(){e._update(v())});function v(){var x=[["setCoordinates",r.getCoordinates().toArray()]];return r instanceof Eh?(x.push(["setWidth",r.getWidth()]),x.push(["setHeight",r.getHeight()])):x.push(["setSymbol",r.getSymbol()]),x}},i.createCircleEditor=function(){var e=this,r=this._shadow||this._geometry,s=this.getMap();this._history||this._recordHistory([["setCoordinates",r.getCoordinates().toArray()],["setRadius",r.getRadius()]]),this._createResizeHandles(null,function(a){var h=r.getCenter(),l=s.containerPointToCoord(a),c=new fe([[h.x,h.y],[l.x,h.y]]),u=new fe([[h.x,h.y],[h.x,l.y]]),f=Math.max(s.computeGeometryLength(c),s.computeGeometryLength(u));r.setRadius(f),r!==e._geometry&&e._geometry.setRadius(f)},function(){e._update("setRadius",r.getRadius())})},i.createEllipseOrRectEditor=function(){var e=this,r=[2,1,2,0,0,2,1,2],s=this._shadow||this._geometry;this._history||this._recordHistory(u());var a=this.getMap(),h=this._geometry instanceof _r,l;this.options.fixAspectRatio&&(l=s.getWidth()/s.getHeight());var c=this._createResizeHandles(null,function(f,d){var p=h?1:2,g,m,v,x=c[d],_=x.getContainerPoint(),y=r[d];if(h){var b=c[7-d],M=b.getContainerPoint();g=_.sub(M);var C=g.abs();m=a.pixelToDistance(C.x,0),v=a.pixelToDistance(0,C.y);var w=s.getSize(),S=s.getCoordinates(),P=s.getWidth(),O=s.getHeight(),D=a.containerPointToCoord(f),L=a.containerPointToCoord(M),T=new fe([[L.x,L.y],[D.x,L.y]]),A=new fe([[L.x,L.y],[L.x,D.y]]);if(m=a.computeGeometryLength(T),v=a.computeGeometryLength(A),y===0)if(l&&(C.y=C.x/l,w.height=Math.abs(C.y),v=m/l),_.y=M.y-w.height/2,D.y=S.y,d===4)D.x=Math.min(D.x,S.x);else{var N=a.locate(S,P,0);D.x=a.locate(new q(N.x,D.y),-m,0).x}else if(y===1)l&&(C.x=C.y*l,w.width=Math.abs(C.x),m=v*l),_.x=M.x-w.width/2,D.x=S.x,D.y=Math.max(D.y,L.y);else{if(l&&(m>v*l?(v=m/l,_.y=M.y+C.x*Ie(g.y)/l):(m=v*l,_.x=M.x+C.y*Ie(g.x)*l)),d===0||d===5){var B=d===0?a.locate(S,P,0):a.locate(S,P,-O);D.x=a.locate(new q(B.x,D.y),-m,0).x}else D.x=Math.min(D.x,L.x);D.y=Math.max(D.y,L.y)}s.setCoordinates(D),e._updateCoordFromShadow(!0)}else{var F=s.getCenter(),I=a.containerPointToCoord(_),z=new fe([[F.x,F.y],[I.x,F.y]]),Z=new fe([[F.x,F.y],[F.x,I.y]]);m=a.computeGeometryLength(z),v=a.computeGeometryLength(Z),l&&(m=Math.max(m,v*l),v=m/l)}(l||y===0||y===2)&&(s.setWidth(m*p),s!==e._geometry&&e._geometry.setWidth(m*p)),(l||y===1||y===2)&&(s.setHeight(v*p),s!==e._geometry&&e._geometry.setHeight(v*p))},function(){e._update(u())});function u(){return[["setCoordinates",s.getCoordinates().toArray()],["setWidth",s.getWidth()],["setHeight",s.getHeight()]]}},i.createPolygonEditor=function(){var e=this.getMap(),r=this._shadow||this._geometry,s=this;this._history||this._recordHistory("setCoordinates",q.toNumberArrays(r.getCoordinates()));var a=r instanceof ie?3:2,h="maptalks--editor-vertex-index",l={0:[]},c={0:[]};function u(T){if(T===void 0&&(T=0),r instanceof ie){var A=r.getCoordinates()[T]||[];return A.slice(0,A.length-1)}else return r.getCoordinates()}function f(T){return T===void 0&&(T=0),T===0?r._getPrjCoordinates():r._getPrjHoles()[T-1]}function d(){for(var T in l){for(var A=l[T].length-1;A>=0;A--)l[T][A][h]=A;for(var N=c[T].length-1;N>=0;N--)c[T][N][h]=N}s._updateCoordFromShadow()}function p(T){s._updating=!0;var A=T.target,N=A[h],B=St(A._ringIndex)?A._ringIndex:0,F=f(B);if(!(F.length<=a)){var I=r instanceof fe&&(N===0||N===F.length-1);F.splice(N,1),B>0?r._prjHoles[B-1]=F:r._setPrjCoordinates(F),r._updateCache(),l[B].splice(N,1)[0].delete(),N<c[B].length&&c[B].splice(N,1)[0].delete();var z;N===0?z=c[B].length-1:z=N-1,c[B].splice(z,1)[0].delete(),I||c[B].splice(z,0,y.call(s,z,B)),d(),s._updating=!1}}function g(T,A,N){N===void 0&&(N=0);var B=s._geometry.snapTo;B&&ne(B)&&(T=s._geometry.snapTo(T)||T);var F=f(N),I=e._containerPointToPrj(T.sub(v())),z=F[A];z.x=I.x,z.y=I.y,r._updateCache(),r.onShapeChanged(),s._updateCoordFromShadow(!0);var Z;A===0?Z=c[N].length-1:Z=A-1,c[N][A]&&c[N][A].refresh(),c[N][Z]&&c[N][Z].refresh()}var m=new W(0,0);function v(){var T=r._getCompiledSymbol();return m.x=T.lineDx||0,m.y=T.lineDy||0,m}function x(T,A,N){A===void 0&&(A=0);var B=(N||u(A))[T],F=s.createHandle(e.coordToContainerPoint(B)._add(v()),{symbol:s.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){g(F.getContainerPoint(),F[h],A)},onRefresh:function(z,Z){B=(Z||u(A))[F[h]];var j=e.coordToContainerPoint(B);F.setContainerPoint(j._add(v()))},onUp:function(){s._updateCoordFromShadow()},onDown:function(z,Z){Z&&Z.domEvent&&Z.domEvent.button}});return F[h]=T,F._ringIndex=A,F.on(s.options.removeVertexOn,p),F}var _=!1;function y(T,A,N){A===void 0&&(A=0);var B=N||u(A),F;T+1>=B.length?F=B[0]:F=B[T+1];var I=B[T].add(F).multi(1/2),z=s.createHandle(I,{symbol:s.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(j,K){if(!(K&&K.domEvent&&K.domEvent.button===2)){var et=f(A),st=z[h],V=z.getContainerPoint(),pt=e._containerPointToPrj(V);et.splice(st+1,0,pt),A>0?r._prjHoles[A-1]=et:r._setPrjCoordinates(et),r._updateCache(),z.opacity=1,c[A].splice(st,0,y.call(s,st,A),y.call(s,st+1,A)),_=!0}},onMove:function(){g(z.getContainerPoint(),z[h]+1,A)},onUp:function(j){if(j&&j.domEvent&&j.domEvent.button===2){_=!1;return}var K=z[h];dh(z,c[A]),z.delete(),l[A].splice(K+1,0,x.call(s,K+1,A)),d(),s._updateCoordFromShadow(),_=!1},onRefresh:function(j,K){B=K||u(j);var et=z[h],st;et===B.length-1?st=0:st=et+1;var V=B[et].add(B[st]).multi(1/2),pt=e.coordToContainerPoint(V);z.setContainerPoint(pt._add(v()))}});return z[h]=T,z}if(r instanceof ie)for(var b=r.getHoles().length+1,M=0;M<b;M++){l[M]=[],c[M]=[];for(var C=u(M),w=0,S=C.length;w<S;w++)l[M].push(x.call(this,w,M,C)),w<S-1&&c[M].push(y.call(this,w,M,C));c[M].push(y.call(this,C.length-1,M,C))}else{for(var P=0,O=u(P),D=0,L=O.length;D<L;D++)l[P].push(x.call(this,D,P,O)),D<L-1&&c[P].push(y.call(this,D,P,O));c[P].length&&r.getCoordinates().length===2&&(c[P][0].options.symbol.markerDx=12)}this._addRefreshHook(function(){if(!_){for(var T in c)for(var A=u(T),N=c[T].length-1;N>=0;N--)c[T][N].refresh(T,A);c[0].length&&r instanceof fe&&(r.getCoordinates().length===2?c[0][0].options.symbol.markerDx=12:r.getCoordinates().length>2&&(c[0][0].options.symbol.markerDx=0));for(var B in l)for(var F=u(B),I=l[B].length-1;I>=0;I--)l[B][I].refresh(B,F)}})},i._refresh=function(){if(this._refreshHooks)for(var e=this._refreshHooks.length-1;e>=0;e--)this._refreshHooks[e].call(this)},i._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},i._addRefreshHook=function(e){!e||(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(e))},i._update=function(e){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];this._exeHistory([e,s]),this._recordHistory.apply(this,[e].concat(s))},i._updateCoordFromShadow=function(e){var r=this._shadow||this._geometry,s=r.getCoordinates(),a=this._geometry,h=this._updating;this._updating=!0,a.setCoordinates(s),e||this._recordHistory("setCoordinates",q.toNumberArrays(a.getCoordinates())),this._updating=h},i._recordHistory=function(e){this._history||(this._history=[],this._historyPointer=0);for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];if(this._history.length){var h=this._history[this._history.length-1];if(h[0]===e&&JSON.stringify(h[1])===JSON.stringify(s))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([e,s]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},i.cancel=function(){if(!this._history||this._historyPointer===0)return this;this._historyPointer=0;var e=this._history[0];return this._exeAndReset(e),this},i.undo=function(){if(!this._history||this._historyPointer===0)return this;var e=this._history[--this._historyPointer];return this._exeAndReset(e),this},i.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var e=this._history[++this._historyPointer];return this._exeAndReset(e),this},i._exeAndReset=function(e){if(!this._updating){this._exeHistory(e);var r=this._history,s=this._historyPointer;this.stop(),this._history=r,this._historyPointer=s,this.start()}},i._onDragStart=function(){this._updating=!0},i._onDragEnd=function(){this._updating=!1},i._exeHistory=function(e){if(!!Array.isArray(e)){var r=this._updating;this._updating=!0;var s=this._shadow||this._geometry,a=this._geometry;Array.isArray(e[0])?e[0].forEach(function(h){var l=h[0],c=h.slice(1);s[l].apply(s,c),s!==a&&a[l].apply(a,c)}):(s[e[0]].apply(s,e[1]),s!==a&&a[e[0]].apply(a,e[1])),this._updating=r}},t}(Ui(wi));R_.mergeOptions(uE);var fE={startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/ig,"").replace(/<\/p>/ig,"<br/>"),this._textEditor.innerHTML=t;var i=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(i),ge(this._textEditor,"mousedown dblclick",ni),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),i=this._createEditor();this._textEditor=i,t.on("mousedown",this.endEditText,this);var n=this._getEditorOffset();this._editUIMarker=new Qh(this.getCoordinates(),{animation:null,content:i,dx:n.dx,dy:n.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},i=0,n=0,e=t.textHorizontalAlignment;return e==="middle"||H(e)?(i=(t.textDx||0)-2,n=(t.textDy||0)-2):(i=(t.markerDx||0)-2,n=(t.markerDy||0)-2),{dx:i,dy:n}},_createEditor:function(){var t=this.getContent(),i=this.getSize(),n=this._getInternalSymbol()||{},e=i.width,r=n.textFill||"#000000",s=n.textSize||12,a=i.height,h=n.markerLineColor||"#000",l=n.markerFill||"#3398CC",c=n.textLineSpacing||0,u=Et("div");return u.contentEditable=!0,u.style.cssText="background:"+l+"; border:1px solid "+h+`;
            color:`+r+";font-size:"+s+"px;width:"+(e-2)+"px;height:"+(a-2)+`px;margin: auto;
            line-height:`+(s+c)+`px;outline: 0; padding:0; margin:0;word-wrap: break-word;
            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;`,u.innerText=t,we(u,"mousedown dblclick",ni),u.onkeyup=function(f){var d=u.style.height||0;f.keyCode===13&&(u.style.height=parseInt(d)+s/2+"px")},u},_setCursorToLast:function(t){var i;window.getSelection?(t.focus(),i=window.getSelection(),i.selectAllChildren(t),i.collapseToEnd()):document.selection&&(i=document.selection.createRange(),i.moveToElementText(t),i.collapse(!1),i.select())}};bf.include(fE);Jt.include({animate:function(t,i,n){var e=this;this._animPlayer&&this._animPlayer.finish(),ne(i)&&(n=i),i||(i={});var r=this.getMap(),s=this._getProjection(),a=this._prepareAnimationStyles(t),h,l=i.focus;if(delete this._animationStarted,r){var c=r._getRenderer(),u=function(p){c.callInNextFrame(p)};i.framer=u}var f=Ue.animate(a,i,function(d){if(r&&r.isRemoved()){f.finish();return}r&&!e._animationStarted&&l&&r.onMoveStart();var p=d.styles;for(var g in p)if(g!=="symbol"&&g!=="translate"&&p.hasOwnProperty(g)){var m="set"+g[0].toUpperCase()+g.slice(1);e[m](p[g])}var v=p.translate;if(v){var x=v;h&&(x=v.sub(h)),h=v,e.translate(x)}var _=p.symbol;if(_){var y=e.getSymbol()||{};e.setSymbol(Ai(y,_))}if(r&&l){var b=s.project(e.getCenter());r._setPrjCenter(b);var M=r._parseEventFromCoord(s.unproject(b));f.playState!=="running"?r.onMoveEnd(M):r.onMoving(M)}e._fireAnimateEvent(f.playState),n&&n(d)},this);return this._animPlayer=f,this._animPlayer.play()},_prepareAnimationStyles:function(t){var i=this._getInternalSymbol(),n={};for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];if(e!=="translate"&&e!=="symbol"){var s="get"+e[0].toUpperCase()+e.substring(1),a=this[s]();n[e]=[a,r]}else if(e==="symbol"){var h=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(i))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");h=[];for(var l=t.symbol,c=0;c<l.length;c++){if(!l[c]){h.push(null);continue}var u={};for(var f in l[c])l[c].hasOwnProperty(f)&&(u[f]=[i[c][f],l[c][f]]);h.push(u)}}else{if(Array.isArray(i))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");h={};for(var d in r)r.hasOwnProperty(d)&&(h[d]=[i[d],r[d]])}n.symbol=h}else e==="translate"&&(n.translate=new q(r))}return n},_fireAnimateEvent:function(t){t==="finished"?(delete this._animationStarted,this._fireEvent("animateend")):t==="running"&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var zc=Vo+"_drag_stage",Og=jt.touch?"touchstart mousedown":"mousedown",dE=function(o){ht(t,o);function t(n){return o.call(this,n)||this}var i=t.prototype;return i.addHooks=function(){this.target.on(Og,this._startDrag,this)},i.removeHooks=function(){this._endDrag(),this.target.off(Og,this._startDrag,this),delete this.container},i._prepareDragHandler=function(){this._dragHandler=new ks(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},i._prepareShadow=function(){var e=this,r=this.target,s=r.getLayer().options.renderer==="canvas";if(!!s){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var a=this._shadow=r.copy();if(a.getGeometries){var h=a.getGeometries(),l=r.getGeometries();h.forEach(function(c,u){e._updateShadowSymbol(c,l[u])})}else this._updateShadowSymbol(a,r);a.setId(null),this._prepareShadowConnectors()}},i._updateShadowSymbol=function(e,r){if(e.setSymbol(r._getInternalSymbol()),r.options.dragShadow){var s=Mh(e._getInternalSymbol(),.5);e.setSymbol(s)}},i._prepareShadowConnectors=function(){var e=this.target,r=this._shadow,s=this._dragStageLayer._getRenderer().resources,a=[];if(Ah._hasConnectors(e))for(var h=Ah._getConnectors(e),l=0,c=h.length;l<c;l++){var u=h[l],f=u.config(),d=u._getInternalSymbol();f.symbol=Mh(d,.5);var p=void 0;u.getConnectSource()===e?p=new u.constructor(r,u.getConnectTarget(),f):p=new u.constructor(u.getConnectSource(),r,f),a.push(p),u.getLayer()&&u.getLayer()._getRenderer()&&s.merge(u.getLayer()._getRenderer().resources)}this._shadowConnectors=a,a.push(r),this._dragStageLayer.bringToFront().addGeometry(a)},i._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},i._prepareDragStageLayer=function(){var e=this.target.getMap(),r=this.target.getLayer();this._dragStageLayer=e.getLayer(zc),this._dragStageLayer||(this._dragStageLayer=new Bi(zc,{enableAltitude:r.options.enableAltitude,altitudeProperty:r.options.altitudeProperty}),e.addLayer(this._dragStageLayer));var s=new Sr;s.merge(r._getRenderer().resources),this._dragStageLayer._getRenderer().resources=s},i._startDrag=function(e){var r=this.target.getMap();if(!!r){var s=this.target._getParent();if(!s&&!this.isDragging()){var a=e.domEvent;a.touches&&a.touches.length>1||a.button===2||(this.container=r._panels.mapWrapper||r._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(e.coordinate),this._lastPoint=e.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(e.domEvent),we(this.container,"mouseleave",this._endDrag,this),this._startParam=e,this._moved=!1)}}},i._dragging=function(e){var r=this.target,s=r.getMap(),a=s._parseEvent(e.domEvent),h=a.domEvent;if(!(h.touches&&h.touches.length>1)){var l=s._getVisualHeight(s.options.maxVisualPitch);if(!(a.containerPoint.y<s.height-l)){if(!this._moved){this._moved=!0,r.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(r.options.dragShadow||r.hide(),this._shadow._fireEvent("dragstart",a)),this.target._fireEvent("dragstart",this._startParam||a),delete this._startParam;return}var c=this._shadow||r,u=c.options.dragOnAxis,f=c.options.dragOnScreenAxis,d=a.containerPoint,p=a.coordinate;this._lastPoint=this._lastPoint||d,this._lastCoord=this._lastCoord||p,f?(u==="x"?d.y=this._lastPoint.y:u==="y"&&(d.x=this._lastPoint.x),p=s.containerPointToCoord(d)):p=this._correctCoord(p);var g=d.sub(this._lastPoint),m=p.sub(this._lastCoord);f||(u==="x"?g.y=m.y=0:u==="y"&&(g.x=m.x=0)),this._lastPoint=d,this._lastCoord=p,c.translate(m),c!==r&&!r.options.dragShadow&&r.translate(m),a.coordOffset=m,a.pointOffset=g,c._fireEvent("dragging",a),c!==r&&r._fireEvent("dragging",a)}}},i._endDrag=function(e){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&ge(this.container,"mouseleave",this._endDrag),!!this.target){var r=this.target;r.off("click",this._endDrag,this),r.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var s=r.getMap();if(this.enabled()&&s){var a=s._parseEvent(e?e.domEvent:null);this._updateTargetAndRemoveShadow(a),this._moved&&r._fireEvent("dragend",a)}}},i.isDragging=function(){return!!this._isDragging},i._updateTargetAndRemoveShadow=function(e){if(!!this._shadow){var r=this.target,s=r.getMap();r.options.dragShadow||r.show();var a=this._shadow;if(a){if(r.options.dragShadow)if(r.getGeometries){var h=a.getGeometries(),l=r.getGeometries();h.forEach(function(c,u){l[u].setCoordinates(h[u].getCoordinates())})}else r.setCoordinates(a.getCoordinates());a._fireEvent("dragend",e),a.remove(),delete this._shadow}this._shadowConnectors&&(s.getLayer(zc).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new Sr,this._dragStageLayer.remove())}},i._correctCoord=function(e){var r=this.target.getMap();if(!r.getPitch())return e;var s=this.target;if(!s.getMinAltitude())return e;var a=(s.getMinAltitude()+s.getMaxAltitude())/2;return r.locateByPoint(e,0,-a)},t}(Li);Jt.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1});Jt.addInitHook("addHandler","draggable",dE);Jt.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():this.draggable?this.draggable.isDragging():!1}});Jt.include({startEdit:function(t){return!this.getMap()||!this.options.editable?this:(this.endEdit(),this._editor=new R_(this,t),this._editor.start(),this._getParent()||this.fire("editstart"),this)},endEdit:function(){return this._editor&&(this._editor.stop(),delete this._editor,this._getParent()||this.fire("editend")),this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return this._editor?this._editor.isEditing():!1}});Jt.include({_onEvent:function(t,i){var n=this.getMap();if(!!n){var e=i||this._getEventTypeToFire(t);e==="contextmenu"&&this.listens("contextmenu")&&(ni(t),ai(t));var r=n._getEventParams(t);St(this._pickGeometryIndex)&&(r.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(e,r)}},_getEventTypeToFire:function(t){return t.type}});Jt.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof Rh?(this._infoWindow=t,this._infoWinOptions=dt({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=dt({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()?(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(t)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var t=this._infoWinOptions;return t?(this._infoWindow=new Rh(t),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var pE=new W(0,0),gE=new W(0,0),Dg=new W(0,0),Ig=new W(0,0),mE=[],vE=function(o){ht(t,o);function t(){return o.call(this,gf)||this}var i=t.prototype;return i.checkUrl=function(e){return!e||!Xt(e)?e:qu(e)},i.fetchImage=function(e,r,s,a){e=this.checkUrl(e);var h={url:e,fetchOptions:a};this.send(h,mE,s,r)},t}(pf),_E=new Image,tl=function(o){ht(t,o);function t(n){var e;return e=o.call(this,n)||this,e.tilesInView={},e.tilesLoading={},e._parentTiles=[],e._childTiles=[],e._tileQueue=[],e.tileCache=new Tv(n.options.maxCacheSize,e.deleteTile.bind(ze(ze(e)))),jt.decodeImageInWorker&&e.layer.options.decodeImageInWorker&&(n.options.renderer==="gl"||!jt.safari)&&(e._tileImageWorkerConn=new vE),e._compareTiles=xE.bind(ze(ze(e))),e}var i=t.prototype;return i.getCurrentTileZoom=function(){return this._tileZoom},i.draw=function(e,r){var s=this.getMap();if(!!this.isDrawable()){var a=this.prepareCanvas();if(a&&!a.intersects(this.canvasExtent2D)){this.completeRender();return}this._renderTimestamp!==e&&(this._consumeTileQueue(),this._renderTimestamp=e);var h,l=!1,c=this._frameTiles;if(c&&e===c.timestamp){if(c.empty)return;h=c}else{if(h=this._getTilesInCurrentFrame(),!h){this._frameTiles={empty:!0,timestamp:e},this.completeRender();return}l=!0,this._frameTiles=h,this._frameTiles.timestamp=e,h.loadingCount&&this.loadTileQueue(h.tileQueue)}var u=h,f=u.tiles,d=u.childTiles,p=u.parentTiles,g=u.placeholders,m=u.loading,v=u.loadingCount;this._drawTiles(f,p,d,g,r),v||m||(!s.isAnimating()&&(this._parentTiles.length||this._childTiles.length)&&(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),l&&this._retireTiles()}},i.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},i._getTilesInCurrentFrame=function(){var e=this.getMap(),r=this.layer,s=r.getTiles();if(this._frameTileGrids=s,s=s.tileGrids,!s||!s.length)return null;var a=s.reduce(function(Z,j){return Z+(j&&j.tiles&&j.tiles.length||0)},0);a>=this.tileCache.max/2&&this.tileCache.setMaxSize(a*2+1);var h=0,l=!1,c={},u=[],f=[],d={},p=[],g={},m=[],v={},x={},_=this._markTiles(),y=this._getLoadLimit(),b=s.length;this._tileZoom=s[0].zoom;for(var M=0;M<b;M++){var C=s[M],w=C.tiles,S=void 0;w.length&&(S=this._generatePlaceHolder(w[0].res));for(var P=0,O=w.length;P<O;P++){var D=w[P],L=D.id,T=!1;if(this._isLoadingTile(L))T=l=!0,this.tilesLoading[L].current=!0;else{var A=this._getCachedTile(L);if(A)A.image&&this.getTileOpacity(A.image)<1&&(T=l=!0,this.setToRedraw()),u.push(A);else{T=l=!0;var N=y&&h+_[0]>y;if(!N&&(!e.isInteracting()||e.isMoving()||e.isRotating())){h++;var B=L;x[B]=D}}}if(!!T&&!c[L]){c[L]=1,S&&!v[L]&&(D.cache=!1,m.push({image:S,info:D}),v[L]=1);var F=this._findParentTile(D);if(F){var I=F.info.id;d[I]===void 0&&(d[I]=f.length,f.push(F))}else if(!f.length){var z=this._findChildTiles(D);z.length&&z.forEach(function(Z){g[Z.info.id]||(p.push(Z),g[Z.info.id]=1)})}}}}return f.length&&(p.length=0,this._childTiles.length=0),{childTiles:p,parentTiles:f,tiles:u,placeholders:m,loading:l,loadingCount:h,tileQueue:x}},i.isTileCachedOrLoading=function(e){return this.tileCache.get(e)||this.tilesInView[e]||this.tilesLoading[e]},i._drawTiles=function(e,r,s,a,h){var l=this;r.length&&(r.sort(function(d,p){return Math.abs(p.info.z-l._tileZoom)-Math.abs(d.info.z-l._tileZoom)}),this._parentTiles=r),s.length&&(this._childTiles=s);var c={tiles:e,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:h};this.onDrawTileStart(c,h),this.layer.options.opacity===1&&(this._childTiles.forEach(function(d){return l._drawTile(d.info,d.image,h)}),this._parentTiles.forEach(function(d){return l._drawTile(d.info,d.image,h)})),e.sort(this._compareTiles);for(var u=0,f=e.length;u<f;u++)this._drawTileAndCache(e[u],h);this.layer.options.opacity<1&&(this._childTiles.forEach(function(d){return l._drawTile(d.info,d.image,h)}),this._parentTiles.forEach(function(d){return l._drawTile(d.info,d.image,h)})),a.forEach(function(d){return l._drawTile(d.info,d.image,h)}),this.onDrawTileEnd(c,h)},i.onDrawTileStart=function(){},i.onDrawTileEnd=function(){},i._drawTile=function(e,r,s){r&&this.drawTile(e,r,s)},i._drawTileAndCache=function(e,r){e.current=!0,this.tilesInView[e.info.id]=e,this._drawTile(e.info,e.image,r),this.tileCache.add(e.info.id,e)},i.drawOnInteracting=function(e,r,s){this.draw(r,s)},i.needToRedraw=function(){var e=this.getMap();return this._tileQueue.length?!0:e.getPitch()?o.prototype.needToRedraw.call(this):e.isRotating()||e.isZooming()?!0:e.isMoving()?!!this.layer.options.forceRenderOnMoving:o.prototype.needToRedraw.call(this)},i.hitDetect=function(){return!1},i._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:0},i.isDrawable=function(){return this.getMap().getPitch()?(this.clear(),!1):!0},i.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],o.prototype.clear.call(this)},i._isLoadingTile=function(e){return!!this.tilesLoading[e]},i.clipCanvas=function(e){return o.prototype.clipCanvas.call(this,e)},i._clipByPitch=function(e){var r=this.getMap();if(r.getPitch()<=r.options.maxVisualPitch||!this.layer.options.clipByPitch)return!1;var s=r.getContainerExtent(),a=r.getDevicePixelRatio();return e.save(),e.strokeStyle="rgba(0, 0, 0, 0)",e.beginPath(),e.rect(0,Math.ceil(s.ymin)*a,Math.ceil(s.getWidth())*a,Math.ceil(s.getHeight())*a),e.stroke(),e.clip(),!0},i.loadTileQueue=function(e){for(var r in e)if(e.hasOwnProperty(r)){var s=e[r],a=this.loadTile(s);a.loadTime===void 0&&(this.tilesLoading[s.id]={image:a,current:!0,info:s})}},i.loadTile=function(e){var r;if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)r={},this._fetchImage(r,e);else{var s=this.layer.getTileSize(e.layer);r=new Image,r.width=s.width,r.height=s.height,r.onload=this.onTileLoad.bind(this,r,e),r.onerror=this.onTileError.bind(this,r,e),this.loadTileImage(r,e.url)}return r},i._fetchImage=function(e,r){var s=this;if(e instanceof Image)e.src=r.url;else{var a=r.x,h=r.y,l=Math.abs(a+h)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(r.url,l,function(c,u){c?s.onTileError(e,r,c):$u(u,function(f){s.onTileLoad(f,r)})},this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},i.loadTileImage=function(e,r){var s=this.layer.options.crossOrigin;return H(s)||(e.crossOrigin=s),Po(e,[r])},i.abortTileLoading=function(e){!e||(e.onload=kg,e.onerror=kg,e.src=Zu)},i.onTileLoad=function(e,r){this._tileQueue.push({tileInfo:r,tileData:e})},i._consumeTileQueue=function(){for(var e=0,r=this.layer.options.tileLimitPerFrame,s=this._tileQueue;s.length&&(r<=0||e<r);){var a=s.shift(),h=a.tileData,l=a.tileInfo;!this.checkTileInQueue(h,l)||(this.consumeTile(h,l),e++)}},i.checkTileInQueue=function(){return!0},i.consumeTile=function(e,r){if(!!this.layer){var s=r.id;if(!!this.tilesInView){var a={tile:r,tileImage:e};this.layer.fire("tileload",a),e=a.tileImage,e.loadTime=me(),delete this.tilesLoading[s],this._addTileToCache(r,e),this.setToRedraw()}}},i.onTileError=function(e,r){if(!!this.layer){e.onerrorTick=e.onerrorTick||0;var s=this.layer.options.tileRetryCount;if(s>e.onerrorTick){e.onerrorTick++,this._fetchImage(e,r);return}var a=this.layer.options.errorUrl;if(a)if(e instanceof Image&&e.src!==a){e.src=a;return}else e=new Image,e.src=a;e=e instanceof Image?e:_E,this.abortTileLoading(e,r),e.loadTime=0,delete this.tilesLoading[r.id],this._addTileToCache(r,e),this.setToRedraw(),this.layer.fire("tileerror",{tile:r})}},i.drawTile=function(e,r){if(!(!r||!this.getMap())){var s=e.extent2d,a=e.offset,h=pE.set(s.xmin-a[0],s.ymax-a[1]),l=e.z,c=e.id,u=this.getMap(),f=u.getZoom(),d=this.context,p=u._pointAtResToContainerPoint(h,e.res,0,gE),g=u.getBearing(),m=g||f!==l,v=this.getTileOpacity(r),x=d.globalAlpha;v<1&&(d.globalAlpha=v,this.setToRedraw()),m||p._round();var _=p.x,y=p.y,b=e.extent2d.xmax-e.extent2d.xmin,M=e.extent2d.ymax-e.extent2d.ymin;if(m){d.save(),d.translate(_,y),g&&(d.rotate(-g*Math.PI/180),b+=.1,M+=.1);var C=u._getResolution();if(C!==e.res){var w=e.res/C;d.scale(w,w)}_=y=0}if(ot.image(d,r,_,y,b,M),this.layer.options.debug){var S=this.layer.options.debugOutline;d.save(),d.strokeStyle=S,d.fillStyle=S,d.strokeWidth=10,d.font="20px monospace";var P=new W(_,y);ot.rectangle(d,P,{width:b,height:M},1,0),ot.fillText(d,this.getDebugInfo(c),P._add(32,M-14),S),ot.drawCross(d,_+b/2,y+M/2,2,S),d.restore()}m&&d.restore(),d.globalAlpha!==x&&(d.globalAlpha=x),this.setCanvasUpdated()}},i.getDebugInfo=function(e){var r=e.split("_"),s=r.length;return"x:"+r[s-2]+", y:"+r[s-3]+", z:"+r[s-1]},i._findChildTiles=function(e){var r=this._getLayerOfTile(e.layer);if(!r||!r.options.background)return[];for(var s=this.getMap(),a=[],h=e.res,l=e.extent2d.getMin(),c=e.extent2d.getMax(),u=r._project(s._pointToPrjAtRes(l,h,Dg),Dg),f=r._project(s._pointToPrjAtRes(c,h,Ig),Ig),d=3,p=1;p<d;p++)this._findChildTilesAt(a,u,f,r,e.z+p);return a},i._findChildTilesAt=function(e,r,s,a,h){var l=a.options.zoomOffset,c=a.getId(),u=a.getSpatialReference().getResolution(h+l);if(!!u)for(var f=a._getTileConfig().getTileIndex(r,u),d=a._getTileConfig().getTileIndex(s,u),p=Math.min(f.idx,d.idx),g=Math.max(f.idx,d.idx),m=Math.min(f.idy,d.idy),v=Math.max(f.idy,d.idy),x,_,y=p;y<g;y++)for(var b=m;b<v;b++)x=a._getTileId(y,b,h+l,c),this.tileCache.has(x)&&(_=this.tileCache.getAndRemove(x),e.push(_),this.tileCache.add(x,_))},i._findParentTile=function(e){var r=this.getMap(),s=this._getLayerOfTile(e.layer);if(!s||!s.options.background)return null;for(var a=s.getSpatialReference(),h=a.getZoomDirection(),l=s.options.zoomOffset,c=s.options.backgroundZoomDiff,u=e.res,f=e.extent2d.getCenter(),d=s._project(r._pointToPrjAtRes(f,u)),p=1;p<=c;p++){var g=e.z-h*p,m=a.getResolution(g+l);if(!!m){var v=s._getTileConfig().getTileIndex(d,m),x=s._getTileId(v.x,v.y,g+l,e.layer);if(this.tileCache.has(x)){var _=this.tileCache.getAndRemove(x);return this.tileCache.add(x,_),_}}}return null},i._getLayerOfTile=function(e){return this.layer.getChildLayer?this.layer.getChildLayer(e):this.layer},i._getCachedTile=function(e){var r=this.tilesInView,s=this.tileCache.getAndRemove(e);if(s){r[e]=s;var a=this.tilesLoading;if(a&&a[e]){a[e].current=!1;var h=a[e],l=h.image,c=h.info;this.abortTileLoading(l,c),delete a[e]}}else s=r[e];return s},i._addTileToCache=function(e,r){this.tilesInView[e.id]={image:r,current:!0,info:e}},i.getTileOpacity=function(e){return!this.layer.options.fadeAnimation||!e.loadTime?1:Math.min(1,(me()-e.loadTime)/(1e3/60*10))},i.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,o.prototype.onRemove.call(this)},i._markTiles=function(){var e=0,r=0;if(this.tilesLoading)for(var s in this.tilesLoading)this.tilesLoading[s].current=!1,e++;if(this.tilesInView)for(var a in this.tilesInView)this.tilesInView[a].current=!1,r++;return[e,r]},i._retireTiles=function(e){for(var r in this.tilesLoading){var s=this.tilesLoading[r];(e||!s.current)&&(s.image&&this.abortTileLoading(s.image,s.info),this.deleteTile(s),delete this.tilesLoading[r])}for(var a in this.tilesInView){var h=this.tilesInView[a];h.current||(delete this.tilesInView[a],this.tileCache.has(a)||this.deleteTile(h))}},i.deleteTile=function(e){!e||!e.image||(e.image.close&&e.image.close(),e.image.onload=null,e.image.onerror=null)},i._generatePlaceHolder=function(e){var r=this.getMap(),s=this.layer.options.placeholder;if(!s||r.getPitch())return null;var a=this.layer.getTileSize(),h=e/r._getResolution(),l=this._tilePlaceHolder=this._tilePlaceHolder||ot.createCanvas(1,1,r.CanvasClass);return l.width=a.width*h,l.height=a.height*h,ne(s)?s(l):yE(l),l},t}(Fs);vi.registerRenderer("canvas",tl);function kg(){return!1}function yE(o){var t=o.getContext("2d"),i=o.width,n=o.height,e=i/16,r=n/16;t.beginPath();for(var s=0;s<16;s++)t.moveTo(0,s*r),t.lineTo(i,s*r),t.moveTo(s*e,0),t.lineTo(s*e,n);t.strokeStyle="rgba(180, 180, 180, 0.1)",t.lineWidth=1,t.stroke(),t.beginPath();for(var a=[[0,0],[i,0],[0,n],[i,n],[0,0],[0,n],[i,0],[i,n],[0,n/2],[i,n/2],[i/2,0],[i/2,n]],h=1;h<a.length;h+=2)t.moveTo(a[h-1][0],a[h-1][1]),t.lineTo(a[h][0],a[h][1]);t.lineWidth=1*4,t.stroke()}function xE(o,t){return Math.abs(this._tileZoom-o.info.z)-Math.abs(this._tileZoom-t.info.z)}var wE=new W(0,0),ME={properties:{}},Df=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.isDrawable=function(){return!0},i.needToRedraw=function(){var e=this.getMap();return this._gl()&&!e.getPitch()&&e.isZooming()&&!e.isMoving()&&!e.isRotating()?!0:o.prototype.needToRedraw.call(this)},i.onDrawTileStart=function(e,r){var s=this.gl;if(s.stencilOp(s.KEEP,s.KEEP,s.REPLACE),r&&r.renderTarget){var a=r.renderTarget.fbo;if(a){var h=r.renderTarget.getFramebuffer(a);s.bindFramebuffer(s.FRAMEBUFFER,h)}}},i.onDrawTileEnd=function(e,r){var s=this.gl;if(r&&r.renderTarget){var a=r.renderTarget.fbo;a&&s.bindFramebuffer(s.FRAMEBUFFER,null)}},i.drawTile=function(e,r,s){if(!(s&&s.sceneFilter&&!s.sceneFilter(ME))){var a=this.getMap();if(!(!e||!a||!r)){var h=e._glScale=e._glScale||e.res/a.getGLRes(),l=e.extent2d.xmax-e.extent2d.xmin,c=e.extent2d.ymax-e.extent2d.ymin;if(e.cache!==!1&&this._bindGLBuffer(r,l,c),!this._gl()){o.prototype.drawTile.call(this,e,r);return}var u=e.extent2d,f=e.offset,d=wE.set(u.xmin-f[0],e.extent2d.ymax-f[1]),p=d.x*h,g=d.y*h,m=this.getTileOpacity(r),v=null;this.layer.options.debug&&(v=this.getDebugInfo(e.id));var x=this.gl;x.stencilFunc(x.LEQUAL,Math.abs(this.getCurrentTileZoom()-e.z),255),this.drawGLImage(r,p,g,l,c,h,m,v),m<1?this.setToRedraw():this.setCanvasUpdated()}}},i._bindGLBuffer=function(e,r,s){e.glBuffer||(e.glBuffer=this.bufferTileData(0,0,r,s))},i.loadTileImage=function(e,r){var s=this.layer.options.crossOrigin;e.crossOrigin=s!==null?s:"",e.src=r},i.onCanvasCreate=function(){(!this.canvas.gl||!this.canvas.gl.wrap)&&this.createCanvas2()},i.createContext=function(){o.prototype.createContext.call(this),this.createGLContext()},i.resizeCanvas=function(e){!this.canvas||(o.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},i.clearCanvas=function(){!this.canvas||(o.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.getCanvasImage=function(){if(!this._gl()||!this.canvas2)return o.prototype.getCanvasImage.call(this);var e=o.prototype.getCanvasImage.call(this);return e&&(e.image=this.canvas2),e},i._gl=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var e=this.getMap();return e&&(e.getPitch()||e.getBearing())||this.layer&&!!this.layer.options.fragmentShader},i.deleteTile=function(e){o.prototype.deleteTile.call(this,e),e&&e.image&&this.disposeImage(e.image),delete e.image},i.onRemove=function(){o.prototype.onRemove.call(this),this.removeGLCanvas()},t}(Af(tl));vi.registerRenderer("gl",Df);function O_(o){var t=this.layer.getTileSize(),i=this.canvas.constructor,n=this.getMap(),e=n.getDevicePixelRatio(),r=ot.createCanvas(t.width*e,t.height*e,i);r.layer=this.layer;var s=this,a=new W(o.extent2d.xmin,o.extent2d.ymax),h=new oe(n.pointToCoordinate(a),n.pointToCoordinate(a.add(t.width,t.height)),n.getProjection());return this.layer.drawTile(r,{url:o.url,point:a,center:n.pointToCoordinate(a.add(t.width/2,t.height/2)),extent:h,z:o.z,x:o.x,y:o.y},function(l){if(l){s.onTileError(r,o);return}s.onTileLoad(r,o)}),r}var D_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.loadTile=function(){return O_.apply(this,arguments)},t}(tl),I_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.loadTile=function(){return O_.apply(this,arguments)},t}(Df);Ef.registerRenderer("canvas",D_);Ef.registerRenderer("gl",I_);var bE=typeof Int8Array<"u"?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[],SE=`
    attribute vec3 a_position;
    uniform mat4 transform;

    void main()
    {
        gl_Position = transform * vec4(a_position, 1.0);
    }
`,CE=`
    precision mediump float;
    uniform vec3 color;
    void main()
    {
        gl_FragColor = vec4(color, 1.0);
    }
`,TE=function(){function o(i,n,e){this.gl=i,this.quadVertices=n||bE,this.attributes=["a_position",3,PE(n)],this.debug=e}var t=o.prototype;return t.start=function(){var n=this.gl;n.enable(n.STENCIL_TEST),n.stencilMask(255),n.stencilOp(n.KEEP,n.REPLACE,n.REPLACE),n.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),n.useProgram(this.program),n.bindBuffer(n.ARRAY_BUFFER,this.buffer),E_(n,this.program,this.attributes),this.transformLoc||(this.transformLoc=n.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=n.getUniformLocation(this.program,"color")),!this.debug&&n.colorMask(!1,!1,!1,!1)},t.end=function(){var n=this.gl;n.depthMask(!0),this._restore(),!this.debug&&n.colorMask(!0,!0,!0,!0)},t.draw=function(n){var e=this.gl;e.uniformMatrix4fv(this.transformLoc,!1,n),e.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),e.drawArrays(e.TRIANGLE_STRIP,0,4)},t.remove=function(){var n=this.gl;return this.buffer&&n.deleteBuffer(this.buffer),this.program&&(n.deleteShader(this.program.fragmentShader),n.deleteShader(this.program.vertexShader),n.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},t.stencilMask=function(n){return this.gl.stencilMask(n),this},t.stencilFunc=function(n,e,r){return this.ref=e,this.gl.stencilFunc(n,e,r),this},t.stencilOp=function(n,e,r){return this.gl.stencilOp(n,e,r),this},t.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},t._save=function(){var n=this.gl;this._savedProgram=n.program},t._restore=function(){var n=this.gl;n.program=this._savedProgram,n.program&&n.useProgram(n.program)},t._createBuffer=function(){var n=this.gl;if(this.buffer=n.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.bufferData(n.ARRAY_BUFFER,this.quadVertices,n.STATIC_DRAW)},t._createProgram=function(){var n=P_(this.gl,SE,CE),e=n.program,r=n.vertexShader,s=n.fragmentShader;e.vertexShader=r,e.fragmentShader=s,this.program=e},o}();function PE(o){return o instanceof Float32Array?"FLOAT":o instanceof Int16Array?"SHORT":o instanceof Uint16Array?"UNSIGNED_SHORT":o instanceof Int8Array?"BYTE":o instanceof Uint8Array||o instanceof Uint8ClampedArray?"UNSIGNED_BYTE":"FLOAT"}var k_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.checkResources=function(){var e=this._geosToCheck;if(!this._resourceChecked&&!e&&(e=this.layer._geoList),!ee(e))return[];for(var r=[],s={},a=e.length-1;a>=0;a--){var h=e[a],l=h._getExternalResources();if(!!l.length)if(!this.resources)r.push.apply(r,l);else for(var c=0;c<l.length;c++){var u=l[c][0];!this.resources.isResourceLoaded(l[c])&&!s[u]&&(r.push(l[c]),s[u]=1)}}return this._resourceChecked=!0,delete this._geosToCheck,r},i.render=function(){return this.layer._sortGeometries(),o.prototype.render.apply(this,arguments)},i._addGeoToCheckRes=function(e){!e||(Array.isArray(e)||(e=[e]),this._geosToCheck||(this._geosToCheck=[]),Ar(this._geosToCheck,e))},i.onGeometryAdd=function(e){this._addGeoToCheckRes(e),Yi(this)},i.onGeometryRemove=function(){Yi(this)},i.onGeometrySymbolChange=function(e){this._addGeoToCheckRes(e.target),Yi(this)},i.onGeometryShapeChange=function(){Yi(this)},i.onGeometryPositionChange=function(){Yi(this)},i.onGeometryZIndexChange=function(){Yi(this)},i.onGeometryShow=function(){Yi(this)},i.onGeometryHide=function(){Yi(this)},i.onGeometryPropertiesChange=function(){Yi(this)},t}(Fs);function Yi(o){o.layer.options.drawImmediate&&o.render(),o.setToRedraw()}var EE=new Vt,ja=[],Fc=new Vt,AE="center",z_=function(o){ht(t,o);function t(){return o.apply(this,arguments)||this}var i=t.prototype;return i.getImageData=function(){if(!this.layer.options.geometryEvents||!this._lastRenderTime||me()-this._lastRenderTime<32||!this.context||!this.context.canvas)return null;if(!this._imageData){var e=this.context.canvas,r=e.width,s=e.height;try{this._imageData=this.context.getImageData(0,0,r,s)}catch{}}return this._imageData},i.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=me()},i.checkResources=function(){var e=this,r=o.prototype.checkResources.apply(this,arguments),s=this.layer.getStyle();return s&&(Array.isArray(s)||(s=[s]),s.forEach(function(a){for(var h=Wo(a.symbol,!0),l=0,c=h.length;l<c;l++)e.resources.isResourceLoaded(h[l])||r.push(h[l])})),r},i.needToRedraw=function(){var e=this.getMap();return e.isInteracting()&&this.layer.options.enableAltitude?!0:e.isZooming()&&!e.isRotating()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===Bi?!1:o.prototype.needToRedraw.call(this)},i.draw=function(){if(!!this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty()){this.clearCanvas(),this.completeRender();return}this.prepareCanvas(),this.drawGeos(),this.completeRender()}},i.isBlank=function(){return this.context?!this.context.canvas._drawn:!1},i.drawOnInteracting=function(){if(!!this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var e=this.getMap(),r=this.layer.getCount(),s=this.mapStateCache.resolution;(e.isZooming()&&e.options.seamlessZoom&&this._drawnRes!==void 0&&s>this._drawnRes*1.5&&this._geosToDraw.length<r||e.isMoving()||e.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._drawnRes=s),this._sortByDistanceToCamera(e.cameraPosition);for(var a=0,h=this._geosToDraw.length;a<h;a++){var l=this._geosToDraw[a];if(!l._isCheck&&!l.isVisible()){delete l._cPoint,delete l._inCurrentView;continue}l._paint(this._displayExtent),this._geosToDraw[a]._cPoint=void 0,this._geosToDraw[a]._inCurrentView=void 0}this.clearImageData()}},i.show=function(){this.layer.forEach(function(e){e._repaint()}),o.prototype.show.apply(this,arguments)},i.forEachGeo=function(e,r){this.layer.forEach(e,r)},i.drawGeos=function(){this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._sortByDistanceToCamera(this.getMap().cameraPosition);for(var e=0,r=this._geosToDraw.length;e<r;e++)this._geosToDraw[e]._paint(),this._geosToDraw[e]._cPoint=void 0,this._geosToDraw[e]._inCurrentView=void 0;this.clearImageData()},i.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},i.checkGeo=function(e){if(e.type==="Point"&&this._onlyHasPoint!==void 0){e._inCurrentView&&(this._hasPoint=!0,e._isCheck=!0,this._geosToDraw.push(e));return}if(e._isCheck=!1,!(!e||!e.isVisible()||!e.getMap()||!e.getLayer()||!e.getLayer().isCanvasRender())){var r=e._getPainter(),s=!0;if(e._inCurrentView)s=!0;else if(e._inCurrentView===!1)s=!1;else{var a=r.get2DExtent(this.resources,EE);(!a||!a.intersects(this._displayExtent))&&(s=!1)}!s||(r.hasPoint()&&(this._hasPoint=!0),e._isCheck=!0,this._geosToDraw.push(e))}},i.onZoomEnd=function(){delete this.canvasExtent2D,o.prototype.onZoomEnd.apply(this,arguments)},i.onRemove=function(){this.forEachGeo(function(e){e.onHide()}),delete this._geosToDraw},i.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),o.prototype.onGeometryPropertiesChange.call(this,e)},i._updateDisplayExtent=function(){var e=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(e)){this.completeRender();return}e=e.intersection(this._maskExtent)}this._displayExtent=e},i.identifyAtPoint=function(e,r){r===void 0&&(r={});var s=this._geosToDraw;return s?this.layer._hitGeos(s,e,r):[]},i._updateMapStateCache=function(){var e=this.getMap(),r=e._pointToContainerPoint(this.southWest)._add(0,-e.height),s=e.getResolution(),a=e.getPitch(),h=e.getBearing(),l=e.getGLScale(),c=e.getGLRes(),u=e.getContainerExtent(),f=e._get2DExtent(),d=e._get2DExtentAtRes(c);return this.mapStateCache={resolution:s,pitch:a,bearing:h,glScale:l,glRes:c,_2DExtent:f,glExtent:d,containerExtent:u,offset:r},this},i._batchConversionMarkers=function(e){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var r=[],s=[],a=[],h={},l=this.layer,c=l.options,u=l.getAltitude?l.getAltitude():0,f=l.isCanvasRender();this._onlyHasPoint=!0;for(var d=0,p=0,g=this.layer._geoList.length;p<g;p++){var m=this.layer._geoList[p],v=m.getType();if(v==="Point"){var x=m._painter;x||(x=m._getPainter());var _=x.getRenderPoints(AE)[0][0],y=c.enableAltitude?m.getAltitude():u;h[y]===void 0&&(h[y]=x.getAltitude()),r[d]=_,a[d]=h[y],s[d]=m,d++}else this._onlyHasPoint=!1}if(d===0)return[];var b=this.getMap(),M=Eo(r,"_pt");M=b._pointsAtResToContainerPoints(r,e,a,M);for(var C=b.getContainerExtent(),w=C.xmax,S=C.ymax,P=C.xmin,O=C.ymin,D={},L=0,T=s.length;L<T;L++){var A=s[L];if(A._cPoint=M[L],!A._cPoint){A._inCurrentView=!1;continue}var N=M[L],B=N.x,F=N.y;if(A._inCurrentView=B>=P&&F>=O&&B<=w&&F<=S,!A._inCurrentView){var I=A.getSymbolHash(),z=void 0;I?z=D[I]=D[I]||A._painter.getFixedExtent():z=A._painter.getFixedExtent(),Fc.set(z.xmin,z.ymin,z.xmax,z.ymax),Fc._add(M[L]),A._inCurrentView=Fc.intersects(C)}A._inCurrentView&&((!A.isVisible()||!f)&&(A._inCurrentView=!1),this._onlyHasPoint&&A._inCurrentView&&(this._hasPoint=!0,A._isCheck=!0,this._geosToDraw.push(A)))}return M},i._sortByDistanceToCamera=function(e){if(!!this.layer.options.sortByDistanceToCamera&&!!this._geosToDraw.length){var r=this.getMap(),s=r.distanceToPoint(1e3,0,r.getGLScale()).x,a=s/1e3,h="center";this._geosToDraw.sort(function(l,c){var u=l.getType(),f=c.getType();if(u!=="Point"||f!=="Point")return 0;var d=l._painter,p=c._painter;if(!d||!p)return 0;var g=d.getRenderPoints(h)[0][0],m=p.getRenderPoints(h)[0][0],v=d.getAltitude()*a,x=p.getAltitude()*a;di(ja,g.x,g.y,v);var _=Lh(ja,e);di(ja,m.x,m.y,x);var y=Lh(ja,e);return y-_})}},i._constructorIsThis=function(){return this.constructor===t},t}(k_);Bi.registerRenderer("canvas",z_);var F_=function(o){ht(t,o);function t(n){var e;return e=o.call(this)||this,e.map=n,e._handlerQueue=[],e}var i=t.prototype;return i.callInNextFrame=function(e){this._handlerQueue.push(e)},i.executeFrameCallbacks=function(){var e=this._handlerQueue;this._handlerQueue=[];for(var r=0,s=e.length;r<s;r++)e[r]()},i.offsetPlatform=function(e,r){if(!this.map._panels.front)return this;if(!r&&e.x===0&&e.y===0)return this;var s=this.map._panels,a=this._frontCount=s.back.layerDOM.childElementCount,h=this._backCount=s.front.layerDOM.childElementCount,l=this._uiCount=s.front.uiDOM.childElementCount;if(a||h||l){var c=this.map.offsetPlatform();e?c=c.add(e)._round():c=c.round(),h&&po(s.back,c),(a||l)&&po(s.front,c)}return this},i.domChanged=function(){var e=this.map._panels;if(!e.front)return!1;var r=e.back.layerDOM.childElementCount;if(this._frontCount===void 0||this._frontCount!==r)return!0;var s=e.front.layerDOM.childElementCount;if(this._backCount===void 0||this._backCount!==s)return!0;var a=e.front.uiDOM.childElementCount;return this._uiCount===void 0||this._uiCount!==a},i.resetContainer=function(){if(!!this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var e=new W(0,0);po(this.map._panels.back,e),po(this.map._panels.front,e)}},i.onZoomEnd=function(){this.resetContainer()},i.onLoad=function(){this._frameLoop()},t}(wi),N_=function(o){ht(t,o);function t(n){var e;return e=o.call(this,n)||this,e._containerIsCanvas=!!n._containerDOM.getContext,e._thisVisibilitychange=e._onVisibilitychange.bind(ze(ze(e))),e._registerEvents(),e._loopTime=0,e}var i=t.prototype;return i.load=function(){this.initContainer()},i.renderFrame=function(e){var r=this.map;if(!r||!r.options.renderable)return!1;if(r.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(e),delete this._isViewChanged,r._fireEvent("framestart"),this.updateMapDOM(),r.clearCollisionIndex();var s=this._getAllLayerToRender();this.drawLayers(s,e);var a=this.drawLayerCanvas(s);return a&&(this.drawTops(),this._drawCenterCross()),r._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,!0},i.updateMapDOM=function(){var e=this.map;if(!e.isZooming()){var r=e._getViewPointFrameOffset();r?e.offsetPlatform(r):this.domChanged()&&this.offsetPlatform(null,!0)}},i.drawLayers=function(e,r){for(var s=this.map,a=s.isInteracting(),h=[],l=[],c=s.options.fpsOnInteracting||0,u=c===0?0:1e3/c,f=this.map.options.layerCanvasLimitOnInteracting,d=e.length,p=s.getBaseLayer(),g=0,m=0;m<d;m++){var v=e[m];if(!!v.isVisible()){var x=v.isCanvasRender();x&&h.push(v.getId());var _=v._getRenderer();if(!!_){var y=this._checkLayerRedraw(v);x&&_.isCanvasUpdated()&&(y||l.push(v.getId()),this.setLayerCanvasUpdated());var b=_.__zoomTransformMatrix;if(delete _.__zoomTransformMatrix,!y){x&&a&&(s.isZooming()&&!s.getPitch()?(_.prepareRender(),_.__zoomTransformMatrix=this._zoomMatrix):(s.getPitch()||s.isRotating())&&_.clearCanvas());continue}if(a&&x){if(f>0&&d-1-m>f&&v!==p){v._getRenderer().clearCanvas();continue}g+=this._drawCanvasLayerOnInteracting(v,g,u,r)}else a&&_.drawOnInteracting?(_.prepareRender&&_.prepareRender(),_.checkAndDraw?_.checkAndDraw(_.drawOnInteracting,this._eventParam,r):_.drawOnInteracting(this._eventParam,r)):(_.render(r),x&&b&&_.isLoadingResource()&&(_.__zoomTransformMatrix=b));x&&(l.push(v.getId()),this.setLayerCanvasUpdated())}}}var M=this._canvasIds||[],C=this._updatedIds||[];if(this._canvasIds=h,this._updatedIds=l,!this.isLayerCanvasUpdated()){var w="---";(M.join(w)!==h.join(w)||C.join(w)!==l.join(w))&&this.setLayerCanvasUpdated()}},i._checkLayerRedraw=function(e){if(this.isSpatialReferenceChanged())return!0;var r=this.map,s=e._getRenderer();return e.isCanvasRender()?s.testIfNeedRedraw():s.needToRedraw&&s.needToRedraw()?!0:r.isInteracting()||this.isViewChanged()},i._drawCanvasLayerOnInteracting=function(e,r,s,a){var h=this.map,l=e._getRenderer(),c=l.getDrawTime(),u=s===0||s>0&&r+c<=s;if(l.mustRenderOnInteracting&&l.mustRenderOnInteracting())l.render(a);else{if(l.drawOnInteracting&&(e===h.getBaseLayer()||u||h.isZooming()&&e.options.forceRenderOnZooming||h.isMoving()&&e.options.forceRenderOnMoving||h.isRotating()&&e.options.forceRenderOnRotating))return l.prepareRender(),l.prepareCanvas(),l.checkAndDraw?l.checkAndDraw(l.drawOnInteracting,this._eventParam,a):l.drawOnInteracting(this._eventParam,a),c;h.isZooming()&&!h.getPitch()&&!h.isRotating()?(l.prepareRender(),l.__zoomTransformMatrix=this._zoomMatrix):(h.getPitch()||h.isRotating())&&l.clearCanvas()}return l.drawOnInteracting&&!u&&l.onSkipDrawOnInteracting(this._eventParam,a),0},i._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var e=this.map;this._updatedIds.reverse().forEach(function(r){var s=e.getLayer(r);if(!!s){var a=s._getRenderer();!a||!a.isRenderComplete()||s.fire("layerload")}})}},i.isLayerCanvasUpdated=function(){return this._canvasUpdated},i.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},i.drawLayerCanvas=function(e){var r=this.map;if(!r||!this.isLayerCanvasUpdated()&&!this.isViewChanged())return!1;this.canvas||this.createCanvas(),r._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var s=r.isInteracting(),a=r.options.layerCanvasLimitOnInteracting,h=e.length,l,c=[],u=0;u<h;u++)if(!(!e[u].isVisible()||!e[u].isCanvasRender())){var f=e[u]._getRenderer();if(!!f){var d=this._getLayerImage(e[u]);d&&d.image&&(e[u]===r.getBaseLayer()?l=[e[u],d]:c.push([e[u],d]))}}var p=this.canvas.width,g=this.canvas.height;l&&(this._drawLayerCanvasImage(l[0],l[1],p,g),this._drawFog()),h=c.length;for(var m=s&&a>=0&&h>a?h-a:0,v=m;v<h;v++)this._drawLayerCanvasImage(c[v][0],c[v][1],p,g);return r._fireEvent("renderend",{context:this.context}),!0},i.setToRedraw=function(){for(var e=this._getAllLayerToRender(),r=0,s=e.length;r<s;r++){var a=e[r].getRenderer();a&&a.canvas&&a.setToRedraw&&a.setToRedraw()}},i.updateMapSize=function(e){if(!(!e||this._containerIsCanvas)){var r=e.width+"px",s=e.height+"px",a=this.map._panels;a.mapWrapper.style.width=r,a.mapWrapper.style.height=s,this._updateCanvasSize()}},i.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},i.toDataURL=function(e,r){return this.canvas?this.canvas.toDataURL(e,r):null},i.remove=function(){jt.webgl&&typeof document<"u"&&$n(document,"visibilitychange",this._thisVisibilitychange),this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},i.hitDetect=function(e){var r=this.map;if(!(!r||!r.options.hitDetect||r.isInteracting())){var s=r._getLayers(),a="default",h=r.options.hitDetectLimit||0,l=0;e&&e._round&&e._round();for(var c=s.length-1;c>=0;c--){var u=s[c];if(!(!u.options.hitDetect||u.isEmpty&&u.isEmpty())){var f=u._getRenderer();if(!(!f||!f.hitDetect)&&!(f.isBlank&&f.isBlank())){if(u.options.cursor!=="default"&&f.hitDetect(e)){a=u.options.cursor||"pointer";break}if(l++,h>0&&l>h)break}}}r._trySetCursor(a)}},i._getLayerImage=function(e){var r=e._getRenderer();return r.getCanvasImage?r.getCanvasImage():null},i.initContainer=function(){var e=this.map._panels;function r(y,b,M,C){var w=Et("div",b);return M&&(w.style.cssText=M),e[y]=w,C||_v(w),w}var s=this.map._containerDOM;if(!this._containerIsCanvas){s.innerHTML="";var a="position:absolute;top:0px;left:0px;",h=r("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),l=r("allLayers","maptalks-all-layers",a+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),c=r("backStatic","maptalks-back-static",a+"z-index:0;",!0),u=r("back","maptalks-back",a+"z-index:1;"),f=r("backLayer","maptalks-back-layer",a),d=r("canvasContainer","maptalks-canvas-layer",a+"border:none;z-index:2;"),p=r("frontStatic","maptalks-front-static",a+"z-index:3;",!0),g=r("front","maptalks-front",a+"z-index:4;",!0),m=r("frontLayer","maptalks-front-layer",a+"z-index:0;"),v=r("ui","maptalks-ui",a+"border:none;z-index:1;",!0),x=r("control","maptalks-control","z-index:1",!0);s.appendChild(h),l.appendChild(c),u.appendChild(f),u.layerDOM=f,l.appendChild(u),l.appendChild(d),g.appendChild(m),g.layerDOM=m,g.uiDOM=v,l.appendChild(p),l.appendChild(g),g.appendChild(v),h.appendChild(l),h.appendChild(x),this.createCanvas(),this.resetContainer();var _=this.map._getContainerDomSize();this.updateMapSize(_)}},i.isViewChanged=function(){if(this._isViewChanged!==void 0)return this._isViewChanged;var e=this._mapview,r=this._getMapView();return this._isViewChanged=!e||!vh(e,r),this._isViewChanged},i._recordView=function(){var e=this.map;!e._onViewChange||e.isInteracting()||e.isAnimating()||vh(e.getView(),e._getCurrentView())||e._onViewChange(e.getView())},i.isSpatialReferenceChanged=function(){return this._spatialRefChanged},i._getMapView=function(){var e=this.map,r=e._getPrjCenter();return{x:r.x,y:r.y,zoom:e.getZoom(),pitch:e.getPitch(),bearing:e.getBearing(),width:e.width,height:e.height}},i._frameLoop=function(e){var r=this;if(!this.map){this._cancelFrameLoop();return}e=e||0,this._frameTimestamp=e,this._resizeCount=0,this.renderFrame(e),this._animationFrame=Fi(function(s){r._frameLoop(s)})},i._cancelFrameLoop=function(){this._animationFrame&&To(this._animationFrame)},i._drawLayerCanvasImage=function(e,r,s,a){var h=this.context,l=r.point.round(),c=this.map.getDevicePixelRatio();c!==1&&l._multi(c);var u=r.image,f=u.width,d=u.height;if(!(l.x+f<=0||l.y+d<=0)){var p=e.options.opacity;if(St(p)||(p=1),!(p<=0)){var g=r.opacity;if(St(g)||(g=1),!(g<=0)){var m=h.globalAlpha;p<1&&(h.globalAlpha*=p),g<1&&(h.globalAlpha*=g),e.options.cssFilter&&(h.filter=e.options.cssFilter);var v=e.getRenderer(),x=v.__zoomTransformMatrix,_=v.clipCanvas(this.context);x&&(h.save(),h.setTransform.apply(h,x)),h.drawImage(u,0,0,f,d,l.x,l.y,s,a),x&&h.restore(),_&&h.restore(),h.filter!=="none"&&(h.filter="none"),h.globalAlpha=m}}}},i._drawCenterCross=function(){var e=this.map.options.centerCross;if(e){var r=this.context,s=new W(this.canvas.width/2,this.canvas.height/2);ne(e)?e(r,s):ot.drawCross(this.context,s.x,s.y,2,"#f00")}},i._drawContainerExtent=function(){var e=this.map.options.cascadePitches,r=this.map.height-this.map._getVisualHeight(e[0]),s=this.map.height-this.map._getVisualHeight(e[1]),a=this.map.getContainerExtent(),h=this.context;h.beginPath(),h.moveTo(0,a.ymin),h.lineTo(a.xmax,a.ymin),h.stroke(),h.beginPath(),h.moveTo(0,r),h.lineTo(a.xmax,r),h.stroke(),h.beginPath(),h.moveTo(0,s),h.lineTo(a.xmax,s),h.stroke()},i._drawFog=function(){var e=this.map;if(!(e.getPitch()<=e.options.maxVisualPitch||!e.options.fog)){var r=30,s=e.getDevicePixelRatio(),a=this.context,h=e.getContainerExtent(),l=(e.height-e._getVisualHeight(75))*s;l<0&&(l=0);var c=h.ymin*s,u=Math.ceil(c-l),f=e.options.fogColor.join(),d=a.createLinearGradient(0,l,0,c+r),p=1-r/(u+r);d.addColorStop(0,"rgba("+f+", 0)"),d.addColorStop(.3,"rgba("+f+", 0.3)"),d.addColorStop(p,"rgba("+f+", 1)"),d.addColorStop(1,"rgba("+f+", 0)"),a.beginPath(),a.fillStyle=d,a.fillRect(0,l,Math.ceil(h.getWidth())*s,Math.ceil(u+r))}},i._getAllLayerToRender=function(){return this.map._getLayers()},i.clearCanvas=function(){!this.canvas||ot.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var e=this.map,r=e.getSize(),s=this.canvas,a=e.getDevicePixelRatio(),h=Ju(r,a),l=h.width,c=h.height,u=h.cssWidth,f=h.cssHeight;return s.style&&(s.style.width!==u||s.style.height!==f)&&(s.style.width=u,s.style.height=f),l===s.width&&c===s.height?!1:(s.height=c,s.width=l,this.topLayer.width=s.width,this.topLayer.height=s.height,!0)},i.createCanvas=function(){this.topLayer=Et("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=Et("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},i._updateDomPosition=function(e){this._checkPositionTime===void 0&&(this._checkPositionTime=-1/0);var r=Math.abs(e-this._checkPositionTime);return r>=500&&(Zo(this.map._containerDOM),this._checkPositionTime=Math.min(e,this._checkPositionTime)),this},i._checkSize=function(){!this.map||this.map.checkSize()},i._setCheckSizeInterval=function(e){var r=this;jt.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver(function(s){!r.map||r.map.isRemoved()?r._resizeObserver.disconnect():s.length&&(r.map._containerDomContentRect=s[0].contentRect,r._checkSize(s[0].contentRect),r._resizeCount=r._resizeCount||0,r.renderFrame((r._frameTimestamp||0)+ ++r._resizeCount/100))}),this._resizeObserver.observe(this.map._containerDOM))):(clearInterval(this._resizeInterval),this._checkSizeInterval=e,this._resizeInterval=setInterval(function(){!r.map||r.map.isRemoved()?clearInterval(r._resizeInterval):r._checkSize()},this._checkSizeInterval))},i._registerEvents=function(){var e=this,r=this.map;r.options.checkSize&&!De&&typeof window<"u"&&this._setCheckSizeInterval(r.options.checkSizeInterval),jt.mobile||r.on("_mousemove",this._onMapMouseMove,this),r.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",function(s){e._eventParam=s}),r.on("_zooming",function(s){r.getPitch()||(e._zoomMatrix=s.matrix.container),e._eventParam=s}),r.on("_zoomend",function(s){e._eventParam=s,delete e._zoomMatrix}),r.on("_spatialreferencechange",function(){e._spatialRefChanged=!0}),jt.webgl&&typeof document<"u"&&on(document,"visibilitychange",this._thisVisibilitychange,this),jt.addDPRListening&&jt.addDPRListening(this.map)},i._onMapMouseMove=function(e){var r=this,s=this.map;s.isInteracting()||!s.options.hitDetect||(this._hitDetectFrame&&To(this._hitDetectFrame),this._hitDetectFrame=Fi(function(){r.hitDetect(e.containerPoint)}))},i._getCanvasLayers=function(){return this.map._getLayers(function(e){return e.isCanvasRender()})},i._onVisibilitychange=function(){document.visibilityState==="visible"&&this.setToRedraw()},i.addTopElement=function(e){this._tops||(this._tops=[]),this._tops.push(e)},i.removeTopElement=function(e){if(!!this._tops){var r=this._tops.indexOf(e);r>=0&&this._tops.splice(r,1)}},i.getTopElements=function(){return this._tops||[]},i.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var e=this.getTopElements(),r=!1,s=0;s<e.length;s++)e[s].render(this.topCtx)&&(r=!0);r&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},i._containerIsOffscreen=function(){var e=this.map.getContainer();if(!e||!e.style||e.style.display==="none")return!0;var r=Math.min(e.clientWidth,e.clientHeight);return r<=0},t}(F_);Bt.registerRenderer("canvas",N_);Bt.mergeOptions({fog:!1,fogColor:[233,233,233]});var LE=Object.freeze({ResourceCache:Sr,CanvasRenderer:Fs,ImageGLRenderable:Af,MapRenderer:F_,MapCanvasRenderer:N_,Renderable:df,ImageLayerCanvasRenderer:Rf,ImageLayerGLRenderer:A_,TileLayerCanvasRenderer:tl,TileLayerGLRenderer:Df,CanvasTileLayerCanvasRenderer:D_,CanvasTileLayerGLRenderer:I_,QuadStencil:TE,OverlayLayerCanvasRenderer:k_,VectorLayerCanvasRenderer:z_,CanvasLayerRenderer:Of}),el={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};Ce.include(el);ln.include(el);Ni.include(el);Bs.include(el);_r.include({_getRenderPoints:function(t){var i=this.getMap(),n=i.getGLRes();if(t==="vertex"){for(var e=this._trimRing(this.getShell()),r=[],s=0,a=e.length;s<a;s++)r.push(i.coordToPointAtRes(e[s],n));return[r,null]}else{var h=i.coordToPointAtRes(this.getCenter(),n);return[[h],null]}}});var B_={_getRenderPoints:function(t){var i=this.getMap(),n=i.getGLRes(),e,r=null;if(t==="point")e=this._getPath2DPoints(this._getPrjCoordinates(),!1,n),e&&e.length>0&&Array.isArray(e[0])&&(e=e[0].concat(e[1]));else if(t==="vertex")if(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,n),r=[],e&&e.length>0&&Array.isArray(e[0])){for(var s=0,a=e.length;s<a;s++)for(var h=0,l=e[s].length;h<l;h++)h===0?r.push([e[s][h],e[s][h+1]]):r.push([e[s][h-1],e[s][h]]);e=e[0].concat(e[1])}else for(var c=0,u=e.length;c<u;c++)c===0?r.push([e[c],e[c+1]]):r.push([e[c-1],e[c]]);else if(t==="line"){e=[],r=[];var f=this._getPath2DPoints(this._getPrjCoordinates(),!1,n),d=f.length>0&&Array.isArray(f[0]);if(d)for(var p,g=1,m=f.length;g<m;g++){p=f[g],this instanceof ie&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(p[0]);for(var v=1,x=p.length;v<x;v++)e.push(p[v].add(p[v-1])._multi(.5)),r.push([p[v-1],p[v]])}else{this instanceof ie&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(f[0]);for(var _=1,y=f.length;_<y;_++)e.push(f[_].add(f[_-1])._multi(.5)),r.push([f[_-1],f[_]])}}else if(t==="vertex-first"){var b=this._getPrjCoordinates(),M=b.length,C=M?i._prjToPointAtRes(b[0],n):null;e=M?[C]:[],r=M?[[C,b[1]?i._prjToPointAtRes(b[1],n):C]]:[]}else if(t==="vertex-last"){var w=this._getPrjCoordinates(),S=w.length,P=S?i._prjToPointAtRes(w[S-1],n):null;e=S?[P]:[];var O=S>1?S-2:S-1;r=S?[[w[O]?i._prjToPointAtRes(w[O],n):P,P]]:[]}else{var D=this.getCenter();if(!D)e=[];else{var L=this._getProjection().project(D);e=[i._prjToPointAtRes(L,n)]}}return[e,r]}};fe.include(B_);ie.include(B_);var is={within:!1,center:[0,0]};function G_(o){if(!o||!o._containerBbox)is.within=!1;else{is.within=!1;var t=o._containerBbox,i=t.minx,n=t.miny,e=t.maxx,r=t.maxy,s=Math.abs(e-i),a=Math.abs(r-n);s<=1&&a<=1&&(is.within=!0,is.center[0]=(i+e)/2,is.center[1]=(n+r)/2),delete o._containerBbox}return is}Jt.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}});var If={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof ln||this instanceof Bs},_paintAsPath:function(){var t=this.getMap(),i=this.getAltitude();return i>0||t.getPitch()||this instanceof ln&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return ie.prototype._getPaintParams.call(this,!0);var i=this._getPrjCoordinates(),n=t._prjToPointAtRes(i,t.getGLRes()),e=this._getRenderSize(n);return[n].concat(e)},_paintOn:function(){return this._paintAsPath()?ot.polygon.apply(ot,arguments):ot.ellipse.apply(ot,arguments)},_getRenderSize:function(t){var i=this.getMap(),n=i.getGLRes(),e=this._getPrjExtent(),r=i._prjToPointAtRes(e.getMin(),n),s=i._prjToPointAtRes(e.getMax(),n);return[Math.abs(s.x-r.x)/2,Math.abs(s.y-t.y),Math.abs(t.y-r.y)]}};ln.include(If);Ni.include(If);_r.include({_getPaintParams:function(){var t=this.getMap(),i=this._getPrjShell(),n=this._getPath2DPoints(i,!1,t.getGLRes());return[n]},_paintOn:ot.polygon});Bs.include(If,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return ie.prototype._getPaintParams.call(this,!0);var t=this.getMap(),i=t._prjToPointAtRes(this._getPrjCoordinates(),t.getGLRes()),n=this._getRenderSize(i);return[i,n[0],[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return ot.polygon.apply(ot,arguments);var t=this.getMap().getBearing(),i=arguments;return t&&(i[3]=i[3].slice(0),i[3][0]+=t,i[3][1]+=t),ot.sector.apply(ot,i)}});Jh.include({_paintAsPath:function(){return!0}});fe.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(t,i,n,e,r){if(!t||!i||t.equals(i))return null;r||(r=0);var s=n*e[0],a=n*e[1]+r,h=s/2+r,l;i.nextCtrlPoint||i.prevCtrlPoint?i.prevCtrlPoint?l=i.sub(new W(i.prevCtrlPoint)):l=i.sub(new W(i.nextCtrlPoint)):l=i.sub(t),l._unit();var c=i.sub(l.multi(a));l._perp();var u=c.add(l.multi(h));l._multi(-1);var f=c.add(l.multi(h));return[u,i,f,u]},_getPaintParams:function(){var t=this._getPrjCoordinates(),i=this._getPath2DPoints(t,!1,this.getMap().getGLRes());return[i]},_paintOn:function(t,i,n,e,r){var s=G_(this._painter);s.within?ot.pixelRect(t,s.center,n,e):this.options.smoothness?ot.paintSmoothLine(t,i,n,this.options.smoothness,!1,this._animIdx,this._animTailRatio):ot.path(t,i,n,null,r),this._paintArrow(t,i,n)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,i,n){var e=this._getArrowStyle();if(!e||t.length<2)return[];for(var r=t.length>0&&Array.isArray(t[0]),s=r?t:[t],a=this._getArrowPlacement(),h=[],l=this.getMap(),c=l.coordToContainerPoint(this.getFirstCoordinate()),u=l.coordToContainerPoint(this.getLastCoordinate()),f=s.length-1;f>=0;f--){if(a==="vertex-first"||a==="vertex-firstlast"&&s[f][0].closeTo(c,.01)){var d=this._getArrowShape(s[f][1],s[f][0],i,e,n);d&&h.push(d)}if(a==="vertex-last"||a==="vertex-firstlast"&&s[f][s[f].length-1].closeTo(u,.01)){var p=this._getArrowShape(s[f][s[f].length-2],s[f][s[f].length-1],i,e,n);p&&h.push(p)}else a==="point"&&this._getArrowPoints(h,s[f],i,e,n)}return h},_getArrowPoints:function(t,i,n,e,r){for(var s=0,a=i.length-1;s<a;s++){var h=this._getArrowShape(i[s],i[s+1],n,e,r);h&&t.push(h)}},_paintArrow:function(t,i,n){var e=this._getInternalSymbol().lineWidth;(!St(e)||e<3)&&(e=3);var r=this._getArrows(i,e);if(!!r.length){t.setLineDash&&t.setLineDash([]);for(var s=r.length-1;s>=0;s--)t.fillStyle=t.strokeStyle,ot.polygon(t,r[s],n,n)}}});ie.include({_getPaintParams:function(t){var i=this.getMap().getGLRes(),n=this._getPrjShell(),e=this._getPath2DPoints(n,t,i),r=e.length>0&&Array.isArray(e[0]);r&&(e=[[e[0]],[e[1]]]);var s=this._getPrjHoles(),a=[];if(s&&s.length>0){for(var h=this._simplified,l=0;l<s.length;l++){var c=this._getPath2DPoints(s[l],t,i);Array.isArray(c)&&r?Array.isArray(c[0])?(e[0].push(c[0]),e[1].push(c[1])):e[0].push(c):a.push(c)}h&&(this._simplified=h)}return r||(e=[e],Ar(e,a)),[e]},_paintOn:function(t,i,n,e,r){var s=G_(this._painter);s.within?ot.pixelRect(t,s.center,n,e):ot.polygon(t,i,n,e,r,this.options.smoothness)}});Bt.VERSION=NS;var wu={Actor:pf};const H_=parseInt(Go.replace("dev",""));function Nt(o,t,i){return H_>109?o.setAttribute(t,i):o.addAttribute(t,i),o}function RE(o,t){H_>113?o.params.Line.threshold=t:o.linePrecision=t}function Le(){return!0}class U_ extends ES{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";var t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],i=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),Nt(this,"position",new Fe(t,3)),Nt(this,"uv",new Fe(i,2))}applyMatrix(t){var i=this.attributes.instanceStart,n=this.attributes.instanceEnd;return i!==void 0&&(t.applyToBufferAttribute(i),t.applyToBufferAttribute(n),i.data.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){var i;t instanceof Float32Array?i=t:Array.isArray(t)&&(i=new Float32Array(t));var n=new hu(i,6,1);return Nt(this,"instanceStart",new In(n,3,0)),Nt(this,"instanceEnd",new In(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){var i;t instanceof Float32Array?i=t:Array.isArray(t)&&(i=new Float32Array(t));var n=new hu(i,6,1);return Nt(this,"instanceColorStart",new In(n,3,0)),Nt(this,"instanceColorEnd",new In(n,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new _S(t.geometry)),this}fromLineSegements(t){var i=t.geometry;return i.isGeometry?this.setPositions(i.vertices):i.isBufferGeometry&&this.setPositions(i.position.array),this}computeBoundingBox(){var t=new wr;this.boundingBox===null&&(this.boundingBox=new wr);var i=this.attributes.instanceStart,n=this.attributes.instanceEnd;i!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(i),t.setFromBufferAttribute(n),this.boundingBox.union(t))}computeBoundingSphere(){var t=new G;this.boundingSphere===null&&(this.boundingSphere=new Rs),this.boundingBox===null&&this.computeBoundingBox();var i=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(i!==void 0&&n!==void 0){var e=this.boundingSphere.center;this.boundingBox.getCenter(e);for(var r=0,s=0,a=i.count;s<a;s++)t.fromBufferAttribute(i,s),r=Math.max(r,e.distanceToSquared(t)),t.fromBufferAttribute(n,s),r=Math.max(r,e.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)}}toJSON(){}copy(t){return this}}const V_={},uh={};V_.line={linewidth:{value:1},resolution:{value:new bt(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};uh.line={uniforms:ku.merge([mt.common,mt.fog,V_.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		varying vec2 vUv;

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;

			#endif

			float aspect = resolution.x / resolution.y;

			vUv = uv;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec2 ndcStart = clipStart.xy / clipStart.w;
			vec2 ndcEnd = clipEnd.xy / clipEnd.w;

			// direction
			vec2 dir = ndcEnd - ndcStart;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			// perpendicular to dir
			vec2 offset = vec2( dir.y, - dir.x );

			// undo aspect ratio adjustment
			dir.x /= aspect;
			offset.x /= aspect;

			// sign flip
			if ( position.x < 0.0 ) offset *= - 1.0;

			// endcaps
			if ( position.y < 0.0 ) {

				offset += - dir;

			} else if ( position.y > 1.0 ) {

				offset += dir;

			}

			// adjust for linewidth
			offset *= linewidth;

			// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
			offset /= resolution.y;

			// select end
			vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

			// back to clip space
			offset *= clip.w;

			clip.xy += offset;

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;

		#ifdef USE_DASH

			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		varying vec2 vUv;

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			if ( abs( vUv.y ) > 1.0 ) {

				float a = vUv.x;
				float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
				float len2 = a * a + b * b;

				if ( len2 > 1.0 ) discard;

			}

			vec4 diffuseColor = vec4( diffuse, opacity );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );

			#include <premultiplied_alpha_fragment>
			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>

		}
		`};class il extends Nn{constructor(t){super({uniforms:ku.clone(uh.line.uniforms),vertexShader:uh.line.vertexShader,fragmentShader:uh.line.fragmentShader}),this.dashed=!0,this.isLineMaterial=!0,this.type="LineMaterial",Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(i){this.uniforms.diffuse.value=i}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(i){this.uniforms.linewidth.value=i}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(i){this.uniforms.dashScale.value=i}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(i){this.uniforms.dashSize.value=i}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(i){this.uniforms.gapSize.value=i}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(i){this.uniforms.resolution.value.copy(i)}}}),this.setValues(t)}}class OE extends ei{constructor(t,i){super(t,i),this.isLineSegments2=!0,this.type="LineSegments2",this.geometry=t!==void 0?t:new U_,this.material=i!==void 0?i:new il({color:Math.random()*16777215})}computeLineDistances(){var t=new G,i=new G,n=this.geometry,e=n.attributes.instanceStart,r=n.attributes.instanceEnd;if(!e||!r)return this;for(var s=new Float32Array(2*e.data.count),a=0,h=0,l=e.data.count;a<l;a++,h+=2)t.fromBufferAttribute(e,a),i.fromBufferAttribute(r,a),s[h]=h===0?0:s[h-1],s[h+1]=s[h]+t.distanceTo(i);var c=new hu(s,2,1);return Nt(n,"instanceDistanceStart",new In(c,1,0)),Nt(n,"instanceDistanceEnd",new In(c,1,1)),this}}class xs extends U_{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}fromLine(t){var i=t.geometry;return i.isGeometry?this.setPositions(i.vertices):i.isBufferGeometry&&this.setPositions(i.position.array),this}}class kf extends OE{constructor(t,i){super(t,i),this.isLine2=!0,this.type="Line2",this.geometry=t!==void 0?t:new xs,this.material=i!==void 0?i:new il({color:Math.random()*16777215})}copy(t){return this}}const DE={interactive:!0,altitude:0,minZoom:0,maxZoom:30,asynchronous:!1,bloom:!1};function IE(){}class de extends Ui(IE){constructor(t){super(),this.isAdd=!1,this._mouseover=!1,this._visible=!0,this._zoomVisible=!0,this.picked=!1,this.isBaseObject=!0,t===void 0&&(t=yt.GUID()),this.id=t}addTo(t){return t&&t.type==="ThreeLayer"&&t.addMesh([this]),this}remove(){const t=this.getLayer();return t&&t.removeMesh([this]),this}getObject3d(){return this.object3d}getId(){return this.id}setId(t){const i=this.getId();return this.id=t,this._fire("idchange",{old:i,new:t,target:this}),this}getType(){return this.type}getOptions(){return this.options}getProperties(){return(this.options||{}).properties}setProperties(t){const i=Object.assign({},this.getProperties());return this.options.properties=t,this._fire("propertieschange",{old:i,new:t,target:this}),this}getLayer(){return this.options.layer}getMap(){const t=this.getLayer();if(t)return t.getMap()}getCenter(){const t=this.getOptions(),{coordinate:i,lineString:n,polygon:e}=t;if(i)return i instanceof q?i:new q(i);{const r=e||n;if(r&&r.getCenter)return r.getCenter()}}getAltitude(){return this.getOptions().altitude}setAltitude(t){if(yt.isNumber(t)){const i=this.getLayer().altitudeToVector3(t,t).x;if(this.getObject3d().position.z=i,this.options.altitude=t,this.pickObject3d&&(this.pickObject3d.position.z=i),this._baseObjects&&Array.isArray(this._baseObjects))for(let n=0,e=this._baseObjects.length;n<e;n++)this._baseObjects[n]&&(this._baseObjects[n].getObject3d().position.z=i)}return this}supportHeight(){return this.getOptions().heightEnable}getHeight(){const{height:t}=this.getOptions();return yt.isNumber(t)?t:0}setHeight(t){if(!yt.isNumber(t)||this._baseObjects||!this.supportHeight())return this;const i=this.getLayer();if(!i)return this;const{geometry:n}=this.getObject3d();if(n instanceof ae){const{position:e}=n.attributes||{};if(!e)return this;const r=e.array;let s=1/0,a=-1/0;for(let c=0,u=r.length;c<u;c+=3){const f=r[c+2];s=Math.min(f,s),a=Math.max(f,a)}const h=(s+a)/2;let l=i.altitudeToVector3(t,t).x;l=Math.max(l,1e-6);for(let c=0,u=r.length;c<u;c+=3)r[c+2]>h&&(r[c+2]=l);n.attributes.position.needsUpdate=!0,n.computeBoundingBox(),n.computeBoundingSphere(),this.getOptions().height=t}return this}show(){return this._zoomVisible&&(this.getObject3d().visible=!0,this._fire("show")),this._visible=!0,this}hide(){return this.getObject3d().visible=!1,this._fire("hide"),this._visible=!1,this._hideUI(),this}isVisible(){return!!this.getObject3d().visible}getSymbol(){return this.getObject3d().material}setSymbol(t){if(t&&t instanceof Gi){t.needsUpdate=!0,t.vertexColors=this.getObject3d().material.vertexColors;const i=this.getObject3d().material.clone();this.getObject3d().material=t,this._fire("symbolchange",{old:i,new:t,target:this})}return this}setInfoWindow(t){return this.removeInfoWindow(),this.infoWindow=new Oh.InfoWindow(t),this.infoWindow.addTo(this),this}getInfoWindow(){return this.infoWindow}openInfoWindow(t){return t=t||this.getCenter(),t instanceof q||(t=new q(t)),t&&this.infoWindow&&this.infoWindow.show(t),this}closeInfoWindow(){return this.infoWindow&&this.infoWindow.hide(),this}removeInfoWindow(){return this.infoWindow&&(this.infoWindow.remove(),delete this.infoWindow),this}setToolTip(t,i){return this.removeToolTip(),this.toolTip=new Oh.ToolTip(t,i),this.toolTip.addTo(this),this}getToolTip(){return this.toolTip}openToolTip(t){return t=t||this.getCenter(),t instanceof q||(t=new q(t)),t&&this.toolTip&&this.toolTip.show(t),this}closeToolTip(){return this.toolTip&&this.toolTip.hide(),this}removeToolTip(){return this.toolTip&&(this.toolTip.remove(),delete this.toolTip),this}_hideUI(){return this.closeInfoWindow(),this.closeToolTip(),this}animateShow(t={},i){this._showPlayer&&this._showPlayer.cancel(),yt.isFunction(t)&&(t={},i=t);const n=t.duration||1e3,e=t.easing||"out",r=this._showPlayer=OT.Animation.animate({scale:1},{duration:n,easing:e},s=>{const a=s.styles.scale;a>0&&(this.getObject3d().scale.z=a),i&&i(s,a)});return r.play(),r}getMinZoom(){return this.getOptions().minZoom}getMaxZoom(){return this.getOptions().maxZoom}isAsynchronous(){return this.getOptions().asynchronous}get bloom(){return this.getOptions().bloom}fire(t,i){return this._fire(t,i),this._vt&&this._vt.onSelectMesh&&this._vt.onSelectMesh(t,i),this}config(){return this}setPickObject3d(t){return this.pickObject3d=t,this.pickObject3d.__parent=this,this}_initOptions(t){return this.options=yt.extend({},DE,t),this}_createMesh(t,i){return this.object3d=new ei(t,i),this.object3d.__parent=this,this}_createInstancedMesh(t,i,n){return this.object3d=new Nb(t,i,n),this.object3d.__parent=this,this}_createGroup(){return this.object3d=new ls,this.object3d.__parent=this,this}_createLine(t,i){return this.object3d=new Pm(t,i),this._computeLineDistances(t),this.object3d.__parent=this,this}_createLine2(t,i){return this.object3d=new kf(t,i),this.object3d.computeLineDistances(),this.object3d.__parent=this,this}_createPoints(t,i){return this.object3d=new Bb(t,i),this.object3d.__parent=this,this}_createLineSegments(t,i){return this.object3d=new Gu(t,i),this._computeLineDistances(t),this.object3d.__parent=this,this}_computeLineDistances(t){const i=t.attributes.position.array,n=t.attributes.position.count,e=new Float32Array(n);e[0]=0;const r=new G(0,0,0),s=new G(0,0,0);for(let a=1;a<n;a++){const h=(a-1)*3;r.x=i[h],r.y=i[h+1],r.z=i[h+2];const l=a*3;s.x=i[l],s.y=i[l+1],s.z=i[l+2];const c=s.distanceTo(r);e[a]=e[a-1]+c}Nt(t,"lineDistance",new It(e,1))}}const Vn=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];function Lr(o){return o.geometry?o.geometry.type:null}function nl(o){const t=Lr(o);if(t){for(let i=0,n=Vn.length;i<n;i++)if(Vn[i]===t)return!0}return!1}function Wn(o){const t=Lr(o);return!!(t&&(t===Vn[4]||t===Vn[5]))}function un(o){const t=Lr(o);return!!(t&&(t===Vn[2]||t===Vn[3]))}function kE(o){const t=Lr(o);return!!(t&&(t===Vn[0]||t===Vn[1]))}function zf(o){const t=Lr(o);return!!(t&&t.indexOf("Multi")>-1)}function qo(o){return o.geometry?o.geometry.coordinates:[]}function jn(o,t){const i=Lr(o);if(!i||!o.geometry)return null;const e=o.geometry.coordinates;if(!e)return null;let r=0,s=0,a=0;switch(i){case"Point":{r=e[0],s=e[1],a++;break}case"MultiPoint":case"LineString":{for(let c=0,u=e.length;c<u;c++)r+=e[c][0],s+=e[c][1],a++;break}case"MultiLineString":case"Polygon":{for(let c=0,u=e.length;c<u;c++)for(let f=0,d=e[c].length;f<d;f++)r+=e[c][f][0],s+=e[c][f][1],a++;break}case"MultiPolygon":{for(let c=0,u=e.length;c<u;c++)for(let f=0,d=e[c].length;f<d;f++)for(let p=0,g=e[c][f].length;p<g;p++)r+=e[c][f][p][0],s+=e[c][f][p][1],a++;break}}const h=r/a,l=s/a;return t?(t.x=h,t.y=l,t):new q(h,l)}function Ro(o){const t=Lr(o);if(!t||!o.geometry)return null;const i=o.geometry,n=o.properties||{},e=i.coordinates;if(!e)return null;const r=[];let s;switch(t){case"MultiPoint":{s="Point";break}case"MultiLineString":{s="LineString";break}case"MultiPolygon":{s="Polygon";break}}if(s)for(let a=0,h=e.length;a<h;a++)r.push({type:"Feature",geometry:{type:s,coordinates:e[a]},properties:n});else r.push(o);return r}/*!
 * poly-extrude v0.2.0
  */var Ff={exports:{}};Ff.exports=rl;Ff.exports.default=rl;function rl(o,t,i){i=i||2;var n=t&&t.length,e=n?t[0]*i:o.length,r=W_(o,0,e,i,!0),s=[];if(!r||r.next===r.prev)return s;var a,h,l,c,u,f,d;if(n&&(r=GE(o,t,r,i)),o.length>80*i){a=l=o[0],h=c=o[1];for(var p=i;p<e;p+=i)u=o[p],f=o[p+1],u<a&&(a=u),f<h&&(h=f),u>l&&(l=u),f>c&&(c=f);d=Math.max(l-a,c-h),d=d!==0?32767/d:0}return Oo(r,s,i,a,h,d,0),s}function W_(o,t,i,n,e){var r,s;if(e===Su(o,t,i,n)>0)for(r=t;r<i;r+=n)s=zg(r,o[r],o[r+1],s);else for(r=i-n;r>=t;r-=n)s=zg(r,o[r],o[r+1],s);return s&&sl(s,s.next)&&(Io(s),s=s.next),s}function Cr(o,t){if(!o)return o;t||(t=o);var i=o,n;do if(n=!1,!i.steiner&&(sl(i,i.next)||ye(i.prev,i,i.next)===0)){if(Io(i),i=t=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==t);return t}function Oo(o,t,i,n,e,r,s){if(!!o){!s&&r&&jE(o,n,e,r);for(var a=o,h,l;o.prev!==o.next;){if(h=o.prev,l=o.next,r?FE(o,n,e,r):zE(o)){t.push(h.i/i|0),t.push(o.i/i|0),t.push(l.i/i|0),Io(o),o=l.next,a=l.next;continue}if(o=l,o===a){s?s===1?(o=NE(Cr(o),t,i),Oo(o,t,i,n,e,r,2)):s===2&&BE(o,t,i,n,e,r):Oo(Cr(o),t,i,n,e,r,1);break}}}}function zE(o){var t=o.prev,i=o,n=o.next;if(ye(t,i,n)>=0)return!1;for(var e=t.x,r=i.x,s=n.x,a=t.y,h=i.y,l=n.y,c=e<r?e<s?e:s:r<s?r:s,u=a<h?a<l?a:l:h<l?h:l,f=e>r?e>s?e:s:r>s?r:s,d=a>h?a>l?a:l:h>l?h:l,p=n.next;p!==t;){if(p.x>=c&&p.x<=f&&p.y>=u&&p.y<=d&&fs(e,a,r,h,s,l,p.x,p.y)&&ye(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function FE(o,t,i,n){var e=o.prev,r=o,s=o.next;if(ye(e,r,s)>=0)return!1;for(var a=e.x,h=r.x,l=s.x,c=e.y,u=r.y,f=s.y,d=a<h?a<l?a:l:h<l?h:l,p=c<u?c<f?c:f:u<f?u:f,g=a>h?a>l?a:l:h>l?h:l,m=c>u?c>f?c:f:u>f?u:f,v=Mu(d,p,t,i,n),x=Mu(g,m,t,i,n),_=o.prevZ,y=o.nextZ;_&&_.z>=v&&y&&y.z<=x;){if(_.x>=d&&_.x<=g&&_.y>=p&&_.y<=m&&_!==e&&_!==s&&fs(a,c,h,u,l,f,_.x,_.y)&&ye(_.prev,_,_.next)>=0||(_=_.prevZ,y.x>=d&&y.x<=g&&y.y>=p&&y.y<=m&&y!==e&&y!==s&&fs(a,c,h,u,l,f,y.x,y.y)&&ye(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;_&&_.z>=v;){if(_.x>=d&&_.x<=g&&_.y>=p&&_.y<=m&&_!==e&&_!==s&&fs(a,c,h,u,l,f,_.x,_.y)&&ye(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;y&&y.z<=x;){if(y.x>=d&&y.x<=g&&y.y>=p&&y.y<=m&&y!==e&&y!==s&&fs(a,c,h,u,l,f,y.x,y.y)&&ye(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function NE(o,t,i){var n=o;do{var e=n.prev,r=n.next.next;!sl(e,r)&&j_(e,n,n.next,r)&&Do(e,r)&&Do(r,e)&&(t.push(e.i/i|0),t.push(n.i/i|0),t.push(r.i/i|0),Io(n),Io(n.next),n=o=r),n=n.next}while(n!==o);return Cr(n)}function BE(o,t,i,n,e,r){var s=o;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&$E(s,a)){var h=Z_(s,a);s=Cr(s,s.next),h=Cr(h,h.next),Oo(s,t,i,n,e,r,0),Oo(h,t,i,n,e,r,0);return}a=a.next}s=s.next}while(s!==o)}function GE(o,t,i,n){var e=[],r,s,a,h,l;for(r=0,s=t.length;r<s;r++)a=t[r]*n,h=r<s-1?t[r+1]*n:o.length,l=W_(o,a,h,n,!1),l===l.next&&(l.steiner=!0),e.push(XE(l));for(e.sort(HE),r=0;r<e.length;r++)i=UE(e[r],i);return i}function HE(o,t){return o.x-t.x}function UE(o,t){var i=VE(o,t);if(!i)return t;var n=Z_(i,o);return Cr(n,n.next),Cr(i,i.next)}function VE(o,t){var i=t,n=o.x,e=o.y,r=-1/0,s;do{if(e<=i.y&&e>=i.next.y&&i.next.y!==i.y){var a=i.x+(e-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>r&&(r=a,s=i.x<i.next.x?i:i.next,a===n))return s}i=i.next}while(i!==t);if(!s)return null;var h=s,l=s.x,c=s.y,u=1/0,f;i=s;do n>=i.x&&i.x>=l&&n!==i.x&&fs(e<c?n:r,e,l,c,e<c?r:n,e,i.x,i.y)&&(f=Math.abs(e-i.y)/(n-i.x),Do(i,o)&&(f<u||f===u&&(i.x>s.x||i.x===s.x&&WE(s,i)))&&(s=i,u=f)),i=i.next;while(i!==h);return s}function WE(o,t){return ye(o.prev,o,t.prev)<0&&ye(t.next,o,o.next)<0}function jE(o,t,i,n){var e=o;do e.z===0&&(e.z=Mu(e.x,e.y,t,i,n)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==o);e.prevZ.nextZ=null,e.prevZ=null,ZE(e)}function ZE(o){var t,i,n,e,r,s,a,h,l=1;do{for(i=o,o=null,r=null,s=0;i;){for(s++,n=i,a=0,t=0;t<l&&(a++,n=n.nextZ,!!n);t++);for(h=l;a>0||h>0&&n;)a!==0&&(h===0||!n||i.z<=n.z)?(e=i,i=i.nextZ,a--):(e=n,n=n.nextZ,h--),r?r.nextZ=e:o=e,e.prevZ=r,r=e;i=n}r.nextZ=null,l*=2}while(s>1);return o}function Mu(o,t,i,n,e){return o=(o-i)*e|0,t=(t-n)*e|0,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,o|t<<1}function XE(o){var t=o,i=o;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==o);return i}function fs(o,t,i,n,e,r,s,a){return(e-s)*(t-a)>=(o-s)*(r-a)&&(o-s)*(n-a)>=(i-s)*(t-a)&&(i-s)*(r-a)>=(e-s)*(n-a)}function $E(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!qE(o,t)&&(Do(o,t)&&Do(t,o)&&JE(o,t)&&(ye(o.prev,o,t.prev)||ye(o,t.prev,t))||sl(o,t)&&ye(o.prev,o,o.next)>0&&ye(t.prev,t,t.next)>0)}function ye(o,t,i){return(t.y-o.y)*(i.x-t.x)-(t.x-o.x)*(i.y-t.y)}function sl(o,t){return o.x===t.x&&o.y===t.y}function j_(o,t,i,n){var e=Xa(ye(o,t,i)),r=Xa(ye(o,t,n)),s=Xa(ye(i,n,o)),a=Xa(ye(i,n,t));return!!(e!==r&&s!==a||e===0&&Za(o,i,t)||r===0&&Za(o,n,t)||s===0&&Za(i,o,n)||a===0&&Za(i,t,n))}function Za(o,t,i){return t.x<=Math.max(o.x,i.x)&&t.x>=Math.min(o.x,i.x)&&t.y<=Math.max(o.y,i.y)&&t.y>=Math.min(o.y,i.y)}function Xa(o){return o>0?1:o<0?-1:0}function qE(o,t){var i=o;do{if(i.i!==o.i&&i.next.i!==o.i&&i.i!==t.i&&i.next.i!==t.i&&j_(i,i.next,o,t))return!0;i=i.next}while(i!==o);return!1}function Do(o,t){return ye(o.prev,o,o.next)<0?ye(o,t,o.next)>=0&&ye(o,o.prev,t)>=0:ye(o,t,o.prev)<0||ye(o,o.next,t)<0}function JE(o,t){var i=o,n=!1,e=(o.x+t.x)/2,r=(o.y+t.y)/2;do i.y>r!=i.next.y>r&&i.next.y!==i.y&&e<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==o);return n}function Z_(o,t){var i=new bu(o.i,o.x,o.y),n=new bu(t.i,t.x,t.y),e=o.next,r=t.prev;return o.next=t,t.prev=o,i.next=e,e.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function zg(o,t,i,n){var e=new bu(o,t,i);return n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function Io(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function bu(o,t,i){this.i=o,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}rl.deviation=function(o,t,i,n){var e=t&&t.length,r=e?t[0]*i:o.length,s=Math.abs(Su(o,0,r,i));if(e)for(var a=0,h=t.length;a<h;a++){var l=t[a]*i,c=a<h-1?t[a+1]*i:o.length;s-=Math.abs(Su(o,l,c,i))}var u=0;for(a=0;a<n.length;a+=3){var f=n[a]*i,d=n[a+1]*i,p=n[a+2]*i;u+=Math.abs((o[f]-o[p])*(o[d+1]-o[f+1])-(o[f]-o[d])*(o[p+1]-o[f+1]))}return s===0&&u===0?0:Math.abs((u-s)/s)};function Su(o,t,i,n){for(var e=0,r=t,s=i-n;r<i;r+=n)e+=(o[s]-o[r])*(o[r+1]+o[s+1]),s=r;return e}rl.flatten=function(o){for(var t=o[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,e=0;e<o.length;e++){for(var r=0;r<o[e].length;r++)for(var s=0;s<t;s++)i.vertices.push(o[e][r][s]);e>0&&(n+=o[e-1].length,i.holes.push(n))}return i};var YE=Ff.exports;function Fg(o){for(var t=0,i=1,n,e,r=o.length;i<r;)n=e||o[0],e=o[i],t+=(e[0]-n[0])*(e[1]+n[1]),i++;return t>0}function Ng(o,t,i){return o[0]=t[0]-i[0],o[1]=t[1]-i[1],o[2]=t[2]-i[2],o}function QE(o,t){var i=t[0],n=t[1],e=t[2],r=Math.sqrt(i*i+n*n+e*e)||1;return o[0]=i/r,o[1]=n/r,o[2]=e/r,o}function KE(o,t,i){var n=t[0],e=t[1],r=t[2],s=i[0],a=i[1],h=i[2];return o[0]=e*h-r*a,o[1]=r*s-n*h,o[2]=n*a-e*s,o}function Nf(o,t){function i(b,M,C,w){b[0]=M,b[1]=C,b[2]=w}for(var n=[],e=[],r=[],s=[],a=[],h=[],l=o.length,c=new Float32Array(t.length),u=0;u<l;){var f=o[u],d=o[u+1],p=o[u+2],g=f*3,m=d*3,v=p*3;i(n,t[g],t[g+1],t[g+2]),i(e,t[m],t[m+1],t[m+2]),i(r,t[v],t[v+1],t[v+2]),Ng(a,r,e),Ng(s,n,e),KE(h,a,s);for(var x=0;x<3;x++)c[g+x]+=h[x],c[m+x]+=h[x],c[v+x]+=h[x];u+=3}for(var _=0,y=c.length;_<y;)i(h,c[_],c[_+1],c[_+2]),QE(h,h),c[_]=h[0]||0,c[_+1]=h[1]||0,c[_+2]=h[2]||0,_+=3;return c}function X_(o){if(o.length===1){var t={position:o[0].position,normal:o[0].normal,uv:o[0].uv,indices:o[0].indices,results:o};return t}for(var i=0,n=0,e=0,r=o.length;e<r;e++){var s=o[e],a=s.position,h=s.indices;i+=a.length,n+=h.length}for(var l={position:new Float32Array(i),normal:new Float32Array(i),uv:new Float32Array(i/3*2),indices:new Uint32Array(n),results:o},c=0,u=0,f=0,d=0,p=0,g=o.length;p<g;p++){var m=o[p],v=m.position,x=m.indices,_=m.normal,y=m.uv;l.position.set(v,c),l.normal.set(_,c),l.uv.set(y,d);for(var b=0,M=x.length;b<M;){var C=x[b]+u;l.indices[f]=C,f++,b++}d+=y.length,c+=v.length,u+=v.length/3}return l}function t2(o){return o*180/Math.PI}function Bg(o){return o/180*Math.PI}function $_(o,t,i,n,e,r){var s=i*3,a=n*3,h=e*3,l=r*3,c=t[s],u=t[s+1],f=t[s+2],d=t[a],p=t[a+1],g=t[a+2],m=t[h],v=t[h+1],x=t[h+2],_=t[l],y=t[l+1],b=t[l+2];Math.abs(u-p)<Math.abs(c-d)?(o.push(c,1-f),o.push(d,1-g),o.push(m,1-x),o.push(_,1-b)):(o.push(u,1-f),o.push(p,1-g),o.push(v,1-x),o.push(y,1-b))}function e2(o,t){t=Object.assign({},{depth:2},t);var i=o.map(function(e){for(var r=0,s=e.length;r<s;r++){var a=e[r];o2(a),r===0?Fg(a)||(e[r]=a.reverse()):Fg(a)&&(e[r]=a.reverse()),q_(a)&&a.splice(a.length-1,1)}var h=s2(e,t);h.polygon=e;var l=YE(h.flatVertices,h.holes,2);return i2(h,l),n2(h,t),h.position=new Float32Array(h.points),h.indices=new Uint32Array(h.index),h.uv=new Float32Array(h.uvs),h.normal=Nf(h.indices,h.position),h}),n=X_(i);return n.polygons=o,n}function i2(o,t){for(var i=[],n=o.count,e=0,r=t.length;e<r;e+=3){var s=t[e],a=t[e+1],h=t[e+2];i[e]=s,i[e+1]=a,i[e+2]=h;var l=r+e,c=n+s,u=n+a,f=n+h;i[l]=c,i[l+1]=u,i[l+2]=f}o.index=i}function n2(o,t){for(var i=o.points,n=o.index,e=o.polygon,r=o.uvs,s=t.depth,a=0,h=e.length;a<h;a++)for(var l=e[a],c=0,u=l.length;c<u;){var f=l[c],d=l[c+1];c===u-1&&(d=l[0]);var p=i.length/3,g=f[0],m=f[1],v=d[0],x=d[1];i.push(g,m,s,v,x,s,g,m,0,v,x,0);var _=p+2,y=p+3,b=p,M=p+1;n.push(_,b,y,b,M,y),$_(r,i,_,y,b,M),c++}}function r2(o){for(var t=0,i=0,n=o.length;i<n;)t+=o[i].length,i++;return t}function s2(o,t){for(var i=r2(o),n=o.length,e=[],r=new Float32Array(i*2),s=[],a=[],h=i*3,l=i*2,c=t.depth,u=0,f=0,d=0,p=0;p<n;p++){var g=o[p];p>0&&e.push(u/2);for(var m=0,v=g.length;m<v;){var x=g[m],_=x[0],y=x[1];r[u++]=_,r[u++]=y,s[f]=_,s[f+1]=y,s[f+2]=c,s[h+f]=_,s[h+f+1]=y,s[h+f+2]=0,a[d]=_,a[d+1]=y,a[l+d]=_,a[l+d+1]=y,f+=3,d+=2,m++}}return{flatVertices:r,holes:e,points:s,count:i,uvs:a}}function o2(o){q_(o)||o.push(o[0])}function q_(o){var t=o.length,i=o[0],n=i[0],e=i[1],r=o[t-1],s=r[0],a=r[1];return n===s&&e===a}function a2(o,t){t=Object.assign({},{depth:2,lineWidth:1},t);var i=o.map(function(e){var r=c2(e,t);return r.line=e,h2(r,t),l2(r,t),r.position=new Float32Array(r.points),r.indices=new Uint32Array(r.index),r.uv=new Float32Array(r.uvs),r.normal=Nf(r.indices,r.position),r}),n=X_(i);return n.lines=o,n}function h2(o,t){for(var i=t.depth,n=[],e=[],r=[],s=o.leftPoints,a=o.rightPoints,h=0,l=s.length;h<l;){var c=h*3,u=s[h],f=u[0],d=u[1],p=u[2];n[c]=f,n[c+1]=d,n[c+2]=i+p;var g=a[h],m=g[0],v=g[1],x=g[2],_=l*3+c;n[_]=m,n[_+1]=v,n[_+2]=i+x;var y=l*2*3+c;n[y]=f,n[y+1]=d,n[y+2]=p;var b=l*2*3+l*3+c;n[b]=m,n[b+1]=v,n[b+2]=x,h++}for(h=0,l=n.length;h<l;){var M=n[h],C=n[h+1];r.push(M,C),h+=3}for(h=0,l=s.length;h<l-1;){var w=h,S=h+1,P=w+l,O=S+l;e.push(w,P,S),e.push(P,O,S);var D=l*2,L=h+D,T=L+1,A=L+l,N=T+l;e.push(L,A,T),e.push(A,N,T),h++}o.index=e,o.points=n,o.uvs=r}function l2(o,t){var i=o.points,n=o.index,e=o.leftPoints,r=o.rightPoints,s=o.uvs,a=t.depth,h=[e,r];function l(M,C){var w=i.length/3;i.push(M[0],M[1],a+M[2],C[0],C[1],a+C[2],M[0],M[1],M[2],C[0],C[1],C[2]);var S=w+2,P=w+3,O=w,D=w+1;n.push(S,O,P,O,D,P),$_(s,i,S,P,O,D)}for(var c=0,u=h.length;c<u;c++){var f=h[c];c>0&&(f=f.map(function(M){return M}),f=f.reverse());for(var d=0,p=f.length-1;d<p;){var g=f[d],m=f[d+1];l(g,m),d++}}for(var v=e.length,x=[r[0],e[0],e[v-1],r[v-1]],_=0;_<x.length;_+=2){var y=x[_],b=x[_+1];l(y,b)}}var Nc={x:0,y:0},Bc={x:0,y:0};function c2(o,t){for(var i=0,n=t.lineWidth/2,e=[],r=[],s=[],a=o.length,h=0;h<a-1;){var l=o[h],c=o[h+1],u=c[1]-l[1],f=c[0]-l[0],d=0,p=Math.atan(u/f),g=t2(p);if(i=g,h===0)d=g,d-=90;else{var m=o[h-1];Nc.x=m[0]-l[0],Nc.y=m[1]-l[1],Bc.x=c[0]-l[0],Bc.y=c[1]-l[1];var v=u2(Nc,Bc);d=g-v/2}var x=Bg(d),_=Gg(x,n,l),y=_[0],b=_[1];e.push(y,b),Hg(y,l,c)?(r.push(y),s.push(b)):(r.push(b),s.push(y)),h++}var M=i;M-=90;var C=Bg(M),w=o[a-2],S=o[a-1],P=Gg(C,n,S),O=P[0],D=P[1];return e.push(O,D),Hg(O,w,S)?(r.push(O),s.push(D)):(r.push(D),s.push(O)),{offsetPoints:e,leftPoints:r,rightPoints:s}}function Gg(o,t,i){var n=i[0],e=i[1],r=i[2]||0,s=Math.cos(o)*t,a=Math.sin(o)*t,h=[n+s,e+a,r],l=o+=Math.PI,c=Math.cos(l)*t,u=Math.sin(l)*t,f=[n+c,e+u,r];return[h,f]}var u2=function(t,i){var n=t.x,e=t.y,r=i.x,s=i.y,a=n*r+e*s,h=n*s-e*r,l=Math.atan2(h,a)/Math.PI*180;return(l+360)%360};function Hg(o,t,i){var n=t[0],e=t[1],r=i[0],s=i[1],a=o[0],h=o[1];return(e-s)*a+(r-n)*h+n*s-r*e>0}function f2(o,t){t===void 0&&(t={}),t=Object.assign({},{radius:1,height:2,radialSegments:6},t);for(var i=Math.round(Math.max(4,t.radialSegments)),n=t,e=n.radius,r=n.height,s=360/i/360*Math.PI*2,a=i+1,h=new Float32Array(a*3*2),l=o[0],c=o[1],u=0,f=0,d=a*3,p=a*2,g=[],m=[],v=-1;v<i;v++){var x=s*v,_=Math.cos(x)*e+l,y=Math.sin(x)*e+c;h[u]=_,h[u+1]=y,h[u+2]=0,h[u+d]=_,h[u+1+d]=y,h[u+2+d]=r;var b=0,M=0;b=.5+_/e/2,M=.5+y/e/2,m[f]=b,m[f+1]=M,m[f+p]=b,m[f+1+p]=M,u+=3,f+=2,v>1&&g.push(0,v-1,v)}u-=3,h[u]=h[0],h[u+1]=h[1],h[u+2]=h[2];var C=h.length;h[C-3]=h[0],h[C-2]=h[1],h[C-1]=r;for(var w=g.length,S=0;S<w;S++){var P=g[S];g.push(P+a)}var O=new Float32Array((a*3*2-6)*2),D=-1;u=a*2,f=0;for(var L=0,T=h.length/2;L<T-3;L+=3){var A=h[L],N=h[L+1],B=h[L+3],F=h[L+4];O[++D]=A,O[++D]=N,O[++D]=r,O[++D]=B,O[++D]=F,O[++D]=r,O[++D]=A,O[++D]=N,O[++D]=0,O[++D]=B,O[++D]=F,O[++D]=0;var I=u+2,z=u+3,Z=u,j=u+1;g.push(Z,I,j,I,z,j),u+=4;var K=f/a,et=(f+1)/a;m.push(K,r/e/2,et,r/e/2,K,0,et,0),f++}var st=new Float32Array(h.length+O.length);st.set(h,0),st.set(O,h.length);var V=Nf(g,st);return{points:h,indices:new Uint32Array(g),position:st,normal:V,uv:new Float32Array(m)}}function Dh(o,t,i={}){return i[o]===void 0&&(i[o]=t.distanceToVector3(o,o).x),i[o]}function kn(o,t,i={}){return i[o]===void 0&&(i[o]=t.altitudeToVector3(o,o).x),i[o]}function Jo(o=[]){let t=0,i=0;const n=o.length;for(let e=0;e<n;e++){const{coordinate:r,lnglat:s,lnglats:a,xy:h,xys:l}=o[e],c=r||s||a||h||l||o[e];let u,f;Array.isArray(c)?(u=c[0],f=c[1]):c instanceof q&&(u=c.x,f=c.y),t+=u,i+=f}return new q(t/n,i/n)}function qn(o,t,i,n){if(t===void 0||typeof t!="number"||t===0)return 0;let e;o instanceof ae?e=o.attributes.position.array:Array.isArray(o)||o instanceof Float32Array?e=o:e=o.position;let r=0;if(e){n?(n[t]===void 0&&(n[t]=i.altitudeToVector3(t,t).x),r=n[t]):r=i.altitudeToVector3(t,t).x;const s=e.length;if(e[0]instanceof G)for(let a=0;a<s;a++)e[a].z+=r;else for(let a=0;a<s;a+=3)e[a+2]+=r}return r}function Bf(o){const t=o.length;let i=0;for(let n=0;n<t;n++){const{count:e}=o[n].position;i+=e}return new Float32Array(i*3)}function Ih(o=[]){const t=o.length,i=new Float64Array(t*2);for(let n=0;n<t;n++){let e,r;const s=o[n];s.x?(e=s.x,r=s.y):(e=s[0],r=s[1]),i[n*2]=e,i[n*2+1]=r}return i.buffer}const nr=new qt("#fff"),rr=new qt("#fff");function d2(o,t,i,n){const{position:e,normal:r,uv:s,indices:a}=J_(o,t,i,n),h=new Float32Array(e.length);h.fill(1,0,e.length);const l=new ae;return Nt(l,"color",new It(h,3)),Nt(l,"normal",new It(r,3)),Nt(l,"position",new It(e,3)),Nt(l,"uv",new It(s,2)),l.setIndex(new It(a,1)),l}function J_(o,t,i,n,e,r){const a=Y_(o,i,n,e,!1);if(!a)return null;r?(r[t]==null&&(r[t]=i.altitudeToVector3(t,t).x),t=r[t]):t=i.altitudeToVector3(t,t).x;const{position:h,normal:l,uv:c,indices:u}=e2(a,{depth:t});return{position:h,normal:l,uv:c,indices:u}}function Zn(o,t,i,n){n===void 0&&(n=0);const e=o.attributes.position.array,r=e.length;rr.setStyle(t),nr.setStyle(i);let s;if(Array.isArray(n)){let a=0;for(let h=0,l=n.length;h<l;h++){const{count:c}=n[h].position;a+=c*3}s=new Float32Array(a)}else s=new Float32Array(e.length);if(Array.isArray(n))for(let a=0,h=n.length;a<h;a++){const{middleZ:l,start:c,end:u}=n[a].position;for(let f=c;f<u;f+=3)e[f+2]>l?(s[f]=nr.r,s[f+1]=nr.g,s[f+2]=nr.b):(s[f]=rr.r,s[f+1]=rr.g,s[f+2]=rr.b)}else for(let a=0;a<r;a+=3)e[a+2]>n?(s[a]=nr.r,s[a+1]=nr.g,s[a+2]=nr.b):(s[a]=rr.r,s[a+1]=rr.g,s[a+2]=rr.b);return Nt(o,"color",new It(s,3,!0)),s}function Y_(o,t,i,n,e=!1){if(!o)return null;let r=[];if(o instanceof Es)r=o.getGeometries().map(s=>$a(s,t,i||o.getCenter(),n,e));else if(o instanceof ie){const s=$a(o,t,i||o.getCenter(),n,e);r.push(s)}else if(Wn(o))if(zf(o)){const s=Ro(o);for(let a=0,h=s.length;a<h;a++)r.push($a(s[a],t,i||jn(o),n,e))}else{const s=$a(o,t,i||jn(o),n,e);r.push(s)}return r}function $a(o,t,i,n,e=!1){let r,s;if(Wn(o)){const l=qo(o);r=l[0],s=l.slice(1,l.length),i=i||jn(o)}else o instanceof ie&&(r=o.getShell(),s=o.getHoles(),i=i||o.getCenter());n=n||t.coordinateToVector3(i);let a;e?a=t.coordinatiesToGLFloatArray(r,n).positons2d:a=t.coordinatiesToGLArray(r,n);const h=[e?a.buffer:a];if(s&&s.length>0)for(let l=0,c=s.length;l<c;l++){let u;e?u=t.coordinatiesToGLFloatArray(s[l],n).positons2d:u=t.coordinatiesToGLArray(s[l],n),h.push(e?u.buffer:u)}return h}function p2(o){if(!o)return null;let t=[];if(o instanceof Es)t=o.getGeometries().map(i=>qa(i,!1));else if(o instanceof ie){const i=qa(o,!1);t.push(i)}else if(Wn(o))if(zf(o)){const i=Ro(o);for(let n=0,e=i.length;n<e;n++)t.push(qa(i[n],!0))}else{const i=qa(o,!0);t.push(i)}return t}function qa(o,t){let i,n;if(t){const s=qo(o);i=s[0],n=s.slice(1,s.length)}else o instanceof ie&&(i=o.getShell(),n=o.getHoles());const r=[Ih(i)];if(n&&n.length>0)for(let s=0,a=n.length;s<a;s++){const h=Ih(n[s]);r.push(h)}return r}const Q_=",";function Rr(o,t,i,n=!0){let e=[],r,s;if(Array.isArray(o)&&o[0]instanceof G)e=o;else{Array.isArray(o)&&(o=new fe(o));const a=0;let h,l;nl(o)?(h=qo(o),i||(l=jn(o))):o instanceof fe&&(h=o.getCoordinates(),i||(l=o.getCenter()));const c=t.coordinateToVector3(i||l);if(n)for(let u=0,f=h.length;u<f;u++){const d=h[u],p=t.coordinateToVector3(d,a).sub(c);e.push(p)}else{const u=t.coordinatiesToGLFloatArray(h,c);r=u.positions,s=u.positons2d}}if(!n)return{positions:r,positionsV:e,positions2d:s,arrayBuffer:s.buffer};s=new Float32Array(e.length*2),r=new Float32Array(e.length*3);for(let a=0,h=e.length;a<h;a++){const l=a*3,c=e[a];r[l]=c.x,r[l+1]=c.y,r[l+2]=c.z;const u=a*2;s[u]=c.x,s[u+1]=c.y}return{positions:r,positionsV:e,positions2d:s,arrayBuffer:s.buffer}}function Ug(o,t,i,n){const e=[],r=[],s=[];let a,h;for(let l=0,c=o.length;l<c;l++){const u=o[l];for(let f=0,d=u.length;f<d;f++){const p=u[f],g=p.join(Q_).toString();if(!a){s.push(p),a=g,h=t.coordinateToVector3(p,0).sub(n),e.push(h.x,h.y,h.z),r.push(h);continue}g!==a&&(h=t.coordinateToVector3(p,0).sub(n),e.push(h.x,h.y,h.z),r.push(h),s.push(p)),a=g}}return{positions:e,positionsV:r,lnglats:s}}function g2(o){let t;const i=[];for(let n=0,e=o.length;n<e;n++){const r=o[n];for(let s=0,a=r.length;s<a;s++){const h=r[s],l=h.join(Q_).toString();if(!t){i.push(h),t=l;continue}l!==t&&i.push(h),t=l}}return i}function kh(o,t=1,i=1,n,e){const r=Rr(o,n,e).positionsV,s=[];for(let u=0,f=r.length;u<f;u++){const d=r[u];s.push([d.x,d.y])}const{indices:a,position:h,normal:l,uv:c}=a2([s],{lineWidth:t,depth:i});return{position:h,normal:l,indices:a,uv:c}}function Gs(o){let t=[],i;return o instanceof Lo?(t=o.getGeometries(),i=o.getCenter()):o instanceof fe?(t.push(o),i=o.getCenter()):nl(o)&&(i=jn(o),zf(o)?t=Ro(o):t.push(o)),{lineStrings:t,center:i}}function ol(o){const t=new Float32Array(o.length*2-6);let i=0;for(let n=0,e=o.length/3;n<e;n++){const r=o[n*3],s=o[n*3+1],a=o[n*3+2];if(n>0&&n<e-1){const l=i*3;t[l]=r,t[l+1]=s,t[l+2]=a,i++}const h=i*3;t[h]=r,t[h+1]=s,t[h+2]=a,i++}return t}function al(o){let t=0;const i=o.length;if(i===1)return o[0];for(let r=0;r<i;r++)t+=o[r].length;const n=new Float32Array(t);let e=0;for(let r=0;r<i;r++)n.set(o[r],e),e+=o[r].length;return n}function K_(o){if(o instanceof fe)return Ih(o.getCoordinates());if(un(o))return Ih(o.geometry.coordinates)}let Ja;function ty(){return Ja||(Ja=new ae,Nt(Ja,"position",new It(new Float32Array(3),3))),Ja}const m2="__maptalks.three__";function v2(){return m2}let Cu;wu&&(Cu=class extends wu.Actor{test(o,t){this.send(o,null,t)}pushQueue(o={}){const{type:t,data:i,callback:n,layer:e,key:r,center:s,lineStrings:a,options:h,id:l}=o;let c;t.indexOf("ExtrudePolygon")>-1?c=y2(i,s,e,h):t==="ExtrudeLines"?c=Vg(i,s,e,a):t==="Point"||(t==="Line"||t==="FatLine"?c=Wg(i,s,e,a,h):t==="Lines"||t==="FatLines"?c=Wg(i,s,e,a):t==="ExtrudeLine"?c=Vg(i,s,e,a,h):(t==="Bar"||t==="Bars")&&(c=x2(i))),c&&this.send({type:t,datas:c.datas,glRes:c.glRes,matrix:c.matrix,center:c.center},c.transfer,function(u,f){f.key=r,f.id=l,n(f)})}});var Gc;function Ri(){return!Gc&&Cu&&(Gc=new Cu(v2())),Gc}function _2(o,t,i={}){return o!==void 0&&typeof o=="number"&&o!==0?(i[o]===void 0&&(i[o]=t.distanceToVector3(o,o).x),i[o]):0}function ko(o,t,i={}){return o!==void 0&&typeof o=="number"&&o!==0?(i[o]===void 0&&(i[o]=t.altitudeToVector3(o,o).x),i[o]):0}function y2(o=[],t,i,n=[]){const e=i.isMercator();let r,s;if(e){const f=i.getMap();r=f.getGLRes(),s=f.getSpatialReference().getTransformation().matrix}let a;t&&(a=i.coordinateToVector3(t));const h=o.length,l=[],c=[],u={};for(let f=0;f<h;f++){const d=o[f],p=d,g=n[f]?n[f]:Wn(p)?p.properties:p.getProperties()||{};t||(a=i.coordinateToVector3(g.center));let m;e?m=p2(d):m=Y_(d,i,g.center||t,a,!0);for(let y=0,b=m.length;y<b;y++){const M=m[y];for(let C=0,w=M.length;C<w;C++)c.push(M[C])}let v=g.height||1,x=g.bottomHeight||0;v=ko(v,i,u),x=ko(x,i,u);const _={id:g.id,data:m,height:v,bottomHeight:x};e&&(_.center=[a.x,a.y]),l.push(_),p._properties&&delete p._properties}return{datas:l,transfer:c,glRes:r,matrix:s,center:e?[a.x,a.y]:null}}function Vg(o,t,i,n,e=[]){const r=i.isMercator();let s,a;if(r){const p=i.getMap();s=p.getGLRes(),a=p.getSpatialReference().getTransformation().matrix}let h;t&&(h=i.coordinateToVector3(t));const l=[],c=[],u={},f={},d=o.length;for(let p=0;p<d;p++){const g=o[p],m=e[p]?e[p]:un(n[p])?n[p].properties:n[p].getProperties()||{};t||(h=i.coordinateToVector3(m.center));let v=m.width||1,x=m.height||1,_=m.bottomHeight||0;v=_2(v,i,u),x=ko(x,i,f),_=ko(_,i,f);const y=[];for(let M=0,C=g.length;M<C;M++){const w=g[M];let S;r?S=K_(w):S=Rr(w,i,t,!1).arrayBuffer,c.push(S),y.push(S)}const b={id:m.id,data:y,height:x,width:v,bottomHeight:_};r&&(b.center=[h.x,h.y]),l.push(b)}return{datas:l,transfer:c,glRes:s,matrix:a,center:r?[h.x,h.y]:null}}function Wg(o,t,i,n,e=[]){const r=i.isMercator();let s,a;if(r){const d=i.getMap();s=d.getGLRes(),a=d.getSpatialReference().getTransformation().matrix}let h;t&&(h=i.coordinateToVector3(t));const l=[],c=[],u={},f=o.length;for(let d=0;d<f;d++){const p=o[d],g=e[d]?e[d]:un(n[d])?n[d].properties:n[d].getProperties()||{};t||(h=i.coordinateToVector3(g.center));let m=g.bottomHeight||0;m=ko(m,i,u);const v=[];for(let _=0,y=p.length;_<y;_++){const b=p[_];if(r){const M=K_(b);v.push(M),v.push(M)}else{const M=Rr(b,i,t,!1).arrayBuffer;c.push(M),v.push(M)}}const x={id:g.id,data:v,bottomHeight:m};r&&(x.center=[h.x,h.y]),l.push(x)}return{datas:l,transfer:c,glRes:s,matrix:a,center:r?[h.x,h.y]:null}}function x2(o){const t=o.length,i=new Float32Array(t*7);let n=0;for(let r=0;r<t;r++){let{center:s,radialSegments:a,radius:h,height:l,altitude:c,id:u}=o[r];s=s||[0,0],i[n]=s[0],i[n+1]=s[1],i[n+2]=a||6,i[n+3]=h||1,i[n+4]=l,i[n+5]=c||0,i[n+6]=u,n+=7}const e=i.buffer;return{datas:e,transfer:[e]}}function Yo(o){return o.map(t=>t.data)}function Qo(o){return o.map(t=>t.option||t.baseObject.getOptions())}class Vi{constructor(){this.queueMap={},this.tempQueue=[],this.time=this.getCurrentTime(),this.deQueueCount=5,this.resultQueue=[]}getActor(){return Ri()}getCurrentTime(){return yt.now()}loop(){this.deQueue()}push(t){return this.tempQueue.push(t),t.id&&(this.queueMap[t.id]=t),this}reset(){return this.time=this.getCurrentTime(),this.tempQueue=[],this}pushResult(t){if(!!t)return Array.isArray(t)||(t=[t]),t.forEach(i=>{this.resultQueue.push(i)}),this}deQueue(){if(!this.resultQueue.length)return this;const t=this.deQueueCount;return(this.resultQueue.slice(0,t)||[]).forEach(n=>{const{id:e}=n;if(this.queueMap[e]){const{baseObject:r}=this.queueMap[e];r&&r._workerLoad&&r._workerLoad(n),delete this.queueMap[e]}}),this.resultQueue.splice(0,t),this}}class w2 extends Vi{constructor(){super(),this.deQueueCount=100}loop(){(this.getCurrentTime()-this.time>=32||this.tempQueue.length>=1e3)&&this.tempQueue.length&&(Ri().pushQueue({type:"ExtrudePolygon",layer:this.tempQueue[0].layer,data:Yo(this.tempQueue),options:Qo(this.tempQueue),callback:n=>{this.pushResult(n)}}),this.reset()),super.loop()}}class M2 extends Vi{loop(){if(this.tempQueue.length){const t=Ri();this.tempQueue.forEach(i=>{t.pushQueue({id:i.id,type:"ExtrudePolygons",layer:i.layer,data:i.data,key:i.key,center:i.center,callback:n=>{this.pushResult(n)}})}),this.reset()}super.loop()}}class b2 extends Vi{constructor(){super(),this.deQueueCount=100}loop(){(this.getCurrentTime()-this.time>=32||this.tempQueue.length>=1e3)&&this.tempQueue.length&&(Ri().pushQueue({type:"ExtrudeLine",layer:this.tempQueue[0].layer,data:Yo(this.tempQueue),options:Qo(this.tempQueue),lineStrings:this.tempQueue.map(n=>n.lineString),callback:n=>{this.pushResult(n)}}),this.reset()),super.loop()}}class S2 extends Vi{loop(){if(this.tempQueue.length){const t=Ri();this.tempQueue.forEach(i=>{t.pushQueue({id:i.id,type:"ExtrudeLines",layer:i.layer,data:i.data,key:i.key,lineStrings:i.lineStrings,center:i.center,callback:n=>{this.pushResult(n)}})}),this.reset()}super.loop()}}class C2 extends Vi{constructor(){super(),this.deQueueCount=200}loop(){(this.getCurrentTime()-this.time>=32||this.tempQueue.length>=1e3)&&this.tempQueue.length&&(Ri().pushQueue({type:"Line",layer:this.tempQueue[0].layer,data:Yo(this.tempQueue),options:Qo(this.tempQueue),lineStrings:this.tempQueue.map(n=>n.lineString),callback:n=>{this.pushResult(n)}}),this.reset()),super.loop()}}class T2 extends Vi{loop(){if(this.tempQueue.length){const t=Ri();this.tempQueue.forEach(i=>{t.pushQueue({id:i.id,type:"Lines",layer:i.layer,data:i.data,key:i.key,lineStrings:i.lineStrings,center:i.center,callback:n=>{this.pushResult(n)}})}),this.reset()}super.loop()}}class P2 extends Vi{constructor(){super(),this.deQueueCount=100}loop(){(this.getCurrentTime()-this.time>=32||this.tempQueue.length>=1e3)&&this.tempQueue.length&&(Ri().pushQueue({type:"FatLine",layer:this.tempQueue[0].layer,data:Yo(this.tempQueue),options:Qo(this.tempQueue),lineStrings:this.tempQueue.map(n=>n.lineString),callback:n=>{this.pushResult(n)}}),this.reset()),super.loop()}}class E2 extends Vi{loop(){if(this.tempQueue.length){const t=Ri();this.tempQueue.forEach(i=>{t.pushQueue({id:i.id,type:"FatLines",layer:i.layer,data:i.data,key:i.key,lineStrings:i.lineStrings,center:i.center,callback:n=>{this.pushResult(n)}})}),this.reset()}super.loop()}}class A2 extends Vi{constructor(){super(),this.deQueueCount=100}loop(){(this.getCurrentTime()-this.time>=32||this.tempQueue.length>=1e3)&&this.tempQueue.length&&(Ri().pushQueue({type:"Bar",layer:this.tempQueue[0].layer,data:Yo(this.tempQueue),options:Qo(this.tempQueue),callback:n=>{this.pushResult(n)}}),this.reset()),super.loop()}}class L2 extends Vi{constructor(){super(),this.deQueueCount=1}loop(){if(this.tempQueue.length){const t=Ri();this.tempQueue.forEach(i=>{t.pushQueue({id:i.id,type:"Bars",layer:i.layer,data:i.data,callback:n=>{this.pushResult(n)}})}),this.reset()}super.loop()}}const ey=new w2,iy=new M2,Gf=new b2,ny=new S2,ry=new C2,sy=new T2,oy=new P2,ay=new E2,hy=new A2,ly=new L2,Ki={isRunning:!1,tasks:[],addTask:o=>{o&&Ki.tasks.push(o)},removeTask:o=>{Ki.tasks.splice(Ki.tasks.indexOf(o),1)},loop(){ey.loop(),iy.loop(),Gf.loop(),ny.loop(),ry.loop(),sy.loop(),oy.loop(),ay.loop(),hy.loop(),ly.loop(),Ki.tasks.forEach(o=>{o&&o.loop&&o.loop()}),yt.requestAnimFrame(Ki.loop)},star(){Ki.isRunning||(Ki.isRunning=!0,Ki.loop())}};function hl(o){const{position:t,normal:i,uv:n,indices:e}=cy(o),r=new ae,s=new Float32Array(t.length);return s.fill(1,0,t.length),Nt(r,"color",new It(s,3)),Nt(r,"normal",new It(i,3)),Nt(r,"position",new It(t,3)),n&&n.length&&Nt(r,"uv",new It(n,2)),r.setIndex(new It(e,1)),r}function cy(o){const t={},i={};for(let s=0;s<o.length;++s){const a=o[s];for(const h in a)t[h]===void 0&&(t[h]=[],i[h]=0),t[h].push(a[h]),i[h]+=a[h].length}const n={};let e=0;const r=new Uint32Array(i.indices);for(const s in t)if(s==="indices"){const a=t[s];let h=0;for(let l=0,c=a.length;l<c;l++){const u=a[l];for(let f=0,d=u.length;f<d;f++)r[h]=u[f]+e,h++;e+=t.position[l].length/3}}else{const a=R2(t[s],i[s]);if(!a)return null;n[s]=a}return n.indices=r,n}function R2(o,t){const i=new Float32Array(t);let n=0;for(let e=0;e<o.length;++e)i.set(o[e],n),n+=o[e].length;return i}function Hs(o){const{position:t,normal:i,uv:n,indices:e}=o,r=new ae;return Nt(r,"normal",new It(new Float32Array(i),3)),Nt(r,"position",new It(new Float32Array(t),3)),Nt(r,"uv",new It(new Float32Array(n),2)),r.setIndex(new It(new Uint32Array(e),1)),r}function Tr(o){const t=new ae;return Nt(t,"normal",o.getAttribute("normal")),Nt(t,"position",o.getAttribute("position").clone()),t.setIndex(o.getIndex()),t}let Hc;function Or(){return Hc||(Hc=new Nm(1e-6,1e-6,1e-6)),Hc}Or();const uy=new Nm(1,1,1);uy.translate(0,0,.5);const sr=new qt("#fff"),or=new qt("#fff");function O2(o){const{position:t,normal:i,uv:n,indices:e}=f2(o.center||[0,0],o),r=new ae;return Nt(r,"normal",new It(i,3)),Nt(r,"position",new It(t,3)),Nt(r,"uv",new It(n,2)),r.setIndex(new It(e,1)),r}function fy(o){const t=Object.assign({},o);return t._radius&&(t.radius=t._radius),O2(t)}function As(o,t,i,n="y",e=0){let r=0;n==="y"?r=1:n==="z"&&(r=2);const s=o.attributes.position.array,a=s.length;or.setStyle(t),sr.setStyle(i);const h=new Float32Array(a);if(Array.isArray(e))for(let l=0,c=e.length;l<c;l++){const{middleZ:u,start:f,end:d}=e[l].position;for(let p=f;p<d;p+=3)s[p+2]>u?(h[p]=sr.r,h[p+1]=sr.g,h[p+2]=sr.b):(h[p]=or.r,h[p+1]=or.g,h[p+2]=or.b)}else for(let l=0;l<a;l+=3)s[l+r]>e?(h[l]=sr.r,h[l+1]=sr.g,h[l+2]=sr.b):(h[l]=or.r,h[l+1]=or.g,h[l+2]=or.b);return Nt(o,"color",new It(h,3,!0)),h}function dy(o){const t=[],i=o.length;let n=0;for(let a=0;a<i;a++){const{color:h}=o[a].attributes;h&&(n+=h.array.length)}const e=new Float32Array(n);let r=0;for(let a=0,h=o.length;a<h;a++){const{color:l,normal:c,position:u,uv:f}=o[a].attributes,d=o[a].index;l&&(e.set(l.array,r),r+=l.array.length),t.push({normal:c.array,uv:f.array,position:u.array,indices:d.array})}const s=hl(t);e.length&&Nt(s,"color",new It(e,3,!0));for(let a=0,h=o.length;a<h;a++)o[a].dispose();return s}function py(){return uy}const D2={radius:10,height:100,radialSegments:6,altitude:0,topColor:"",bottomColor:"#2d2f61",heightEnable:!0};class Tu extends de{constructor(t,i,n,e){i=yt.extend({},D2,i,{layer:e,coordinate:t}),super(),this._initOptions(i);const{height:r,radius:s,topColor:a,bottomColor:h,altitude:l,asynchronous:c}=i;i.height=e.altitudeToVector3(r,r).x,i.radius=e.distanceToVector3(s,s).x;let u;if(c){u=Or();const p=yt.GUID();this.getOptions().id=p,hy.push({data:{radius:i.radius,height:i.height,radialSegments:i.radialSegments,id:p},layer:e,id:p,baseObject:this})}else u=fy(i),a&&(As(u,h,a,"z",i.height/2),n.vertexColors=Le());this._createMesh(u,n);const f=e.altitudeToVector3(l,l).x,d=e.coordinateToVector3(t,f);this.getObject3d().position.copy(d),this.type="Bar"}_workerLoad(t){const i=Hs(t),{topColor:n,bottomColor:e,height:r}=this.getOptions(),s=this.getObject3d(),a=s.material;if(n){const l=this.getLayer().altitudeToVector3(r,r).x;As(i,e,n,"z",l/2),a.vertexColors=Le()}s.geometry=i,s.material.needsUpdate=!0,this._fire("workerload",{target:this})}}function jg(o){const t=[];return o&&o.length&&o.forEach(i=>{i=i instanceof qt?i:new qt(i),t.push(i.r,i.g,i.b)}),t}const I2={altitude:0,bottomHeight:0,colors:null};class gy extends de{constructor(t,i,n,e){i=yt.extend({},I2,i,{layer:e,lineString:t}),super(),this._initOptions(i);const{lineStrings:r,center:s}=Gs(t),{asynchronous:a}=i;let h;if(a){h=ty();const f=yt.GUID();this.getOptions().id=f,this.getOptions().center=s,ry.push({id:f,data:r,layer:e,key:i.key,lineString:t,baseObject:this})}else{const f=[];for(let g=0,m=r.length;g<m;g++){const v=r[g],{positions:x}=Rr(v,e,s,!1);f.push(ol(x))}const d=al(f);h=new ae,Nt(h,"position",new It(d,3)),qn(h,i.bottomHeight,e);const p=jg(i.colors);p&&p.length&&(Nt(h,"color",new Fe(p,3)),n.vertexColors=Le())}this._createLineSegments(h,n);const{altitude:l}=i,c=e.altitudeToVector3(l,l).x,u=e.coordinateToVector3(s,c);this.getObject3d().position.copy(u),this.type="Line"}_workerLoad(t){const i=new ae;Nt(i,"position",new It(new Float32Array(t.position),3));const n=jg(this.getOptions().colors),e=this.getObject3d(),r=e.material;n&&n.length&&(Nt(i,"color",new Fe(n,3)),r.vertexColors=Le()),this._computeLineDistances(i),e.geometry=i,e.material.needsUpdate=!0,this._fire("workerload",{target:this})}}const k2={bottomHeight:0,width:3,height:1,altitude:0,topColor:null,bottomColor:"#2d2f61",heightEnable:!0};class my extends de{constructor(t,i,n,e){i=yt.extend({},k2,i,{layer:e,lineString:t}),super(),this._initOptions(i);const{height:r,width:s,bottomColor:a,topColor:h,bottomHeight:l,altitude:c,asynchronous:u}=i,f=e.altitudeToVector3(r,r).x,d=e.distanceToVector3(s,s).x,{lineStrings:p,center:g}=Gs(t);let m;if(u){m=Or();const _=yt.GUID();this.getOptions().id=_,this.getOptions().center=g,Gf.push({id:_,data:p,layer:e,center:g,lineString:t,baseObject:this})}else{const _=[];let y=0;const b={};for(let M=0,C=p.length;M<C;M++){const w=kh(p[M],d,f,e,g);y=qn(w,l,e,b),_.push(w)}m=hl(_),h&&(Zn(m,a,h,y+f/2),n.vertexColors=Le())}this._createMesh(m,n);const v=e.altitudeToVector3(c,c).x,x=e.coordinateToVector3(g,v);this.getObject3d().position.copy(x),this.type="ExtrudeLine"}_workerLoad(t){const i=Hs(t),{topColor:n,bottomColor:e,bottomHeight:r,height:s}=this.getOptions(),a=this.getObject3d(),h=a.material;if(n){const l=this.getLayer(),c=l.altitudeToVector3(r,r).x,u=l.altitudeToVector3(s,s).x;Zn(i,e,n,c+u/2),h.vertexColors=Le()}a.geometry=i,a.material.needsUpdate=!0,this._fire("workerload",{target:this})}}const z2={altitude:0,height:1,bottomHeight:0,topColor:null,bottomColor:"#2d2f61",heightEnable:!0};class vy extends de{constructor(t,i,n,e){i=yt.extend({},z2,i,{layer:e,polygon:t}),super(),this._initOptions(i);const{height:r,topColor:s,bottomColor:a,altitude:h,bottomHeight:l,asynchronous:c}=i;let u;const f=Wn(t)?jn(t):t.getCenter();if(c){u=Or();const g=yt.GUID();this.getOptions().id=g,this.getOptions().center=f,ey.push({data:t,layer:e,id:g,baseObject:this})}else{u=d2(t,r,e);const g=qn(u,l,e);if(s){const m=e.altitudeToVector3(r,r).x;Zn(u,a,s,g+m/2),n.vertexColors=Le()}}this._createMesh(u,n);const d=e.altitudeToVector3(h,h).x,p=e.coordinateToVector3(f,d);this.getObject3d().position.copy(p),this.type="ExtrudePolygon"}_workerLoad(t){const i=Hs(t),{topColor:n,bottomColor:e,bottomHeight:r,height:s}=this.getOptions(),a=this.getObject3d(),h=a.material;if(n){const l=this.getLayer(),c=l.altitudeToVector3(r,r).x,u=l.altitudeToVector3(s,s).x;Zn(i,e,n,c+u/2),h.vertexColors=Le()}a.geometry=i,a.material.needsUpdate=!0,this._fire("workerload",{target:this})}}const F2={altitude:0,coordinate:null};class N2 extends de{constructor(t,i={},n){i.coordinate||(i.coordinate=n.getMap().getCenter()),i=yt.extend({},F2,i,{layer:n,model:t}),super(),this._initOptions(i),this._createGroup(),this.getObject3d().add(t);const{altitude:e,coordinate:r}=i,s=n.altitudeToVector3(e,e).x,a=n.coordinateToVector3(r,s);this.getObject3d().position.copy(a),this.type="Model"}}const B2=Math.PI/180,G2=6378137,H2=.1;function U2(o){return o.getCoordinates().map(i=>i.toArray())}function Ya(o){return o*B2}function V2(o,t){if(!o||!t)return 0;Array.isArray(o)||(o=o.toArray()),Array.isArray(t)||(t=t.toArray());let i=Ya(o[1]);const n=Ya(t[1]),e=i-n,r=Ya(o[0])-Ya(t[0]);return i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(e/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin(r/2),2))),i*=G2,Math.round(i*1e5)/1e5}function W2(o,t){const{len:i,c1:n,c2:e}=o,r=e[0]-n[0],s=e[1]-n[1],a=t/i,h=n[0]+a*r,l=n[1]+a*s;return[h,l]}function j2(o,t=10){t=Math.max(t,H2),Array.isArray(o)||(o=U2(o));const i=o.length;let n=[],e=0;for(let f=0;f<i-1;f++){const d=V2(o[f],o[f+1]),p=Math.floor(d);n.push({c1:o[f],len:p,c2:o[f+1]}),e+=p}if(e<=t)return n.map(d=>[d.c1,d.c2]);if(n.length===1&&n[0].len<=t)return[[n[0].c1,n[0].c2]];const r=n.length,s=n[0];let a=0,h,l=0;const c=[];let u=[s.c1];for(;a<r;){const{len:f,c2:d}=n[a];if(l+=f,l<t&&(u.push(d),a===r-1&&c.push(u),a++),l===t&&(u.push(d),l=0,c.push(u),u=[d],a++),l>t){const p=f-l+t;h=W2(n[a],p),u.push(h),c.push(u),l=0,n[a].c1=h,n[a].len=f-p,u=[],u.push(h)}}return c}const Uc=1e3;function Z2(o,t,i,n){const e=t.length;o.attributes.normal.count=e,o.attributes.position.count=e;const r=o.attributes.position.array,s=o.attributes.normal.array;for(let a=0;a<e;a++)r[a]=t[a],s[a]=i[a];o.index.count=n.length;for(let a=0,h=n.length;a<h;a++)o.index.array[a]=n[a]}const X2={trail:5,chunkLength:50,width:2,height:1,speed:1,altitude:0,interactive:!1,heightEnable:!0};class $2 extends de{constructor(t,i,n,e){i=yt.extend({},X2,i,{layer:e,lineString:t}),super(),this._initOptions(i);const{width:r,height:s,altitude:a,speed:h,chunkLength:l,trail:c}=i;let u,f;nl(t)?(u=jn(t),f=qo(t)):(u=t.getCenter(),f=t);const d=j2(f,l),p=e.coordinateToVector3(u),g=new ae,m=new Float32Array(Uc*3),v=new Float32Array(Uc*3),x=new Uint16Array(Uc);Nt(g,"position",new It(m,3)),Nt(g,"normal",new It(v,3)),g.setIndex(new It(x,1));const _=e.distanceToVector3(r,r).x,y=e.altitudeToVector3(s,s).x;this._createMesh(g,n);const b=e.altitudeToVector3(a,a).x,M=e.coordinateToVector3(u,b);this.getObject3d().position.copy(M),this._params={index:0,chunkLines:d,geometries:[],layer:e,trail:Math.max(1,c),lineWidth:_,depth:y,speed:Math.min(1,h),idx:0,loaded:!0,center:u,centerPt:p,workerInitCount:0},this._init(this._params),this.type="ExtrudeLineTrail"}_init(t){const{layer:i,trail:n,lineWidth:e,depth:r,chunkLines:s,positionMap:a,centerPt:h,center:l}=t,c=s.length,u=[];if(this.options.asynchronous){t.loaded=!1;const f=yt.GUID();for(let d=0;d<c;d++){const p=s.slice(d,d+n),g=g2(p),m={type:"Feature",geometry:{type:"LineString",coordinates:g}},v=`${f}-${d}`,x=yt.extend({},this.options);x.id=v,x.center=l,Gf.push({id:v,data:[m],layer:i,center:l,lineString:m,baseObject:this,option:x})}}else for(let f=0;f<c;f++){const d=s.slice(f,f+n),p=Ug(d,i,a,h).positionsV;u.push(kh(p,e,r,i))}}_animation(){const{index:t,geometries:i,speed:n,idx:e,chunkLines:r,trail:s,lineWidth:a,depth:h,loaded:l,layer:c,positionMap:u,centerPt:f}=this._params;if(!l)return;const d=Math.round(t);if(d>e){this._params.idx++;let p=i[d];if(!p){const m=r.slice(d,d+s),v=Ug(m,c,u,f).positionsV;p=kh(v,a,h,c),i[d]=p}const g=this.getObject3d();Z2(g.geometry,p.position,p.normal,p.indices),g.geometry.attributes.position.needsUpdate=!0,g.geometry.attributes.normal.needsUpdate=!0,g.geometry.index.needsUpdate=!0}t>=r.length-1&&(this._params.index=-1,this._params.idx=-1),this._params.index+=n}_workerLoad(t){if(!t)return this;const{id:i,indices:n,position:e,normal:r,uv:s}=t;if(!i||!n||!e||!r||!s)return;let a=i.split("-")[1];if(a=parseInt(a),yt.isNumber(a)){const h=this._params.geometries;h[a]={indices:new Uint32Array(n),position:new Float32Array(e),uv:new Float32Array(s),normal:new Float32Array(r)},this._params.workerInitCount++}this._params.workerInitCount===this._params.chunkLines.length&&(this._params.loaded=!0,this._fire("workerload",{target:this}))}}const q2=["click","mousemove","mousedown","mouseup","dblclick","contextmenu"].join(" ").toString(),_y=new Iu;_y.vertexColors=Le();const Dr=o=>class extends o{_initBaseObjectsEvent(t){if(t&&Array.isArray(t)&&t.length)for(let i=0,n=t.length;i<n;i++){const e=t[i];this._proxyEvent(e)}return this}_proxyEvent(t){t.on("add",i=>{this._showGeometry(i.target,!0)}),t.on("remove",i=>{this._showGeometry(i.target,!1)}),t.on("mouseout",i=>{this._mouseover=!1,this.fire("mouseout",Object.assign({},i,{target:this,selectMesh:this.getSelectMesh?this.getSelectMesh():null}))}),t.on(q2,i=>{this.fire(i.type,Object.assign({},i,{target:this,selectMesh:this.getSelectMesh?this.getSelectMesh():null}))})}_getHideGeometryIndex(t){const i=[];let n=0;for(let e=0,r=this._geometriesAttributes.length;e<r;e++)this._geometriesAttributes[e].hide===!0&&(i.push(e),n+=this._geometriesAttributes[e][t].count);return{indexs:i,count:n}}_updateAttribute(t,i){const{indexs:n}=this._getHideGeometryIndex(i),e=this._geometryCache.attributes[i].array,r=e.length;for(let a=0;a<r;a++)t.array[a]=e[a];let s=NaN;this.getObject3d()instanceof Gu&&(s=0);for(let a=0;a<n.length;a++){const h=n[a],{start:l,end:c}=this._geometriesAttributes[h][i];for(let u=l;u<c;u++)t.array[u]=s}return this}_showGeometry(t,i){let n;if(t&&(n=t.getOptions().index),n!=null){const e=this._geometriesAttributes[n],{hide:r}=e;if(r===i)return this;e.hide=i;const s=this.getObject3d().geometry;this._updateAttribute(s.attributes.position,"position"),s.attributes.position.needsUpdate=!0,this.isHide=i}return this}getSelectMesh(){const t=this._getIndex();if(t!=null)return{data:this._datas[t],baseObject:this._baseObjects[t]}}_getIndex(t){return t==null&&(t=this.faceIndex||this.index),t}_init(){const t=this.getLayer().getPick();this.on("add",()=>{t.add(this.pickObject3d)}),this.on("remove",()=>{t.remove(this.pickObject3d)})}_setPickObject3d(){if(!this._colorMap)return;const t=this._geometryCache||this.getObject3d().geometry.clone(),i=this.getLayer().getPick(),{_geometriesAttributes:n}=this,e=n.length,r=Bf(n);let s=0;for(let c=0;c<e;c++){const u=i.getColor(),f=u.getHex();this._colorMap[f]=c;const{count:d}=n[c].position;this._datas[c].colorIndex=f;for(let p=0;p<d;p++)r[s]=u.r,r[s+1]=u.g,r[s+2]=u.b,s+=3}Nt(t,"color",new It(r,3,!0));const h=i.getColor().getHex(),l=new ei(t,_y);l.position.copy(this.getObject3d().position),l._colorIndex=h,this.setPickObject3d(l)}},J2={altitude:0,height:1,bottomHeight:0,topColor:null,bottomColor:"#2d2f61"},Y2=new q(0,0);class Q2 extends Dr(de){constructor(t,i,n,e){Array.isArray(t)||(t=[t]);const r=t.length;let s=1/0,a=1/0,h=-1/0,l=-1/0;for(let y=0;y<r;y++){const b=t[y],M=b.getCenter?b.getCenter():jn(b,Y2);let C,w;Array.isArray(M)?(C=M[0],w=M[1]):M instanceof q&&(C=M.x,w=M.y),s=Math.min(s,C),a=Math.min(a,w),h=Math.max(h,C),l=Math.max(l,w)}const c=new q((s+h)/2,(a+l)/2);i=yt.extend({},J2,i,{layer:e,polygons:t,coordinate:c});const{topColor:u,bottomColor:f,altitude:d,asynchronous:p}=i;let g;const m=[],v=[];if(super(),p)g=Or(),iy.push({id:yt.GUID(),layer:e,key:i.key,center:c,data:t,baseObject:this});else{const y=e.coordinateToVector3(c),b=[];let M=0;const C={};for(let w=0;w<r;w++){const S=t[w],P=Wn(S)?S.properties:S.getProperties()||{},O=P.height||1,D=P.bottomHeight||0,L=J_(S,O,e,c,y,C);b.push(L);const T=qn(L,D,e,C),{position:A,normal:N,uv:B,indices:F}=L;F.length/3;const I=A.length/3;N.length/3,B.length/2,v[w]={position:{middleZ:T+C[O]/2,count:I,start:M,end:M+I*3},hide:!1},M+=I*3}g=hl(b),u&&(Zn(g,f,u,v),n.vertexColors=Le())}this._initOptions(i),this._createMesh(g,n);const x=e.altitudeToVector3(d,d).x,_=e.coordinateToVector3(c,x);this.getObject3d().position.copy(_),this._baseObjects=m,this._datas=t,this._geometriesAttributes=v,this.faceIndex=null,this._geometryCache=Tr(g),this.isHide=!1,this._colorMap={},this._initBaseObjectsEvent(m),p||(this._setPickObject3d(),this._init()),this.type="ExtrudePolygons"}getSelectMesh(){const t=this._getIndex();if(t!=null){if(!this._baseObjects[t]){const i=this._datas[t],n=Object.assign({},this.options,Wn(i)?i.properties:i.getProperties(),{index:t});this._baseObjects[t]=new vy(i,n,this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}}identify(t){return this.picked}_workerLoad(t){const{geometriesAttributes:i}=t;this._geometriesAttributes=i;const n=Hs(t);this._geometryCache=Tr(n);const{topColor:e,bottomColor:r}=this.getOptions(),s=this.getObject3d(),a=s.material;e&&(Zn(n,r,e,i),a.vertexColors=Le()),s.geometry=n,s.material.needsUpdate=!0,this._setPickObject3d(),this._init(),this.isAdd&&this.getLayer().getPick().add(this.pickObject3d),this._fire("workerload",{target:this})}}function yy(o,t,i){const n=o.project(i),e=t.width/2,r=t.height/2;return{x:Math.round(n.x*e+e),y:Math.round(-n.y*r+r)}}const K2={altitude:0,height:0,color:null},Qa=new G;class xy extends de{constructor(t,i,n,e){i=yt.extend({},K2,i,{layer:e,coordinate:t}),super();let{height:r,altitude:s,color:a,size:h}=i;const l=[],c=[];a&&(a=a instanceof qt?a:new qt(a),c.push(a.r,a.g,a.b));const u=e.altitudeToVector3(r,r).x,f=e.coordinateToVector3(t,u);l.push(0,0,f.z);const d=new ae;Nt(d,"position",new Fe(l,3,!0)),c.length&&Nt(d,"color",new Fe(c,3,!0)),h!==void 0&&Nt(d,"size",new Fe([h],1,!0)),i.positions=f,this._initOptions(i),this._createPoints(d,n);const p=e.altitudeToVector3(s,s).x,g=new G(f.x,f.y,p);this.getObject3d().position.copy(g),this.type="Point"}identify(t){const i=this.getLayer(),n=this.getMap().getSize(),e=this.getLayer().getCamera(),r=this.getOptions().positions,s=this.getOptions().altitude;let a=this.getObject3d().material.size;a===void 0&&(a=this.options.size||1);const h=this.getMap().coordToContainerPoint(t),l=i.altitudeToVector3(s,s).x;Qa.x=r.x,Qa.y=r.y,Qa.z=r.z+l;const c=yy(Qa,n,e);return Math.sqrt(Math.pow(h.x-c.x,2)+Math.pow(h.y-c.y,2))<=a/2}}const Vc=30,Wc=30;function Cn(o,t){const{minx:i,miny:n,maxx:e,maxy:r}=o,[s,a]=t;return i<=s&&s<=e&&n<=a&&a<=r}class Hf{constructor(t,i,n,e){this.minlng=t,this.minlat=i,this.maxlng=n,this.maxlat=e,this.minx=1/0,this.miny=1/0,this.maxx=-1/0,this.maxy=-1/0,this.coordinates=[],this.positions=[],this.indexs=[],this.key=null}updateBBoxPixel(t){let i=1/0,n=1/0,e=-1/0,r=-1/0;const{minlng:s,minlat:a,maxlng:h,maxlat:l}=this;return[[s,a],[s,l],[h,a],[h,l]].map(c=>new q(c)).map(c=>t.coordToContainerPoint(c)).forEach(c=>{i=Math.min(i,c.x),n=Math.min(n,c.y),e=Math.max(e,c.x),r=Math.max(r,c.y)}),this.minx=i,this.miny=n,this.maxx=e,this.maxy=r,this}containsCoordinate(t){let i,n;Array.isArray(t)?(i=t[0],n=t[1]):t instanceof q&&(i=t.x,n=t.y);const{minlng:e,minlat:r,maxlng:s,maxlat:a}=this;return e<=i&&i<=s&&r<=n&&n<=a}isRecCross(t,i){const{x:n,y:e}=t,r={minx:n-i/2,miny:e-i/2,maxx:n+i/2,maxy:e+i/2},{minx:s,miny:a,maxx:h,maxy:l}=r;return!!(Cn(this,[s,a])||Cn(this,[s,l])||Cn(this,[h,a])||Cn(this,[h,l])||Cn(r,[this.minx,this.miny])||Cn(r,[this.minx,this.maxy])||Cn(r,[this.maxx,this.miny])||Cn(r,[this.maxx,this.maxy]))}static initGrids(t,i,n,e){const r=[],s=n-t,a=e-i,h=s/Wc,l=a/Vc;let c=t,u=i;for(let f=0;f<Wc;f++){c=t+f*h;for(let d=0;d<Vc;d++){u=i+d*l;const p=new Hf(c,u,c+h,u+l);p.key=d+"-"+f,r.push(p)}}return{grids:r,averageX:h,averageY:l,ROWS:Vc,COLS:Wc}}}const tA={altitude:0},Ka=new G;function Zg(o,t){const i=Math.pow(10,t);return Math.round(o*i)/i}class eA extends Dr(de){constructor(t,i,n,e){Array.isArray(t)||(t=[t]),i=yt.extend({},tA,i,{layer:e,points:t});let r=1/0,s=1/0,a=-1/0,h=-1/0;for(let T=0,A=t.length;T<A;T++){const{coordinate:N}=t[T];let B,F;Array.isArray(N)?(B=N[0],F=N[1]):N instanceof q&&(B=N.x,F=N.y),t[T].coords=[B,F],r=Math.min(r,B),s=Math.min(s,F),a=Math.max(a,B),h=Math.max(h,F)}const l=e.coordinateToVector3([(r+a)/2,(s+h)/2]),{grids:c,averageX:u,averageY:f,ROWS:d,COLS:p}=Hf.initGrids(r,s,a,h);c.length;const g=new Float32Array(t.length*3),m=[],v=new Float32Array(t.length*3),x=new Float32Array(t.length),_=[],y=[],b={};let M=0,C=!1,w=!1;const S=new G(0,0,0);for(let T=0,A=t.length;T<A;T++){let{coordinate:N,height:B,color:F,size:I,coords:z}=t[T];const Z=T*3;F&&(C=!0,F=F instanceof qt?F:new qt(F),v[Z]=F.r,v[Z+1]=F.g,v[Z+2]=F.b),I&&(w=!0,x[T]=I,M=Math.max(M,I));const j=kn(B,e,b),K=e.coordinateToVector3(N,j);S.x=K.x,S.y=K.y,S.z=K.z,S.sub(l),g[Z]=S.x,g[Z+1]=S.y,g[Z+2]=S.z,m.push(K),y[T]={position:{count:1,start:T*3,end:T*3+3},hide:!1};let et=Zg((z[1]-s)/f,4),st=Zg((z[0]-r)/u,4);et-=1,st-=1,et=Math.max(0,et),st=Math.max(0,st),et=Math.ceil(et),st=Math.ceil(st);const V=st*d+et;c[V]&&(c[V].positions.push(K),c[V].indexs.push(T))}const P=new ae;Nt(P,"position",new It(g,3,!0)),C&&Nt(P,"color",new It(v,3,!0)),w&&Nt(P,"size",new It(x,1,!0)),i.positions=m,super(),this._initOptions(i),this._createPoints(P,n);const O=i.altitude,D=e.altitudeToVector3(O,O).x,L=l.clone();L.z=D,this.getObject3d().position.copy(L),this._baseObjects=_,this._datas=t,this.faceIndex=null,this._geometriesAttributes=y,this._geometryCache=P.clone(),this.isHide=!1,this._initBaseObjectsEvent(_),this._grids=c,this._bindMapEvents(),this.type="Points",this.maxSize=M}_bindMapEvents(){const t=this.getMap(),i="zoomstart zooming zoomend movestart moving moveend pitch rotate";this.on("add",()=>{this._updateGrids(),t.on(i,this._updateGrids,this)}),this.on("remove",()=>{t.off(i,this._updateGrids,this)})}_updateGrids(){const t=this.getMap();this._grids.forEach(i=>{i.indexs.length&&i.updateBBoxPixel(t)})}getSelectMesh(){const t=this.faceIndex;if(t!=null){if(!this._baseObjects[t]){const i=this._datas[t],{coordinate:n,height:e,color:r,size:s}=i;this._baseObjects[t]=new xy(n,{height:e,index:t,color:r,size:s},this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}}identify(t){const i=this.getLayer(),n=this.getMap().getSize(),e=this.getLayer().getCamera(),r=this.getOptions().altitude,s=this.getMap(),a=i.altitudeToVector3(r,r).x;let h=this.getObject3d().material.size;const l=h===void 0,c=s.coordToContainerPoint(t),u=[];if(this._grids.forEach(f=>{f.indexs.length&&f.isRecCross(c,l?this.maxSize:h)&&u.push(f)}),u.length<1)return!1;for(let f=0,d=u.length;f<d;f++)for(let p=u[f].positions.length,g=p-1;g>=0;g--){l&&(h=this._datas[u[f].indexs[g]].size||1);const m=u[f].positions[g];Ka.x=m.x,Ka.y=m.y,Ka.z=m.z+a;const v=yy(Ka,n,e);if(Math.sqrt(Math.pow(c.x-v.x,2)+Math.pow(c.y-v.y,2))<=h/2)return this.faceIndex=u[f].indexs[g],!0}return!1}}const jc={coordinate:"",radius:10,height:100,radialSegments:6,altitude:0,topColor:"",bottomColor:"#2d2f61"};class iA extends Dr(de){constructor(t,i,n,e){Array.isArray(t)||(t=[t]);const r=t.length,s=Jo(t),a=e.coordinateToVector3(s),h=[],l=[],c=[];let u=0;const f={},d={};super(),i=yt.extend({},{altitude:0,layer:e,points:t},jc,i),this._initOptions(i);let p;const g=new G;if(i.asynchronous){p=Or();const _=yt.GUID();this.getOptions().id=_;const y=[];for(let b=0;b<r;b++){const M=yt.extend({index:b},jc,t[b]),{radius:C,radialSegments:w,altitude:S,height:P,coordinate:O}=M,D=Dh(C,e,f);t[b]._radius=D;const L=kn(P,e,d),T=kn(S,e,d),A=e.coordinateToVector3(O,0,g).sub(a);y.push({radialSegments:w,radius:D,height:L,center:[A.x,A.y],altitude:T})}ly.push({id:_,data:y,layer:e,baseObject:this})}else{for(let _=0;_<r;_++){const y=yt.extend({index:_},jc,t[_]),{radius:b,radialSegments:M,altitude:C,topColor:w,bottomColor:S,height:P,coordinate:O}=y,D=Dh(b,e,f),L=kn(P,e,d),T=kn(C,e,d),A=e.coordinateToVector3(O,0,g).sub(a),N=fy({radius:D,height:L,radialSegments:M,center:[A.x,A.y]});w&&(As(N,S,w,"z",L/2),n.vertexColors=Le());const B=N.attributes.position.array;for(let z=0,Z=B.length;z<Z;z+=3)B[z+2]+=T;h.push(N);const F=new Tu(O,y,n,e);l.push(F),N.index.count/3;const I=N.attributes.position.count;N.attributes.normal.count,N.attributes.uv.count,c[_]={position:{count:I,start:u,end:u+I*3},hide:!1},u+=I*3}p=dy(h)}this._createMesh(p,n);const m=i.altitude,v=e.altitudeToVector3(m,m).x,x=a.clone();x.z=v,this.getObject3d().position.copy(x),this._baseObjects=l,this._datas=t,this._geometriesAttributes=c,this.faceIndex=null,this._geometryCache=Tr(p),this.isHide=!1,this._colorMap={},this._initBaseObjectsEvent(l),i.asynchronous||(this._setPickObject3d(),this._init()),this.type="Bars"}identify(){return this.picked}getSelectMesh(){const t=this._getIndex();if(t!=null){if(!this._baseObjects[t]){const i=this._datas[t],n=Object.assign({},this.options,i,{index:t,asynchronous:!1});this._baseObjects[t]=new Tu(i.coordinate,n,this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}}_workerLoad(t){const{geometriesAttributes:i}=t;this._geometriesAttributes=i;const n=Hs(t);this._geometryCache=Tr(n);const{topColor:e,bottomColor:r}=this.getOptions(),s=this.getObject3d(),a=s.material;e&&(As(n,r,e,"z",i),a.vertexColors=Le()),s.geometry=n,s.material.needsUpdate=!0,this._setPickObject3d(),this._init(),this.isAdd&&this.getLayer().getPick().add(this.pickObject3d),this._fire("workerload",{target:this})}}const Xg={width:3,height:1,altitude:0,topColor:null,bottomColor:"#2d2f61"};class nA extends Dr(de){constructor(t,i,n,e){Array.isArray(t)||(t=[t]);const r=[],s=[],a=t.length;for(let x=0;x<a;x++){const _=t[x],y=Gs(_);r.push(y.center),s.push(y.lineStrings)}const h=Jo(r);i=yt.extend({},Xg,i,{layer:e,lineStrings:t,coordinate:h});const{altitude:l,topColor:c,bottomColor:u,asynchronous:f}=i;let d;const p=[],g=[];if(super(),f)d=Or(),ny.push({id:yt.GUID(),layer:e,key:i.key,center:h,data:s,lineStrings:t,baseObject:this});else{const x=[];let _=0;const y={},b={};for(let M=0;M<a;M++){const C=t[M],w=yt.extend({},Xg,nl(C)?C.properties:C.getProperties(),{index:M}),{height:S,width:P,bottomHeight:O}=w,D=Dh(P,e,y),L=kn(S,e,b),T=s[M],A=[];let N=0;for(let j=0,K=T.length;j<K;j++){const et=kh(T[j],D,L,e,h);N=qn(et,O,e,y),A.push(et)}const B=cy(A);x.push(B);const{position:F,normal:I,indices:z}=B;z.length/3;const Z=F.length/3;I.length/3,g[M]={position:{middleZ:N+L/2,count:Z,start:_,end:_+Z*3},hide:!1},_+=Z*3}d=hl(x),c&&(Zn(d,u,c,g),n.vertexColors=Le())}this._initOptions(i),this._createMesh(d,n);const m=e.altitudeToVector3(l,l).x,v=e.coordinateToVector3(h,m);this.getObject3d().position.copy(v),this._baseObjects=p,this._datas=t,this._geometriesAttributes=g,this.faceIndex=null,this._geometryCache=Tr(d),this.isHide=!1,this._colorMap={},this._initBaseObjectsEvent(p),f||(this._setPickObject3d(),this._init()),this.type="ExtrudeLines"}getSelectMesh(){const t=this._getIndex();if(t!=null){if(!this._baseObjects[t]){const i=this._datas[t],n=Object.assign({},this.options,un(i)?i.properties:i.getProperties(),{index:t});this._baseObjects[t]=new my(i,n,this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}}identify(t){return this.picked}_workerLoad(t){const{geometriesAttributes:i}=t;this._geometriesAttributes=i;const n=Hs(t);this._geometryCache=Tr(n);const{topColor:e,bottomColor:r,bottomHeight:s,height:a}=this.getOptions(),l=this.getObject3d().material;e&&(Zn(n,r,e,i),l.vertexColors=Le()),this.getObject3d().geometry=n,this.getObject3d().material.needsUpdate=!0,this._setPickObject3d(),this._init(),this.isAdd&&this.getLayer().getPick().add(this.pickObject3d),this._fire("workerload",{target:this})}}const rA={altitude:0,colors:null};class sA extends Dr(de){constructor(t,i,n,e){Array.isArray(t)||(t=[t]);const r=[],s=[],a=t.length;for(let _=0;_<a;_++){const y=t[_],b=Gs(y);r.push(b.center),s.push(b.lineStrings)}const h=Jo(r);i=yt.extend({},rA,i,{layer:e,lineStrings:t,coordinate:h}),super(),this._initOptions(i);const{asynchronous:l}=i;let c;const u=[],f={};let d=[],p=0,g=[];if(l)c=ty(),sy.push({id:yt.GUID(),layer:e,key:i.key,center:h,data:s,lineStrings:t,baseObject:this});else{for(let y=0;y<a;y++){const b=s[y];let M=0;for(let C=0,w=b.length;C<w;C++){const S=un(b[C])?b[C].properties:b[C].getProperties()||{},{positions:P}=Rr(b[C],e,h,!1);qn(P,S.bottomHeight,e,f),M+=P.length/3*2-2,g.push(ol(P))}d[y]={position:{count:M,start:p,end:p+M*3},hide:!1},p+=M*3}const _=al(g);c=new ae,Nt(c,"position",new It(_,3))}this._createLineSegments(c,n);const{altitude:m}=i,v=e.altitudeToVector3(m,m).x,x=e.coordinateToVector3(h,v);this.getObject3d().position.copy(x),this._baseObjects=u,this._datas=t,this._geometriesAttributes=d,this.faceIndex=null,this.index=null,this._geometryCache=c.clone(),this.isHide=!1,this._colorMap={},this._initBaseObjectsEvent(u),l||(this._setPickObject3d(),this._init()),this.type="Lines"}getSelectMesh(){const t=this._getIndex();if(t!=null){if(!this._baseObjects[t]){const i=this._datas[t],n=yt.extend({},this.getOptions(),{index:t},un(i)?i.properties:i.getProperties());this._baseObjects[t]=new gy(i,n,this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}}_setPickObject3d(){if(!this._colorMap)return;const t=this._geometryCache||this.getObject3d().geometry.clone(),i=this.getLayer().getPick(),{_geometriesAttributes:n}=this,e=n.length,r=Bf(n);let s=0;for(let u=0;u<e;u++){const f=i.getColor(),d=f.getHex();this._colorMap[d]=u;const{count:p}=n[u].position;this._datas[u].colorIndex=d;for(let g=0;g<p;g++)r[s]=f.r,r[s+1]=f.g,r[s+2]=f.b,s+=3}Nt(t,"color",new It(r,3,!0));const a=this.getObject3d().material.clone();a.color.set("#fff"),a.vertexColors=Le();const l=i.getColor().getHex(),c=new Gu(t,a);c.position.copy(this.getObject3d().position),c._colorIndex=l,this.setPickObject3d(c)}identify(t){return this.picked}_workerLoad(t){const{position:i,geometriesAttributes:n}=t;this._geometriesAttributes=n;const e=new ae;Nt(e,"position",new It(new Float32Array(i),3)),this._computeLineDistances(e),this._geometryCache=e.clone(),this.getObject3d().geometry=e,this.getObject3d().material.needsUpdate=!0,this._setPickObject3d(),this._init(),this.isAdd&&this.getLayer().getPick().add(this.pickObject3d),this._fire("workerload",{target:this})}}const oA=10,ws=[],fr=[];function aA(){return{waitingQueue:ws,currentQueue:fr}}function hA(o,t,i,n,e){const r={key:o,url:t,callback:i,img:n,vt:e};fr.length<oA?(fr.push(r),e.loopMessage(r)):ws.push(r)}function lA(o){const t=wy(ws,o);t&&t(o)}function wy(o,t){for(let i=0,n=o.length;i<n;i++){const e=o[i];if(e){const{key:r,callback:s}=e;if(t===r)return o.splice(i,1),s}}return null}function cA(o,t){if(wy(fr,o),ws.length){fr.push(ws[0]),ws.splice(0,1);const i=fr[fr.length-1];t.loopMessage(i)}}const zh=document.createElement("canvas"),Pu=256;zh.width=zh.height=Pu;let th;function ns(o,t=!1){if(th)return th;const i=zh.getContext("2d");return i.clearRect(0,0,Pu,Pu),i.save(),th=zh.toDataURL(),th}function Ko(o=1,t=1){let i;return typeof document>"u"||(i=document.createElement("canvas"),o&&(i.width=o),t&&(i.height=t)),i}class My extends vi{constructor(t,i={}){super(yt.GUID(),yt.extend({urlTemplate:t},i)),this._opts=null,this._layer=null,this.material=null,this.getMaterial=null,this._baseObjectKeys={},this._loadTiles={},this._add=null,this._layerLaodTime=new Date().getTime()}isAsynchronous(){return this._opts.worker}getBaseObjects(){const t=this._loadTiles,i=[];for(let n in t){const e=this._baseObjectKeys[n];if(e&&Array.isArray(e)&&e.length)for(let r=0,s=e.length;r<s;r++)i.push(e[r])}return i}onSelectMesh(t,i){}formatBaseObjects(t,i){return[]}loopMessage(t){}getTileData(t){const{key:i,url:n,callback:e,img:r}=t;Ke.getJSON(n,{},function(s,a){s?e(i,null,r):e(i,a,r)})}_getCurentTileKeys(){const t=this.getTiles().tileGrids||[],i=[],n={};for(let e=0,r=t.length;e<r;e++){const a=t[e].tiles||[];for(let h=0,l=a.length;h<l;h++){const{id:c}=a[h];i.push(c),n[c]=!0}}return{keys:i,keysMap:n}}_isLoad(){const{keys:t}=this._getCurentTileKeys(),i=Object.keys(this._renderer.tilesInView);return t.length===i.length}_layerOnLoad(){const t=new Date().getTime();if(t-this._layerLaodTime<20)return;this._layerLaodTime=t;const n=this._renderer.tilesInView,e=this._loadTiles,r=this._layer,s=this._baseObjectKeys,a=Object.keys(n).length,h=Object.keys(e).length,l=[];if(a&&h)for(let c in e)n[c]||s[c]&&(s[c]||[]).forEach(u=>{l.push(u)});if(l.length&&r.removeMesh(l,!1),a&&h){for(let c in n)if(!e[c])if(s[c]){const u=s[c];r.addMesh(u)}else{const{x:u,y:f,z:d}=this._getXYZOfIndex(c);this.getTileUrl(u,f,d)}}this._loadTiles=Object.assign({},n),this._diffCache()}_init(){}_workerLoad(t){const n=t.target._img;n.currentCount++,n.currentCount===n.needCount&&(n.src=ns(n._key,this._opts.debug))}_generateBaseObjects(t,i,n){if(i&&n){const{keysMap:e}=this._getCurentTileKeys();if(!e[t]){n.src=ns(t,this._opts.debug);return}const r=this.formatBaseObjects(t,i);if(r.length){n.needCount=r.length,n.currentCount=0;for(let s=0,a=r.length;s<a;s++){const h=r[s];h._img=n,h._vt=this,this.isVisible()||h.hide(),this._cachetile(t,h),h.isAsynchronous()||n.currentCount++}this._layer.addMesh(r,!1),n.needCount===n.currentCount&&(n.src=ns(t,this._opts.debug)),this.isAsynchronous()?r.filter(s=>s.isAsynchronous()).forEach(s=>{s.on("workerload",this._workerLoad,this)}):n.src=ns(t,this._opts.debug)}else n.src=ns(t,this._opts.debug);this._loadTiles[t]=!0}else n&&(n.src=ns(t,this._opts.debug))}_diffCache(){if(Object.keys(this._baseObjectKeys).length>this._renderer.tileCache.max){const t=this._renderer.tileCache.data,i=this._renderer.tilesInView,n=[];for(let e in this._baseObjectKeys)!t[e]&&!i[e]&&((this._baseObjectKeys[e]||[]).forEach(r=>{r.isAdd&&n.push(r)}),this._diposeBaseObject(e),delete this._baseObjectKeys[e]);n.length&&this._layer.removeMesh(n,!1)}}_diposeBaseObject(t){const i=this._baseObjectKeys[t];i&&i.length&&i.forEach(n=>{n.getObject3d().geometry.dispose(),n._geometryCache&&n._geometryCache.dispose();const e=n._baseObjects;e&&e.length&&e.forEach(r=>{r.getObject3d().geometry.dispose(),r=null}),n._datas=null,n._geometriesAttributes=null,n._faceMap=null,n._colorMap=null,n.pickObject3d&&n.pickObject3d.geometry.dispose(),n=null})}_cachetile(t,i){this._baseObjectKeys[t]||(this._baseObjectKeys[t]=[]),this._baseObjectKeys[t].push(i)}_getXYZOfIndex(t){const i=t.indexOf("_")>-1?"_":"-";let[n,e,r]=t.split(i).slice(1,4);const s=parseInt(e),a=parseInt(n),h=parseInt(r);return{x:s,y:a,z:h}}_getTileExtent(t,i,n){const e=this.getMap(),r=e._getResolution(n);return this._getTileConfig().getTilePrjExtent(t,i,r)}_getTileLngLatExtent(t,i,n){const e=this._getTileExtent(t,i,n);let r=e.getMax(),s=e.getMin();const h=this.getMap().getProjection();return s=h.unproject(s),r=h.unproject(r),new oe(s,r)}}const uA={worker:!1};class fA extends My{constructor(t,i={},n,e){super(yt.GUID(),yt.extend({urlTemplate:t},uA,i)),this._opts=i,this._layer=e,this.getMaterial=n,this._baseObjectKeys={},this._loadTiles={},this._add=null,this._layerLaodTime=new Date().getTime(),this._init()}formatBaseObjects(t,i){const n=this._opts,e=[],r=this.isAsynchronous();for(let s in i){const a=i[s]||{};let h;if(Array.isArray(a)?h=a:a.type==="FeatureCollection"&&(h=a.features),h&&h.length){const l=[],c=[],u=[];for(let f=0,d=h.length;f<d;f++){const p=h[f];if(Wn(p))l.push(p);else if(un(p)){const g=Ro(p);for(let m=0,v=g.length;m<v;m++)c.push(g[m])}else if(kE(p)){const g=Ro(p);for(let m=0,v=g.length;m<v;m++)u.push(yt.extend({},g[m].properties,g[m],{coordinate:qo(g[m])}))}}if(l.length){const f=this._getMaterial(s,l,t,a);if(f){const d=this._layer.toExtrudePolygons(l,yt.extend({},{topColor:"#fff",layerName:s,asynchronous:r,key:t},n),f);e.push(d)}}if(c.length){const f=this._getMaterial(s,c,t,a);if(f&&(f instanceof Bu||f instanceof yS)){const d=this._layer.toLines(c,yt.extend({},{layerName:s,asynchronous:r},n),f);e.push(d)}}if(u.length){const f=this._getMaterial(s,u,t,a);if(f&&f instanceof Em){const d=this._layer.toPoints(u,yt.extend({},{layerName:s,asynchronous:r},n),f);e.push(d)}}}}return e}loopMessage(t){const{currentQueue:i}=aA();i.length>0&&this.getTileData(t)}_init(){this.on("layerload",this._layerOnLoad),this.on("add",()=>{if(this._add===!1){const t=this.getBaseObjects();this._layer.addMesh(t)}this._add=!0,this.intervalId=setInterval(()=>{this._isLoad()&&!this._layer.getMap().isInteracting()&&this.fire("layerload")},1e3)}),this.on("remove",()=>{this._add=!1;const t=this.getBaseObjects();this._layer.removeMesh(t),clearInterval(this.intervalId)}),this.on("show",()=>{this.getBaseObjects().forEach(i=>{i.show()});for(let i in this._baseObjectKeys)(this._baseObjectKeys[i]||[]).forEach(e=>{e.show()})}),this.on("hide",()=>{this.getBaseObjects().forEach(i=>{i.hide()});for(let i in this._baseObjectKeys)(this._baseObjectKeys[i]||[]).forEach(e=>{e.hide()})}),this.on("renderercreate",t=>{t.renderer.loadTile=function(n){var e=this.layer.getTileSize(),r=new Image;return r.width=e.width,r.height=e.height,r.onload=this.onTileLoad.bind(this,r,n),r.onerror=this.onTileError.bind(this,r,n),this.loadTileImage(r,n.url,n.id),r},t.renderer.deleteTile=function(i){if(!i||!i.image)return;i.image.onload=null,i.image.onerror=null;const n=i.info||{};lA(n.id)},t.renderer.loadTileImage=(i,n,e)=>{i._key=e,hA(e,n,(r,s,a)=>{this._generateBaseObjects(r,s,a),cA(r,this)},i,this)}})}_getMaterial(t,i,n,e){return this.getMaterial&&yt.isFunction(this.getMaterial)?this.getMaterial(t,i,n,e):null}}function dA(o,t,i,n){const e=o/i,r=t/n,s=-o/2,a=t/2,h=-t/2,l=(i+1)*(n+1),c=new Float32Array(l*3),u=new Float32Array(l*2),f=new Float32Array(l*3),d=new Uint32Array(l*10);let p=0,g=0,m=0;for(let x=0;x<=n;x++)for(let _=0;_<=i;_++){const y=s+e*_,b=a-r*x;c[p]=y,c[p+1]=b,c[p+2]=0,f[p]=0,f[p+1]=0,f[p+2]=1;const M=(y-s)/o,C=(b-h)/t;if(u[g]=M,u[g+1]=C,p+=3,g+=2,_<i&&x<n){const w=x*(i+1)+_,S=w+1,P=(i+1)*(x+1)+_,O=P+1;d[m]=w,d[m+1]=P,d[m+2]=S,d[m+3]=P,d[m+4]=O,d[m+5]=S,m+=6}}const v=new Uint32Array(m);for(let x=0,_=v.length;x<_;x++)v[x]=d[x];return{position:c,uv:u,normal:f,indexs:v}}function by(o,t,i,n){const{position:e,uv:r,normal:s,indexs:a}=dA(o,t,i,n),h=new ae;return Nt(h,"position",new It(e,3)),Nt(h,"normal",new It(s,3)),Nt(h,"uv",new It(r,2)),h.setIndex(new It(a,1)),h}const pA=new bS,Zc=document.createElement("canvas"),$g=256;function gA(o,t=$g,i=$g){Zc.width=t,Zc.height=i;const n=Zc.getContext("2d");return n.drawImage(o,0,0,t,i),n.getImageData(0,0,t,i).data}function qg(o){if(!o)return null;let t;return typeof o=="string"?(t=new Image,t.src=o):o instanceof HTMLCanvasElement?(t=new Image,t.src=o.toDataURL()):o instanceof Image&&(t=new Image,t.src=o.src,t.crossOrigin=o.crossOrigin),t&&!t.crossOrigin&&(t.crossOrigin="Anonymous"),t}const mA=new Map;function Jg(o,t,i,n){if(!t||!i)return;const{imageWidth:e,imageHeight:r}=n;let s;if(o instanceof Uint32Array||o instanceof Uint8ClampedArray?s=o:s=gA(o,e,r),!s)return;let a=0;const h=new G,l=mA;for(let c=0,u=s.length;c<u;c+=4){const f=s[c],d=s[c+1],p=s[c+2],g=-1e4+(f*256*256+d*256+p)*.1;let m=0;const v=l.get(g);v!==void 0?m=v:(m=i.altitudeToVector3(g,g,null,h).x,l.set(g,m)),t.attributes.position.array[a*3+2]=m,a++}t.attributes.position.needsUpdate=!0}const vA={interactive:!1,altitude:0,image:null,imageWidth:256,imageHeight:256,texture:null};class Sy extends de{constructor(t,i,n,e){i=yt.extend({},vA,i,{layer:e,extent:t});const{texture:r,image:s,altitude:a,imageHeight:h,imageWidth:l}=i;t instanceof oe||(t=new oe(t));const{xmin:c,ymin:u,xmax:f,ymax:d}=t,p=[[c,u],[c,d],[f,d],[f,u]];let g=1/0,m=1/0,v=-1/0,x=-1/0;p.forEach(P=>{const O=e.coordinateToVector3(P),{x:D,y:L}=O;g=Math.min(D,g),m=Math.min(L,m),v=Math.max(D,v),x=Math.max(L,x)});const _=Math.abs(v-g),y=Math.abs(x-m),b=qg(s),M=qg(r),C=by(_,y,l-1,h-1);super(),this._initOptions(i),this._createMesh(C,n);const w=e.altitudeToVector3(a,a).x,S=e.coordinateToVector3(t.getCenter(),w);this.getObject3d().position.copy(S),n.transparent=!0,b&&(b.onload=()=>{Jg(b,C,e,{imageWidth:l,imageHeight:h})},b.onerror=function(){}),M?(n.opacity=0,pA.load(M.src,P=>{n.map=P,n.opacity=1,n.needsUpdate=!0})):n.opacity=1,this.type="Terrain"}updateData(t){const i=this.getObject3d().geometry,n=this.getLayer();return Jg(t,i,n,this.getOptions()),this}}const _A={scale:1,tileDivisor:4};class yA extends My{constructor(t,i={},n,e){super(yt.GUID(),yt.extend({urlTemplate:t},_A,i)),this._opts=i,this._layer=e,this.material=n,this._baseObjectKeys={},this._loadTiles={},this._add=null,this._imgQueue={},this._layerLaodTime=new Date().getTime(),this._init()}isAsynchronous(){return!1}formatBaseObjects(t,i){const n=this.options,e=[],{scale:r,tileDivisor:s}=n,{x:a,y:h,z:l}=this._getXYZOfIndex(t),c=this.getMap().getZoom(),u=this.getTileUrl(a,h,l),[f,d]=this.options.tileSize,p=this._getTileLngLatExtent(a,h,l),g=this.material.clone();if(l+1>=Math.round(c)){const m=new Sy(p,{image:i,imageWidth:f/s,imageHeight:d/s,texture:u},g,this._layer);m.getObject3d().scale.set(r,r,1),e.push(m)}return e}loopMessage(t){this.getTileData(t)}_init(){this.on("layerload",this._layerOnLoad),this.on("add",()=>{if(this._add===!1){const t=this.getBaseObjects();this._layer.addMesh(t)}this._add=!0,this.intervalId=setInterval(()=>{this._isLoad()&&!this._layer.getMap().isInteracting()&&this.fire("layerload")},1e3)}),this.on("remove",()=>{this._add=!1;const t=this.getBaseObjects();this._layer.removeMesh(t),clearInterval(this.intervalId)}),this.on("show",()=>{this.getBaseObjects().forEach(i=>{i.show()});for(let i in this._baseObjectKeys)(this._baseObjectKeys[i]||[]).forEach(e=>{e.show()})}),this.on("hide",()=>{this.getBaseObjects().forEach(i=>{i.hide()});for(let i in this._baseObjectKeys)(this._baseObjectKeys[i]||[]).forEach(e=>{e.hide()})}),this.on("renderercreate",t=>{t.renderer.loadTile=function(n){var e=this.layer.getTileSize(),r=new Image;return r.width=e.width,r.height=e.height,r.onload=this.onTileLoad.bind(this,r,n),r.onerror=this.onTileError.bind(this,r,n),this.loadTileImage(r,n.url,n.id),r},t.renderer.deleteTile=i=>{if(!i||!i.image)return;i.image.onload=null,i.image.onerror=null;const n=i.info||{},e=this._imgQueue[n.id];e&&(e.src="",e.onload=null,e.onerror=null,delete this._imgQueue[n.id])},t.renderer.loadTileImage=(i,n,e)=>{i._key=e;const r=new Image;this._imgQueue[e]=r;const s={key:e,url:n,rgbImage:r,callback:(a,h,l)=>{this._generateBaseObjects(a,h,l)},img:i,vt:this};this.loopMessage(s)}})}}/*!
 * Code from baidu mapv
 * License: BSD-3
 * https://github.com/huiyan-fe/mapv
 *
 */function Oi(o){o=o||{},this.gradient=o.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=o.maxSize||35,this.minSize=o.minSize||0,this.max=o.max||100,this.min=o.min||0,this.initPalette()}Oi.prototype.setMax=function(o){this.max=o||100};Oi.prototype.setMin=function(o){this.min=o||0};Oi.prototype.setMaxSize=function(o){this.maxSize=o||35};Oi.prototype.setMinSize=function(o){this.minSize=o||0};Oi.prototype.initPalette=function(){var o=this.gradient,t=Ko(256,1),i=this.paletteCtx=t.getContext("2d"),n=i.createLinearGradient(0,0,256,1);for(var e in o)n.addColorStop(parseFloat(e),o[e]);i.fillStyle=n,i.fillRect(0,0,256,1)};Oi.prototype.getColor=function(o){var t=this.getImageData(o);return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]/256+")"};Oi.prototype.getImageData=function(o){var t=this.paletteCtx.getImageData(0,0,256,1).data;if(o===void 0)return t;var i=this.max,n=this.min;o>i&&(o=i),o<n&&(o=n);var e=Math.floor((o-n)/(i-n)*(256-1))*4;return[t[e],t[e+1],t[e+2],t[e+3]]};Oi.prototype.getSize=function(o){var t=0,i=this.max,n=this.min,e=this.maxSize,r=this.minSize;if(o>i&&(o=i),o<n&&(o=n),i>n)t=r+(o-n)/(i-n)*(e-r);else return e;return t};Oi.prototype.getLegend=function(o){var t=this.gradient,i=o.width||20,n=o.height||180,e=Ko(i,n),r=e.getContext("2d"),s=r.createLinearGradient(0,n,0,0);for(var a in t)s.addColorStop(parseFloat(a),t[a]);return r.fillStyle=s,r.fillRect(0,0,i,n),e};/*!
 * Code from baidu mapv
 * License: BSD-3
 * https://github.com/huiyan-fe/mapv
 *
 */function xA(o){var t=o/2,i=o+t,n=1e4,e=Ko(i*2,i*2),r=e.getContext("2d");return r.shadowBlur=t,r.shadowColor="black",r.shadowOffsetX=r.shadowOffsetY=n,r.beginPath(),r.arc(i-n,i-n,o,0,Math.PI*2,!0),r.closePath(),r.fill(),e}function Cy(o,t,i){var n=Ty(i),e=wA(i),r=n-e,s=i.range||null,a=0,h=1024;s&&s.length===2&&(a=(s[0]-e)/r*1024),s&&s.length===2&&(h=(s[1]-e)/r*1024);for(var l=i.maxOpacity||.8,c=i.minOpacity||0,u=3,f=o.length,d;u<f;u+=4)d=o[u]*4,o[u]/256>l&&(o[u]=256*l),o[u]/256<c&&(o[u]=256*c),d&&d>=a&&d<=h?(o[u-3]=t[d],o[u-2]=t[d+1],o[u-1]=t[d+2]):o[u]=0}function Ty(o){var t=o.max||100;return t}function wA(o){var t=o.min||0;return t}function Py(o,t,i){var n=Ty(i),e=i._size||i.size||13,r=xA(e),s=r.width/2,a=r.height/2,h=t,l={};h.forEach(function(f){var d=f.count===void 0?1:f.count,p=Math.min(1,d/n).toFixed(2);l[p]=l[p]||[],l[p].push(f)});for(var c in l)if(!isNaN(c)){var u=l[c];o.beginPath(),i.withoutAlpha||(o.globalAlpha=c),u.forEach(function(f){var d=f.coordinate,p=f.count===void 0?1:f.count;o.globalAlpha=p/n,o.drawImage(r,d[0]-s,d[1]-a)})}}function MA(o,t,i){if(!(o.canvas.width<=0||o.canvas.height<=0)){var n=i.strength||.3;o.strokeStyle="rgba(0,0,0,"+n+")";var e=Ko(o.canvas.width,o.canvas.height),r=e.getContext("2d");r.scale(devicePixelRatio,devicePixelRatio),i=i||{},o.save();var s=new Oi({gradient:i.gradient});if(Py(r,t,i),!i.absolute){var a=r.getImageData(0,0,o.canvas.width,o.canvas.height);Cy(a.data,s.getImageData(),i),o.putImageData(a,0,0),o.restore()}s=null,e=null}}const Yg={draw:MA,drawGray:Py,colorize:Cy},bA={altitude:0,interactive:!1,min:0,max:100,size:13,gradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},gridScale:.5},Qg=2048;class SA extends de{constructor(t,i,n,e){Array.isArray(t)||(t=[t]);let r=1/0,s=1/0,a=-1/0,h=-1/0;const l=[];for(let z=0,Z=t.length;z<Z;z++){const{coordinate:j,lnglat:K,xy:et}=t[z],st=j||K||et;if(!st)continue;const V=e.coordinateToVector3(st);l.push(V);const{x:pt,y:xt}=V;r=Math.min(r,pt),s=Math.min(s,xt),a=Math.max(a,pt),h=Math.max(h,xt)}i=yt.extend({},bA,i,{layer:e,points:t});let{gridScale:c,altitude:u}=i;const f=Math.abs(a-r),d=Math.abs(h-s),p=Math.max(f*c,d*c);if(p>Qg){const z=p/c;c=Qg/z}const g=Math.ceil(f*c),m=Math.ceil(d*c),v=g/f,x=m/d,_=[];for(let z=0,Z=l.length;z<Z;z++){const j=l[z];j.x-=r,j.y-=s,j.x*=v,j.y*=x,j.y=m-j.y,_.push({coordinate:[j.x,j.y],count:t[z].count})}let y=Ko(g,m),b=y.getContext("2d");Yg.drawGray(b,_,i);const M=b.getImageData(0,0,b.canvas.width,b.canvas.height);let C=-1/0;const w=new Float32Array(M.data.length/4),S=new Float32Array(M.data.length/4);for(let z=3,Z=M.data.length,j=0;z<Z;z+=4){const K=M.data[z];C=Math.max(C,K),S[j]=K,K<=0&&(w[j]=1),j++}const P=new Oi({gradient:i.gradient});Yg.colorize(M.data,P.getImageData(),i),y=null,b=null;const O=by(f,d,g-1,m-1),D=O.getIndex().array,L=O.attributes.position.array,T=new Float32Array(L.length),A=new Uint32Array(L.length*6),N=new qt;let B=0;for(let z=0,Z=L.length,j=0,K=D.length,et=0,st=M.data.length,V=0;z<Math.max(Z,K,st);z+=3){if(z<Z){const pt=S[V];pt>0&&(L[z+2]=pt/C)}if(j<K){const pt=D[j],xt=D[j+1],ut=D[j+2];(!w[pt]||!w[xt]||!w[ut])&&(A[B]=pt,A[B+1]=xt,A[B+2]=ut,B+=3)}if(et<st){const pt=M.data[et],xt=M.data[et+1],ut=M.data[et+2],ft=`rgb(${pt},${xt},${ut})`;N.setStyle(ft),T[j]=N.r,T[j+1]=N.g,T[j+2]=N.b}j+=3,et+=4,V++}const F=new Uint32Array(B);for(let z=0;z<B;z++)F[z]=A[z];O.setIndex(new It(F,1)),Nt(O,"color",new It(T,3,!0)),n.vertexColors=Le(),super(),this._initOptions(i),this._createMesh(O,n);const I=e.altitudeToVector3(u,u).x;this.getObject3d().position.copy(new G((r+a)/2,(s+h)/2,I)),this.type="HeatMap"}}const Kg=new qt;let tm=1;class CA{constructor(t){this.object3ds=[],this.layer=t,this.camera=t.getCamera(),this.renderer=t.getThreeRenderer(),this.pickingTexture=new an(1,1),this.pickingScene=new Tm}getColor(){return Kg.setHex(tm),tm++,Kg}add(t){if(t){const i=t._colorIndex;i&&(this.object3ds[i]=t,this.pickingScene.add(t))}return this}remove(t){if(t){const i=t._colorIndex;i&&(this.object3ds[i]=null,this.pickingScene.remove(t))}return this}isEmpty(){if(this.pickingScene.children.length===0)return!0;for(let t=0,i=this.pickingScene.children.length;t<i;t++){const n=this.pickingScene.children[t];if(n){const e=n.__parent;if(e&&e.getOptions().interactive===!0)return!1}}return!0}pick(t){if(!t||this.isEmpty())return;const{camera:i,renderer:n,pickingTexture:e,pickingScene:r,object3ds:s,layer:a}=this,h=this.pickingScene.children.length;for(let b=0;b<h;b++){const M=this.pickingScene.children[b];M&&M.__parent&&(M.__parent.picked=!1)}const{width:l,height:c}=a._getRenderer().canvas,u=e.width,f=e.height;(l!==u||c!==f)&&e.setSize(l,c),n.setRenderTarget(e),n.clear(),i&&i.layers&&this.camera.layers.set(0),n.render(r,i);const d=new Uint8Array(4),{x:p,y:g}=t,m=window.devicePixelRatio,v=p*m,x=e.height-g*m;n.readRenderTargetPixels(e,Math.round(v),Math.round(x),1,1,d);const _=d[0]<<16|d[1]<<8|d[2],y=s[_];if(y)y.__parent&&(s[_].__parent.picked=!0);else for(let b=0;b<h;b++){const M=this.pickingScene.children[b];if(M&&M.__parent){const C=M.__parent;if(C._colorMap&&C._colorMap[_]!=null){C.picked=!0,C.index=C._colorMap[_];break}}}n.setRenderTarget(null)}}const TA={bottomHeight:0,altitude:0};class Ey extends de{constructor(t,i,n,e){i=yt.extend({},TA,i,{layer:e,lineString:t}),super(),this._initOptions(i);const{asynchronous:r}=i,{lineStrings:s,center:a}=Gs(t),h=new xs;let l;if(r){const d=yt.GUID();this.getOptions().id=d,this.getOptions().center=a,oy.push({id:d,data:s,lineString:t,center:a,layer:e,baseObject:this})}else{const d=[],p={};for(let g=0,m=s.length;g<m;g++){const v=Rr(s[g],e,a,!1).positions;qn(v,i.bottomHeight,e,p),d.push(ol(v))}l=al(d),h.setPositions(l)}this._setMaterialRes(e,n),this._createLine2(h,n);const{altitude:c}=i,u=e.altitudeToVector3(c,c).x,f=e.coordinateToVector3(a,u);this.getObject3d().position.copy(f),r||(this._setPickObject3d(l,n.linewidth),this._init()),this.type="FatLine"}_init(){const t=this.getLayer().getPick();this.on("add",()=>{t.add(this.pickObject3d)}),this.on("remove",()=>{t.remove(this.pickObject3d)})}_setMaterialRes(t,i){const e=t.getMap().getSize(),r=e.width,s=e.height;i.resolution.set(r,s)}_setPickObject3d(t,i){const n=new xs;n.setPositions(t);const r=this.getLayer().getPick().getColor(),s=[];for(let c=0,u=t.length/3;c<u;c++)s.push(r.r,r.g,r.b);n.setColors(s);const a=new il({color:"#fff",linewidth:i,vertexColors:Le()});this._setMaterialRes(this.getLayer(),a);const h=r.getHex(),l=new kf(n,a);l.position.copy(this.getObject3d().position),l._colorIndex=h,this.setPickObject3d(l)}identify(t){return this.picked}setSymbol(t){if(t&&t instanceof Gi){t.needsUpdate=!0;const i=this.getMap().getSize(),n=i.width,e=i.height;t.resolution.set(n,e),this.getObject3d().material=t}return this}_workerLoad(t){const i=new Float32Array(t.position),n=this.getObject3d();n.geometry.setPositions(i),n.computeLineDistances(),this._setPickObject3d(i,n.material.linewidth),this._init(),this.isAdd&&this.getLayer().getPick().add(this.pickObject3d),this._fire("workerload",{target:this})}}const PA={altitude:0,colors:null};class EA extends Dr(de){constructor(t,i,n,e){Array.isArray(t)||(t=[t]);const r=[],s=[],a=t.length;for(let b=0;b<a;b++){const M=t[b],C=Gs(M);r.push(C.center),s.push(C.lineStrings)}const h=Jo(r);i=yt.extend({},PA,i,{layer:e,lineStrings:t,coordinate:h}),super(),this._initOptions(i);const{asynchronous:l}=i,c=new xs,u=[],f={};let d=[],p=0,g=[],m,v;if(l)ay.push({id:yt.GUID(),data:s,key:i.key,center:h,layer:e,baseObject:this,lineStrings:t});else{for(let b=0;b<a;b++){const M=s[b];let C=0;for(let w=0,S=M.length;w<S;w++){const P=un(M[w])?M[w].properties:M[w].getProperties()||{},{positions:O}=Rr(M[w],e,h,!1);qn(O,P.bottomHeight,e,f),C+=O.length/3*2-2,g.push(ol(O))}d[b]={position:{count:C,start:p,end:p+C*3},instanceStart:{count:C,start:p,end:p+C*3},instanceEnd:{count:C,start:p,end:p+C*3},hide:!1},p+=C*3}m=al(g),c.setPositions(m)}this._setMaterialRes(e,n),this._createLine2(c,n);const{altitude:x}=i,_=e.altitudeToVector3(x,x).x,y=e.coordinateToVector3(h,_);this.getObject3d().position.copy(y),this._baseObjects=u,this._datas=t,this._geometriesAttributes=d,this.faceIndex=null,this.index=null,this._geometryCache=new xs,l||(v=new Float32Array(m),this._geometryCache.setPositions(v)),this._colorMap={},this.isHide=!1,this._initBaseObjectsEvent(u),l||(this._setPickObject3d(v,n.linewidth),this._init()),this.type="FatLines"}_setMaterialRes(t,i){const e=t.getMap().getSize(),r=e.width,s=e.height;i.resolution.set(r,s)}_setPickObject3d(t,i){if(!this._colorMap)return;const n=this._geometryCache||new xs;n.setPositions(t);const e=this.getLayer().getPick(),{_geometriesAttributes:r}=this,s=Bf(r);let a=0;for(let f=0,d=r.length;f<d;f++){const p=e.getColor(),g=p.getHex();this._colorMap[g]=f;const{count:m}=r[f].position;this._datas[f].colorIndex=g;for(let v=0;v<m;v++)s[a]=p.r,s[a+1]=p.g,s[a+2]=p.b,a+=3}n.setColors(s);const h=new il({color:"#fff",linewidth:i,vertexColors:Le()});this._setMaterialRes(this.getLayer(),h);const c=e.getColor().getHex(),u=new kf(n,h);u.position.copy(this.getObject3d().position),u._colorIndex=c,this.setPickObject3d(u)}identify(t){return this.picked}setSymbol(t){if(t&&t instanceof Gi){t.needsUpdate=!0;const i=this.getMap().getSize(),n=i.width,e=i.height;t.resolution.set(n,e),this.getObject3d().material=t}return this}getSelectMesh(){const t=this._getIndex();if(t!=null){if(!this._baseObjects[t]){const i=this._datas[t],n=yt.extend({},this.getOptions(),{index:t},un(i)?i.properties:i.getProperties());this._baseObjects[t]=new Ey(i,n,this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}}_updateAttribute(t,i){const{indexs:n}=this._getHideGeometryIndex(i),e=this._geometryCache.attributes[i].array,r=e.length;for(let a=0;a<r;a++)t.array[a]=e[a];let s=-1e5;for(let a=0;a<n.length;a++){const h=n[a],{start:l,end:c}=this._geometriesAttributes[h][i];for(let u=l;u<c;u++)t.array[u]=s}return this}_showGeometry(t,i){let n;if(t&&(n=t.getOptions().index),n!=null){const e=this._geometriesAttributes[n],{hide:r}=e;if(r===i)return this;e.hide=i;const s=this.getObject3d().geometry;this._updateAttribute(s.attributes.instanceStart,"instanceStart"),this._updateAttribute(s.attributes.instanceEnd,"instanceEnd"),s.attributes.instanceStart.data.needsUpdate=!0,s.attributes.instanceEnd.data.needsUpdate=!0,this.isHide=i}return this}_workerLoad(t){const{geometriesAttributes:i}=t;this._geometriesAttributes=i;const n=this.getObject3d(),e=new Float32Array(t.position),r=new Float32Array(e);n.geometry.setPositions(new Float32Array(e)),this._geometryCache.setPositions(r),this._setPickObject3d(r,n.material.linewidth),this._init(),this.isAdd&&this.getLayer().getPick().add(this.pickObject3d),this._fire("workerload",{target:this})}}const AA={radius:10,height:100,altitude:0,topColor:"",bottomColor:"#2d2f61",heightEnable:!0};class Ay extends de{constructor(t,i,n,e){i=yt.extend({},AA,i,{layer:e,coordinate:t}),super(),this._initOptions(i);const{height:r,radius:s,topColor:a,bottomColor:h,altitude:l}=i,c=e.altitudeToVector3(r,r).x,u=e.distanceToVector3(s,s).x,f=py().clone();f.scale(u*2,u*2,c),a&&(As(f,h,a,"z",c/2),n.vertexColors=Le()),this._createMesh(f,n);const d=e.altitudeToVector3(l,l).x,p=e.coordinateToVector3(t,d);this.getObject3d().position.copy(p),this.type="Box"}}const LA={radius:10,height:100,altitude:0,topColor:null,bottomColor:"#2d2f61"};class RA extends Dr(de){constructor(t,i,n,e){Array.isArray(t)||(t=[t]);const r=t.length,s=Jo(t),a=e.coordinateToVector3(s),h=[],l=[],c=[];let u=0;const f={},d={};for(let x=0;x<r;x++){const _=yt.extend({index:x},LA,t[x]),{radius:y,altitude:b,topColor:M,bottomColor:C,height:w,coordinate:S}=_,P=Dh(y,e,f),O=kn(w,e,d),D=kn(b,e,d),L=py().clone();L.scale(P*2,P*2,O),M&&(As(L,C,M,"z",O/2),n.vertexColors=Le());const T=e.coordinateToVector3(S).sub(a),A=L.attributes.position.array;for(let F=0,I=A.length;F<I;F+=3)A[F+2]+=D,A[F]+=T.x,A[F+1]+=T.y,A[F+2]+=T.z;h.push(L);const N=new Ay(S,_,n,e);l.push(N),L.index.count/3;const B=L.attributes.position.count;L.attributes.normal.count,L.attributes.uv.count,c[x]={position:{count:B,start:u,end:u+B*3},hide:!1},u+=B*3}super(),i=yt.extend({},{altitude:0,layer:e,points:t},i),this._initOptions(i);const p=dy(h);this._createMesh(p,n);const g=i.altitude,m=e.altitudeToVector3(g,g).x,v=a.clone();v.z=m,this.getObject3d().position.copy(v),this._baseObjects=l,this._datas=t,this._geometriesAttributes=c,this.faceIndex=null,this._geometryCache=Tr(p),this.isHide=!1,this._colorMap={},this._initBaseObjectsEvent(l),this._setPickObject3d(),this._init(),this.type="Boxs"}identify(t){return this.picked}}var Ly={exports:{}};Ly.exports=ll;Ly.exports.default=ll;function ll(o,t,i){i=i||2;var n=t&&t.length,e=n?t[0]*i:o.length,r=Ry(o,0,e,i,!0),s=[];if(!r||r.next===r.prev)return s;var a,h,l,c,u,f,d;if(n&&(r=zA(o,t,r,i)),o.length>80*i){a=l=o[0],h=c=o[1];for(var p=i;p<e;p+=i)u=o[p],f=o[p+1],u<a&&(a=u),f<h&&(h=f),u>l&&(l=u),f>c&&(c=f);d=Math.max(l-a,c-h),d=d!==0?32767/d:0}return zo(r,s,i,a,h,d,0),s}function Ry(o,t,i,n,e){var r,s;if(e===Lu(o,t,i,n)>0)for(r=t;r<i;r+=n)s=em(r,o[r],o[r+1],s);else for(r=i-n;r>=t;r-=n)s=em(r,o[r],o[r+1],s);return s&&cl(s,s.next)&&(No(s),s=s.next),s}function Pr(o,t){if(!o)return o;t||(t=o);var i=o,n;do if(n=!1,!i.steiner&&(cl(i,i.next)||xe(i.prev,i,i.next)===0)){if(No(i),i=t=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==t);return t}function zo(o,t,i,n,e,r,s){if(!!o){!s&&r&&HA(o,n,e,r);for(var a=o,h,l;o.prev!==o.next;){if(h=o.prev,l=o.next,r?DA(o,n,e,r):OA(o)){t.push(h.i/i|0),t.push(o.i/i|0),t.push(l.i/i|0),No(o),o=l.next,a=l.next;continue}if(o=l,o===a){s?s===1?(o=IA(Pr(o),t,i),zo(o,t,i,n,e,r,2)):s===2&&kA(o,t,i,n,e,r):zo(Pr(o),t,i,n,e,r,1);break}}}}function OA(o){var t=o.prev,i=o,n=o.next;if(xe(t,i,n)>=0)return!1;for(var e=t.x,r=i.x,s=n.x,a=t.y,h=i.y,l=n.y,c=e<r?e<s?e:s:r<s?r:s,u=a<h?a<l?a:l:h<l?h:l,f=e>r?e>s?e:s:r>s?r:s,d=a>h?a>l?a:l:h>l?h:l,p=n.next;p!==t;){if(p.x>=c&&p.x<=f&&p.y>=u&&p.y<=d&&ds(e,a,r,h,s,l,p.x,p.y)&&xe(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function DA(o,t,i,n){var e=o.prev,r=o,s=o.next;if(xe(e,r,s)>=0)return!1;for(var a=e.x,h=r.x,l=s.x,c=e.y,u=r.y,f=s.y,d=a<h?a<l?a:l:h<l?h:l,p=c<u?c<f?c:f:u<f?u:f,g=a>h?a>l?a:l:h>l?h:l,m=c>u?c>f?c:f:u>f?u:f,v=Eu(d,p,t,i,n),x=Eu(g,m,t,i,n),_=o.prevZ,y=o.nextZ;_&&_.z>=v&&y&&y.z<=x;){if(_.x>=d&&_.x<=g&&_.y>=p&&_.y<=m&&_!==e&&_!==s&&ds(a,c,h,u,l,f,_.x,_.y)&&xe(_.prev,_,_.next)>=0||(_=_.prevZ,y.x>=d&&y.x<=g&&y.y>=p&&y.y<=m&&y!==e&&y!==s&&ds(a,c,h,u,l,f,y.x,y.y)&&xe(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;_&&_.z>=v;){if(_.x>=d&&_.x<=g&&_.y>=p&&_.y<=m&&_!==e&&_!==s&&ds(a,c,h,u,l,f,_.x,_.y)&&xe(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;y&&y.z<=x;){if(y.x>=d&&y.x<=g&&y.y>=p&&y.y<=m&&y!==e&&y!==s&&ds(a,c,h,u,l,f,y.x,y.y)&&xe(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function IA(o,t,i){var n=o;do{var e=n.prev,r=n.next.next;!cl(e,r)&&Oy(e,n,n.next,r)&&Fo(e,r)&&Fo(r,e)&&(t.push(e.i/i|0),t.push(n.i/i|0),t.push(r.i/i|0),No(n),No(n.next),n=o=r),n=n.next}while(n!==o);return Pr(n)}function kA(o,t,i,n,e,r){var s=o;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&WA(s,a)){var h=Dy(s,a);s=Pr(s,s.next),h=Pr(h,h.next),zo(s,t,i,n,e,r,0),zo(h,t,i,n,e,r,0);return}a=a.next}s=s.next}while(s!==o)}function zA(o,t,i,n){var e=[],r,s,a,h,l;for(r=0,s=t.length;r<s;r++)a=t[r]*n,h=r<s-1?t[r+1]*n:o.length,l=Ry(o,a,h,n,!1),l===l.next&&(l.steiner=!0),e.push(VA(l));for(e.sort(FA),r=0;r<e.length;r++)i=NA(e[r],i);return i}function FA(o,t){return o.x-t.x}function NA(o,t){var i=BA(o,t);if(!i)return t;var n=Dy(i,o);return Pr(n,n.next),Pr(i,i.next)}function BA(o,t){var i=t,n=o.x,e=o.y,r=-1/0,s;do{if(e<=i.y&&e>=i.next.y&&i.next.y!==i.y){var a=i.x+(e-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>r&&(r=a,s=i.x<i.next.x?i:i.next,a===n))return s}i=i.next}while(i!==t);if(!s)return null;var h=s,l=s.x,c=s.y,u=1/0,f;i=s;do n>=i.x&&i.x>=l&&n!==i.x&&ds(e<c?n:r,e,l,c,e<c?r:n,e,i.x,i.y)&&(f=Math.abs(e-i.y)/(n-i.x),Fo(i,o)&&(f<u||f===u&&(i.x>s.x||i.x===s.x&&GA(s,i)))&&(s=i,u=f)),i=i.next;while(i!==h);return s}function GA(o,t){return xe(o.prev,o,t.prev)<0&&xe(t.next,o,o.next)<0}function HA(o,t,i,n){var e=o;do e.z===0&&(e.z=Eu(e.x,e.y,t,i,n)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==o);e.prevZ.nextZ=null,e.prevZ=null,UA(e)}function UA(o){var t,i,n,e,r,s,a,h,l=1;do{for(i=o,o=null,r=null,s=0;i;){for(s++,n=i,a=0,t=0;t<l&&(a++,n=n.nextZ,!!n);t++);for(h=l;a>0||h>0&&n;)a!==0&&(h===0||!n||i.z<=n.z)?(e=i,i=i.nextZ,a--):(e=n,n=n.nextZ,h--),r?r.nextZ=e:o=e,e.prevZ=r,r=e;i=n}r.nextZ=null,l*=2}while(s>1);return o}function Eu(o,t,i,n,e){return o=(o-i)*e|0,t=(t-n)*e|0,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,o|t<<1}function VA(o){var t=o,i=o;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==o);return i}function ds(o,t,i,n,e,r,s,a){return(e-s)*(t-a)>=(o-s)*(r-a)&&(o-s)*(n-a)>=(i-s)*(t-a)&&(i-s)*(r-a)>=(e-s)*(n-a)}function WA(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!jA(o,t)&&(Fo(o,t)&&Fo(t,o)&&ZA(o,t)&&(xe(o.prev,o,t.prev)||xe(o,t.prev,t))||cl(o,t)&&xe(o.prev,o,o.next)>0&&xe(t.prev,t,t.next)>0)}function xe(o,t,i){return(t.y-o.y)*(i.x-t.x)-(t.x-o.x)*(i.y-t.y)}function cl(o,t){return o.x===t.x&&o.y===t.y}function Oy(o,t,i,n){var e=ih(xe(o,t,i)),r=ih(xe(o,t,n)),s=ih(xe(i,n,o)),a=ih(xe(i,n,t));return!!(e!==r&&s!==a||e===0&&eh(o,i,t)||r===0&&eh(o,n,t)||s===0&&eh(i,o,n)||a===0&&eh(i,t,n))}function eh(o,t,i){return t.x<=Math.max(o.x,i.x)&&t.x>=Math.min(o.x,i.x)&&t.y<=Math.max(o.y,i.y)&&t.y>=Math.min(o.y,i.y)}function ih(o){return o>0?1:o<0?-1:0}function jA(o,t){var i=o;do{if(i.i!==o.i&&i.next.i!==o.i&&i.i!==t.i&&i.next.i!==t.i&&Oy(i,i.next,o,t))return!0;i=i.next}while(i!==o);return!1}function Fo(o,t){return xe(o.prev,o,o.next)<0?xe(o,t,o.next)>=0&&xe(o,o.prev,t)>=0:xe(o,t,o.prev)<0||xe(o,o.next,t)<0}function ZA(o,t){var i=o,n=!1,e=(o.x+t.x)/2,r=(o.y+t.y)/2;do i.y>r!=i.next.y>r&&i.next.y!==i.y&&e<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==o);return n}function Dy(o,t){var i=new Au(o.i,o.x,o.y),n=new Au(t.i,t.x,t.y),e=o.next,r=t.prev;return o.next=t,t.prev=o,i.next=e,e.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function em(o,t,i,n){var e=new Au(o,t,i);return n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function No(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Au(o,t,i){this.i=o,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ll.deviation=function(o,t,i,n){var e=t&&t.length,r=e?t[0]*i:o.length,s=Math.abs(Lu(o,0,r,i));if(e)for(var a=0,h=t.length;a<h;a++){var l=t[a]*i,c=a<h-1?t[a+1]*i:o.length;s-=Math.abs(Lu(o,l,c,i))}var u=0;for(a=0;a<n.length;a+=3){var f=n[a]*i,d=n[a+1]*i,p=n[a+2]*i;u+=Math.abs((o[f]-o[p])*(o[d+1]-o[f+1])-(o[f]-o[d])*(o[p+1]-o[f+1]))}return s===0&&u===0?0:Math.abs((u-s)/s)};function Lu(o,t,i,n){for(var e=0,r=t,s=i-n;r<i;r+=n)e+=(o[s]-o[r])*(o[r+1]+o[s+1]),s=r;return e}ll.flatten=function(o){for(var t=o[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,e=0;e<o.length;e++){for(var r=0;r<o[e].length;r++)for(var s=0;s<t;s++)i.vertices.push(o[e][r][s]);e>0&&(n+=o[e-1].length,i.holes.push(n))}return i};const XA=`(function(n){"use strict";
/*!
   * poly-extrude v0.1.0
    */var t={exports:{}};function r(n,t,r){r=r||2;var i,o,u,v,s,l,x,c=t&&t.length,d=c?t[0]*r:n.length,g=e(n,0,d,r,!0),y=[];if(!g||g.next===g.prev)return y;if(c&&(g=function(n,t,r,i){var a,o,u,v=[];for(a=0,o=t.length;a<o;a++)(u=e(n,t[a]*i,a<o-1?t[a+1]*i:n.length,i,!1))===u.next&&(u.steiner=!0),v.push(p(u));for(v.sort(h),a=0;a<v.length;a++)r=f(v[a],r);return r}(n,t,g,r)),n.length>80*r){i=u=n[0],o=v=n[1];for(var m=r;m<d;m+=r)(s=n[m])<i&&(i=s),(l=n[m+1])<o&&(o=l),s>u&&(u=s),l>v&&(v=l);x=0!==(x=Math.max(u-i,v-o))?32767/x:0}return a(g,y,r,i,o,x,0),y}function e(n,t,r,e,i){var a,o;if(i===z(n,t,r,e)>0)for(a=t;a<r;a+=e)o=Z(a,n[a],n[a+1],o);else for(a=r-e;a>=t;a-=e)o=Z(a,n[a],n[a+1],o);return o&&y(o,o.next)&&(F(o),o=o.next),o}function i(n,t){if(!n)return n;t||(t=n);var r,e=n;do{if(r=!1,e.steiner||!y(e,e.next)&&0!==g(e.prev,e,e.next))e=e.next;else{if(F(e),(e=t=e.prev)===e.next)break;r=!0}}while(r||e!==t);return t}function a(n,t,r,e,h,f,l){if(n){!l&&f&&function(n,t,r,e){var i=n;do{0===i.z&&(i.z=x(i.x,i.y,t,r,e)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,function(n){var t,r,e,i,a,o,u,v,s=1;do{for(r=n,n=null,a=null,o=0;r;){for(o++,e=r,u=0,t=0;t<s&&(u++,e=e.nextZ);t++);for(v=s;u>0||v>0&&e;)0!==u&&(0===v||!e||r.z<=e.z)?(i=r,r=r.nextZ,u--):(i=e,e=e.nextZ,v--),a?a.nextZ=i:n=i,i.prevZ=a,a=i;r=e}a.nextZ=null,s*=2}while(o>1)}(i)}(n,e,h,f);for(var p,c,d=n;n.prev!==n.next;)if(p=n.prev,c=n.next,f?u(n,e,h,f):o(n))t.push(p.i/r|0),t.push(n.i/r|0),t.push(c.i/r|0),F(n),n=c.next,d=c.next;else if((n=c)===d){l?1===l?a(n=v(i(n),t,r),t,r,e,h,f,2):2===l&&s(n,t,r,e,h,f):a(i(n),t,r,e,h,f,1);break}}}function o(n){var t=n.prev,r=n,e=n.next;if(g(t,r,e)>=0)return!1;for(var i=t.x,a=r.x,o=e.x,u=t.y,v=r.y,s=e.y,h=i<a?i<o?i:o:a<o?a:o,f=u<v?u<s?u:s:v<s?v:s,l=i>a?i>o?i:o:a>o?a:o,x=u>v?u>s?u:s:v>s?v:s,p=e.next;p!==t;){if(p.x>=h&&p.x<=l&&p.y>=f&&p.y<=x&&c(i,u,a,v,o,s,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function u(n,t,r,e){var i=n.prev,a=n,o=n.next;if(g(i,a,o)>=0)return!1;for(var u=i.x,v=a.x,s=o.x,h=i.y,f=a.y,l=o.y,p=u<v?u<s?u:s:v<s?v:s,d=h<f?h<l?h:l:f<l?f:l,y=u>v?u>s?u:s:v>s?v:s,m=h>f?h>l?h:l:f>l?f:l,w=x(p,d,t,r,e),M=x(y,m,t,r,e),b=n.prevZ,A=n.nextZ;b&&b.z>=w&&A&&A.z<=M;){if(b.x>=p&&b.x<=y&&b.y>=d&&b.y<=m&&b!==i&&b!==o&&c(u,h,v,f,s,l,b.x,b.y)&&g(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,A.x>=p&&A.x<=y&&A.y>=d&&A.y<=m&&A!==i&&A!==o&&c(u,h,v,f,s,l,A.x,A.y)&&g(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;b&&b.z>=w;){if(b.x>=p&&b.x<=y&&b.y>=d&&b.y<=m&&b!==i&&b!==o&&c(u,h,v,f,s,l,b.x,b.y)&&g(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;A&&A.z<=M;){if(A.x>=p&&A.x<=y&&A.y>=d&&A.y<=m&&A!==i&&A!==o&&c(u,h,v,f,s,l,A.x,A.y)&&g(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function v(n,t,r){var e=n;do{var a=e.prev,o=e.next.next;!y(a,o)&&m(a,e,e.next,o)&&b(a,o)&&b(o,a)&&(t.push(a.i/r|0),t.push(e.i/r|0),t.push(o.i/r|0),F(e),F(e.next),e=n=o),e=e.next}while(e!==n);return i(e)}function s(n,t,r,e,o,u){var v=n;do{for(var s=v.next.next;s!==v.prev;){if(v.i!==s.i&&d(v,s)){var h=A(v,s);return v=i(v,v.next),h=i(h,h.next),a(v,t,r,e,o,u,0),void a(h,t,r,e,o,u,0)}s=s.next}v=v.next}while(v!==n)}function h(n,t){return n.x-t.x}function f(n,t){var r=function(n,t){var r,e=t,i=n.x,a=n.y,o=-1/0;do{if(a<=e.y&&a>=e.next.y&&e.next.y!==e.y){var u=e.x+(a-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=i&&u>o&&(o=u,r=e.x<e.next.x?e:e.next,u===i))return r}e=e.next}while(e!==t);if(!r)return null;var v,s=r,h=r.x,f=r.y,x=1/0;e=r;do{i>=e.x&&e.x>=h&&i!==e.x&&c(a<f?i:o,a,h,f,a<f?o:i,a,e.x,e.y)&&(v=Math.abs(a-e.y)/(i-e.x),b(e,n)&&(v<x||v===x&&(e.x>r.x||e.x===r.x&&l(r,e)))&&(r=e,x=v)),e=e.next}while(e!==s);return r}(n,t);if(!r)return t;var e=A(r,n);return i(e,e.next),i(r,r.next)}function l(n,t){return g(n.prev,n,t.prev)<0&&g(t.next,n,n.next)<0}function x(n,t,r,e,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(n){var t=n,r=n;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==n);return r}function c(n,t,r,e,i,a,o,u){return(i-o)*(t-u)>=(n-o)*(a-u)&&(n-o)*(e-u)>=(r-o)*(t-u)&&(r-o)*(a-u)>=(i-o)*(e-u)}function d(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(n,t){var r=n;do{if(r.i!==n.i&&r.next.i!==n.i&&r.i!==t.i&&r.next.i!==t.i&&m(r,r.next,n,t))return!0;r=r.next}while(r!==n);return!1}(n,t)&&(b(n,t)&&b(t,n)&&function(n,t){var r=n,e=!1,i=(n.x+t.x)/2,a=(n.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(e=!e),r=r.next}while(r!==n);return e}(n,t)&&(g(n.prev,n,t.prev)||g(n,t.prev,t))||y(n,t)&&g(n.prev,n,n.next)>0&&g(t.prev,t,t.next)>0)}function g(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function y(n,t){return n.x===t.x&&n.y===t.y}function m(n,t,r,e){var i=M(g(n,t,r)),a=M(g(n,t,e)),o=M(g(r,e,n)),u=M(g(r,e,t));return i!==a&&o!==u||(!(0!==i||!w(n,r,t))||(!(0!==a||!w(n,e,t))||(!(0!==o||!w(r,n,e))||!(0!==u||!w(r,t,e)))))}function w(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function M(n){return n>0?1:n<0?-1:0}function b(n,t){return g(n.prev,n,n.next)<0?g(n,t,n.next)>=0&&g(n,n.prev,t)>=0:g(n,t,n.prev)<0||g(n,n.next,t)<0}function A(n,t){var r=new P(n.i,n.x,n.y),e=new P(t.i,t.x,t.y),i=n.next,a=t.prev;return n.next=t,t.prev=n,r.next=i,i.prev=r,e.next=r,r.prev=e,a.next=e,e.prev=a,e}function Z(n,t,r,e){var i=new P(n,t,r);return e?(i.next=e.next,i.prev=e,e.next.prev=i,e.next=i):(i.prev=i,i.next=i),i}function F(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function P(n,t,r){this.i=n,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function z(n,t,r,e){for(var i=0,a=t,o=r-e;a<r;a+=e)i+=(n[o]-n[a])*(n[a+1]+n[o+1]),o=a;return i}t.exports=r,t.exports.default=r,r.deviation=function(n,t,r,e){var i=t&&t.length,a=i?t[0]*r:n.length,o=Math.abs(z(n,0,a,r));if(i)for(var u=0,v=t.length;u<v;u++){var s=t[u]*r,h=u<v-1?t[u+1]*r:n.length;o-=Math.abs(z(n,s,h,r))}var f=0;for(u=0;u<e.length;u+=3){var l=e[u]*r,x=e[u+1]*r,p=e[u+2]*r;f+=Math.abs((n[l]-n[p])*(n[x+1]-n[l+1])-(n[l]-n[x])*(n[p+1]-n[l+1]))}return 0===o&&0===f?0:Math.abs((f-o)/o)},r.flatten=function(n){for(var t=n[0][0].length,r={vertices:[],holes:[],dimensions:t},e=0,i=0;i<n.length;i++){for(var a=0;a<n[i].length;a++)for(var o=0;o<t;o++)r.vertices.push(n[i][a][o]);i>0&&(e+=n[i-1].length,r.holes.push(e))}return r};var I=t.exports;function E(n){for(var t,r,e=0,i=1,a=n.length;i<a;)t=r||n[0],e+=((r=n[i])[0]-t[0])*(r[1]+t[1]),i++;return e>0}function L(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n}function H(n,t){var r=t[0],e=t[1],i=t[2],a=Math.sqrt(r*r+e*e+i*i)||1;return n[0]=r/a,n[1]=e/a,n[2]=i/a,n}function U(n,t){function r(n,t,r,e){n[0]=t,n[1]=r,n[2]=e}for(var e,i,a,o,u,v,s,h,f,l=[],x=[],p=[],c=[],d=[],g=[],y=n.length,m=new Float32Array(t.length),w=0;w<y;){var M=3*n[w],b=3*n[w+1],A=3*n[w+2];r(l,t[M],t[M+1],t[M+2]),r(x,t[b],t[b+1],t[b+2]),r(p,t[A],t[A+1],t[A+2]),L(d,p,x),L(c,l,x),e=g,a=c,o=void 0,u=void 0,v=void 0,s=void 0,h=void 0,f=void 0,o=(i=d)[0],u=i[1],v=i[2],s=a[0],h=a[1],f=a[2],e[0]=u*f-v*h,e[1]=v*s-o*f,e[2]=o*h-u*s;for(var Z=0;Z<3;Z++)m[M+Z]+=g[Z],m[b+Z]+=g[Z],m[A+Z]+=g[Z];w+=3}for(var F=0,P=m.length;F<P;)r(g,m[F],m[F+1],m[F+2]),H(g,g),m[F]=g[0]||0,m[F+1]=g[1]||0,m[F+2]=g[2]||0,F+=3;return m}function j(n){if(1===n.length)return{position:n[0].position,normal:n[0].normal,uv:n[0].uv,indices:n[0].indices,results:n};for(var t=0,r=0,e=0,i=n.length;e<i;e++){var a=n[e],o=a.position,u=a.indices;t+=o.length,r+=u.length}for(var v={position:new Float32Array(t),normal:new Float32Array(t),uv:new Float32Array(t/3*2),indices:new Uint32Array(r),results:n},s=0,h=0,f=0,l=0,x=0,p=n.length;x<p;x++){var c=n[x],d=c.position,g=c.indices,y=c.normal,m=c.uv;v.position.set(d,s),v.normal.set(y,s),v.uv.set(m,l);for(var w=0,M=g.length;w<M;){var b=g[w]+h;v.indices[f]=b,f++,w++}l+=m.length,s+=d.length,h+=d.length/3}return v}function O(n){return 180*n/Math.PI}function S(n){return n/180*Math.PI}function W(n,t,r,e,i,a){var o=3*r,u=3*e,v=3*i,s=3*a,h=t[o],f=t[o+1],l=t[o+2],x=t[u],p=t[u+1],c=t[u+2],d=t[v],g=t[v+1],y=t[v+2],m=t[s],w=t[s+1],M=t[s+2];Math.abs(f-p)<Math.abs(h-x)?(n.push(h,1-l),n.push(x,1-c),n.push(d,1-y),n.push(m,1-M)):(n.push(f,1-l),n.push(p,1-c),n.push(g,1-y),n.push(w,1-M))}function k(n,t){t=Object.assign({},{depth:2},t);var r=n.map((function(n){for(var r=0,e=n.length;r<e;r++){var i=n[r];B(i),0===r?E(i)||(n[r]=i.reverse()):E(i)&&(n[r]=i.reverse()),V(i)&&i.splice(i.length-1,1)}var a=function(n,t){for(var r=function(n){var t=0,r=0,e=n.length;for(;r<e;)t+=n[r].length,r++;return t}(n),e=n.length,i=[],a=new Float32Array(2*r),o=[],u=[],v=3*r,s=2*r,h=t.depth,f=0,l=0,x=0,p=0;p<e;p++){var c=n[p];p>0&&i.push(f/2);for(var d=0,g=c.length;d<g;){var y=c[d],m=y[0],w=y[1];a[f++]=m,a[f++]=w,o[l]=m,o[l+1]=w,o[l+2]=h,o[v+l]=m,o[v+l+1]=w,o[v+l+2]=0,u[x]=m,u[x+1]=w,u[s+x]=m,u[s+x+1]=w,l+=3,x+=2,d++}}return{flatVertices:a,holes:i,points:o,count:r,uvs:u}}(n,t);return a.polygon=n,function(n,t){for(var r=[],e=n.count,i=0,a=t.length;i<a;i+=3){var o=t[i],u=t[i+1],v=t[i+2];r[i]=o,r[i+1]=u,r[i+2]=v;var s=a+i,h=e+o,f=e+u,l=e+v;r[s]=h,r[s+1]=f,r[s+2]=l}n.index=r}(a,I(a.flatVertices,a.holes,2)),function(n,t){for(var r=n.points,e=n.index,i=n.polygon,a=n.uvs,o=t.depth,u=0,v=i.length;u<v;u++)for(var s=i[u],h=0,f=s.length;h<f;){var l=s[h],x=s[h+1];h===f-1&&(x=s[0]);var p=r.length/3,c=l[0],d=l[1],g=x[0],y=x[1];r.push(c,d,o,g,y,o,c,d,0,g,y,0);var m=p+2,w=p+3,M=p,b=p+1;e.push(m,M,w,M,b,w),W(a,r,m,w,M,b),h++}}(a,t),a.position=new Float32Array(a.points),a.indices=new Uint32Array(a.index),a.uv=new Float32Array(a.uvs),a.normal=U(a.indices,a.position),a})),e=j(r);return e.polygons=n,e}function B(n){V(n)||n.push(n[0])}function V(n){var t=n.length,r=n[0],e=r[0],i=r[1],a=n[t-1],o=a[0],u=a[1];return e===o&&i===u}function _(n,t){t=Object.assign({},{depth:2,lineWidth:1},t);var r=n.map((function(n){var r=function(n,t){var r=0,e=t.lineWidth/2,i=[],a=[],o=[],u=n.length,v=0;for(;v<u-1;){var s=n[v],h=n[v+1],f=h[1]-s[1],l=h[0]-s[0],x=0,p=O(Math.atan(f/l));if(r=p,0===v)x=p,x-=90;else{var c=n[v-1];q.x=c[0]-s[0],q.y=c[1]-s[1],R.x=h[0]-s[0],R.y=h[1]-s[1],x=p-D(q,R)/2}var d=C(S(x),e,s),g=d[0],y=d[1];i.push(g,y),G(g,s,h)?(a.push(g),o.push(y)):(a.push(y),o.push(g)),v++}var m=r,w=S(m-=90),M=n[u-2],b=n[u-1],A=C(w,e,b),Z=A[0],F=A[1];i.push(Z,F),G(Z,M,b)?(a.push(Z),o.push(F)):(a.push(F),o.push(Z));return{offsetPoints:i,leftPoints:a,rightPoints:o}}(n,t);return r.line=n,function(n,t){var r=t.depth,e=[],i=[],a=[],o=n.leftPoints,u=n.rightPoints,v=0,s=o.length;for(;v<s;){var h=3*v,f=o[v],l=f[0],x=f[1];e[h]=l,e[h+1]=x,e[h+2]=r;var p=u[v],c=p[0],d=p[1],g=3*s+h;e[g]=c,e[g+1]=d,e[g+2]=r;var y=2*s*3+h;e[y]=l,e[y+1]=x,e[y+2]=0;var m=2*s*3+3*s+h;e[m]=c,e[m+1]=d,e[m+2]=0,v++}v=0,s=e.length;for(;v<s;){var w=e[v],M=e[v+1];a.push(w,M),v+=3}v=0,s=o.length;for(;v<s-1;){var b=v,A=v+1,Z=b+s,F=A+s;i.push(b,Z,A),i.push(Z,F,A);var P=v+2*s,z=P+1,I=P+s,E=z+s;i.push(P,I,z),i.push(I,E,z),v++}n.index=i,n.points=e,n.uvs=a}(r,t),function(n,t){var r=n.points,e=n.index,i=n.leftPoints,a=n.rightPoints,o=n.uvs,u=t.depth,v=[i,a];function s(n,t){var i=r.length/3;r.push(n[0],n[1],u,t[0],t[1],u,n[0],n[1],0,t[0],t[1],0);var a=i+2,v=i+3,s=i,h=i+1;e.push(a,s,v,s,h,v),W(o,r,a,v,s,h)}for(var h=0,f=v.length;h<f;h++){var l=v[h];h>0&&(l=(l=l.map((function(n){return n}))).reverse());for(var x=0,p=l.length-1;x<p;){s(l[x],l[x+1]),x++}}for(var c=i.length,d=[a[0],i[0],i[c-1],a[c-1]],g=0;g<d.length;g+=2){s(d[g],d[g+1])}}(r,t),r.position=new Float32Array(r.points),r.indices=new Uint32Array(r.index),r.uv=new Float32Array(r.uvs),r.normal=U(r.indices,r.position),r})),e=j(r);return e.lines=n,e}var q={x:0,y:0},R={x:0,y:0};function C(n,t,r){var e=r[0],i=r[1],a=[e+Math.cos(n)*t,i+Math.sin(n)*t],o=n+=Math.PI;return[a,[e+Math.cos(o)*t,i+Math.sin(o)*t]]}var D=function(n,t){var r=n.x,e=n.y,i=t.x,a=t.y,o=r*i+e*a,u=r*a-e*i;return(Math.atan2(u,o)/Math.PI*180+360)%360};function G(n,t,r){var e=t[0],i=t[1],a=r[0],o=r[1];return(i-o)*n[0]+(a-e)*n[1]+e*o-a*i>0}function J(n,t){void 0===t&&(t={}),t=Object.assign({},{radius:1,height:2,radialSegments:6},t);for(var r=Math.round(Math.max(4,t.radialSegments)),e=t,i=e.radius,a=e.height,o=360/r/360*Math.PI*2,u=r+1,v=new Float32Array(3*u*2),s=n[0],h=n[1],f=0,l=0,x=3*u,p=2*u,c=[],d=[],g=-1;g<r;g++){var y=o*g,m=Math.cos(y)*i+s,w=Math.sin(y)*i+h;v[f]=m,v[f+1]=w,v[f+2]=0,v[f+x]=m,v[f+1+x]=w,v[f+2+x]=a;var M,b;M=.5+m/i/2,b=.5+w/i/2,d[l]=M,d[l+1]=b,d[l+p]=M,d[l+1+p]=b,f+=3,l+=2,g>1&&c.push(0,g-1,g)}v[f-=3]=v[0],v[f+1]=v[1],v[f+2]=v[2];var A=v.length;v[A-3]=v[0],v[A-2]=v[1],v[A-1]=a;for(var Z=c.length,F=0;F<Z;F++){var P=c[F];c.push(P+u)}var z=new Float32Array(2*(3*u*2-6)),I=-1;f=2*u,l=0;for(var E=0,L=v.length/2;E<L-3;E+=3){var H=v[E],j=v[E+1],O=v[E+3],S=v[E+4];z[++I]=H,z[++I]=j,z[++I]=a,z[++I]=O,z[++I]=S,z[++I]=a,z[++I]=H,z[++I]=j,z[++I]=0,z[++I]=O,z[++I]=S,z[++I]=0;var W=f+2,k=f+3,B=f,V=f+1;c.push(B,W,V,W,k,V),f+=4;var _=l/u,q=(l+1)/u;d.push(_,a/i/2,q,a/i/2,_,0,q,0),l++}var R=new Float32Array(v.length+z.length);R.set(v,0),R.set(z,v.length);var C=U(c,R);return{points:v,indices:new Uint32Array(c),position:R,normal:C,uv:new Float32Array(d)}}var K={x:0,y:0},N={x:0,y:0};function Q(n,t,r,e){for(var i=n.length,a=0;a<i;a++){var o=n[a].data;t=n[a].center||t;for(var u=0,v=o.length;u<v;u++)for(var s=o[u],h=0,f=s.length;h<f;h++)n[a].data[u][h]=T(s[h],t,r,e)}}function T(n,t,r,e){for(var i,a=[],o=0,u=(i=r?new Float64Array(n):new Float32Array(n)).length;o<u;o+=2){var v=i[o],s=i[o+1];if(t&&r&&e){K.x=v,K.y=s;var h=un(K,N);K.x=h.x,K.y=h.y,v=(h=vn(e,K,r,N)).x,s=h.y,v-=t[0],s-=t[1]}a.push([v,s])}return a}function X(n,t){void 0===t&&(t=!1);for(var r=n.length,e=[],i=[],a=0,o=0;o<r;o++){var u=t?$(n[o]):Y(n[o]),v=n[o].bottomHeight||0,s=u.position;i.push(u);var h=s.length/3;e[o]={position:{middleZ:v+(n[o].height||0)/2,count:h,start:a,end:a+3*h},hide:!1},a+=3*h}var f=tn(i),l=f.position,x=f.normal,p=f.uv,c=f.indices;return{position:l.buffer,normal:x.buffer,uv:p.buffer,indices:c.buffer,geometriesAttributes:e}}function Y(n){var t=n.data,r=n.height,e=n.bottomHeight,i=k(t,{depth:r}),a=i.position,o=i.normal,u=i.uv,v=i.indices;return rn(a,e),{position:a,normal:o,uv:u,indices:v}}function $(n){var t=n.data,r=n.height,e=n.width,i=n.bottomHeight,a=_(t,{lineWidth:e,depth:r}),o=a.position,u=a.normal,v=a.uv,s=a.indices;return rn(o,i),{position:o,normal:u,uv:v,indices:s}}function nn(n,t){for(var r=new Float32Array(t),e=0,i=0;i<n.length;++i)r.set(n[i],e),e+=n[i].length;return r}function tn(n){for(var t={},r={},e=0;e<n.length;++e){var i=n[e];for(var a in i)void 0===t[a]&&(t[a]=[],r[a]=0),t[a].push(i[a]),r[a]+=i[a].length}var o={},u=0,v=[];for(var s in t)if("indices"===s)for(var h=t[s],f=0,l=h.length;f<l;f++){for(var x=h[f],p=0,c=x.length;p<c;p++)v.push(x[p]+u);u+=t.position[f].length/3}else{var d=nn(t[s],r[s]);if(!d)return null;o[s]=d}return o.indices=new Uint32Array(v),o}function rn(n,t){if(void 0!==t&&"number"==typeof t&&0!==t)for(var r=0,e=n.length;r<e;r+=3)n[r+2]+=t}function en(n){for(var t=[],r=0,e=n.length;r<e;r+=7){var i=n[r],a=n[r+1],o=n[r+2],u=n[r+3],v=n[r+4],s=n[r+5];t.push({radialSegments:o,radius:u,height:v,altitude:s,center:[i,a]})}for(var h=t.length,f=[],l=[],x=0,p=0;p<h;p++){var c=J(t[p].center||[0,0],t[p]),d=c.position;if(t[p].altitude)for(var g=t[p].altitude,y=0,m=d.length;y<m;y+=3)c[y+2]+=g;l.push(c);var w=d.length/3;f[p]={position:{middleZ:t[p].height/2,count:w,start:x,end:x+3*w},hide:!1},x+=3*w}var M=tn(l),b=M.position,A=M.normal,Z=M.uv,F=M.indices;return{position:b.buffer,normal:A.buffer,uv:Z.buffer,indices:F.buffer,geometriesAttributes:f}}var an=Math.PI/180,on=6378137*Math.PI/180;function un(n,t){var r,e=85.0511287798,i=n.x,a=Math.max(Math.min(e,n.y),-e);r=0===a?0:Math.log(Math.tan((90+a)*an/2))/an;var o=i*on,u=r*on;return t?(t.x=o,t.y=u,t):{x:o,y:u}}function vn(n,t,r,e){var i=n[0]*(t.x-n[2])/r,a=-n[1]*(t.y-n[3])/r;return e?(e.x=i,e.y=a,e):{x:i,y:a}}function sn(n){void 0===n&&(n=[]);for(var t=n.length,r=new Float32Array(3*t),e=0;e<t;e++){var i=n[e],a=3*e;r[a]=i[0],r[a+1]=i[1]}return r}function hn(n){for(var t=new Float32Array(2*n.length-6),r=0,e=0,i=n.length/3;e<i;e++){var a=n[3*e],o=n[3*e+1],u=n[3*e+2];if(e>0&&e<i-1){var v=3*r;t[v]=a,t[v+1]=o,t[v+2]=u,r++}var s=3*r;t[s]=a,t[s+1]=o,t[s+2]=u,r++}return t}function fn(n){var t=0,r=n.length;if(1===r)return n[0];for(var e=0;e<r;e++)t+=n[e].length;for(var i=new Float32Array(t),a=0,o=0;o<r;o++)i.set(n[o],a),a+=n[o].length;return i}n.initialize=function(){},n.onmessage=function(n,t){var r=n.data,e=r.type,i=r.datas,a=r.glRes,o=r.matrix,u=r.center;if("ExtrudePolygons"===e){Q(i,u,a,o);var v=X(i);t(null,v,[v.position,v.normal,v.uv,v.indices])}else if("ExtrudeLines"===e){for(var s=0,h=i.length;s<h;s++)for(var f=0,l=i[s].data.length;f<l;f++)i[s].data[f]=T(i[s].data[f],i[s].center||u,a,o);var x=X(i,!0);t(null,x,[x.position,x.normal,x.uv,x.indices])}else if("ExtrudePolygon"===e){var p=[],c=[];i.forEach((function(n){var t=[n];Q(t,u,a,o);var r=X(t),e=r.position,i=r.normal,v=r.uv,s=r.indices;p.push({id:n.id,position:e,normal:i,uv:v,indices:s}),c.push(e,i,v,s)})),t(null,p,c)}else if("Line"===e||"FatLine"===e){for(var d=[],g=[],y=0,m=i.length;y<m;y++){for(var w=[],M=0,b=i[y].data.length;M<b;M++){i[y].data[M]=T(i[y].data[M],i[y].center||u,a,o);var A=sn(i[y].data[M]);w.push(hn(A))}var Z=fn(w);rn(Z,i[y].bottomHeight),d.push({id:i[y].id,position:Z.buffer}),g.push(Z.buffer)}t(null,d,g)}else if("Lines"===e||"FatLines"===e){for(var F=0,P=[],z=[],I=0,E=[],L=0,H=i.length;L<H;L++){for(var U=0,j=0,O=i[L].data.length;j<O;j++){i[L].data[j]=T(i[L].data[j],i[L].center||u,a,o);var S=sn(i[L].data[j]);rn(S,i[L].bottomHeight),U+=S.length/3*2-2,E.push(hn(S))}var W=U;P[L]=[F,F+W],F+=W,z[L]={position:{count:U,start:I,end:I+3*U},hide:!1},"FatLines"===e&&(z[L].instanceStart={count:U,start:I,end:I+3*U},z[L].instanceEnd={count:U,start:I,end:I+3*U}),I+=3*U}var k=fn(E);t(null,{id:i.id,position:k.buffer,geometriesAttributes:z,faceMap:P},[k.buffer])}else if("ExtrudeLine"===e){for(var B=0,V=i.length;B<V;B++)for(var _=0,q=i[B].data.length;_<q;_++)i[B].data[_]=T(i[B].data[_],i[B].center||u,a,o);var R=[],C=[];i.forEach((function(n){var t=X([n],!0),r=t.position,e=t.normal,i=t.uv,a=t.indices;R.push({id:n.id,position:r,normal:e,uv:i,indices:a}),C.push(r,e,i,a)})),t(null,R,C)}else if("Bar"===e){for(var D=[],G=[],J=(i=new Float32Array(i)).length/7,K=0;K<J;){var N=i.slice(7*K,7*(K+1)),Y=en(N),$=Y.position,nn=Y.normal,tn=Y.uv,an=Y.indices;D.push({id:parseInt(N[6]),position:$,normal:nn,uv:tn,indices:an}),G.push($,nn,tn,an),K++}t(null,D,G)}else if("Bars"===e){var on=en(i=new Float32Array(i));t(null,on,[on.position,on.normal,on.uv,on.indices])}},Object.defineProperty(n,"__esModule",{value:!0})})`,$A="__maptalks.three__";function qA(){return $A}function JA(){return XA}const YA="__maptalks.three.fetchdata__";function QA(o){const t=[],i=[];o.initialize=function(){},o.onmessage=function(s,a){const l={url:s.data,postResponse:a,abort:!1};e(l)};function e(s){s.abort?(i.splice(i.indexOf(s),1),t.length&&(i.push(t[0]),t.splice(0,1),r(i[i.length-1]))):i.length<5?(i.push(s),r(s)):t.push(s)}function r(s){fetch(s.url).then(a=>a.text()).then(a=>{new Blob([a],{type:"application/json"}).arrayBuffer().then(l=>{s.postResponse(null,l,[l]),s.abort=!0,e(s)})}).catch(a=>{s.abort=!0,e(s)})}}const KA={renderer:"gl",doubleBuffer:!1,glOptions:null,geometryEvents:!0,identifyCountOnEvent:0,forceRenderOnZooming:!0,loopRenderCount:50},t3=Math.PI/180,im=[[4e3,220],[2e3,100],[1e3,30],[500,15],[100,5],[50,2],[10,1],[5,.7],[2,.1],[1,.05],[.5,.02],[.4,.01],[.1,.005],[.05,.002],[.01,.001]],nm=["mouseout","mousemove","click","mousedown","mouseup","dblclick","contextmenu","touchstart","touchmove","touchend"],Qi=new q(0,0),Xc=new W(0,0),$c="__webglFramebuffer";class Uf extends Kh{constructor(t,i){super(t,i),this._animationBaseObjectMap={},this._needsUpdate=!0,this._mousemoveTimeOut=0,this._mousedownTime=0,this._baseObjects=[],this._delayMeshes=[],this.type="ThreeLayer"}isMercator(){const t=this.getMap();if(!t)return!1;const i=t.getSpatialReference(),n=i._projection,e=i._resolutions;return!!(n&&n.code==="EPSG:3857"&&e&&e.length&&Math.floor(e[0])===156543&&t.getGLRes)}isRendering(){const t=this.getMap();return t?t.isInteracting()||t.isAnimating():!1}prepareToDraw(...t){}draw(t,i,n,e,r,s){this.renderScene(s,this)}drawOnInteracting(t,i,n,e,r,s,a){this.renderScene(a,this)}coordinateToVector3(t,i=0,n){const e=this.getMap();if(!e)return null;const r=Array.isArray(t);r?(Qi.x=t[0],Qi.y=t[1]):t instanceof q||(t=new q(t));const s=oo(e),a=ao(e,r?Qi:t,s,Xc);return n&&(n.x=a.x,n.y=a.y,n.z=i),new G(a.x,a.y,i)}coordinatiesToGLFloatArray(t,i){const n=this.getMap();if(!n)return null;const e=oo(n),r=t.length,s=new Float32Array(r*2),a=new Float32Array(r*3);for(let h=0;h<r;h++){let l=t[h];const c=Array.isArray(l);c?(Qi.x=l[0],Qi.y=l[1]):l instanceof q||(l=new q(l));const u=ao(n,c?Qi:l,e,Xc);u.x-=i.x,u.y-=i.y;const f=h*2;s[f]=u.x,s[f+1]=u.y;const d=h*3;a[d]=u.x,a[d+1]=u.y,a[d+2]=0}return{positions:a,positons2d:s}}coordinatiesToGLArray(t,i){const n=this.getMap();if(!n)return null;const e=oo(n),r=t.length,s=new Array(r);for(let a=0;a<r;a++){let h=t[a];const l=Array.isArray(h);l?(Qi.x=h[0],Qi.y=h[1]):h instanceof q||(h=new q(h));const c=ao(n,l?Qi:h,e,Xc);c.x-=i.x,c.y-=i.y,s[a]=[c.x,c.y]}return s}distanceToVector3(t,i,n){if(t===0&&i===0||!yt.isNumber(t)||!yt.isNumber(i))return new G(0,0,0);const e=this.getMap(),r=oo(e);let s=n||e.getCenter();s instanceof q||(s=new q(s));const a=e.locate(s,t,i),h=ao(e,s,r),l=ao(e,a,r),c=Math.abs(l.x-h.x)*yt.sign(t),u=Math.abs(l.y-h.y)*yt.sign(i);return new G(c,u,0)}altitudeToVector3(t,i,n,e){if(t===0||!yt.isNumber(t))return new G(0,0,0);const r=this.getMap();if(r.altitudeToPoint){const s=oo(r);let a=r.altitudeToPoint(t,s);return t<0&&a>0&&(a=-a),e?(e.x=a,e.y=a,e.z=0,e):new G(a,a,0)}return this.distanceToVector3(t,t,n)}toShape(t){if(!t)return null;if(t instanceof Es)return t.getGeometries().map(h=>this.toShape(h));const i=t.getCenter(),n=this.coordinateToVector3(i),r=t.getShell().map(h=>{const l=this.coordinateToVector3(h).sub(n);return new bt(l.x,l.y)}),s=new su(r),a=t.getHoles();return a&&a.length>0&&(s.holes=a.map(h=>{const l=h.map(c=>{const u=this.coordinateToVector3(c).sub(n);return new bt(u.x,u.y)});return new su(l)})),s}toExtrudeMesh(t,i,n,e){if(!t)return null;if(t instanceof Es)return t.getGeometries().map(p=>this.toExtrudeMesh(p,i,n,e));const r=t.getCoordinates();r.forEach(p=>{const g=p.length;for(let m=g-1;m>=1;m--)p[m].equals(p[m-1])&&p.splice(m,1)}),t.setCoordinates(r);const s=this.toShape(t),a=this.coordinateToVector3(t.getCenter());e=yt.isNumber(e)?e:i,e=this.altitudeToVector3(e,e).x;const h=this.altitudeToVector3(i,i).x,l={bevelEnabled:!1,bevelSize:1},c=parseInt(Go)>=93?"depth":"amount";l[c]=e;const u=new Wu(s,l);let f=u;ae.prototype.fromGeometry&&(f=new ae,f.fromGeometry(u));const d=new ei(f,n);return d.position.set(a.x,a.y,h-e),d}toExtrudePolygon(t,i,n){return new vy(t,i,n,this)}toBar(t,i,n){return new Tu(t,i,n,this)}toLine(t,i,n){return new gy(t,i,n,this)}toExtrudeLine(t,i,n){return new my(t,i,n,this)}toModel(t,i){return new N2(t,i,this)}toExtrudeLineTrail(t,i,n){return new $2(t,i,n,this)}toExtrudePolygons(t,i,n){return new Q2(t,i,n,this)}toPoint(t,i,n){return new xy(t,i,n,this)}toPoints(t,i,n){return new eA(t,i,n,this)}toBars(t,i,n){return new iA(t,i,n,this)}toExtrudeLines(t,i,n){return new nA(t,i,n,this)}toLines(t,i,n){return new sA(t,i,n,this)}toThreeVectorTileLayer(t,i,n){return new fA(t,i,n,this)}toTerrain(t,i,n){return new Sy(t,i,n,this)}toTerrainVectorTileLayer(t,i,n){return new yA(t,i,n,this)}toHeatMap(t,i,n){return new SA(t,i,n,this)}toFatLine(t,i,n){return new Ey(t,i,n,this)}toFatLines(t,i,n){return new EA(t,i,n,this)}toBox(t,i,n){return new Ay(t,i,n,this)}toBoxs(t,i,n){return new RA(t,i,n,this)}getBaseObjects(){return this.getMeshes().filter(t=>t instanceof de)}getMeshes(){const t=this.getScene();if(!t)return[];const i=[];for(let n=0,e=t.children.length;n<e;n++){const r=t.children[n];r instanceof Te&&!(r instanceof fh)&&i.push(r.__parent||r)}return i}clear(){return this.clearMesh()}clearMesh(){const t=this.getScene();if(!t)return this;for(let i=t.children.length-1;i>=0;i--){const n=t.children[i];if(n instanceof Te&&!(n instanceof fh)){t.remove(n);const e=n.__parent;e&&e instanceof de&&(e.isAdd=!1,e.options.layer=null,e._fire("remove",{target:e}),delete this._animationBaseObjectMap[n.uuid],e._hideUI())}}return this}lookAt(t){const i=this._getRenderer();return i&&i.context.lookAt(t),this}getCamera(){const t=this._getRenderer();return t?t.camera:null}getScene(){const t=this._getRenderer();return t?t.scene:null}renderScene(t,i){const n=this._getRenderer();return n&&(n.clearCanvas(),n.renderScene(t),i||n.setToRedraw()),this}loop(t=!1){const i=this._delayMeshes;if(!i.length)return;const n=this.getMap();if(!n||n.isAnimating()||n.isInteracting())return;const e=this.options.loopRenderCount||50,r=i.slice(0,e);r&&this.addMesh(r,t),i.splice(0,e)}renderPickScene(){const t=this._getRenderer();if(t){const i=t.pick;i&&i.pick(this._containerPoint)}return this}getThreeRenderer(){const t=this._getRenderer();return t?t.context:null}getPick(){const t=this._getRenderer();return t?t.pick:null}delayAddMesh(t){if(!t)return this;Array.isArray(t)||(t=[t]);for(let i=0,n=t.length;i<n;i++)this._delayMeshes.push(t[i]);return this}addMesh(t,i=!0){if(!t)return this;Array.isArray(t)||(t=[t]);const n=this.getScene();if(t.forEach(e=>{e instanceof de?(n.add(e.getObject3d()),e.isAdd||(e.isAdd=!0,e.options.layer=this,e._fire("add",{target:e})),e._animation&&yt.isFunction(e._animation)&&(this._animationBaseObjectMap[e.getObject3d().uuid]=e)):e instanceof Te&&n.add(e)}),this._zoomend(),i){const e=this._getRenderer();e&&e.setToRedraw()}return this}removeMesh(t,i=!0){if(!t)return this;Array.isArray(t)||(t=[t]);const n=this.getScene();if(t.forEach(e=>{if(e instanceof de){n.remove(e.getObject3d()),e.isAdd&&(e.isAdd=!1,e.options.layer=null,e._fire("remove",{target:e}),e._hideUI()),e._animation&&yt.isFunction(e._animation)&&delete this._animationBaseObjectMap[e.getObject3d().uuid];const r=this._delayMeshes;if(r.length){for(let s=0,a=r.length;s<a;s++)if(r[s]===e){r.splice(s,1);break}}}else e instanceof Te&&n.remove(e)}),i){const e=this._getRenderer();e&&e.setToRedraw()}return this}_initRaycaster(){return this._raycaster||(this._raycaster=new AS,this._mouse=new bt),this}getRaycaster(){return this._raycaster}identify(t,i){if(!t)return[];if(Array.isArray(t)&&(t=new q(t)),!(t instanceof q))return[];const n=this.getMap().coordToContainerPoint(t);this._containerPoint=n;const{x:e,y:r}=n;this._initRaycaster(),this.fire("identify",{coordinate:t,options:i});const s=this._raycaster,a=this._mouse,h=this.getCamera(),l=this.getScene(),c=this.getMap().getSize();if(!l)return[];const u=c.width,f=c.height;a.x=e/u*2-1,a.y=-(r/f)*2+1,s.setFromCamera(a,h),s.layers&&s.layers.enableAll&&s.layers.enableAll(),RE(s,this._getLinePrecision(this.getMap().getResolution()));const d=[],p=[];l.children.forEach(_=>{const y=_.__parent;if(y&&y.getOptions){const b=y;b.getOptions().interactive&&b.isVisible()&&(b.identify&&yt.isFunction(b.identify)?p.push(b):d.push(_))}else(_ instanceof ei||_ instanceof ls)&&d.push(_)});let g=[];const m=s.intersectObjects(d,!0);m&&Array.isArray(m)&&m.length&&(g=m.map(_=>{let y=_.object;const b=_.instanceId;y=this._recursionMesh(y)||{};const M=y.__parent||y;return M.faceIndex=_.faceIndex,M.index=_.index,M.intersect=_,yt.isNumber(b)&&(M.instanceId=b),M})),this.renderPickScene(),p.length&&p.forEach(_=>{_.identify(t)&&g.push(_)});const v=g.length;for(let _=0;_<v;_++)if(g[_])for(let y=_+1;y<v;y++)g[_]===g[y]&&g.splice(y,1);i=yt.extend({},i);const x=i.count;return yt.isNumber(x)&&x>0?g.slice(0,x):g}_recursionMesh(t){for(;t&&t.parent!==this.getScene();)t=t.parent;return t}_getLinePrecision(t=10){for(let i=0,n=im.length;i<n;i++){const[e,r]=im[i];if(t>e)return r}return .01}_identifyBaseObjectEvents(t){if(!this.options.geometryEvents)return this;const i=this.map||this.getMap();if(i.isInteracting()||!i.options.geometryEvents||i._ignoreEvent(t))return this;const n=t.type,e=i._getEventParams?i._getEventParams(t):this._getEventParams(t);e.type=n;const{type:r,coordinate:s}=e,a=yt.now();if(this._mousemoveTimeOut&&r==="mousemove"&&a-this._mousemoveTimeOut<64)return this;this._mousemoveTimeOut=a,(r==="mousedown"||r==="touchstart")&&(this._mousedownTime=yt.now());let h=!1;if(r==="click"||r==="touchend"){const g=i.options.clickTimeThreshold||280;h=yt.now()-this._mousedownTime<g}if(r==="click"&&!h)return this;const l=this.options.identifyCountOnEvent;let c=Math.max(0,yt.isNumber(l)?l:0);c===0&&(c=1/0);const u=g=>{const m=[];this._baseObjects&&this._baseObjects.forEach(v=>{let x=!0;g.forEach(_=>{v===_&&(x=!1)}),x&&m.push(v)}),m.forEach(v=>{v&&v instanceof de&&(v.getSelectMesh?v.isHide||(v._mouseover=!1,v.fire("mouseout",Object.assign({},e,{target:v,type:"mouseout",selectMesh:null})),v.closeToolTip()):(v._mouseover=!1,v.fire("mouseout",Object.assign({},e,{target:v,type:"mouseout"})),v.closeToolTip()))})};if(r==="mouseout")return u([]),this._baseObjects=[],this;const f=this.identify(s,{count:c}),d=this.getScene();if(f.length===0&&d)for(let g=0,m=d.children.length;g<m;g++){const x=(d.children[g]||{}).__parent;x&&x.fire("empty",Object.assign({},e,{target:x}))}function p(g,m){m=m||r;const v=g.getInfoWindow();v&&!v._owner&&v.addTo(g),((v?v.options:{}).autoOpenOn||"click")===m&&(g.openInfoWindow(s),g.fire("showinfowindow",{infoWindow:v}))}if(r==="mousemove"?(u(f),f.forEach(g=>{if(g instanceof de){g._mouseover||(g.fire("mouseover",Object.assign({},e,{target:g,type:"mouseover",selectMesh:g.getSelectMesh?g.getSelectMesh():null})),g._mouseover=!0,p(g,"mouseover")),g.fire(r,Object.assign({},e,{target:g,selectMesh:g.getSelectMesh?g.getSelectMesh():null}));const m=g.getToolTip();m&&!m._owner&&m.addTo(g),g.openToolTip(s),p(g)}}),this._baseObjects=f):f.forEach(g=>{g instanceof de&&(g.fire(r,Object.assign({},e,{target:g,selectMesh:g.getSelectMesh?g.getSelectMesh():null})),p(g))}),r==="touchend"&&h){const g=yt.extend({},e,{domEvent:t});f.forEach(m=>{m instanceof de&&(m.fire("click",Object.assign({},g,{target:m,selectMesh:m.getSelectMesh?m.getSelectMesh():null})),p(m,"click"))})}return this}_getEventParams(t){const i=this.getMap(),n={domEvent:t};if(!i)return n;const e=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(e){const r=pc.getEventContainerPoint,s=r(e,i._containerDOM);n.coordinate=i.containerPointToCoordinate(s),n.containerPoint=s,n.viewPoint=i.containerPointToViewPoint(s),n.pont2d=i._containerPointToPoint(s)}return n}_zoomend(){const t=this.getScene();if(!t)return;const i=this.getMap().getZoom();t.children.forEach(n=>{const e=n.__parent;if(e&&e.getOptions){const r=e;r.zoomChange&&yt.isFunction(r.zoomChange)&&r.zoomChange(i);const s=r.getMinZoom(),a=r.getMaxZoom();i<s||i>a?(r.isVisible()&&(r.getObject3d().visible=!1),r._zoomVisible=!1):s<=i&&i<=a&&(r._visible&&(r.getObject3d().visible=!0),r._zoomVisible=!0)}})}_getGeometryEventMapPanel(){const t=this.map||this.getMap();return t._panels.allLayers||t._containerDOM}onAdd(){super.onAdd();const t=this.map||this.getMap();if(!t)return this;const i=this._getGeometryEventMapPanel();return this._identifyBaseObjectEventsThis||(this._identifyBaseObjectEventsThis=this._identifyBaseObjectEvents.bind(this)),this._zoomendThis||(this._zoomendThis=this._zoomend.bind(this)),pc.on(i,nm.join(" "),this._identifyBaseObjectEventsThis,this),this._needsUpdate=!0,this._animationBaseObjectMap||(this._animationBaseObjectMap={}),t.on("zooming zoomend",this._zoomendThis,this),this}onRemove(){super.onRemove();const t=this.map||this.getMap();if(!t)return this;const i=this._getGeometryEventMapPanel();return pc.off(i,nm.join(" "),this._identifyBaseObjectEventsThis,this),t.off("zooming zoomend",this._zoomendThis,this),this.clear(),this}_callbackBaseObjectAnimation(){const t=this;if(t._animationBaseObjectMap)for(const i in t._animationBaseObjectMap)t._animationBaseObjectMap[i]._animation();return this}_getFovRatio(){const i=this.getMap().getFov();return Math.tan(i/2*t3)}}Uf.mergeOptions(KA);const e3={bloom:!0};class i3 extends LE.CanvasLayerRenderer{constructor(){super(...arguments),this._renderTime=0,this._renderTarget=null}getPrepareParams(){return[this.scene,this.camera]}getDrawParams(){return[this.scene,this.camera]}_drawLayer(){super._drawLayer.apply(this,arguments)}hitDetect(){return!1}createCanvas(){super.createCanvas(),this.createContext()}createContext(){if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap();else{const i=this.layer.options.glOptions||{alpha:!0,depth:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1};i.preserveDrawingBuffer=!0,this.gl=this.gl||this._createGLContext(this.canvas,i)}this._initThreeRenderer(),this.layer.onCanvasCreate(this.context,this.scene,this.camera)}_initThreeRenderer(){this.matrix4=new ve;const t=new Cm({context:this.gl,alpha:!0});t.autoClear=!1,t.setClearColor(new qt(1,1,1),0),t.setSize(this.canvas.width,this.canvas.height),t.clear(),this.context=t;const i=this.scene=new Tm,n=this.layer.getMap(),e=n.getFov()*Math.PI/180,r=this.camera=new gi(e,n.width/n.height,n.cameraNear,n.cameraFar);r.matrixAutoUpdate=!1,this._syncCamera(),i.add(r),this.pick=new CA(this.layer),Ki.star()}onCanvasCreate(){super.onCanvasCreate()}resizeCanvas(t){if(!this.canvas)return;let i,n=this.getMap();t?i=t:i=n.getSize();const e=n.getDevicePixelRatio?n.getDevicePixelRatio():jt.retina?2:1,r=this.canvas,{width:s,height:a,cssWidth:h,cssHeight:l}=yt.calCanvasSize(i,e);if(this.layer._canvas&&(r.style.width!==h||r.style.height!==l)&&(r.style.width=h,r.style.height=l),r.width===s&&r.height===a)return this;r.width=s,r.height=a,this.context.setSize(r.width,r.height)}clearCanvas(){!this.canvas||this.context.clear()}prepareCanvas(){return this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context}),null}renderScene(t){if(this.layer._callbackBaseObjectAnimation(),this._syncCamera(),t&&t.renderTarget){const{width:i,height:n}=t.renderTarget.fbo;this._renderTarget?(this._renderTarget.viewport.set(0,0,i,n),this._renderTarget.scissor.set(0,0,i,n)):(this._renderTarget=new an(i,n,{depthBuffer:!1}),this.context.setRenderTarget(this._renderTarget),this.context.render(this.scene,this.camera));const e=this.context.properties.get(this._renderTarget),r=e[$c];e[$c]=t.renderTarget.getFramebuffer(t.renderTarget.fbo),this.context.setRenderTarget(this._renderTarget);const s=t.bloom===1&&t.sceneFilter,a=this.scene.children||[];let h=!1;if(s){const l=t.sceneFilter;h=l(e3);for(let c=0,u=a.length;c<u;c++){if(!a[c]||!a[c].layers)continue;const f=a[c].__parent;a[c].bloom=!1,f&&(a[c].bloom=f.bloom);let d=0;(a[c]&&l(a[c])||!f)&&h&&(d=1),a[c].__layer!==d&&(Ru(a[c],d),a[c].__layer=d)}}else for(let l=0,c=a.length;l<c;l++)!a[l]||!a[l].layers||a[l].__layer!==0&&(Ru(a[l],0),a[l].__layer=0);this.camera.layers.set(h?1:0),this.context.render(this.scene,this.camera),e[$c]=r}else this.context.render(this.scene,this.camera);this.context.setRenderTarget(null),this.completeRender()}remove(){delete this._drawContext,this._renderTarget&&(this._renderTarget.dispose(),delete this._renderTarget),super.remove()}_syncCamera(){const t=this.getMap(),i=this.camera;i.matrix.elements=t.cameraWorldMatrix,i.projectionMatrix.elements=t.projMatrix,this.matrix4.invert?i.projectionMatrixInverse.elements=this.matrix4.copy(i.projectionMatrix).invert().elements:i.projectionMatrixInverse&&(i.projectionMatrixInverse.elements=this.matrix4.getInverse(i.projectionMatrix).elements)}_createGLContext(t,i){const n=["webgl2","webgl","experimental-webgl"];let e=null;for(let r=0;r<n.length;++r){try{e=t.getContext(n[r],i)}catch{}if(e)break}return e}}Uf.registerRenderer("gl",i3);function Ru(o,t){if(!o)return;o.layers&&o.layers.set(t);const i=o.children;if(i&&i.length)for(let n=0,e=i.length;n<e;n++)Ru(i[n],t)}function oo(o){return o.getGLRes?o.getGLRes():o.getGLZoom()}function ao(o,t,i,n){return o.coordToPointAtRes?o.coordToPointAtRes(t,i,n):o.coordinateToPoint(t,i,n)}oh&&(oh(qA(),JA()),oh(YA,QA));const En={assert(o,t){if(!o)throw new Error(`[GIS] ${t}`)},mixin(o,t){for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])},uuid(o=32,t=16){let i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],e;if(t=t||i.length,o)for(e=0;e<o;e++)n[e]=i[0|Math.random()*t];else{let r;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",e=0;e<36;e++)n[e]||(r=0|Math.random()*16,n[e]=i[e===19?r&3|8:r])}return n.join("")},meter2degree(o){return o*.001*.008993220292999999},degree2meter(o){return o*1e3/.008993220292999999},convertTableArr2objects(o){if(!o)return null;var t=[];for(let i=0;i<o.length;i++){let n=this.convertTable2objects(o[i]);t=t.concat(n||[])}return t},convertTable2objects(o){if(!o)return null;var t=[];for(let n=0;n<o.Values.length;n++){var i=this.convertRow2object(o,n);t.push(i)}return t},convertRow2object(o,t){for(var i={},n=0;n<o.Columns.length;n++){var e=o.Values[t][n];(o.ColumnsType[n]==="number"||o.ColumnsType[n]==="double")&&(e===""?e=0:e=parseFloat(e)),i[o.Columns[n]]=e}return i},extendTable(o){o.objects=[];for(var t=0;t<o.Values.length;t++){for(var i=o.Values[t],n={},e=0;e<o.Columns.length;e++){var r=o.Columns[e];n[r]=i[e]}o.objects.push(n)}return o},trim(o){return(""+o).replace(/(^[\s\n\t]+|[\s\n\t]+$)/g,"")},renderTemplate(o,t){let i=/(\\)?\{([^\{\}\\]+)(\\)?\}/g;return o.replace(i,function(n,e,r,s){if(e||s)return n.replace("\\","");let a=r.replace(/\s/g,"").split("."),h=t,l,c,u;for(l=0,c=a.length;l<c;++l)if(u=a[l],h=h[u],h==null)return"";return h})},isType(o,t){return Object.prototype.toString.call(o)==="[object "+t+"]"}},n3={computed:{...Bo({configLoaded:"MapModule/configLoaded",mapConfig:"MapModule/mapConfig"})},watch:{configLoaded(){this.configLoaded&&this.initMap()}},mounted(){this.$nextTick(()=>{this.configLoaded&&this.initMap()})},methods:{initMap(){const o=this.mapConfig;let t=[],i=[];o.baseLayers.forEach(m=>{i.push(new vi(m.name,m))}),t=new Pf("base-map",i);const n={center:[0,0],zoom:5,minZoom:1,maxZoom:19,zoomInCenter:!0,attribution:!1,spatialReference:null,zoomControl:!1,scaleControl:!1},{center:e,zoom:r,minZoom:s,maxZoom:a,zoomInCenter:h,attribution:l,spatialReference:c,zoomControl:u,layerSwitcherControl:f,scaleControl:d}={...n,...o.mapOptions};let p=new Bt("map",{center:e,zoom:r,minZoom:s,maxZoom:a,zoomInCenter:h,attribution:l,spatialReference:c,zoomControl:{...u},layerSwitcherControl:{...f},scaleControl:{...d},baseLayer:t}),g=r3(p);Ms={getInstance(){return p},getBaseLayers(){return t},clearLayerById(m){let v=p.getLayer(m);v&&v.clear()},getOrCreateLayerById(m,v={}){let x=p.getLayer(m);return!x&&(x=new Bi(m,v).addTo(p)),x},setLayerVisuableById(m,v){let x=p.getLayer(m);x&&x.config("visible",v)},addPoints(m,v,x){const{id:_,x:y,y:b,symbol:M,cursor:C,fitExtent:w}={id:"id",x:"x",y:"y",cursor:"pointer",fitExtent:!1,...x};let S=this.getOrCreateLayerById(m),P=o3(v,{id:_,x:y,y:b,symbol:M,cursor:C});S.addGeometry(P,w),S.config("cursor","default")},addLines(m,v,{id:x,x:_,y,symbol:b,cursor:M,fitExtent:C}){let w=this.getOrCreateLayerById(m),S=a3(v,{id:x,x:_,y,symbol:b,cursor:M});w.addGeometry(S,!!C),w.config("cursor","default")},getInfoWindow(){return g},hideInfoWindow(){g.hide()},setMapLinstener(m){if(typeof m=="function"){let v={id:En.uuid(),type:"click",run:m};Tn.push(v)}else m instanceof Object&&typeof m.run=="function"?(m.type=m.type||"click",Tn.push(m)):alert("not support event linstener")},getMapLinstener(m){return Tn},removeMapLinstener(m){Tn.forEach((v,x)=>{(typeof m=="function"&&v.run===m||typeof m=="string"&&v.id===m||typeof m=="object"&&(!m.type&&v.id===m.id&&v.run===m.run||v.id===m.id&&v.type===m.type&&v.run===m.run))&&Tn.splice(x,1)})},forEachFeatureAtCoordinate(m,v){return v instanceof Array||(v=[v]),new Promise(x=>{p.identify({coordinate:m,layers:v},function(_){x(_)})})},showInfoWindow({x:m,y:v,dx:x,dy:_,title:y,content:b,lnglat:M,offset:C,data:w,methods:S}){g.config("dy",_||0),g.config("dx",x||0),g.setTitle(y);const P=`pop_${En.uuid(8)}`;g.setContent(`<div id="${P}"></div>`),this._renderTemplate(P,b,w,S),g.show({x:m,y:v})},clear(){this.hideInfoWindow(),this.getInstance().getLayers(m=>(m.getJSONType()!=="TileLayer"&&m.getId()!=="boundary_layer"&&m.getId()!=="label_area"&&m.remove(),m.getJSONType()!=="TileLayer"))},flyTo(m){p.panTo(m)},_renderTemplate(m,v="",x={},_={}){!m||!En.isType(m,"String")||!En.isType(v,"String")||!En.isType(x,"Object")||!En.isType(_,"Object")||setTimeout(()=>{if(!document.getElementById(m)){this._renderTemplate(m,v,x,_);return}try{new Gy({template:`<div class="maptalks-vue-render">${v}</div>`,data(){return{...x}},methods:{..._}}).$mount(`#${m}`)}catch{alert("\u6A21\u677F\u6E32\u67D3\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u6A21\u677F\u662F\u5426\u542B\u6709\u975Ehtml\u5143\u7D20\u3002")}},100)}},this.$store.commit("MapModule/setMap",Ms),this.$store.commit("MapModule/setMapLoaded",!0),s3()}}};let Ms=null,Tn=[];function r3(o){let t={dy:-38,autoPan:!1,autoOpenOn:null,title:"\u8BE6\u60C5",content:'<div class="msgBox-content"></div>'},i=new Oh.InfoWindow(t);return i.addTo(o),i}function s3(o){Ms.getInstance().on("click zoomend mousemove rotate",i=>{switch(i.type){case"click":rm(i);break;case"zoomend":break;case"mousemove":document.getElementById("mouse-position1").innerHTML=i.coordinate.toFixed(5).toArray()[0]+"<br/>"+i.coordinate.toFixed(5).toArray()[1],rm(i);break;case"rotate":let n=0;i.from===0&&(n=0),i.from<0?n=-i.from:i.from<=179.9999999999999&&i.from>0&&(n=360-i.from);let e=document.getElementById("compass");e.style.transform="rotate("+n+"deg)";break}})}function rm(o){o.type==="click"&&Ms.hideInfoWindow(),Tn.forEach(t=>{if(t.type.split(",").indexOf(o.type)>=0){let i=t.layerIds,n=[];i instanceof Array&&i.length>0?(i.forEach(e=>{n.push(Ms.getOrCreateLayerById(e))}),Ms.forEachFeatureAtCoordinate(o.coordinate,n).then(e=>{e.length&&t.run({...o,geos:e})})):t.run(o)}})}function Iy(o,t){let i=parseFloat(o),n=parseFloat(t);return[i,n]}function o3(o,t){if(!o||!(o instanceof Array))return[];const{id:i,x:n,y:e,symbol:r,cursor:s}={id:"id",x:"x",y:"y",cursor:"pointer",...t};let a=[],h=r;return typeof r!="function"&&(h=function(){return r}),o.forEach(l=>{if(!l)return;let[c,u]=Iy(l[n],l[e]);if(isNaN(c)||isNaN(u))return;l._uuid=l[i]||En.uuid();let f={feature:{type:"Feature",id:l._uuid,geometry:{type:"Point",coordinates:[c,u]},properties:l},options:{draggable:!1},symbol:h(l)},d=Jt.fromJSON(f);d.config("cursor",s),a.push(d)}),a}function a3(o,t){const{id:i,x:n,y:e,symbol:r,cursor:s}={id:"id",x:"x",y:"y",cursor:"pointer",...t};if(!(o instanceof Array)||o.length<2)return;let a=[],h=r;typeof r!="function"&&(h=function(){return r});let l=o[0][i]||En.uuid();o.forEach(f=>{if(!f)return;let[d,p]=Iy(f[n],f[e]);isNaN(d)||isNaN(p)||a.push([d,p])});let c={feature:{type:"Feature",id:l,geometry:{type:"LineString",coordinates:a},properties:o},options:{visible:!0,arrowStyle:null,draggable:!1,editable:!1},symbol:h(o[0])},u=Jt.fromJSON(c);return u.config("cursor",s),u}var h3=function(){var t=this,i=t._self._c;return i("div",{staticClass:"map-container",attrs:{id:"map"}})},l3=[],c3=Er(n3,h3,l3,!1,null,null,null,null);const u3=c3.exports;const f3={props:{shipInfo:{type:Object,default(){return{}}}},data(){return{}},methods:{close(){this.$emit("close")},lockBearing(){this.$emit("lockBearing",this.shipInfo)}}};var d3=function(){var t=this,i=t._self._c;return i(Hy,{ref:"shipInfo"},[i(Uy,{attrs:{dense:"",flat:""}},[t.shipInfo.properties?i("div",[t._v(" "+t._s(t.shipInfo.properties.mmsi)+" ")]):t._e(),i(jf),t._v(" 123 ")],1),i(Vy),i(Wy,[i(jf),i(Zf,{attrs:{color:"success"},on:{click:t.lockBearing}},[t._v("\u89C6\u89D2\u9501\u5B9A")]),i(Zf,{attrs:{color:"success"},on:{click:t.close}},[t._v("close")])],1)],1)},p3=[],g3=Er(f3,d3,p3,!1,null,null,null,null);const m3=g3.exports,v3=""+new URL("\u6307\u5317\u9488.82a71869.png",import.meta.url).href,_3={computed:{...Bo({map:"MapModule/map"})},methods:{returnNorth(){let o=this.map.getInstance();if(o){o.setBearing(0),o.setPitch(0);let t=document.getElementById("compass");t.style.transform="rotate("+0+"deg)"}}}};var y3=function(){var t=this,i=t._self._c;return i("div",{staticClass:"compass",attrs:{title:"\u56DE\u5230\u6B63\u5317\u65B9\u5411"},on:{click:t.returnNorth}},[i("img",{attrs:{id:"compass",src:v3}})])},x3=[],w3=Er(_3,y3,x3,!1,null,null,null,null);const M3=w3.exports,b3=[{type:"Feature",geometry:{type:"Point",coordinates:[117.6529200205803,39.017030166666665]},properties:{cog:323.4,heading:511,mmsi:"413694670",navStatus:5,rot:-128,sog:0,time:"03:23:24",timestamp:1666149804}},{type:"Feature",geometry:{type:"Point",coordinates:[117.65192002058029,39.01230966666667]},properties:{cog:150.3,heading:247,mmsi:"413325850",navStatus:1,rot:0,sog:.1,time:"03:28:20",timestamp:1666150100}},{type:"Feature",geometry:{type:"Point",coordinates:[117.65906666666667,39.014275]},properties:{cog:168.7,heading:244,mmsi:"413293440",navStatus:1,rot:0,sog:0,time:"03:17:22",timestamp:1666149442}},{type:"Feature",geometry:{type:"Point",coordinates:[117.65194666666667,39.013541333333336]},properties:{cog:111,heading:511,mmsi:"412365875",navStatus:0,rot:-128,sog:.1,time:"03:25:41",timestamp:1666149941}},{type:"Feature",geometry:{type:"Point",coordinates:[117.65210666666665,39.016105]},properties:{cog:117.4,heading:237,mmsi:"413370790",navStatus:1,rot:0,sog:.2,time:"03:16:57",timestamp:1666149417}},{type:"Feature",geometry:{type:"Point",coordinates:[117.65340833333333,39.01771933333333]},properties:{cog:247.3,heading:247,mmsi:"413484070",navStatus:0,rot:0,sog:12.5,time:"03:28:32",timestamp:1666150112}},{type:"Feature",geometry:{type:"Point",coordinates:[117.65182666666666,39.016345333333334]},properties:{cog:328.4,heading:84,mmsi:"412272450",navStatus:5,rot:-128,sog:0,time:"03:24:10",timestamp:1666149850}},{type:"Feature",geometry:{type:"Point",coordinates:[117.656895,39.0129225]},properties:{cog:279.8,heading:276,mmsi:"413705980",navStatus:0,rot:0,sog:10.6,time:"03:28:19",timestamp:1666150099}},{type:"Feature",geometry:{type:"Point",coordinates:[117.65846666666665,39.010387]},properties:{cog:81.8,heading:511,mmsi:"413311120",navStatus:0,rot:-128,sog:0,time:"03:28:38",timestamp:1666150118}},{type:"Feature",geometry:{type:"Point",coordinates:[117.65064,39.017504833333334]},properties:{cog:303,heading:233,mmsi:"413269000",navStatus:1,rot:0,sog:.2,time:"03:24:40",timestamp:1666149880}}],S3={components:{ShipInfoCard:m3},data(){return{showShipInfoCard:!1,shipInfo:{},activeShip:""}},computed:{...Bo({map:"MapModule/map"})},mounted(){this.$nextTick(()=>{this.getShips()})},methods:{getShips(){let o=this.map;const t=b3,i=this;var n=o.getOrCreateLayerById("\u8239\u8236",{});t.forEach(e=>{const r=e.properties.mmsi;let s="shipItem";i.activeShip&&thta.activeShip===r&&(s="activeShip");var a=new Oh.UIMarker(e.geometry.coordinates,{pitchWithMap:!0,rotateWithMap:!0,content:`<div id="${r}" class="${s}" title="${r}" style="transform:rotate(${e.properties.heading}deg)">
            <img src='/src/assets/ship.png' style="width:100%;height:100%" >
            </div>`}).addTo(n);a.on("click",function(h){i.showShipInfo("click",h,e)})})},getShipInfo(o){return o},showShipInfo(o,t,i){this.activeShip&&(document.getElementById(this.activeShip).className="shipItem"),this.shipInfo=this.getShipInfo(i),this.activeShip=i.properties.mmsi,document.getElementById(this.activeShip).className="activeShip",this.showShipInfoCard=!0},closeShipInfo(){this.activeShip&&(document.getElementById(this.activeShip).className="shipItem"),this.showShipInfoCard=!1},lockBearing(o){let t=this.map.getInstance();t.setPitch(30),t.setBearing(o.properties.heading),t.panTo(o.geometry.coordinates)}}};var C3=function(){var t=this,i=t._self._c;return i("ship-Info-Card",{directives:[{name:"show",rawName:"v-show",value:t.showShipInfoCard,expression:"showShipInfoCard"}],staticClass:"shipInfoCard",attrs:{shipInfo:t.shipInfo},on:{close:t.closeShipInfo,lockBearing:t.lockBearing}})},T3=[],P3=Er(S3,C3,T3,!1,null,null,null,null);const E3=P3.exports,A3={computed:{...Bo({map:"MapModule/map"})},mounted(){this.$nextTick(()=>{this.getArea()})},methods:{getArea(){let o=this.map;var t=new _r([117.63918174165794,39.0133457806687],2250,800,{symbol:{polygonFill:"#1bbc9b22",polygonOpacity:1,lineColor:"#1bbc9b44",lineWidth:6,lineJoin:"round",lineCap:"round",lineDasharray:null,"lineOpacity ":1}}),i=new ie([[[117.64538884162903,39.00791304679197],[117.65717983245848,39.01179795369458],[117.66023755073546,39.011973019581845],[117.66008734703063,39.01263159689522],[117.65722274780272,39.01241485060835],[117.6450777053833,39.008504966987324],[117.64538884162903,39.00791304679197]]],{symbol:{lineColor:"#0bfF0b66",lineWidth:2,polygonFill:"#0bfF0b",polygonOpacity:.6}}),n=new ie([[[117.6514720916748,39.009913883862794],[117.6518154144287,39.00918025017526],[117.65794157981871,39.01109768581222],[117.65755534172058,39.0118146266549],[117.65715837478638,39.01178128073035],[117.6514720916748,39.009913883862794]]],{symbol:[{lineColor:"#FFfF0b36",lineWidth:2,polygonFill:"#fffF0bD4",polygonOpacity:.6},{textName:"\u5371\u9669\u533A",textSize:12}]}),e=new ie([[[117.65125215053557,39.00983468513791],[117.64700889587402,39.008446608878295],[117.64752388000488,39.00747952463328],[117.65156865119934,39.009063535023365],[117.65125215053557,39.00983468513791]]],{symbol:[{lineColor:"#FFfF0b36",lineWidth:2,polygonFill:"#fffF0bD4",polygonOpacity:.6},{textName:"\u5371\u9669\u533A",textSize:12}]}),r=new ie([[[117.64677286148071,39.009063535023365],[117.65100002288818,39.010422420930645],[117.6506781578064,39.01120189278148],[117.6462686061859,39.009838853494074],[117.64677286148071,39.009063535023365]]],{symbol:[{lineColor:"#FFfF0b36",lineWidth:2,polygonFill:"#fffF0bD4",polygonOpacity:.6},{textName:"\u5371\u9669\u533A",textSize:12}]}),s=new ie([[[117.65093564987181,39.0113144361358],[117.6512575149536,39.01048911404537],[117.65709400177,39.01240651419945],[117.65639662742615,39.01322347760249],[117.65093564987181,39.0113144361358]]],{symbol:[{lineColor:"#FFfF0b36",lineWidth:2,polygonFill:"#fffF0bD4",polygonOpacity:.6},{textName:"\u5371\u9669\u533A",textSize:12}]}),a=new ie([[[117.65066206455232,39.01120189278148],[117.65100002288818,39.01041825260885],[117.6512575149536,39.01050578731423],[117.65094101428984,39.01130609959715],[117.65066206455232,39.01120189278148]]],{symbol:[{lineColor:"#FF330b36",lineWidth:2,polygonFill:"#FF330b",polygonOpacity:.6},{textName:"\u7981\u884C\u533A",textSize:10}]}),h=new ie([[[117.6518154144287,39.00918025017526],[117.65146136283873,39.009905547159086],[117.6512575149536,39.00984719020561],[117.65156865119934,39.009063535023365],[117.6518154144287,39.00918025017526]]],{symbol:[{lineColor:"#FF330b36",lineWidth:2,polygonFill:"#FF330b",polygonOpacity:.6},{textName:"\u7981\u884C\u533A",textSize:10}]});o.getOrCreateLayerById("\u76D1\u63A7\u533A",{}).addGeometry([t,i,n,e,r,s,a,h]).addTo(o.getInstance())}}};var L3=function(){var t=this,i=t._self._c;return i("div")},R3=[],O3=Er(A3,L3,R3,!1,null,null,null,null);const D3=O3.exports,I3={computed:{...Bo({map:"MapModule/map"})},mounted(){this.$nextTick(()=>{this.addBridge()})},methods:{addBridge(){let o=this.map;var t=new Uf("\u6865\u4F53\u793A\u610F\u56FE",{identifyCountOnEvent:1});t.prepareToDraw=function(s,a,h){var l=new TS(16724747);l.position.set(0,-10,10).normalize(),a.add(l),a.add(new PS("#FF330b36",.5)),r(),i(),n(),e()},t.addTo(o.getInstance());function i(){const s=new Jl({color:"#FF330b36",transparent:!0}),a={type:"Feature",geometry:{type:"Polygon",coordinates:[[[117.6518154144287,39.00918025017526],[117.65146136283873,39.009905547159086],[117.6512575149536,39.00984719020561],[117.65156865119934,39.009063535023365],[117.6518154144287,39.00918025017526]]]},properties:{name:"1-3cf0006e",_color:"#4b3aff",center:[117.6518154144287,39.00918025017526]}},h=t.toExtrudePolygon(a,{height:10},s);t.addMesh(h)}function n(){const s=new Jl({color:"#FF330b36",transparent:!0}),a={type:"Feature",geometry:{type:"Polygon",coordinates:[[[117.65066206455232,39.01120189278148],[117.65100002288818,39.01041825260885],[117.6512575149536,39.01050578731423],[117.65094101428984,39.01130609959715],[117.65066206455232,39.01120189278148]]]},properties:{name:"1-3cf0006e",_color:"#4b3aff",center:[117.6518154144287,39.00918025017526]}},h=t.toExtrudePolygon(a,{height:10},s);t.addMesh(h)}function e(){const s=new Jl({color:"#33330b36",transparent:!1}),a={type:"Feature",geometry:{type:"Polygon",coordinates:[[[117.65100002288818,39.01041825260885],[117.6512575149536,39.01050578731423],[117.65146136283873,39.009905547159086],[117.6512575149536,39.00984719020561],[117.65100002288818,39.01041825260885]]]},properties:{name:"1-3cf0006e",_color:"#4b3aff",center:[117.6518154144287,39.00918025017526]}},h=t.toExtrudePolygon(a,{height:30},s);t.addMesh(h)}function r(){requestAnimationFrame(r),t._needsUpdate=!t._needsUpdate,t._needsUpdate&&!t.isRendering()&&t.redraw()}}}};var k3=function(){var t=this,i=t._self._c;return i("div")},z3=[],F3=Er(I3,k3,z3,!1,null,null,null,null);const N3=F3.exports;const B3={components:{MapMain:u3,MapShips:E3,MapComapss:M3,MapArea:D3,MapBridge:N3},data(){return{isDebug:!0,show:!1,showShipInfoCard:!1,shipInfo:{},name:"",activeShip:"",map:{}}},mounted(){},created(){},methods:{init(){this.$route.meta.showPanel},update(o){},addPanel(){var o=new maptalks.control.Panel({position:{top:"220",left:"50"},draggable:!0,custom:!1,content:"\u901A\u822A\u516C\u544A",closeButton:!0});this.map.addControl(o);var t=new maptalks.control.Panel({position:{top:"120",left:"50"},draggable:!0,custom:!1,content:"\u6C14\u8C61\u4FE1\u606F",closeButton:!0});this.map.addControl(t)},animation(){var o=new maptalks.VectorLayer("\u8F68\u8FF9",{hitDetect:!0,geometryEvents:!0}).addTo(this.map),t=coordinates,i=new maptalks.LineString(t,{id:"arrow",arrowStyle:"classic",arrowPlacement:"point",symbol:{lineWidth:2,lineColor:"yellow"}});i.addTo(o)},addDragrotatingListener(o){}}};var G3=function(){var t=this,i=t._self._c;return i("div",{staticStyle:{width:"100vw",height:"100%"}},[i("map-main"),i("map-Comapss"),i("map-Ships"),i("map-area"),i("map-bridge"),t._m(0),i("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[i("div",{ref:"infowindow_content"},[i("h2",[t._v(t._s(t.name))])])])],1)},H3=[function(){var o=this,t=o._self._c;return t("div",{staticClass:"mouse-position",attrs:{id:"mouse-position"}},[t("div",{attrs:{id:"mouse-position1"}})])}],U3=Er(B3,G3,H3,!1,null,null,null,null);const X3=U3.exports;export{X3 as default};
