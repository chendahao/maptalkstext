import{n as c,l as u}from"./index.ddbb152d.js";import{_ as r}from"./map-area.d2623651.js";import{_ as m,k as h,l as g,P as b}from"./map-main.a168dc3a.js";import{m as v}from"./vue.200a03fd.js";import{B as _}from"./api.0ba0e65a.js";import"./vuetify.d08ecdbf.js";/* empty css                            */const f={directives:{drag(l,e){l.onmousedown=function(t){t.stopPropagation();let o=t.pageX-l.offsetLeft,i=t.pageY-l.offsetTop;document.body.onselectstart=function(){return!1},document.onmousemove=function(n){i>60||(l.style.left=n.pageX-o+"px",l.style.top=n.pageY-i+"px")},document.onmouseup=function(){document.onmousemove=document.onmouseup=null,document.body.onselectstart=null}}}},props:{fixed:{type:Boolean,default:!0}}};var x=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"drag",rawName:"v-drag"}],staticClass:"drag",class:{position:e.fixed}},[e._t("default")],2)},w=[],$=c(f,x,w,!1,null,"1a9ee3e5",null,null);const d=$.exports;const k={components:{MapDrag:d},data(){return{options:[{value:"\u8FDB\u6E2F",label:"\u8FDB\u6E2F"},{value:"\u51FA\u6E2F",label:"\u51FA\u6E2F"}],symbol:{name:"",description:"",tag:"",textName:"",textSize:12,lineWidth:1,lineColor:"#409EFF",lineOpacity:1,polygonOpacity:.1,polygonFill:"#409EFF"},name:"",description:"",tag:"",textName:"",textSize:12,lineWidth:1,lineColor:"#409EFF",lineOpacity:1,polygonOpacity:.1,polygonFill:"#409EFF",item:{},isShow:!1,styleP:{top:"130px",left:"450px"}}},methods:{open(l){this.item=l,this.symbol=l.geo.getSymbol(),this.isShow=!0;let e=l.xy;this.styleP={top:`${e.y}px`,left:`${e.x}px`}},close(){this.isShow=!1},setSymbol(l,e){let o={...l.getSymbol(),...e};l.setSymbol(o)},callback(l,e){let t=this.symbol;this.setSymbol(this.item.geo,t)},handleWidthChange(l){this.callback("lineWidth",l)},handletextSizeChange(l){this.callback("textSize",l)},handlelineColorChange(l){this.callback("lineColor",l)},handleLineAlphaChange(l){this.callback("lineOpacity",l)},handlePolygonOpacity(l){this.callback("polygonOpacity",l)},handlePolygonFillChange(l){this.callback("polygonFill",l)}}};var S=function(){var e=this,t=e._self._c;return t(d,{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"detail-position",style:e.styleP,attrs:{fixed:!1}},[t("div",{staticClass:"detail-dialog"},[t("header",{staticClass:"title clip"},[e._v(" \u7F16\u8F91\u9762\u677F "),t("span",{staticClass:"close",on:{click:e.close}},[e._v("x")])]),t("main",[t("div",{staticClass:"l-h"},[t("label",[e._v("\u540D\u79F0\uFF1A")]),t("el-input",{staticStyle:{width:"220px"},attrs:{size:"small"},on:{change:function(o){return e.callback("name",e.name)}},model:{value:e.symbol.name,callback:function(o){e.$set(e.symbol,"name",o)},expression:"symbol.name"}})],1),t("div",{staticClass:"l-h"},[t("label",[e._v("\u63CF\u8FF0\uFF1A")]),t("el-input",{staticStyle:{width:"220px"},attrs:{size:"small"},on:{change:function(o){return e.callback("description",e.description)}},model:{value:e.symbol.description,callback:function(o){e.$set(e.symbol,"description",o)},expression:"symbol.description"}})],1),t("div",{staticClass:"l-h"},[t("label",[e._v("\u6807\u7B7E\uFF1A")]),t("el-select",{staticStyle:{width:"220px"},attrs:{multiple:"","collapse-tags":"",size:"small",filterable:"","allow-create":"",placeholder:"\u8BF7\u9009\u62E9"},on:{change:function(o){return e.callback("tag",e.tag)}},model:{value:e.symbol.tag,callback:function(o){e.$set(e.symbol,"tag",o)},expression:"symbol.tag"}},e._l(e.options,function(o){return t("el-option",{key:o.value,attrs:{label:o.label,value:o.value}})}),1)],1),t("div",{staticClass:"l-h"},[t("label",[e._v("\u663E\u793A\u540D\u79F0\uFF1A")]),t("el-input",{staticStyle:{width:"188px"},attrs:{size:"small"},on:{change:function(o){return e.callback("textName",e.textName)}},model:{value:e.symbol.textName,callback:function(o){e.$set(e.symbol,"textName",o)},expression:"symbol.textName"}})],1),t("div",{staticClass:"l-h"},[t("label",[e._v("\u5B57\u4F53\u5927\u5C0F\uFF1A")]),t("el-input-number",{attrs:{min:1,max:40,size:"small"},on:{change:function(o){return e.callback("textSize",e.textSize)}},model:{value:e.symbol.textSize,callback:function(o){e.$set(e.symbol,"textSize",o)},expression:"symbol.textSize"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.item.type=="polygon",expression:"item.type=='polygon'"}],staticClass:"l-h"},[t("label",[e._v("\u8FB9\u6846\u5BBD\uFF1A")]),t("el-input-number",{attrs:{min:1,max:10,size:"small"},on:{change:function(o){return e.callback("lineWidth",e.lineWidth)}},model:{value:e.symbol.lineWidth,callback:function(o){e.$set(e.symbol,"lineWidth",o)},expression:"symbol.lineWidth"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.item.type=="polygon",expression:"item.type=='polygon'"}],staticClass:"l-h"},[t("label",[e._v("\u8FB9\u6846\u989C\u8272\uFF1A")]),t("el-color-picker",{on:{change:function(o){return e.callback("lineColor",e.lineColor)}},model:{value:e.symbol.lineColor,callback:function(o){e.$set(e.symbol,"lineColor",o)},expression:"symbol.lineColor"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.item.type==="polygon",expression:"item.type==='polygon'"}],staticClass:"l-h"},[t("label",[e._v("\u8FB9\u6846\u900F\u660E\u5EA6\uFF1A")]),t("el-input-number",{attrs:{min:.1,max:1,precision:1,step:.1,size:"small"},on:{change:function(o){return e.callback("lineOpacity",e.lineOpacity)}},model:{value:e.symbol.lineOpacity,callback:function(o){e.$set(e.symbol,"lineOpacity",o)},expression:"symbol.lineOpacity"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.item.type==="polygon",expression:"item.type==='polygon'"}],staticClass:"l-h"},[t("label",[e._v("\u586B\u5145\u989C\u8272\uFF1A")]),t("el-color-picker",{on:{change:function(o){return e.callback("polygonFill",e.polygonFill)}},model:{value:e.symbol.polygonFill,callback:function(o){e.$set(e.symbol,"polygonFill",o)},expression:"symbol.polygonFill"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.item.type==="polygon",expression:"item.type==='polygon'"}],staticClass:"l-h"},[t("label",[e._v("\u586B\u5145\u900F\u660E\u5EA6\uFF1A")]),t("el-input-number",{attrs:{min:.1,max:1,precision:1,step:.1,size:"small"},on:{change:function(o){return e.callback("polygonOpacity",e.polygonOpacity)}},model:{value:e.symbol.polygonOpacity,callback:function(o){e.$set(e.symbol,"polygonOpacity",o)},expression:"symbol.polygonOpacity"}})],1)])])])},C=[],I=c(k,S,C,!1,null,"ade8030d",null,null);const p=I.exports;let s,a;const E={components:{MapMain:m,MapArea:r,MapPlotEdit:p},computed:{...v({map:"MapModule/map"})},data(){return{editItem:null}},mounted(){this.$nextTick(()=>{this.initTool()})},methods:{areaLoaded(l){this.getToolBar()},initTool(){let l=this,e=this.map;a=e.getOrCreateLayerById("\u76D1\u63A7\u533A",{}),s=new h({mode:"Polygon",once:!0}).addTo(e.getInstance()).disable(),s.on("drawend",function(t){l.addGeometry(t)}),this.getToolBar()},getToolBar(){let l=this,e=this.map;new g.Toolbar({position:{top:15,right:50},items:[{item:"\u533A\u57DF\u5217\u8868",children:l.getGeometries()},{item:"\u65B0\u589E",click:function(){l.endEdit(),s.enable()}},{item:"\u4FDD\u5B58",click:function(){l.saveArea()}},{item:"\u8FD4\u56DE",click:function(){l.toMain()}}]}).addTo(e.getInstance())},toMain(){this.$router.push({name:"areaIndex"})},addGeometry(l){let e=new b(l.geometry._coordinates,{id:"newSymbol",symbol:{name:"\u65B0\u589E\u533A\u57DF",description:"",tag:"",textName:"\u65B0\u589E\u533A\u57DF",textSize:12,lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3}});a.addGeometry(e),this.getToolBar()},getGeometries(){let l=this;var t=a.getGeometries().map(function(o){return{item:o.getSymbol().name,click:function(){l.editItem?l.checkSave(o):(l.editItem=o,o.startEdit(),l.$refs.plotEdit.open({type:"polygon",xy:{x:20,y:60},geo:o}))}}});return t},checkSave(l){this.$confirm("\u8FD8\u672A\u4FDD\u6301\u6570\u636E\u53D8\u66F4, \u662F\u5426\u4FDD\u5B58?","\u63D0\u793A",{confirmButtonText:"\u4FDD\u5B58",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{this.saveArea(),this.editItem=l,l.startEdit(),this.$refs.plotEdit.open({type:"polygon",xy:{x:20,y:20},geo:l})}).catch(()=>{this.editItem.undoEdit(),this.editItem.endEdit(),this.$refs.plotEdit.close(),this.editItem=null,this.$message("\u5DF2\u53D6\u6D88")})},startDraw(){s.setMode("Polygon").enable()},stopDraw(){this.editItem&&this.editItem.endEdit(),this.editItem.endEdit(),s.disable()},saveArea(){if(this.editItem){const l=this.editItem.getSymbol(),e=new _.AreaClient("",this.$axios);let t=[...this.editItem.getCoordinates()[0]];u.exports.isEqual(t[0],t[t.length-1])||t.push(t[0]);let o=this.toNumberArrays(t);if(this.editItem.getId()=="newSymbol"){const n={name:l.name,tags:l.tags,description:l.description,coords:o,enableAlarm:!1,styles:l};e.areaPOST(n).then(y=>{this.getToolBar()}).catch(y=>{})}const i=this.editItem.getSymbol().name;this.$message({message:`${i}-\u4FDD\u5B58\u6210\u529F`,type:"success"}),this.endEdit()}else this.$message("\u8FD8\u6CA1\u6709\u9009\u62E9\u6216\u521B\u5EFA\u56FE\u5F62")},endEdit(){this.editItem&&(this.editItem.endEdit(),this.$refs.plotEdit.close(),this.editItem=null)},redraw(){},test(){this.getToolBar()},toNumberArrays(l){return l.map(e=>[e.x,e.y])}}};var O=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"area-title"},[e._v(" \u76D1\u63A7\u533A\u57DF\u7EF4\u62A4 ")]),t(m,{staticStyle:{width:"100vw",height:"100vh"}}),t(r,{on:{areaLoaded:e.areaLoaded}}),t(p,{ref:"plotEdit"})],1)},F=[],z=c(E,O,F,!1,null,"e021bf7f",null,null);const L=z.exports;export{L as default};
