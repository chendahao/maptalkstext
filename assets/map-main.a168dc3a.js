import{c as tr,m as eu,V as iu}from"./vue.200a03fd.js";import{n as ru}from"./index.ddbb152d.js";var $o={exports:{}};(function(o){(function(a){var i,r,t="fulfilled",e="undefined",n=function(){var l=[],f=0;function c(){for(;l.length-f;){try{l[f]()}catch(g){a.console&&a.console.error(g)}l[f++]=r,f==1024&&(l.splice(0,1024),f=0)}}var d=function(){if(typeof MutationObserver===e)return typeof process!==e&&typeof process.nextTick=="function"?function(){process.nextTick(c)}:typeof setImmediate!==e?function(){setImmediate(c)}:function(){setTimeout(c,0)};var g=document.createElement("div");return new MutationObserver(c).observe(g,{attributes:!0}),function(){g.setAttribute("a",0)}}();return function(g){l.push(g),l.length-f==1&&d()}}();function s(l){if(!(this instanceof s))throw new TypeError("Zousan must be created with the new keyword");if(typeof l=="function"){var f=this;try{l(function(c){f.resolve(c)},function(c){f.reject(c)})}catch(c){f.reject(c)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+l+" is not a function")}function h(l,f){if(typeof l.y=="function")try{var c=l.y.call(r,f);l.p.resolve(c)}catch(d){l.p.reject(d)}else l.p.resolve(f)}function u(l,f){if(typeof l.n=="function")try{var c=l.n.call(r,f);l.p.resolve(c)}catch(d){l.p.reject(d)}else l.p.reject(f)}s.prototype={resolve:function(l){if(this.state===i){if(l===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var f=this;if(l&&(typeof l=="function"||typeof l=="object"))try{var c=!0,d=l.then;if(typeof d=="function")return void d.call(l,function(g){c&&(c=!1,f.resolve(g))},function(g){c&&(c=!1,f.reject(g))})}catch(g){return void(c&&this.reject(g))}this.state=t,this.v=l,f.c&&n(function(){for(var g=0,v=f.c.length;g<v;g++)h(f.c[g],l)})}},reject:function(l){if(this.state===i){var f=this;this.state="rejected",this.v=l;var c=this.c;n(c?function(){for(var d=0,g=c.length;d<g;d++)u(c[d],l)}:function(){f.handled||!s.suppressUncaughtRejectionError&&a.console&&s.warn("You upset Zousan. Please catch rejections: ",l,l?l.stack:null)})}},then:function(l,f){var c=new s,d={y:l,n:f,p:c};if(this.state===i)this.c?this.c.push(d):this.c=[d];else{var g=this.state,v=this.v;this.handled=!0,n(function(){g===t?h(d,v):u(d,v)})}return c},catch:function(l){return this.then(null,l)},finally:function(l){return this.then(l,l)},timeout:function(l,f){f=f||"Timeout";var c=this;return new s(function(d,g){setTimeout(function(){g(Error(f))},l),c.then(function(v){d(v)},function(v){g(v)})})}},s.resolve=function(l){var f=new s;return f.resolve(l),f},s.reject=function(l){var f=new s;return f.c=[],f.reject(l),f},s.all=function(l){var f=[],c=0,d=new s;function g(m,_){m&&typeof m.then=="function"||(m=s.resolve(m)),m.then(function(p){f[_]=p,++c==l.length&&d.resolve(f)},function(p){d.reject(p)})}for(var v=0;v<l.length;v++)g(l[v],v);return l.length||d.resolve(f),d},s.warn=console.warn,o.exports&&(o.exports=s),a.define&&a.define.amd&&a.define([],function(){return s}),(a.Zousan=s).soon=n})(typeof tr<"u"?tr:tr)})($o);const nu=$o.exports;var jn={exports:{}},Qo={exports:{}};(function(o,a){(function(i,r){o.exports=r()})(tr,function(){function i(n,s,h,u,l){r(n,s,h||0,u||n.length-1,l||e)}function r(n,s,h,u,l){for(;u>h;){if(u-h>600){var f=u-h+1,c=s-h+1,d=Math.log(f),g=.5*Math.exp(2*d/3),v=.5*Math.sqrt(d*g*(f-g)/f)*(c-f/2<0?-1:1),m=Math.max(h,Math.floor(s-c*g/f+v)),_=Math.min(u,Math.floor(s+(f-c)*g/f+v));r(n,s,m,_,l)}var p=n[s],y=h,x=u;for(t(n,h,s),l(n[u],p)>0&&t(n,h,u);y<x;){for(t(n,y,x),y++,x--;l(n[y],p)<0;)y++;for(;l(n[x],p)>0;)x--}l(n[h],p)===0?t(n,h,x):(x++,t(n,x,u)),x<=s&&(h=x+1),s<=x&&(u=x-1)}}function t(n,s,h){var u=n[s];n[s]=n[h],n[h]=u}function e(n,s){return n<s?-1:n>s?1:0}return i})})(Qo);jn.exports=wi;jn.exports.default=wi;var au=Qo.exports;function wi(o,a){if(!(this instanceof wi))return new wi(o,a);this._maxEntries=Math.max(4,o||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),a&&this._initFormat(a),this.clear()}wi.prototype={all:function(){return this._all(this.data,[])},search:function(o){var a=this.data,i=[],r=this.toBBox;if(!ji(o,a))return i;for(var t=[],e,n,s,h;a;){for(e=0,n=a.children.length;e<n;e++)s=a.children[e],h=a.leaf?r(s):s,ji(o,h)&&(a.leaf?i.push(s):Nr(o,h)?this._all(s,i):t.push(s));a=t.pop()}return i},collides:function(o){var a=this.data,i=this.toBBox;if(!ji(o,a))return!1;for(var r=[],t,e,n,s;a;){for(t=0,e=a.children.length;t<e;t++)if(n=a.children[t],s=a.leaf?i(n):n,ji(o,s)){if(a.leaf||Nr(o,s))return!0;r.push(n)}a=r.pop()}return!1},load:function(o){if(!(o&&o.length))return this;if(o.length<this._minEntries){for(var a=0,i=o.length;a<i;a++)this.insert(o[a]);return this}var r=this._build(o.slice(),0,o.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var t=this.data;this.data=r,r=t}this._insert(r,this.data.height-r.height-1,!0)}return this},insert:function(o){return o&&this._insert(o,this.data.height-1),this},clear:function(){return this.data=Ge([]),this},remove:function(o,a){if(!o)return this;for(var i=this.data,r=this.toBBox(o),t=[],e=[],n,s,h,u;i||t.length;){if(i||(i=t.pop(),s=t[t.length-1],n=e.pop(),u=!0),i.leaf&&(h=ou(o,i.children,a),h!==-1))return i.children.splice(h,1),t.push(i),this._condense(t),this;!u&&!i.leaf&&Nr(i,r)?(t.push(i),e.push(n),n=0,s=i,i=i.children[0]):s?(n++,i=s.children[n],u=!1):i=null}return this},toBBox:function(o){return o},compareMinX:ja,compareMinY:Ha,toJSON:function(){return this.data},fromJSON:function(o){return this.data=o,this},_all:function(o,a){for(var i=[];o;)o.leaf?a.push.apply(a,o.children):i.push.apply(i,o.children),o=i.pop();return a},_build:function(o,a,i,r){var t=i-a+1,e=this._maxEntries,n;if(t<=e)return n=Ge(o.slice(a,i+1)),Le(n,this.toBBox),n;r||(r=Math.ceil(Math.log(t)/Math.log(e)),e=Math.ceil(t/Math.pow(e,r-1))),n=Ge([]),n.leaf=!1,n.height=r;var s=Math.ceil(t/e),h=s*Math.ceil(Math.sqrt(e)),u,l,f,c;for(Fa(o,a,i,h,this.compareMinX),u=a;u<=i;u+=h)for(f=Math.min(u+h-1,i),Fa(o,u,f,s,this.compareMinY),l=u;l<=f;l+=s)c=Math.min(l+s-1,f),n.children.push(this._build(o,l,c,r-1));return Le(n,this.toBBox),n},_chooseSubtree:function(o,a,i,r){for(var t,e,n,s,h,u,l,f;r.push(a),!(a.leaf||r.length-1===i);){for(l=f=1/0,t=0,e=a.children.length;t<e;t++)n=a.children[t],h=Gr(n),u=su(o,n)-h,u<f?(f=u,l=h<l?h:l,s=n):u===f&&h<l&&(l=h,s=n);a=s||a.children[0]}return a},_insert:function(o,a,i){var r=this.toBBox,t=i?o:r(o),e=[],n=this._chooseSubtree(t,this.data,a,e);for(n.children.push(o),mi(n,t);a>=0&&e[a].children.length>this._maxEntries;)this._split(e,a),a--;this._adjustParentBBoxes(t,e,a)},_split:function(o,a){var i=o[a],r=i.children.length,t=this._minEntries;this._chooseSplitAxis(i,t,r);var e=this._chooseSplitIndex(i,t,r),n=Ge(i.children.splice(e,i.children.length-e));n.height=i.height,n.leaf=i.leaf,Le(i,this.toBBox),Le(n,this.toBBox),a?o[a-1].children.push(n):this._splitRoot(i,n)},_splitRoot:function(o,a){this.data=Ge([o,a]),this.data.height=o.height+1,this.data.leaf=!1,Le(this.data,this.toBBox)},_chooseSplitIndex:function(o,a,i){var r,t,e,n,s,h,u,l;for(h=u=1/0,r=a;r<=i-a;r++)t=vi(o,0,r,this.toBBox),e=vi(o,r,i,this.toBBox),n=hu(t,e),s=Gr(t)+Gr(e),n<h?(h=n,l=r,u=s<u?s:u):n===h&&s<u&&(u=s,l=r);return l},_chooseSplitAxis:function(o,a,i){var r=o.leaf?this.compareMinX:ja,t=o.leaf?this.compareMinY:Ha,e=this._allDistMargin(o,a,i,r),n=this._allDistMargin(o,a,i,t);e<n&&o.children.sort(r)},_allDistMargin:function(o,a,i,r){o.children.sort(r);var t=this.toBBox,e=vi(o,0,a,t),n=vi(o,i-a,i,t),s=zi(e)+zi(n),h,u;for(h=a;h<i-a;h++)u=o.children[h],mi(e,o.leaf?t(u):u),s+=zi(e);for(h=i-a-1;h>=a;h--)u=o.children[h],mi(n,o.leaf?t(u):u),s+=zi(n);return s},_adjustParentBBoxes:function(o,a,i){for(var r=i;r>=0;r--)mi(a[r],o)},_condense:function(o){for(var a=o.length-1,i;a>=0;a--)o[a].children.length===0?a>0?(i=o[a-1].children,i.splice(i.indexOf(o[a]),1)):this.clear():Le(o[a],this.toBBox)},_initFormat:function(o){var a=["return a"," - b",";"];this.compareMinX=new Function("a","b",a.join(o[0])),this.compareMinY=new Function("a","b",a.join(o[1])),this.toBBox=new Function("a","return {minX: a"+o[0]+", minY: a"+o[1]+", maxX: a"+o[2]+", maxY: a"+o[3]+"};")}};function ou(o,a,i){if(!i)return a.indexOf(o);for(var r=0;r<a.length;r++)if(i(o,a[r]))return r;return-1}function Le(o,a){vi(o,0,o.children.length,a,o)}function vi(o,a,i,r,t){t||(t=Ge(null)),t.minX=1/0,t.minY=1/0,t.maxX=-1/0,t.maxY=-1/0;for(var e=a,n;e<i;e++)n=o.children[e],mi(t,o.leaf?r(n):n);return t}function mi(o,a){return o.minX=Math.min(o.minX,a.minX),o.minY=Math.min(o.minY,a.minY),o.maxX=Math.max(o.maxX,a.maxX),o.maxY=Math.max(o.maxY,a.maxY),o}function ja(o,a){return o.minX-a.minX}function Ha(o,a){return o.minY-a.minY}function Gr(o){return(o.maxX-o.minX)*(o.maxY-o.minY)}function zi(o){return o.maxX-o.minX+(o.maxY-o.minY)}function su(o,a){return(Math.max(a.maxX,o.maxX)-Math.min(a.minX,o.minX))*(Math.max(a.maxY,o.maxY)-Math.min(a.minY,o.minY))}function hu(o,a){var i=Math.max(o.minX,a.minX),r=Math.max(o.minY,a.minY),t=Math.min(o.maxX,a.maxX),e=Math.min(o.maxY,a.maxY);return Math.max(0,t-i)*Math.max(0,e-r)}function Nr(o,a){return o.minX<=a.minX&&o.minY<=a.minY&&a.maxX<=o.maxX&&a.maxY<=o.maxY}function ji(o,a){return a.minX<=o.maxX&&a.minY<=o.maxY&&a.maxX>=o.minX&&a.maxY>=o.minY}function Ge(o){return{children:o,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Fa(o,a,i,r,t){for(var e=[a,i],n;e.length;)i=e.pop(),a=e.pop(),!(i-a<=r)&&(n=a+Math.ceil((i-a)/r/2)*r,au(o,n,a,i,t),e.push(a,n,n,i))}var Ko={exports:{}};(function(o){(function(){function a(s,h){var u=s.x-h.x,l=s.y-h.y;return u*u+l*l}function i(s,h,u){var l=h.x,f=h.y,c=u.x-l,d=u.y-f;if(c!==0||d!==0){var g=((s.x-l)*c+(s.y-f)*d)/(c*c+d*d);g>1?(l=u.x,f=u.y):g>0&&(l+=c*g,f+=d*g)}return c=s.x-l,d=s.y-f,c*c+d*d}function r(s,h){for(var u=s[0],l=[u],f,c=1,d=s.length;c<d;c++)f=s[c],a(f,u)>h&&(l.push(f),u=f);return u!==f&&l.push(f),l}function t(s,h,u,l,f){for(var c=l,d,g=h+1;g<u;g++){var v=i(s[g],s[h],s[u]);v>c&&(d=g,c=v)}c>l&&(d-h>1&&t(s,h,d,l,f),f.push(s[d]),u-d>1&&t(s,d,u,l,f))}function e(s,h){var u=s.length-1,l=[s[0]];return t(s,0,u,h,l),l.push(s[u]),l}function n(s,h,u){if(s.length<=2)return s;var l=h!==void 0?h*h:1;return s=u?s:r(s,l),s=e(s,l),s}o.exports=n,o.exports.default=n})()})(Ko);const uu=Ko.exports;/*!
* Contains code from THREE.js
* MIT License
* https://github.com/mrdoob/three.js
*/var de=[];for(var Zr=0;Zr<6;Zr++)de[Zr]=[];var Hi=[];function Br(o,a,i){lu(o);for(var r=0;r<6;r++)if(!(i&&i.charAt(r)==="0")){var t=de[r];if(Hi[0]=t[0]>0?a[1][0]:a[0][0],Hi[1]=t[1]>0?a[1][1]:a[0][1],Hi[2]=t[2]>0?a[1][2]:a[0][2],fu(t,Hi)<0)return!1}return!0}function lu(o){var a=o,i=a[0],r=a[1],t=a[2],e=a[3],n=a[4],s=a[5],h=a[6],u=a[7],l=a[8],f=a[9],c=a[10],d=a[11],g=a[12],v=a[13],m=a[14],_=a[15];Ie(de[0],e-i,u-n,d-l,_-g),Ie(de[1],e+i,u+n,d+l,_+g),Ie(de[2],e+r,u+s,d+f,_+v),Ie(de[3],e-r,u-s,d-f,_-v),Ie(de[4],e-t,u-h,d-c,_-m),Ie(de[5],e+t,u+h,d+c,_+m)}var Fi=1/6;function Ie(o,a,i,r,t){return o[0]=a*Fi,o[1]=i*Fi,o[2]=r*Fi,o[3]=t*Fi,o}function fu(o,a){return o[0]*a[0]+o[1]*a[1]+o[2]*a[2]+o[3]}/*!
 * maptalks v1.0.0-rc.14
 * LICENSE : BSD-3-Clause
 * (c) 2016-2022 maptalks.org
 */var cu="1.0.0-rc.14",Si="_maptalks__internal_layer_",ts=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],du=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(ts),es=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],gu=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],vu={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},mu=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],is=14;function lt(){return Date.now()}function H(o){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var r in i)o[r]=i[r]}return o}function C(o){return o==null}function N(o){return typeof o=="number"&&!isNaN(o)}function ie(o){return(o|0)===o}function Gt(o){return typeof o=="object"&&!!o}function $(o){return C(o)?!1:typeof o=="string"||o.constructor!==null&&o.constructor===String}function nt(o){return C(o)?!1:typeof o=="function"||o.constructor!==null&&o.constructor===Function}var _u=Object.prototype.hasOwnProperty;function Xe(o,a){return _u.call(o,a)}function pu(o,a){return o.join?o.join(a||","):Array.prototype.join.call(o,a||",")}function yu(o){var a;for(a in o)return!1;return!a}var rs=Math.PI/180;function Ct(o){return o*rs}function ns(o){return o/rs}var pt=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"],Zt={},Gi={};function Ga(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!pt){var te=navigator.userAgent.toLowerCase(),Wr=document.documentElement,ze="ActiveXObject"in window,Vr=te.indexOf("webkit")!==-1,Ur=te.indexOf("phantom")!==-1,Na=te.search("android [23]")!==-1,Jr=te.indexOf("chrome")!==-1,Za=te.indexOf("gecko")!==-1&&!Vr&&!window.opera&&!ze,ii=typeof orientation<"u"||te.indexOf("mobile")!==-1,Ba=!window.PointerEvent&&window.MSPointerEvent,Wa=window.PointerEvent&&navigator.pointerEnabled||Ba,Va=ze&&"transition"in Wr.style,Yr="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Na,Ua="MozPerspective"in Wr.style,Ja="OTransition"in Wr.style,xu=(Va||Yr||Ua)&&!Ja&&!Ur,wu=typeof window<"u"&&nt(window.createImageBitmap),Cu=typeof window<"u"&&nt(window.ResizeObserver),Pu=typeof window<"u"&&nt(window.btoa),Ya=0;Jr&&(Ya=te.match(/chrome\/([\d.]+)/)[1]);var Mu=!Ur&&(Wa||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),Tu=typeof window<"u"&&"WebGLRenderingContext"in window,Xa=Ga(),Xr=!1;try{var Su=new OffscreenCanvas(2,2);Su.getContext("2d"),Xr=!0}catch{Xr=!1}var qa=!1;try{window.addEventListener("testPassive",function(){},{get passive(){qa=!0}})}catch{}if(Zt={ie:ze,ielt9:ze&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:Vr,gecko:Za,android:te.indexOf("android")!==-1,android23:Na,chrome:Jr,chromeVersion:Ya,safari:!Jr&&te.indexOf("safari")!==-1,phantomjs:Ur,ie3d:Va,webkit3d:Yr,gecko3d:Ua,opera12:Ja,any3d:xu,mobile:ii,mobileWebkit:ii&&Vr,mobileWebkit3d:ii&&Yr,mobileOpera:ii&&window.opera,mobileGecko:ii&&Za,touch:!!Mu,msPointer:!!Ba,pointer:!!Wa,retina:Xa>1,devicePixelRatio:Xa,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:ze&&document.documentMode===9,ie10:ze&&document.documentMode===10,webgl:Tu,imageBitMap:wu,resizeObserver:Cu,btoa:Pu,decodeImageInWorker:Xr,monitorDPRChange:!0,supportsPassive:qa,removeDPRListening:function(a){a&&delete Gi[a.id]},checkDevicePixelRatio:function(){if(typeof window<"u"&&Zt.monitorDPRChange){var a=Ga(),i=a!==Zt.devicePixelRatio;return i&&(Zt.devicePixelRatio=a),i}return!1},addDPRListening:function(a){a&&(Gi[a.id]=a)}},typeof window<"u"&&window.matchMedia)for(var qr=1;qr<500;qr++){var bu=(qr*.01).toFixed(2),ri=window.matchMedia("screen and (resolution: "+bu+"dppx)");ri&&(ri.addEventListener?ri.addEventListener("change",Zt.checkDevicePixelRatio):ri.addListener&&ri.addListener(Zt.checkDevicePixelRatio))}if(Zt.devicePixelRatio){var $r=Zt.devicePixelRatio;Object.defineProperty(Zt,"devicePixelRatio",{get:function(){return $r},set:function(a){if(a!==$r&&($r=a,!!Zt.monitorDPRChange))for(var i in Gi){var r=Gi[i];if(!(!r||!r.options||r.options.devicePixelRatio||!r.checkSize||!r.getRenderer)){var t=r.getRenderer();t&&r.checkSize(!0)}}}})}}var q=Zt;function z(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}function xt(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}var as=function(){function o(i,r,t){if(!C(i)&&!C(r)?(this.x=+i,this.y=+r,this.z=t):!C(i.x)&&!C(i.y)?(this.x=+i.x,this.y=+i.y,this.z=i.z):Array.isArray(i)&&(this.x=+i[0],this.y=+i[1],this.z=i[2]),this._isNaN())throw new Error("Position is NaN")}var a=o.prototype;return a.set=function(r,t,e){return this.x=r,this.y=t,this.z=e||0,this},a.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},a._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},a._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},a.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},a._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},a.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},a.distanceTo=function(r){var t=r.x-this.x,e=r.y-this.y;return Math.sqrt(t*t+e*e)},a.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},a.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},a.copy=function(){return new this.constructor(this.x,this.y,this.z)},a._add=function(r,t){return C(r.x)?C(r[0])?(this.x+=r,this.y+=t):(this.x+=r[0],this.y+=r[1]):(this.x+=r.x,this.y+=r.y),this},a.add=function(r,t){var e,n;return C(r.x)?C(r[0])?(e=this.x+r,n=this.y+t):(e=this.x+r[0],n=this.y+r[1]):(e=this.x+r.x,n=this.y+r.y),new this.constructor(e,n)},a._sub=function(r,t){return C(r.x)?C(r[0])?(this.x-=r,this.y-=t):(this.x-=r[0],this.y-=r[1]):(this.x-=r.x,this.y-=r.y),this},a._substract=function(){return this._sub.apply(this,arguments)},a.sub=function(r,t){var e,n;return C(r.x)?C(r[0])?(e=this.x-r,n=this.y-t):(e=this.x-r[0],n=this.y-r[1]):(e=this.x-r.x,n=this.y-r.y),new this.constructor(e,n)},a.substract=function(){return this.sub.apply(this,arguments)},a.multi=function(r){return new this.constructor(this.x*r,this.y*r)},a._multi=function(r){return this.x*=r,this.y*=r,this},a.div=function(r){return this.multi(1/r)},a._div=function(r){return this._multi(1/r)},a.equals=function(r){return r instanceof this.constructor?this.x===r.x&&this.y===r.y&&this.z===r.z:!1},a._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},a.isZero=function(){return this.x===0&&this.y===0},a.toArray=function(){return N(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},a.toFixed=function(r){return new this.constructor(this.x.toFixed(r),this.y.toFixed(r))},a.toJSON=function(){return{x:this.x,y:this.y}},o}(),S=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},i.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.unit=function(){return this.copy()._unit()},i._unit=function(){return this._div(this.mag()),this},i.perp=function(){return this.copy()._perp()},i._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},i.angleWith=function(t){return this.angleWithSep(t.x,t.y)},i.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},i._rotate=function(t){var e=Math.cos(t),n=Math.sin(t),s=e*this.x-n*this.y,h=n*this.x+e*this.y;return this.x=s,this.y=h,this},i.rotate=function(t){return this.copy()._rotate(t)},a}(as),Xt,Ci;(function(){if(pt){Xt=function(n){return setTimeout(n,16)},Ci=clearTimeout;return}var o,a,i=1e3/30;function r(e){return setTimeout(e,i)}function t(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}typeof window<"u"?(o=window.requestAnimationFrame||t("RequestAnimationFrame")||r,a=window.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)}):(o=r,a=clearTimeout),Xt=function(n){return o(n)},Ci=function(n){n&&a(n)}})();function Se(o){var a="data:image/svg+xml";return o.length>4&&o.slice(-4)===".svg"?1:o.slice(0,a.length)===a?2:0}function Pi(o,a){if(pt&&Pi.node){Pi.node(o,a);return}o.src=a[0]}var Eu=0;function Ce(){return Eu++}var Ru=Ce;function Tr(o){return!o||!$(o)?o:JSON.parse(o)}function ke(o){for(var a=1;a<arguments.length;a++){var i=arguments[a];if(i)for(var r=0,t=i.length;r<t;r++)o.push(i[r])}return o.length}function ar(o,a){var i=a.indexOf(o);i>-1&&a.splice(i,1)}function Re(o,a,i){if(!Array.isArray(o))return i?a.call(i,o):a(o);for(var r=[],t,e,n=0,s=o.length;n<s;n++){if(t=o[n],C(t)){r.push(null);continue}Array.isArray(t)?r.push(Re(t,a,i)):(e=i?a.call(i,t):a(t),r.push(e))}return r}function B(o,a){return o===void 0?a:o}function yt(o){return Math.sign?Math.sign(o):(o=+o,o===0||isNaN(o)?Number(o):o>0?1:-1)}function Sn(o){if(Math.log2)return Math.log2(o);var a=Math.log(o)*Math.LOG2E,i=Math.round(a);return Math.abs(i-a)<1e-14?i:a}function or(o,a,i){return o*(1-i)+a*i}function ye(o,a,i){if(o===i||o===a)return o;var r=i-a,t=((o-a)%r+r)%r+a;return t}function sr(o,a,i){return Math.min(i,Math.max(a,o))}function rt(o){return Array.isArray(o)&&o.length>0}var Au=/^([a-z][a-z\d+\-.]*:)?\/\//i;function Ou(o){return Au.test(o)}var os=/^url\((['"])(.+)\1\)$/i,ss=/^url\(([^'"].*[^'"])\)$/i;function hs(o){return $(o)?ss.test(o)?1:os.test(o)?2:3:0}function Sr(o){var a=hs(o),i;return a===3?o:a===1?(i=ss.exec(o),i[1]):a===2?(i=os.exec(o),i[2]):o}var ku="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function us(o){if(q.btoa)return window.btoa(o);for(var a=String(o),i="",r,t,e=0,n=ku;a.charAt(e|0)||(n="=",e%1);i+=n.charAt(63&r>>8-e%1*8)){if(t=a.charCodeAt(e+=3/4),t>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|t}return i}function ls(o,a){for(var i=atob(o),r=new ArrayBuffer(i.length),t=new Uint8Array(r),e=0;e<i.length;e++)t[e]=i.charCodeAt(e)&255;var n=new Blob([r],{type:a});return n}function hr(o,a,i,r){var t=i-o,e=r-a;return Math.atan2(e,t)}var Hn="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function ur(o,a){if(!o&&!a)return!0;if(!o||!a)return!1;for(var i in o)if(i==="center"){if(!a[i]||!$a(o[i][0],a[i][0])||!$a(o[i][1],a[i][1]))return!1}else if(o[i]!==a[i])return!1;return!0}function $a(o,a,i){return i==null&&(i=1e-6),o>=a-i&&o<=a+i}function Fn(o,a,i,r){o||(o=100),a||(a=4);var t=this;a*=2,this._flashTimeout&&clearTimeout(this._flashTimeout);function e(){if(a===0){t.show(),i&&(r?i.call(r):i());return}a%2===0?t.hide():t.show(),a--,t._flashTimeout=setTimeout(e,o)}return this._flashTimeout=setTimeout(e,o),this}function Du(o,a){for(var i=Object.getOwnPropertyNames(a),r=0;r<i.length;r++){var t=i[r],e=Object.getOwnPropertyDescriptor(a,t);e&&e.configurable&&o[t]===void 0&&Object.defineProperty(o,t,e)}return o}function Mi(o,a){o===void 0&&(o=[]),a===void 0&&(a="_pt");for(var i=[],r=0,t=o.length;r<t;r++){var e=o[r];if(!e){i.push(null);continue}e[a]||(e[a]=new S(0,0));var n=e[a];n.x=0,n.y=0,i.push(n)}return i}var fs;if(q.decodeImageInWorker){var Qr=document.createElement("canvas");Qr.width=1,Qr.height=1,fs=Qr.getContext("2d")}function Gn(o,a){var i=fs.createImageData(o.width,o.height);i.data.set(o.data),createImageBitmap(i).then(function(r){a(r)})}function Nn(o){if(o&&o.indexOf("http://")===0||o.indexOf("https://")===0)return o;var a=document.createElement("a");return a.href=o,o=a.href,a=null,o}var ni={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function Zn(o,a){a===void 0&&(a=1);var i=o.width,r=o.height;return ni.cssWidth=i+"px",ni.cssHeight=r+"px",ni.width=Math.round(i*a),ni.height=Math.round(r*a),ni}function cs(o,a){var i,r,t;if(!_t(o))i=function(){return o},r=!0,t=!0;else{var e=o.stops&&typeof o.stops[0][0]=="object",n=e||o.property!==void 0,s=e||!n,h=o.type||a||"exponential",u;if(h==="exponential")u=Qa;else if(h==="interval")u=zu;else if(h==="categorical")u=Iu;else if(h==="identity")u=ju;else throw new Error('Unknown function type "'+h+'"');if(e){for(var l={},f=[],c=0;c<o.stops.length;c++){var d=o.stops[c];l[d[0].zoom]===void 0&&(l[d[0].zoom]={zoom:d[0].zoom,type:o.type,property:o.property,default:o.default,stops:[]}),l[d[0].zoom].stops.push([d[0].value,d[1]])}for(var g in l)f.push([l[g].zoom,cs(l[g])]);i=function(m,_){var p=Qa({stops:f,base:o.base},m)(m,_);return typeof p=="function"?p(m,_):p},r=!1,t=!1}else s?(i=function(m){var _=u(o,m);return typeof _=="function"?_(m):_},r=!0,t=!1):(i=function(m,_){var p=u(o,_?_[o.property]:null);return typeof p=="function"?p(m,_):p},r=!1,t=!0)}return i.isZoomConstant=t,i.isFeatureConstant=r,i}function Lu(o,a,i){return o!==void 0?o:a!==void 0?a:i!==void 0?i:null}function Iu(o,a){for(var i=0;i<o.stops.length;i++)if(a===o.stops[i][0])return o.stops[i][1];return o.default}function zu(o,a){for(var i=0;i<o.stops.length&&!(a<o.stops[i][0]);i++);return o.stops[Math.max(i-1,0)][1]}function Qa(o,a){for(var i=o.base!==void 0?o.base:1,r=0;!(r>=o.stops.length);){if(a<=o.stops[r][0])break;r++}return r===0?o.stops[r][1]:r===o.stops.length?o.stops[r-1][1]:ds(a,i,o.stops[r-1][0],o.stops[r][0],o.stops[r-1][1],o.stops[r][1])}function ju(o,a){return Lu(a,o.default)}function ds(o,a,i,r,t,e){return typeof t=="function"?function(){var n=t.apply(void 0,arguments),s=e.apply(void 0,arguments);return ds(o,a,i,r,n,s)}:t.length?Hu(o,a,i,r,t,e):gs(o,a,i,r,t,e)}function gs(o,a,i,r,t,e){var n=r-i,s=o-i,h;return a===1?h=s/n:h=(Math.pow(a,s)-1)/(Math.pow(a,n)-1),t*(1-h)+e*h}function Hu(o,a,i,r,t,e){for(var n=[],s=0;s<t.length;s++)n[s]=gs(o,a,i,r,t[s],e[s]);return n}function _t(o){return o&&typeof o=="object"&&(o.stops||o.property&&o.type==="identity")}function vs(o){for(var a in o)if(_t(o[a]))return!0;return!1}function ms(o){return _s(o,"exponential")}function Bn(o,a){if(!o)return null;var i=!1;if(Array.isArray(o)){for(var r=[],t,e=0;e<o.length;e++)t=Bn(o[e],a),t?(r.push(t),i=!0):r.push(o[e]);return i?r:o}var n={__fn_types_loaded:!0},s=[],h;for(h in o)o.hasOwnProperty(h)&&s.push(h);for(var u=function(d){Object.defineProperty(n,d,{get:function(){return this["__fn_"+d]||(this["__fn_"+d]=ms(this["_"+d])),this["__fn_"+d].apply(this,a())},set:function(v){this["_"+d]=v},configurable:!0,enumerable:!0})},l=0,f=s.length;l<f;l++)h=s[l],_t(o[h])?(i=!0,n["_"+h]=o[h],u(h)):n[h]=o[h];return i?n:o}function Ka(o){if(!o||!o.stops)return[];for(var a=[],i=0,r=o.stops.length;i<r;i++)a.push(o.stops[i][1]);return a}function _s(o,a){if(!_t(o))return function(){return o};o=JSON.parse(JSON.stringify(o));var i=!0,r=!0,t=o.stops;if(t){for(var e=0;e<t.length;e++)if(_t(t[e][1])){var n=_s(t[e][1],a);i=i&&n.isZoomConstant,r=r&&n.isFeatureConstant,t[e]=[t[e][0],n]}}var s=cs(o,a);return s.isZoomConstant=i&&s.isZoomConstant,s.isFeatureConstant=r&&s.isFeatureConstant,s}var Wn=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Vn(o){return new Function("f","var p = (f && f.properties || {}); return "+ps(o))}function ps(o){if(!o)return"true";var a=o[0];if(o.length<=1)return a==="any"?"false":"true";var i=a==="=="?Kr(o[1],o[2],"===",!1):a==="!="?Kr(o[1],o[2],"!==",!1):a==="<"||a===">"||a==="<="||a===">="?Kr(o[1],o[2],a,!0):a==="any"?tn(o.slice(1),"||"):a==="all"?tn(o.slice(1),"&&"):a==="none"?en(tn(o.slice(1),"||")):a==="in"?to(o[1],o.slice(2)):a==="!in"?en(to(o[1],o.slice(2))):a==="has"?eo(o[1]):a==="!has"?en(eo(o[1])):"true";return"("+i+")"}function ys(o){return o[0]==="$"?"f."+o.substring(1):"p["+JSON.stringify(o)+"]"}function Kr(o,a,i,r){var t=ys(o),e=o==="$type"?Wn.indexOf(a):JSON.stringify(a);return(r?"typeof "+t+"=== typeof "+e+"&&":"")+t+i+e}function tn(o,a){return o.map(ps).join(a)}function to(o,a){o==="$type"&&(a=a.map(function(t){return Wn.indexOf(t)}));var i=JSON.stringify(a.sort(Fu)),r=ys(o);return a.length<=200?i+".indexOf("+r+") !== -1":`function(v, a, i, j) {
        while (i <= j) { var m = (i + j) >> 1;
            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;
        }
    return false; }(`+r+", "+i+",0,"+(a.length-1)+")"}function eo(o){return o==="$id"?'"id" in f':JSON.stringify(o)+" in p"}function en(o){return"!("+o+")"}function Fu(o,a){return o<a?-1:o>a?1:0}function bn(o){var a=o._toJSON(),i=a.feature;return i.type=Wn.indexOf(i.geometry.type),i.subType=a.subType,i}function xs(o){if(!Array.isArray(o))return xs([o]);for(var a=[],i=0;i<o.length;i++){var r=void 0;o[i].filter===!0?r=function(){return!0}:r=Vn(o[i].filter),a.push(Gu({},o[i],{filter:r}))}return a}function Gu(o){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var r in i)o[r]=i[r]}return o}var Nu=[],Zu={};function lr(o,a){return Bn(o,function(){var i=a.getMap();return Bu(Nu,i?i.getZoom():12,H({},a.getProperties(),Wu(Zu,i&&i.getBearing()||0,i&&i.getPitch()||0,i?i.getZoom():10)))})}function Bu(o,a,i){return o[0]=a,o[1]=i,o}function Wu(o,a,i,r){return o["{bearing}"]=a,o["{pitch}"]=i,o["{zoom}"]=r,o}function ws(o){var a={stroke:{stroke:o.markerLineColor,"stroke-width":o.markerLineWidth,"stroke-opacity":o.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:o.markerFill,"fill-opacity":o.markerFillOpacity}};return a.stroke["stroke-width"]===0&&(a.stroke["stroke-opacity"]=0),a}function Ti(o,a,i){if(!o.markerPath)return null;var r=1,t=ws(o);N(o.markerOpacity)&&(r=o.markerOpacity),N(o.opacity)&&(r*=o.opacity);var e={};if(t){for(var n in t.stroke)t.stroke.hasOwnProperty(n)&&(C(t.stroke[n])||(e[n]=t.stroke[n]));for(var s in t.fill)t.fill.hasOwnProperty(s)&&(C(t.fill[s])||(e[s]=t.fill[s]))}for(var h=Array.isArray(o.markerPath)?o.markerPath:[o.markerPath],u,l=[],f=0;f<h.length;f++)u=$(h[f])?{path:h[f]}:h[f],u=H({},u,e),u.d=u.path,delete u.path,l.push(u);var c=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];r<1&&c.push('opacity="'+r+'"'),o.markerPathWidth&&o.markerPathHeight&&c.push('viewBox="0 0 '+o.markerPathWidth+" "+o.markerPathHeight+'"'),c.push('preserveAspectRatio="none"'),a&&c.push('width="'+a+'"'),i&&c.push('height="'+i+'"'),c.push("><defs></defs>");for(var d=0;d<l.length;d++){var g="<path ";for(var v in l[d])l[d].hasOwnProperty(v)&&(g+=" "+v+'="'+l[d][v]+'"');g+="></path>",c.push(g)}c.push("</svg>");var m="data:image/svg+xml;base64,"+us(c.join(" "));return m}function bi(o,a){if(!o)return[];var i=o;Array.isArray(o)||(i=[o]);for(var r=[],t=es,e,n,s,h,u=i.length-1;u>=0;u--)if(o=i[u],!!o){a&&(o=fr(o));for(var l=0;l<t.length;l++)if(e=o[t[l]],_t(e)&&(e=Ka(e)),!!e){Array.isArray(e)||(e=[e]);for(var f=0;f<e.length;f++)e[f].slice(0,4)==="url("&&(e[f]=Sr(e[f])),n=gu[l],r.push([e[f],o[n[0]],o[n[1]]])}if(o.markerType==="path"&&o.markerPath)if(s=_t(o.markerWidth)?200:o.markerWidth,h=_t(o.markerHeight)?200:o.markerHeight,_t(o.markerPath)){e=Ka(o.markerPath);for(var c=o.markerPath,d=0;d<e.length;d++)o.markerPath=e[d],r.push([Ti(o),s,h]);o.markerPath=c}else r.push([Ti(o),s,h])}return r}function fr(o){if(!o)return null;var a=o;if(pt)return a;for(var i=es,r,t=0,e=i.length;t<e;t++)r=a[i[t]],r&&(a[i[t]]=Cs(r));return a}function Cs(o){if(_t(o)){for(var a=o.stops,i=0;i<a.length;i++)a[i][1]=Cs(a[i][1]);return o}return o.slice(0,4)==="url("&&(o=Sr(o)),o}var vt=function(){function o(i,r){N(i)&&N(r)?(this.width=i,this.height=r):N(i.width)?(this.width=i.width,this.height=i.height):Array.isArray(i)&&(this.width=i[0],this.height=i[1])}var a=o.prototype;return a.copy=function(){return new o(this.width,this.height)},a.add=function(r,t){var e,n;return r instanceof o?(e=this.width+r.width,n=this.height+r.height):(e=this.width+r,n=this.height+t),new o(e,n)},a.equals=function(r){return this.width===r.width&&this.height===r.height},a.multi=function(r){return new o(this.width*r,this.height*r)},a._multi=function(r){return this.width*=r,this.height*=r,this},a._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},a.toPoint=function(){return new S(this.width,this.height)},a.toArray=function(){return[this.width,this.height]},a.toJSON=function(){return{width:this.width,height:this.height}},o}();function Un(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}var Vu=/[\b\t\r\v\f]/igm;function br(o){return $(o)?o.replace(Vu,""):o}function Ps(o){return Un(o).split(/\s+/)}var io=typeof document<"u"?document.createElement("canvas").getContext("2d"):null;function pe(o,a){return pe.node?pe.node(o,a):(io.font=a,io.measureText(o).width)}function Jn(o,a,i){var r=pe(o,a);return new vt(r,i||is)}function En(o,a,i,r){if(!o||o.length===0)return[{text:"",width:0}];var t=C(r)?pe(o,a):r,e=t/o.length,n=Math.floor(i/e/2);if(e>=i||n<=0)return[{text:"",width:i}];if(t<=i)return[{text:o,width:t}];for(var s=[],h=o.substring(0,n),u=e*n,l=n,f=o.length;l<f;l++){var c=o[l],d=pe(h+c);d>=i?(s.push({text:h,width:u}),h=o.substring(l,n+l),l+=n-1,u=e*n):(h+=c,u=d),l>=f-1&&(u=pe(h),s.push({text:h,width:u}))}return s}var Ms=/\{([\w_]+)\}/g;function cr(o,a){return $(o)?o.replace(Ms,function(i,r){if(!a)return"";var t=a[r];return C(t)?"":Array.isArray(t)?t.join():t}):o}function dr(o,a){N(o)&&(o+=""),o=o||"";var i=a.textMaxHeight||0,r=Xn(o,a);return i&&i<r.size.height&&(r.size.height=i),r}function xe(o,a,i){var r=o.width,t=o.height,e,n;return a==="left"?e=-r:a==="right"?e=0:e=-r/2,i==="top"?n=-t:i==="bottom"?n=0:n=-t/2,new S(e,n)}var Uu="monospace";function Yn(o){return o.textFont?o.textFont:(o.textStyle&&o.textStyle!=="normal"?o.textStyle+" ":"")+(o.textWeight&&o.textWeight!=="normal"?o.textWeight+" ":"")+o.textSize+"px "+(o.textFaceName?o.textFaceName[0]==='"'?o.textFaceName:'"'+o.textFaceName+'"':Uu)}function Xn(o,a){var i=Yn(a),r=a.textLineSpacing||0,t=Jn(o,i,a.textSize),e=t.width,n=t.height,s=a.textWrapCharacter,h=[],u=a.textWrapWidth;(!u||u>e)&&(u=e),$(o)||(o+="");var l=0;if(s&&o.indexOf(s)>=0)for(var f=o.split(s),c=0,d=f.length;c<d;c++){var g=f[c],v=pe(g,i);if(v>u)for(var m=En(g,i,u,v),_=0,p=m.length;_<p;_++){var y=m[_].width;y>l&&(l=y),h.push({text:m[_].text,size:new vt(y,n)})}else v>l&&(l=v),h.push({text:g,size:new vt(v,n)})}else if(e>u)for(var x=En(o,i,u,e),M=0;M<x.length;M++){var w=x[M].width;w>l&&(l=w),h.push({text:x[M].text,size:new vt(w,n)})}else e>l&&(l=e),h.push({text:o,size:t});var b=h.length,T=new vt(l,n*b+r*(b-1));return{total:b,size:T,rows:h,rawSize:t}}function qn(o){var a=0,i=o&&o.length||0;if(!i)return a;for(var r,t=0;t<i;t++)r=o.charCodeAt(t),a=(a<<5)-a+r,a=a&a;return a}function ne(o){return o&&o.colorStops}function Rn(o){var a=[o.type];if(o.places&&a.push(o.places.join()),o.colorStops){for(var i=[],r=o.colorStops.length-1;r>=0;r--)i.push(o.colorStops[r].join());a.push(i.join(","))}return a.join("_")}function Ju(o,a){return Ei(o,a)}function Ei(o,a){if(!o)return 1;var i=[];if(Array.isArray(o)){for(var r=0;r<o.length;r++)i.push(Ei(o[r],a));return i.sort().join(",")}var t=Object.keys(o).sort(),e=t.reduce(function(s,h){return(!a||h.indexOf(a)===0)&&(s[h]=o[h]),s},{}),n=qn(JSON.stringify(e));return n}function gr(o,a){function i(n,s){var h=n.opacity;C(h)?n.opacity=s:n.opacity*=s}var r;if(Array.isArray(o)){r=[];for(var t=0;t<o.length;t++){var e=H({},o[t]);i(e,a),r.push(e)}}else r=H({},o),i(r,a);return r}function Wt(o){var a=Array.prototype.slice.call(arguments,1);if((!a||!a.length)&&(a=[{}]),Array.isArray(o)){for(var i,r,t=[],e=0,n=o.length;e<n;e++){i=o[e],r={};for(var s=0,h=a.length;s<h;s++)Array.isArray(a[s])?C(a[s][e])?H(r,i||{}):H(r,i,a[s][e]):H(r,i,a[s]?a[s]:{});t.push(r)}return t}else{var u=[{},o];return u.push.apply(u,a),H.apply(this,u)}}function Ts(o){if(o.symbol&&(o=[o]),Array.isArray(o))return o;var a=o.$root,i=o.$iconset;if(o=o.style,a||i){a&&a[a.length-1]==="/"&&(a=a.substring(0,a.length-1)),i&&i[i.length-1]==="/"&&(i=i.substring(0,i.length-1));var r=function(e){return e==="{$root}"?a:e==="{$iconset}"?i:null};Ss(o,r)}return o}function Ss(o,a){for(var i=0;i<o.length;i++){var r=o[i].symbol;r&&$n(r,a)}}var An=/(\{\$root\}|\{\$iconset\})/g;function $n(o,a){for(var i in o)o.hasOwnProperty(i)&&i!=="textName"&&($(o[i])&&o[i].length>2?o[i]=o[i].replace(An,a):_t(o[i])?o[i]=bs(o[i],a):Gt(o[i])&&$n(o[i],a))}function bs(o,a){var i=o.default;$(i)&&(o.default=i.replace(An,a));for(var r=o.stops,t=0;t<r.length;t++)!Array.isArray(r[t])||($(r[t][1])?r[t][1]=r[t][1].replace(An,a):_t(r[t][1])&&(r[t][1]=bs(r[t][1],a)));return o}function Es(o){o===void 0&&(o=[]),Array.isArray(o)||(o=[o]);for(var a=o.length,i=0;i<a;i++){var r=o[i];if(!!r.style){var t=r.style,e=t.lineDasharray,n=t.lineWidth;if(n&&N(n)&&n>0&&e&&Array.isArray(e)&&e.length)return!0}}return!1}var gd=Object.freeze({now:lt,extend:H,isNil:C,isNumber:N,isInteger:ie,isObject:Gt,isString:$,isFunction:nt,hasOwn:Xe,join:pu,isEmpty:yu,toRadian:Ct,toDegree:ns,IS_NODE:pt,get requestAnimFrame(){return Xt},get cancelAnimFrame(){return Ci},isSVG:Se,loadImage:Pi,UID:Ce,GUID:Ru,parseJSON:Tr,pushIn:ke,removeFromArray:ar,forEachCoord:Re,getValueOrDefault:B,sign:yt,log2:Sn,interpolate:or,wrap:ye,clamp:sr,isArrayHasData:rt,isURL:Ou,isCssUrl:hs,extractCssUrl:Sr,btoa:us,b64toBlob:ls,computeDegree:hr,emptyImageUrl:Hn,equalMapView:ur,flash:Fn,_defaults:Du,getPointsResultPts:Mi,getImageBitMap:Gn,getAbsoluteURL:Nn,calCanvasSize:Zn,translateToSVGStyles:ws,getMarkerPathBase64:Ti,getExternalResources:bi,convertResourceUrl:fr,isGradient:ne,getGradientStamp:Rn,getSymbolStamp:Ju,getSymbolHash:Ei,lowerSymbolOpacity:gr,extendSymbol:Wt,parseStyleRootPath:Ts,convertStylePath:Ss,parseSymbolPath:$n,isDashLine:Es,trim:Un,escapeSpecialChars:br,splitWords:Ps,stringWidth:pe,stringLength:Jn,splitContent:En,CONTENT_EXPRE:Ms,replaceVariable:cr,describeText:dr,getAlignPoint:xe,getFont:Yn,splitTextToRow:Xn,hashCode:qn}),Yu=function(a){return a[0]},Er=pt?Yu:function(o){for(var a=document.documentElement.style,i=0;i<o.length;i++)if(o[i]in a)return o[i];return!1},Bt=Er(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),Rs=Er(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),_i=Er(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]),Xu=Er(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function W(o,a){var i=document.createElement(o);return a&&Ar(i,a),i}function On(o,a,i){var r=W(o);return a&&Rr(r,a),i&&i.appendChild(r),r}function Ae(o){if(!o)return this;if(q.ielt9||q.ie9){var a=W("div");a.appendChild(o),a.innerHTML="",a=null}else o.parentNode&&o.parentNode.removeChild(o);return this}function re(o,a,i,r){if(!o||!o.addEventListener||!a||!i)return this;for(var t=function(l){l||(l=window.event),i.call(r||o,l)},e=a.split(" "),n=e.length-1;n>=0;n--){var s=e[n];if(!!s){o["Z__"+s]||(o["Z__"+s]=[]);var h=Qn(o,s,i);h>=0&&Pe(o,s,i),o["Z__"+s].push({callback:t,src:i}),o.addEventListener(s,t,q.supportsPassive?{capture:!1,passive:!1}:!1)}}return this}function Pe(o,a,i){function r(c,d){c==="mousewheel"&&q.gecko&&(c="DOMMouseScroll"),o.removeEventListener(c,d,!1)}if(!o||!o.removeEventListener||!a)return this;for(var t=a.split(" "),e=t.length-1;e>=0;e--){var n=t[e];if(!!n){if(!i&&o["Z__"+n]){for(var s=o["Z__"+n],h=0,u=s.length;h<u;h++)r(s[h].callback);return delete o["Z__"+n],this}var l=Qn(o,n,i);if(l<0)return this;var f=o["Z__"+n][l];r(n,f.callback),o["Z__"+n].splice(l,1)}}return this}function Qn(o,a,i){if(!o||!o["Z__"+a]||!i)return-1;for(var r=o["Z__"+a],t=0,e=r.length;t<e;t++)if(r[t].src===i)return t;return-1}function It(o){return o.preventDefault?o.preventDefault():o.returnValue=!1,this}function Lt(o){return o.stopPropagation?o.stopPropagation():o.cancelBubble=!0,this}function As(o){return o.onselectstart=function(){return!1},o.ondragstart=function(){return!1},o.setAttribute("unselectable","on"),this}function pi(o,a){return o?(q.any3d?Os(o,a):(o.style.left=a.x+"px",o.style.top=a.y+"px"),a):null}function Ri(o){var a=window.getComputedStyle(o),i=[parseInt(a["padding-left"]),parseInt(a["padding-top"])],r=o.getBoundingClientRect(),t=o.offsetWidth,e=o.offsetHeight,n=t?r.width/t:1,s=e?r.height/e:1;return o.__position=[r.left+i[0],r.top+i[1],n,s],o.__position}function Et(o,a){o||(o=window.event);var i=a.__position;return i||(i=Ri(a)),new S((o.clientX-i[0]-a.clientLeft)/i[2],(o.clientY-i[1]-a.clientTop)/i[3])}function qu(o,a){var i=o.length-a.length;return i>=0&&o.indexOf(a,i)===i}function Rr(o,a){var i=o.style.cssText;return qu(i,";")||(i+=";"),o.style.cssText=i+a,this}function Kn(o,a){if(o.classList!==void 0)return o.classList.contains(a);var i=ta(o);return i.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(i)}function be(o,a){if(o.classList!==void 0&&!Kn(o,a))for(var i=Ps(a),r=0,t=i.length;r<t;r++)o.classList.add(i[r]);else{var e=ta(o);Ar(o,(e?e+" ":"")+a)}return this}function Ar(o,a){return C(o.className.baseVal)?o.className=a:o.className.baseVal=a,this}function ta(o){return C(o.className.baseVal)?o.className:o.className.baseVal}function $u(o,a){return o.style.opacity=a,this}function Os(o,a){var i=a||new S(0,0);return o.style[Bt]=q.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)",this}function Qu(o,a){var i="matrix("+($(a)?a:a.join())+")";return o.style[Bt]!==i&&(o.style[Bt]=i),this}function Ku(o){return o.style[Bt]&&(o.style[Bt]=""),this}function ks(o){return/<[a-z\][\s\S]*>/i.test(o)}function Ds(o,a){var i=Ls(o);$(a)?i.innerHTML=a:i.appendChild(a);var r=new vt(i.clientWidth,i.clientHeight);return Ae(i),r}function Ls(o){var a=document.createElement(o);return a.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(a),a}var ct=re,ut=Pe,vd=Object.freeze({TRANSFORM:Bt,TRANSFORMORIGIN:Rs,TRANSITION:_i,CSSFILTER:Xu,createEl:W,createElOn:On,removeDomNode:Ae,addDomEvent:re,removeDomEvent:Pe,listensDomEvent:Qn,preventDefault:It,stopPropagation:Lt,preventSelection:As,offsetDom:pi,computeDomPosition:Ri,getEventContainerPoint:Et,setStyle:Rr,hasClass:Kn,addClass:be,setClass:Ar,getClass:ta,setOpacity:$u,setTransform:Os,setTransformMatrix:Qu,removeTransform:Ku,isHTML:ks,measureDom:Ds,getDomRuler:Ls,on:ct,off:ut}),Is=typeof Map=="function",zs=function(){},tl=function(){function o(i,r){this.max=i,this.onRemove=r||zs,this.reset()}var a=o.prototype;return a.reset=function(){for(var r in this.data)this.onRemove(this.data[r]);return this.data={},this.order=[],this},a.clear=function(){this.reset(),delete this.onRemove},a.add=function(r,t){if(this.has(r))this.order.splice(this.order.indexOf(r),1),this.data[r]=t,this.order.push(r);else if(this.data[r]=t,this.order.push(r),this.order.length>this.max){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},a.has=function(r){return r in this.data},a.keys=function(){return this.order},a.getAndRemove=function(r){if(!this.has(r))return null;var t=this.data[r];return delete this.data[r],this.order.splice(this.order.indexOf(r),1),t},a.get=function(r){if(!this.has(r))return null;var t=this.data[r];return t},a.remove=function(r){if(!this.has(r))return this;var t=this.data[r];return delete this.data[r],this.onRemove(t),this.order.splice(this.order.indexOf(r),1),this},a.setMaxSize=function(r){for(this.max=r;this.order.length>this.max;){var t=this.getAndRemove(this.order[0]);t&&this.onRemove(t)}return this},o}(),js;Is&&(js=function(){function o(i,r){this.max=i,this.onRemove=r||zs,this.reset()}var a=o.prototype;return a.reset=function(){if(this.data)for(var r=this.data.values(),n=r,t=Array.isArray(n),e=0,n=t?n:n[Symbol.iterator]();;){var s;if(t){if(e>=n.length)break;s=n[e++]}else{if(e=n.next(),e.done)break;s=e.value}var h=s;this.onRemove(h)}return this.data=new Map,this},a.clear=function(){this.reset(),delete this.onRemove},a.add=function(r,t){return t?(this.has(r)?(this.data.delete(r),this.data.set(r,t),this.data.size>this.max&&this.shrink()):this.data.set(r,t),this):this},a.keys=function(){for(var r=new Array(this.data.size),t=0,e=this.data.keys(),h=e,n=Array.isArray(h),s=0,h=n?h:h[Symbol.iterator]();;){var u;if(n){if(s>=h.length)break;u=h[s++]}else{if(s=h.next(),s.done)break;u=s.value}var l=u;r[t++]=l}return r},a.shrink=function(){for(var r=this.data.keys(),t=r.next();this.data.size>this.max;){var e=this.getAndRemove(t.value);e&&this.onRemove(e),t=r.next()}},a.has=function(r){return this.data.has(r)},a.getAndRemove=function(r){if(!this.has(r))return null;var t=this.data.get(r);return this.data.delete(r),t},a.get=function(r){if(!this.has(r))return null;var t=this.data.get(r);return t},a.remove=function(r){if(!this.has(r))return this;var t=this.data.get(r);return this.data.delete(r),this.onRemove(t),this},a.setMaxSize=function(r){return this.max=r,this.data.size>this.max&&this.shrink(),this},o}());var Hs=Is?js:tl,Dt={jsonp:function(a,i){var r="_maptalks_jsonp_"+Ce();a.match(/\?/)?a+="&callback="+r:a+="?callback="+r;var t=document.createElement("script");return t.type="text/javascript",t.src=a,window[r]=function(e){i(null,e),document.getElementsByTagName("head")[0].removeChild(t),t=null,delete window[r]},document.getElementsByTagName("head")[0].appendChild(t),this},get:function(a,i,r){if(nt(i)){var t=r;r=i,i=t}if(pt&&Dt.get.node)return Dt.get.node(a,r,i);var e=Dt._getClient(r);if(e.open("GET",a,!0),i){for(var n in i.headers)e.setRequestHeader(n,i.headers[n]);e.withCredentials=i.credentials==="include",i.responseType&&(e.responseType=i.responseType)}return e.send(null),e},post:function(a,i,r){var t;if($(a)){if(nt(i)){var n=r;r=i,i=n}i=i||{},t=i.postData}else{var e=r;t=i,i=a,a=i.url,r=e}if(pt&&Dt.post.node)return i.url=a,Dt.post.node(i,t,r);var s=Dt._getClient(r);if(s.open("POST",i.url,!0),i.headers||(i.headers={}),i.headers["Content-Type"]||(i.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in s)for(var h in i.headers)i.headers.hasOwnProperty(h)&&s.setRequestHeader(h,i.headers[h]);return $(t)||(t=JSON.stringify(t)),s.send(t),s},_wrapCallback:function(a,i){return function(){if(a.readyState===4)if(a.status===200)if(a.responseType==="arraybuffer"){var r=a.response;r.byteLength===0?i(new Error("http status 200 returned without content.")):i(null,{data:a.response,cacheControl:a.getResponseHeader("Cache-Control"),expires:a.getResponseHeader("Expires"),contentType:a.getResponseHeader("Content-Type")})}else i(null,a.responseText);else i(new Error(a.statusText+","+a.status))}},_getClient:function(a){var i;try{i=new XMLHttpRequest}catch{try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch{try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch{}}}return i.onreadystatechange=Dt._wrapCallback(i,a),i},getArrayBuffer:function(a,i,r){if(nt(i)){var t=r;r=i,i=t}return i||(i={}),i.responseType="arraybuffer",Dt.get(a,i,r)},getImage:function(a,i,r){return Dt.getArrayBuffer(i,r,function(t,e){if(t)a.onerror&&a.onerror(t);else if(e){var n=window.URL||window.webkitURL,s=a.onload;a.onload=function(){s&&s(),n.revokeObjectURL(a.src)};var h=new Blob([new Uint8Array(e.data)],{type:e.contentType});a.cacheControl=e.cacheControl,a.expires=e.expires,a.src=e.data.byteLength?n.createObjectURL(h):Hn}})}};Dt.getJSON=function(o,a,i){if(nt(a)){var r=i;i=a,a=r}var t=function(n,s){var h=s?Tr(s):null;i(n,h)};return a&&a.jsonp?Dt.jsonp(o,t):Dt.get(o,a,t)};var ro="#000",el="rgba(255,255,255,0)",il="#000",Ni=!1,je=null,He=Math.PI/180,no=1,L={setHitTesting:function(a){Ni=a},createCanvas:function(a,i,r){var t;return pt?t=new r(a,i):(t=W("canvas"),t.width=a,t.height=i),t},prepareCanvasFont:function(a,i){a.textBaseline="top",a.font=Yn(i);var r=i.textFill;r||(r=il),a.fillStyle=L.getRgba(r,i.textOpacity)},prepareCanvas:function(a,i,r,t){if(!!i){var e=i.lineWidth;!C(e)&&a.lineWidth!==e&&(a.lineWidth=e);var n=i.linePatternFile,s=i.lineColor||ro;if(t)a.strokeStyle="#000";else if(n&&r){var h;(i.linePatternDx||i.linePatternDy)&&(h=[i.linePatternDx,i.linePatternDy]),L._setStrokePattern(a,n,e,h,r),i.lineDasharray=[]}else ne(s)?i.lineGradientExtent?a.strokeStyle=L._createGradient(a,s,i.lineGradientExtent):a.strokeStyle=ro:(Array.isArray(s)&&(s=L.normalizeColorToRGBA(s)),a.strokeStyle=s);i.lineJoin&&(a.lineJoin=i.lineJoin),i.lineCap&&(a.lineCap=i.lineCap),a.setLineDash&&rt(i.lineDasharray)&&a.setLineDash(i.lineDasharray);var u=i.polygonPatternFile,l=i.polygonFill||el;if(t)a.fillStyle="#000";else if(u&&r){var f=oo(u),c=r.getImage([f,null,null]);if(c||(c=r.getImage([f+"-texture",null,e])),Se(f)&&c instanceof Image&&(q.edge||q.ie)){var d=c.width||20,g=c.height||20,v=L.createCanvas(d,g);L.image(v.getContext("2d"),c,0,0,d,g),c=v}c&&(a.fillStyle=a.createPattern(c,"repeat"),(i.polygonPatternDx||i.polygonPatternDy)&&(a.fillStyle.polygonPatternOffset=[i.polygonPatternDx,i.polygonPatternDy]))}else ne(l)?i.polygonGradientExtent?a.fillStyle=L._createGradient(a,l,i.polygonGradientExtent):a.fillStyle="rgba(255,255,255,0)":(Array.isArray(l)&&(l=L.normalizeColorToRGBA(l)),a.fillStyle=l)}},_createGradient:function(a,i,r){var t=null,e=i.places,n=r.getMin(),s=r.getMax(),h=r.getWidth(),u=r.getHeight();if(!i.type||i.type==="linear"){if(!e)e=[n.x,n.y,s.x,n.y];else{if(e.length!==4)throw new Error("A linear gradient's places should have 4 numbers.");e=[n.x+e[0]*h,n.y+e[1]*u,n.x+e[2]*h,n.y+e[3]*u]}t=a.createLinearGradient.apply(a,e)}else if(i.type==="radial"){if(e){if(e.length!==6)throw new Error("A radial gradient's places should have 6 numbers.");e=[n.x+e[0]*h,n.y+e[1]*u,h*e[2],n.x+e[3]*h,n.y+e[4]*u,h*e[5]]}else{var l=r.getCenter()._round();e=[l.x,l.y,Math.abs(l.x-n.x),l.x,l.y,0]}t=a.createRadialGradient.apply(a,e)}return i.colorStops.forEach(function(f){t.addColorStop.apply(t,f)}),t},_setStrokePattern:function(a,i,r,t,e){var n=oo(i),s;if(pt)s=e.getImage([n,null,r]);else{var h=n+"-texture-"+r;if(s=e.getImage(h),!s){var u=e.getImage([n,null,null]);if(u){var l;!u.width||!u.height?l=r:l=Math.round(u.width*r/u.height);var f=L.createCanvas(l,r,a.canvas.constructor);L.image(f.getContext("2d"),u,0,0,l,r),e.addResource([h,null,r],f),s=f}}}s&&(a.strokeStyle=a.createPattern(s,"repeat"),a.strokeStyle.linePatternOffset=t)},clearRect:function(a,i,r,t,e){a.canvas._drawn=!1,a.clearRect(i,r,t,e)},fillCanvas:function(a,i,r,t){if(Ni&&(i=1),a.canvas._drawn=!0,i!==0){var e=L._isPattern(a.fillStyle),n=a.fillStyle&&a.fillStyle.polygonPatternOffset,s=n?n[0]:0,h=n?n[1]:0;C(i)&&(i=1);var u;i<1&&(u=a.globalAlpha,a.globalAlpha*=i),e&&(r=r||0,t=t||0,a.translate(r+s,t+h)),a.fill(),e&&a.translate(-r-s,-t-h),i<1&&(a.globalAlpha=u)}},getRgba:function(a,i){if(C(i)&&(i=1),a[0]!=="#")return Array.isArray(a)&&(a=L.normalizeColorToRGBA(a,i)),a;var r,t,e;return a.length===7?(r=parseInt(a.substring(1,3),16),t=parseInt(a.substring(3,5),16),e=parseInt(a.substring(5,7),16)):(r=parseInt(a.substring(1,2),16)*17,t=parseInt(a.substring(2,3),16)*17,e=parseInt(a.substring(3,4),16)*17),"rgba("+r+","+t+","+e+","+i+")"},normalizeColorToRGBA:function(a,i){return i===void 0&&(i=1),"rgba("+a[0]*255+","+a[1]*255+","+a[2]*255+","+(a.length===4?a[3]:1)*i+")"},image:function(a,i,r,t,e,n){a.canvas._drawn=!0;try{N(e)&&N(n)?a.drawImage(i,r,t,e,n):a.drawImage(i,r,t)}catch{}},text:function(a,i,r,t,e){L._textOnMultiRow(a,e.rows,t,r,e.size,e.rawSize)},_textOnMultiRow:function(a,i,r,t,e,n){for(var s=xe(e,r.textHorizontalAlignment,r.textVerticalAlignment),h=n.height+r.textLineSpacing,u=t.add(0,s.y),l=r.textMaxHeight,f,c,d=0,g=0,v=i.length;g<v&&(f=i[g].text,c=xe(i[g].size,r.textHorizontalAlignment,r.textVerticalAlignment),L._textOnLine(a,f,u.add(c.x,g*h),r.textHaloRadius,r.textHaloFill,r.textHaloOpacity),!(l>0&&(d+=h,d+n.height>=l)));g++);},_textOnLine:function(a,i,r,t,e,n){Ni&&(n=1);var s=n!==0&&t!==0;a.textBaseline="top";var h,u,l=a.shadowBlur,f=a.shadowOffsetX,c=a.shadowOffsetY;if(s){var d=a.globalAlpha;a.globalAlpha*=n,a.miterLimit=2,a.lineJoin="round",a.lineCap="round",a.lineWidth=t*2,Array.isArray(e)&&(e=L.normalizeColorToRGBA(e)),a.strokeStyle=e,a.strokeText(i,r.x,r.y+no),a.miterLimit=10,a.globalAlpha=d,h=a.globalCompositeOperation,a.globalCompositeOperation="destination-out",u=a.fillStyle,a.fillStyle="#000"}l&&s&&(a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0),L.fillText(a,i,r),h&&(a.globalCompositeOperation=h,L.fillText(a,i,r,u),l&&(a.shadowBlur=l,a.shadowOffsetX=f,a.shadowOffsetY=c))},fillText:function(a,i,r,t){a.canvas._drawn=!0,t&&(a.fillStyle=t),a.fillText(i,r.x,r.y+no)},_stroke:function(a,i,r,t){if(Ni&&(i=1),a.canvas._drawn=!0,i!==0){var e=a.strokeStyle&&a.strokeStyle.linePatternOffset,n=e?e[0]:0,s=e?e[1]:0,h=L._isPattern(a.strokeStyle)&&(!C(r)&&!C(t)||!C(n)&&!C(s));C(i)&&(i=1);var u;i<1&&(u=a.globalAlpha,a.globalAlpha*=i),h&&(r=r||0,t=t||0,a.translate(r+n,t+s)),a.stroke(),h&&a.translate(-r-n,-t-s),i<1&&(a.globalAlpha=u)}},_path:function(a,i,r,t,e){if(!rt(i))return;function n(g,v){var m=hr(g.x,g.y,v.x,v.y);a.save();var _=Math.cos(m);Math.abs(_)<1e-7?a.translate(g.x-a.lineWidth/2,g.y):a.translate(g.x,g.y-a.lineWidth/2/_),a.rotate(m),L._stroke(a,t),a.restore()}for(var s=rt(r),h=e===!0?!1:L._isPattern(a.strokeStyle),u,l,f,c=0,d=i.length;c<d;c++)if(u=i[c],!s||a.setLineDash)a.lineTo(u.x,u.y),h&&c>0&&(l=i[c-1],n(l,u),a.beginPath(),a.moveTo(u.x,u.y));else if(s){if(c===d-1)break;f=i[c+1],rl(a,u,f,r)}},path:function(a,i,r,t,e){!rt(i)||(a.beginPath(),a.moveTo(i[0].x,i[0].y),L._path(a,i,e,r),L._stroke(a,r))},_multiClip:function(a,i){if(!(!i||i.length===0)){i=i[0];for(var r=0,t=i.length;r<t;r++){var e=i[r],n=e.x,s=e.y;r===0?a.moveTo(n,s):a.lineTo(n,s),r===t-1&&(n=i[0].x,s=i[0].y,a.lineTo(n,s))}}},polygon:function(a,i,r,t,e,n){if(a.isMultiClip){L._multiClip(a,i);return}if(!!rt(i)){var s=L._isPattern(a.strokeStyle),h=rt(e)&&!a.setLineDash||s&&!n;rt(i[0])||(i=[i]);var u=a;i.length>1&&!pt&&(je||(je=L.createCanvas(1,1)),a.canvas._drawn=!1,je.width=a.canvas.width,je.height=a.canvas.height,a=je.getContext("2d"),so(a,u));var l,f,c;if(h){for(a.save(),f=0,c=i.length;f<c;f++)!rt(i[f])||(L._ring(a,i[f],null,0,!0),l=t,f>0&&(a.globalCompositeOperation="destination-out",l=1),L.fillCanvas(a,l,i[f][0].x,i[f][0].y),f>0?a.globalCompositeOperation="source-over":c>1&&(a.fillStyle="#fff"),L._stroke(a,0));a.restore()}var d=a.fillStyle;for(f=0,c=i.length;f<c;f++)!rt(i[f])||(n?(L.paintSmoothLine(a,i[f],r,n,!0),a.closePath()):L._ring(a,i[f],e,r),h||(l=t,f>0&&(a.globalCompositeOperation="destination-out",l=1),L.fillCanvas(a,l,i[f][0].x,i[f][0].y),f>0?a.globalCompositeOperation="source-over":c>1&&(a.fillStyle="#fff")),L._stroke(a,r));a.fillStyle!==d&&(a.fillStyle=d),i.length>1&&!pt&&(u.drawImage(je,0,0),u.canvas._drawn=a.canvas._drawn,so(u,a))}},_ring:function(a,i,r,t,e){var n=L._isPattern(a.strokeStyle);!e&&n&&!i[0].equals(i[i.length-1])&&(i=i.concat([i[0]])),a.beginPath(),a.moveTo(i[0].x,i[0].y),L._path(a,i,r,t,e),n||a.closePath()},paintSmoothLine:function(a,i,r,t,e,n,s){if(!i)return;if(i.length<=2||!t){L.path(a,i,r);return}function h(T,P,O,I,E,D,R,A,G,F){var j=1-T,Z=1-P,V=O*j*j+E*2*T*j+R*T*T,J=O*Z*Z+E*2*P*Z+R*P*P,ot=E*j*j+R*2*T*j+G*T*T,ft=E*Z*Z+R*2*P*Z+G*P*P,et=I*j*j+D*2*T*j+A*T*T,X=I*Z*Z+D*2*P*Z+A*P*P,tt=D*j*j+A*2*T*j+F*T*T,it=D*Z*Z+A*2*P*Z+F*P*P,bt=V*Z+ot*P,Q=J*j+ft*T,wt=J*Z+ft*P,Ot=et*Z+tt*P,ht=X*j+it*T,Tt=X*Z+it*P;return[bt,Ot,Q,ht,wt,Tt]}function u(T,P,O,I,E,D,R,A,G,F){var j=(T+O)/2,Z=(P+I)/2,V=(O+E)/2,J=(I+D)/2,ot=(E+R)/2,ft=(D+A)/2,et=Math.sqrt((O-T)*(O-T)+(I-P)*(I-P)),X=Math.sqrt((E-O)*(E-O)+(D-I)*(D-I)),tt=Math.sqrt((R-E)*(R-E)+(A-D)*(A-D)),it=et/(et+X),bt=X/(X+tt),Q=j+(V-j)*it,wt=Z+(J-Z)*it,Ot=V+(ot-V)*bt,ht=J+(ft-J)*bt,Tt=Q+(V-Q)*G+O-Q,zt=wt+(J-wt)*G+I-wt,Kt=Ot+(V-Ot)*G+E-Ot,at=ht+(J-ht)*G+D-ht,se=[Tt,zt,Kt,at];return F<1?h(0,F,O,I,Tt,zt,Kt,at,E,D):se}var l=i.length,f=e?l:l-1;a.beginPath(),a.moveTo(i[0].x,i[0].y),s!==void 0&&(f-=Math.max(f-n-1,0));for(var c,d=0;d<f;d++){var g=i[d].x,v=i[d].y,m=void 0,_=void 0,p=void 0,y=void 0,x=void 0,M=void 0;d-1<0?e?(m=i[f-1].x,_=i[f-1].y):(m=i[d+1].x,_=i[d+1].y):(m=i[d-1].x,_=i[d-1].y),d+1<l?(p=i[d+1].x,y=i[d+1].y):(p=i[d+1-l].x,y=i[d+1-l].y),d+2<l?(x=i[d+2].x,M=i[d+2].y):e?(x=i[d+2-l].x,M=i[d+2-l].y):(x=i[d].x,M=i[d].y);var w=u(m,_,g,v,p,y,x,M,t,d===f-1?s:1);if(d===f-1&&s>=0&&s<1){a.bezierCurveTo(w[0],w[1],w[2],w[3],w[4],w[5]),i.splice(f-1,l-(f-1)-1);var b=new S(w[4],w[5]);b.prevCtrlPoint=new S(w[2],w[3]),i.push(b),l=i.length}else a.bezierCurveTo(w[0],w[1],w[2],w[3],p,y);i[d].nextCtrlPoint=w.slice(0,2),i[d].prevCtrlPoint=c?c.slice(2):null,c=w}!e&&i[1].prevCtrlPoint&&(i[0].nextCtrlPoint=i[1].prevCtrlPoint,delete i[0].prevCtrlPoint),i[l-1].prevCtrlPoint||(i[l-1].prevCtrlPoint=i[l-2].nextCtrlPoint),L._stroke(a,r)},_arcBetween:function(a,i,r,t){var e=t,n=i.distanceTo(r),s=n/2/Math.sin(e/2),h=Math.asin((r.y-i.y)/n);i.x>r.x&&(h=Math.PI-h);var u=90*He-e/2,l=h-u,f=Math.cos(l)*s,c=Math.sin(l)*s,d=i.x+f,g=i.y+c,v=Math.asin((r.y-g)/s);d>r.x&&(v=Math.PI-v);var m=v+e;return a.beginPath(),a.arc(d,g,s,v,m),[d,g]},_lineTo:function(a,i){a.lineTo(i.x,i.y)},bezierCurveAndFill:function(a,i,r,t){a.beginPath();var e=i[0];a.moveTo(e.x,e.y);var n=[a];n.push.apply(n,i.splice(1)),L._bezierCurveTo.apply(L,n),L.fillCanvas(a,t),L._stroke(a,r)},_bezierCurveTo:function(a,i,r,t){a.bezierCurveTo(i.x,i.y,r.x,r.y,t.x,t.y)},ellipse:function(a,i,r,t,e,n,s){function h(u,l,f,c,d){var g=.5522848,v=f*g,m=c*g,_=d*g;a.moveTo(u-f,l),a.bezierCurveTo(u-f,l-m,u-v,l-c,u,l-c),a.bezierCurveTo(u+v,l-c,u+f,l-m,u+f,l),a.bezierCurveTo(u+f,l+_,u+v,l+d,u,l+d),a.bezierCurveTo(u-v,l+d,u-f,l+_,u-f,l),a.closePath()}a.beginPath(),r===t&&r===e?a.arc(i.x,i.y,r,0,2*Math.PI):a.ellipse?t!==e?(a.ellipse(i.x,i.y,r,t,0,He*180,He*360,!1),a.ellipse(i.x,i.y,r,e,0,0,He*180,!1)):a.ellipse(i.x,i.y,r,t,0,0,He*360,!1):h(i.x,i.y,r,t,e),L.fillCanvas(a,s,i.x-r,i.y-t),L._stroke(a,n,i.x-r,i.y-t)},rectangle:function(a,i,r,t,e){var n=i.x,s=i.y;a.beginPath(),a.rect(n,s,r.width,r.height),L.fillCanvas(a,e,n,s),L._stroke(a,t,n,s)},sector:function(a,i,r,t,e,n){var s=He,h=t[0],u=t[1];function l(f,c,d,g,v,m){var _=s*-m,p=s*-v;f.beginPath(),f.moveTo(c,d),f.arc(c,d,g,_,p),f.lineTo(c,d),L.fillCanvas(f,n,c-g,d-g),L._stroke(f,e,c-g,d-g)}l(a,i.x,i.y,r,h,u)},_isPattern:function(a){return!$(a)&&!("addColorStop"in a)},drawCross:function(a,i,r,t,e){a.canvas._drawn=!0,a.strokeStyle=e,a.lineWidth=t,a.beginPath(),a.moveTo(i-5,r),a.lineTo(i+5,r),a.moveTo(i,r-5),a.lineTo(i,r+5),a.stroke()},copy:function(a,i){var r=i||W("canvas");return r.width=a.width,r.height=a.height,r.getContext("2d").drawImage(a,0,0),r},pixelRect:function(a,i,r,t){var e=a.lineWidth,n=a.globalAlpha,s=!1;if(e>0&&r>0)s=!0,r<1&&(a.globalAlpha*=r);else if(t>0)t<1&&(a.globalAlpha*=t);else return;a.canvas._drawn=!0,s?a.strokeRect(i[0],i[1],1,1):a.fillRect(i[0],i[1],1,1),a.globalAlpha!==n&&(a.globalAlpha=n)}};function rl(o,a,i,r){var t=a.x,e=a.y,n=i.x,s=i.y,h=r,u=function(w,b){return w<=b},l=function(w,b){return w>=b},f=function(w,b){return Math.min(w,b)},c=function(w,b){return Math.max(w,b)},d={thereYet:l,cap:f},g={thereYet:l,cap:f};e-s>0&&(g.thereYet=u,g.cap=c),t-n>0&&(d.thereYet=u,d.cap=c),o.moveTo(t,e);for(var v=t,m=e,_=0,p=!0,y,x;!(d.thereYet(v,n)&&g.thereYet(m,s));)y=Math.atan2(s-e,n-t),x=h[_],v=d.cap(n,v+Math.cos(y)*x),m=g.cap(s,m+Math.sin(y)*x),p?o.lineTo(v,m):o.moveTo(v,m),_=(_+1)%h.length,p=!p}var ao="data:image/";function oo(o){return o.substring(0,ao.length)===ao?o:Sr(o)}function so(o,a){o.filter=a.filter,o.fillStyle=a.fillStyle,o.globalAlpha=a.globalAlpha,o.lineCap=a.lineCap,o.lineDashOffset=a.lineDashOffset,o.lineJoin=a.lineJoin,o.lineWidth=a.lineWidth,o.shadowBlur=a.shadowBlur,o.shadowColor=a.shadowColor,o.shadowOffsetX=a.shadowOffsetX,o.shadowOffsetY=a.shadowOffsetY,o.strokeStyle=a.strokeStyle}var kn;typeof Promise<"u"?kn=Promise:kn=nu;var ho=kn,oe=function(a){return function(i){z(r,i);function r(){return i.apply(this,arguments)||this}var t=r.prototype;return t.on=function(n,s,h){if(!n)return this;if(!$(n))return this._switch("on",n,s);if(!s)return this;this._eventMap||(this._eventMap={});var u=n.toLowerCase().split(" "),l;h||(h=this);for(var f,c=0,d=u.length;c<d;c++){l=u[c],f=this._eventMap[l],f||(f=[],this._eventMap[l]=f);var g=f.length;if(g>0){for(var v=0;v<g;v++)if(s===f[v].handler&&f[v].context===h)return this}f.push({handler:s,context:h})}return this},t.addEventListener=function(){return this.on.apply(this,arguments)},t.once=function(n,s,h){if(!$(n)){var u={};for(var l in n)n.hasOwnProperty(l)&&(u[l]=this._wrapOnceHandler(l,n[l],h));return this._switch("on",u)}for(var f=n.split(" "),c=0,d=f.length;c<d;c++)this.on(f[c],this._wrapOnceHandler(f[c],s,h));return this},t.off=function(n,s,h){if(!this._eventMap||!n)return this;if(!$(n))return this._switch("off",n,s);if(!s)return this;var u=n.split(" "),l,f,c;h||(h=this);for(var d=0,g=u.length;d<g;d++){if(l=u[d].toLowerCase(),c="Z__"+l,f=this._eventMap[l],!f)return this;for(var v=f.length-1;v>=0;v--){var m=f[v];(s===m.handler||s===m.handler[c])&&m.context===h&&(delete m.handler[c],f.splice(v,1))}f.length||delete this._eventMap[l]}return this},t.removeEventListener=function(){return this.off.apply(this,arguments)},t.listens=function(n,s,h){if(!this._eventMap||!$(n))return 0;var u=this._eventMap[n.toLowerCase()];if(!u||!u.length)return 0;if(!s)return u.length;for(var l=0,f=u.length;l<f;l++)if(s===u[l].handler&&(C(h)||u[l].context===h))return 1;return 0},t.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},t.copyEventListeners=function(n){var s=n._eventMap;if(!s)return this;var h;for(var u in s){h=s[u];for(var l=0,f=h.length;l<f;l++)this.on(u,h[l].handler,h[l].context)}return this},t.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},t._wrapOnceHandler=function(n,s,h){var u=this,l="Z__"+n,f=!1,c=function d(){f||(delete c[l],f=!0,h?s.apply(h,arguments):s.apply(this,arguments),u.off(n,d,this))};return c[l]=s,c},t._switch=function(n,s,h){for(var u in s)s.hasOwnProperty(u)&&this[n](u,s[u],h);return this},t._clearListeners=function(n){if(!(!this._eventMap||!$(n))){var s=this._eventMap[n.toLowerCase()];!s||(this._eventMap[n]=null)}},t._clearAllListeners=function(){this._eventMap=null},t._setEventParent=function(n){return this._eventParent=n,this},t._setEventTarget=function(n){return this._eventTarget=n,this},t._fire=function(n,s){if(!this._eventMap)return this;var h=this._eventMap[n.toLowerCase()];if(!h)return this;s||(s={}),s.type=n,s.target=this._eventTarget||this;for(var u=h.slice(0),l,f,c,d=0,g=u.length;d<g;d++)!u[d]||(l=u[d].context,f=!0,c=H({},s),l?f=u[d].handler.call(l,c):f=u[d].handler(c),f===!1&&s.domEvent&&Lt(s.domEvent));return this},r}(a)},nl=function(){function o(i){this.target=i}var a=o.prototype;return a.enable=function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},a.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},a.enabled=function(){return!!this._enabled},a.remove=function(){this.disable(),delete this.target,delete this.dom},o}(),Ut=oe(nl),Nt=function(){function o(i){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(i),this.callInitHooks()}var a=o.prototype;return a.callInitHooks=function(){var r=Object.getPrototypeOf(this);return this._visitInitHooks(r),this},a.setOptions=function(r){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!r)return this;for(var t in r)this.options[t]=r[t];return this},a.config=function(r){if(r){if(arguments.length===2){var n={};n[r]=arguments[1],r=n}for(var s in r)this.options[s]=r[s],this[s]&&this[s]instanceof Ut&&(r[s]?this[s].enable():this[s].disable());this.onConfig(r)}else{var t={};for(var e in this.options)this.options.hasOwnProperty(e)&&(t[e]=this.options[e]);return t}return this},a.onConfig=function(){},a._visitInitHooks=function(r){if(!this._initHooksCalled){var t=Object.getPrototypeOf(r);t._visitInitHooks&&t._visitInitHooks.call(this,t),this._initHooksCalled=!0;var e=r._initHooks;if(e&&e!==t._initHooks)for(var n=0;n<e.length;n++)e[n].call(this)}},o.addInitHook=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];var s=typeof r=="function"?r:function(){this[r].apply(this,e)},h=this.prototype,u=Object.getPrototypeOf(h);return(!h._initHooks||h._initHooks===u._initHooks)&&(h._initHooks=[]),h._initHooks.push(s),this},o.include=function(){for(var r=0;r<arguments.length;r++)H(this.prototype,r<0||arguments.length<=r?void 0:arguments[r]);return this},o.mergeOptions=function(r){var t=this.prototype,e=Object.getPrototypeOf(t);return(!t.options||t.options===e.options)&&(t.options=t.options?Object.create(t.options):{}),H(t.options,r),this},o}(),Zi={},Fs=function(o){return function(a){z(i,a);function i(){return a.apply(this,arguments)||this}i.registerJSONType=function(e){return e?(Zi[e]=this,this):this},i.getJSONClass=function(e){return e?Zi[e]:null};var r=i.prototype;return r.getJSONType=function(){if(this._jsonType===void 0){var e=Object.getPrototypeOf(this).constructor;for(var n in Zi)if(Zi[n]===e){this._jsonType=n;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},i}(o)},ai={},Gs=function(){function o(){this._tree=jn.exports(9,["[0]","[1]","[2]","[3]"])}var a=o.prototype;return a.collides=function(r){return ai.minX=r[0],ai.minY=r[1],ai.maxX=r[2],ai.maxY=r[3],this._tree.collides(ai)},a.insertBox=function(r){var t=this._tree;return t.insert(r),this},a.bulkInsertBox=function(r){return this._tree.load(r),this},a.clear=function(){return this._tree.clear(),this},o}();function ea(o){return function(a){z(i,a);function i(){return a.apply(this,arguments)||this}var r=i.prototype;return r.addHandler=function(e,n){if(!n)return this;if(this._handlers||(this._handlers=[]),this[e])return this[e].enable(),this;var s=this[e]=new n(this);return this._handlers.push(s),this.options[e]&&s.enable(),this},r.removeHandler=function(e){if(!e)return this;var n=this[e];if(n){var s=this._handlers.indexOf(n);s>=0&&this._handlers.splice(s,1),this[e].remove(),delete this[e]}return this},r._clearHandlers=function(){for(var e=0,n=this._handlers.length;e<n;e++)this._handlers[e].remove();this._handlers=[]},i}(o)}var uo="touchstart mousedown",Bi={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},rn={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},qe=function(o){z(a,o);function a(r,t){var e;return t===void 0&&(t={}),e=o.call(this,null)||this,e.dom=r,e.options=t,e}var i=a.prototype;return i.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},ct(this.dom,uo,this._onMouseDown,this),this):this},i.disable=function(){return this.dom?(this._offEvents(),ut(this.dom,uo,this._onMouseDown),delete this._onMouseDown,this):this},i.onMouseDown=function(t){if(!(!this.options.rightclick&&t.button===2)&&!(t.touches&&t.touches.length>1)&&!(this.options.cancelOn&&this.options.cancelOn(t)===!0)){var e=this.dom;e.setCapture?e.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),e.ondragstart=function(){return!1},delete this.moved;var n=t.touches?t.touches[0]:t;this.startPos=new S(n.clientX,n.clientY),ut(document,Bi[t.type],this.onMouseMove),ut(document,rn[t.type],this.onMouseUp),ct(document,Bi[t.type],this.onMouseMove,this),ct(document,rn[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||(ut(this.dom,"mouseleave",this.onMouseUp),ct(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:t,mousePos:new S(n.clientX,n.clientY)})}},i.onMouseMove=function(t){if(t.touches&&t.touches.length>1){this.moved&&(this.interupted=!0,this.onMouseUp(t));return}var e=t.touches?t.touches[0]:t,n=new S(e.clientX,e.clientY),s=n.sub(this.startPos);!s.x&&!s.y||(this.moved?this.fire("dragging",{domEvent:t,mousePos:new S(e.clientX,e.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))},i.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var n={domEvent:t};N(e.clientX)&&(n.mousePos=new S(parseInt(e.clientX,0),parseInt(e.clientY,0))),this.moved&&(n.interupted=this.interupted,this.fire("dragend",n),delete this.interupted,delete this.moved),this.fire("mouseup",n)},i._offEvents=function(){var t=this.dom;if(ut(t,"mouseleave",this.onMouseUp),!(typeof document>"u"||typeof window>"u")){for(var e in Bi)ut(document,Bi[e],this.onMouseMove),ut(document,rn[e],this.onMouseUp);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},a}(Ut),k=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}return a.toNumberArrays=function(r){return Array.isArray(r)?Re(r,function(t){return[t.x,t.y]}):[r.x,r.y]},a.toCoordinates=function(r){if(N(r[0])&&N(r[1]))return new a(r);if(r instanceof a)return r;for(var t=[],e=0,n=r.length;e<n;e++){var s=r[e];Array.isArray(s)?N(s[0])?t.push(new a(s)):t.push(a.toCoordinates(s)):s instanceof a?t.push(s):t.push(new a(s))}return t},a}(as),Rt=function(){function o(a,i){this.type=a,this.properties=i}return o.createProj4=function(i){return new o("proj4",{proj:i})},o.fromProjectionCode=function(i){return i?(i=i.toUpperCase().replace(":",""),o[i]||null):null},o}();Rt.WGS84=Rt.createProj4("+proj=longlat +datum=WGS84 +no_defs");Rt.EPSG4326=Rt.WGS84;Rt.EPSG3857=Rt.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs");Rt.IDENTITY=Rt.createProj4("+proj=identity +no_defs");Rt.CGCS2000=Rt.createProj4("+proj=longlat +datum=CGCS2000");Rt.EPSG4490=Rt.CGCS2000;Rt.BD09LL=Rt.createProj4("+proj=longlat +datum=BD09");Rt.GCJ02=Rt.createProj4("+proj=longlat +datum=GCJ02");var al=new S(0,0),ol=new k(0,0),nn=new k(0,0),an=new k(0,0),on=new k(0,0),sn=new k(0,0),sl=new k(0,0),lo=new k(0,0),fo=new k(0,0),hn=[],Ne,oi=[],st=function(){function o(i,r,t,e){this._clazz=k;var n=arguments.length,s=n>0?arguments[n-1]:null;s&&s.unproject&&(this.projection=arguments[n-1]),this._dirty=!0,this._initialize(i,r,t,e)}var a=o.prototype;return a._initialize=function(r,t,e,n){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!C(r)){var s=this.projection;if(N(r)&&N(t)&&N(e)&&N(n)){s?this.set(r,t,e,n):this.set(Math.min(r,e),Math.min(t,n),Math.max(r,e),Math.max(t,n));return}else Array.isArray(r)?s?this.set(r[0],r[1],r[2],r[3]):this.set(Math.min(r[0],r[2]),Math.min(r[1],r[3]),Math.max(r[0],r[2]),Math.max(r[1],r[3])):N(r.x)&&N(t.x)&&N(r.y)&&N(t.y)?s?this.set(r.x,r.y,t.x,t.y):(r.x>t.x?(this.xmin=t.x,this.xmax=r.x):(this.xmin=r.x,this.xmax=t.x),r.y>t.y?(this.ymin=t.y,this.ymax=r.y):(this.ymin=r.y,this.ymax=t.y)):N(r.xmin)&&N(r.xmax)&&N(r.ymin)&&N(r.ymax)&&this.set(r.xmin,r.ymin,r.xmax,r.ymax)}},a._add=function(r){return this._dirty=!0,C(r.x)?C(r.xmin)?C(r[0])||(this.xmin+=r[0],this.ymin+=r[1],this.xmax+=r[0],this.ymax+=r[1]):(this.xmin+=r.xmin,this.ymin+=r.ymin,this.xmax+=r.xmax,this.ymax+=r.ymax):(this.xmin+=r.x,this.ymin+=r.y,this.xmax+=r.x,this.ymax+=r.y),this},a.add=function(){var r=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return r._add.apply(r,arguments)},a._scale=function(r){return this._dirty=!0,this.xmin*=r,this.ymin*=r,this.xmax*=r,this.ymax*=r,this},a._sub=function(r){return this._dirty=!0,C(r.x)?C(r.xmin)?C(r[0])||(this.xmin-=r[0],this.ymin-=r[1],this.xmax-=r[0],this.ymax-=r[1]):(this.xmin-=r.xmin,this.ymin-=r.ymin,this.xmax-=r.xmax,this.ymax-=r.ymax):(this.xmin-=r.x,this.ymin-=r.y,this.xmax-=r.x,this.ymax-=r.y),this},a._substract=function(){return this._sub.apply(this,arguments)},a.sub=function(){var r=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return r._sub.apply(r,arguments)},a.substract=function(){return this.sub.apply(this,arguments)},a.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},a._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},a.getMin=function(r){return r?(r.set(this.xmin,this.ymin),r):new this._clazz(this.xmin,this.ymin)},a.getMax=function(r){return r?(r.set(this.xmax,this.ymax),r):new this._clazz(this.xmax,this.ymax)},a.getCenter=function(r){var t=(this.xmin+this.xmax)/2,e=(this.ymin+this.ymax)/2;return r?(r.set(t,e),r):new this._clazz(t,e)},a.isValid=function(){return!C(this.xmin)&&!C(this.ymin)&&!C(this.xmax)&&!C(this.ymax)},a.equals=function(r){return this.xmin===r.xmin&&this.xmax===r.xmax&&this.ymin===r.ymin&&this.ymax===r.ymax},a.intersects=function(r){this._project(this),this._project(r);var t=Math.max(this.pxmin,r.pxmin),e=Math.max(this.pymin,r.pymin),n=Math.min(this.pxmax,r.pxmax),s=Math.min(this.pymax,r.pymax),h=!(t>n||e>s);return h},a.within=function(r){return this._project(this),this._project(r),this.pxmin>=r.pxmin&&this.pxmax<=r.pxmax&&this.pymin>=r.pymin&&this.pymax<=r.pymax},a.contains=function(r){if(!r)return!1;this._project(this);var t=this.projection;if(t)if(r.x!==void 0){var e=ol;Array.isArray(r)?(e.x=r[0],e.y=r[1]):(e.x=r.x,e.y=r.y),r=t.project(e,e)}else r.xmin!==void 0&&this._project(r);return(r.x||r.pxmin||0)>=this.pxmin&&(r.x||r.pxmax||0)<=this.pxmax&&(r.y||r.pymin||0)>=this.pymin&&(r.y||r.pymax||0)<=this.pymax},a.getWidth=function(){return Math.abs(this.xmax-this.xmin)},a.getHeight=function(){return Math.abs(this.ymax-this.ymin)},a.getSize=function(){return new vt(this.getWidth(),this.getHeight())},a.set=function(r,t,e,n){return this.xmin=r,this.ymin=t,this.xmax=e,this.ymax=n,this._dirty=!0,this},a.__combine=function(r){r.x!==void 0&&(Ne.xmin=Ne.xmax=r.x,Ne.ymin=Ne.ymax=r.y,r=Ne),this._project(r),this._project(this);var t=N(this.pxmin),e,n,s,h;t?(e=Math.min(this.pxmin,r.pxmin),n=Math.min(this.pymin,r.pymin),s=Math.max(this.pxmax,r.pxmax),h=Math.max(this.pymax,r.pymax)):(e=r.pxmin,n=r.pymin,s=r.pxmax,h=r.pymax);var u=this.projection;if(u){nn.set(e,n),an.set(s,h);var l=u.unproject(nn,nn),f=u.unproject(an,an);e=l.x,n=l.y,s=f.x,h=f.y}return oi[0]=e,oi[1]=n,oi[2]=s,oi[3]=h,oi},a._combine=function(r){if(!r||r.isValid&&!r.isValid())return this;var t=this.__combine(r);return this.set(t[0],t[1],t[2],t[3]),this._dirty=!0,this},a.combine=function(r){if(!r||r.isValid&&!r.isValid())return this;var t=this.__combine(r);return new this.constructor(t[0],t[1],t[2],t[3],this.projection)},a.intersection=function(r){if(!this.intersects(r))return null;on.x=Math.max(this.pxmin,r.pxmin),on.y=Math.max(this.pymin,r.pymin),sn.x=Math.min(this.pxmax,r.pxmax),sn.y=Math.min(this.pymax,r.pymax);var t=on,e=sn,n=this.projection;return n&&(t=n.unproject(t,t),e=n.unproject(e,e)),new this.constructor(t,e,n)},a.expand=function(r){var t,e;return N(r)?t=e=r:(t=r.width||r.x||r[0]||0,e=r.height||r.y||r[1]||0),new this.constructor(this.xmin-t,this.ymin-e,this.xmax+t,this.ymax+e,this.projection)},a._expand=function(r){var t,e;return N(r)?t=e=r:(t=r.width||r.x||r[0]||0,e=r.height||r.y||r[1]||0),this.xmin-=t,this.ymin-=e,this.xmax+=t,this.ymax+=e,this._dirty=!0,this},a.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},a.toArray=function(r){var t=this.xmin,e=this.ymin,n=this.xmax,s=this.ymax;return r?(r[0].x=t,r[0].y=s,r[1].x=n,r[1].y=s,r[2].x=n,r[2].y=e,r[3].x=t,r[3].y=e,r[4].x=t,r[4].y=s,r):[new this._clazz([t,s]),new this._clazz([n,s]),new this._clazz([n,e]),new this._clazz([t,e]),new this._clazz([t,s])]},a.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},a.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},a.convertTo=function(r,t){if(!this.isValid())return null;var e=t||new this.constructor;t&&e.set(null,null,null,null);var n;return this._clazz===k?n=sl:this._clazz===S&&(n=al),n.x=this.xmin,n.y=this.ymax,e._combine(r(n)),n.x=this.xmax,e._combine(r(n)),n.y=this.ymin,e._combine(r(n)),n.x=this.xmin,e._combine(r(n)),e},a._project=function(r){if(!r||!r.isValid()){r&&(r.pxmin=r.pxmax=r.pymin=r.pymax=null);return}var t=this.projection;if(t){if(r._dirty){lo.set(r.xmax,r.ymin),fo.set(r.xmin,r.ymax),hn[0]=lo,hn[1]=fo;var e=t.projectCoords(hn),n=e[0],s=e[1];r.pxmin=Math.min(n.x,s.x),r.pymin=Math.min(n.y,s.y),r.pxmax=Math.max(n.x,s.x),r.pymax=Math.max(n.y,s.y)}delete r._dirty}else r.pxmin=r.xmin,r.pxmax=r.xmax,r.pymin=r.ymin,r.pymax=r.ymax},o}();Ne=new st(0,0,0,0);var Y=function(o){z(a,o);function a(i,r,t,e){var n;return n=o.call(this,i,r,t,e)||this,n._clazz=S,n}return a}(st),Ns=function(){function o(i){this.matrix=i}var a=o.prototype;return a.transform=function(r,t,e){var n=this.matrix[0]*(r.x-this.matrix[2])/t,s=-this.matrix[1]*(r.y-this.matrix[3])/t;return e?(e.x=n,e.y=s,e):new S(n,s)},a.untransform=function(r,t,e){var n=r.x*t/this.matrix[0]+this.matrix[2],s=r.y*t/-this.matrix[1]+this.matrix[3];return e?(e.x=n,e.y=s,e):new k(n,s)},o}(),$e={project:function(){},unproject:function(){},projectCoords:function(a,i){var r=this;if(!a)return[];if(!Array.isArray(a))return this.project(a);if(a.length===0)return[];if(!this.isSphere())return Re(a,this.project,this);if(Array.isArray(a[0]))return a.map(function(y){return r.projectCoords(y,i)});for(var t=i!==!1,e=this.getCircum(),n=this.getSphereExtent(),s=n.sx,h=n.sy,u,l,f=a[0],c,d,g,v,m=[this.project(f)],_=1,p=a.length;_<p;_++)c=a[_],d=c.x-f.x,g=c.y-f.y,v=this.project(c),Math.abs(d)>180&&t&&(u===void 0&&(u=c.x>f.x),u&&(v._add(-e.x*yt(d)*s,0),c._add(-360*yt(d),0))),Math.abs(g)>90&&t&&(l===void 0&&(l=c.y<f.y),l&&(v._add(0,-e.y*yt(g)*h),c._add(0,-180*yt(g)))),f=c,m.push(v);return m},unprojectCoords:function(a){return a?Array.isArray(a)?Re(a,this.unproject,this):this.unproject(a):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(a){if(!this.isSphere())return!1;var i=this.getSphereExtent();return!i.contains(a)},wrapCoord:function(a){if(!this.isSphere())return a;var i=this.getSphereExtent(),r=new k(a);return i.contains(r)||(r.x=ye(a.x,i.xmin,i.xmax),r.y=ye(a.y,i.ymin,i.ymax)),r},getCircum:function(){if(!this.circum&&this.isSphere()){var a=this.getSphereExtent();this.circum={x:a.getWidth(),y:a.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var a=this.project(new k(180,90)),i=this.project(new k(-180,-90));this.extent=new st(i,a,this),this.extent.sx=a.x>i.x?1:-1,this.extent.sy=a.y>i.y?1:-1}return this.extent}},ia={measureLength:function(a,i){if(!Array.isArray(a))return this.measureLenBetween(a,i);for(var r=0,t=0,e=a.length;t<e-1;t++)r+=this.measureLenBetween(a[t],a[t+1]);return r}},Zs=H({measure:"IDENTITY",measureLenBetween:function(a,i){if(!a||!i)return 0;try{return Math.sqrt(Math.pow(a.x-i.x,2)+Math.pow(a.y-i.y,2))}catch{return 0}},measureArea:function(a){if(!Array.isArray(a))return 0;for(var i=0,r=0,t=a.length;r<t;r++){var e=a[r],n=null;r===t-1?n=a[0]:n=a[r+1],i+=e.x*n.y-e.y*n.x}return Math.abs(i/2)},locate:function(a,i,r,t){return t=t||new k(0,0),t.set(a.x,a.y),this._locate(t,i,r)},_locate:function(a,i,r){return a?(i||(i=0),r||(r=0),!i&&!r||(a.x=a.x+i,a.y=a.y+r),a):null},rotate:function(a,i,r){return a=new k(a.x,a.y),this._rotate(a,i,r)},_rotate:function(){var o=new S(0,0);return function(a,i,r){return o.x=a.x-i.x,o.y=a.y-i.y,o._rotate(r*Math.PI/180),a.x=i.x+o.x,a.y=i.y+o.y,a}}()},ia),Bs=function(){function o(i){this.radius=i}var a=o.prototype;return a.measureLenBetween=function(r,t){if(!r||!t)return 0;var e=Ct(r.y),n=Ct(t.y),s=e-n,h=Ct(r.x)-Ct(t.x);return e=2*Math.asin(Math.sqrt(Math.pow(Math.sin(s/2),2)+Math.cos(e)*Math.cos(n)*Math.pow(Math.sin(h/2),2))),e*=this.radius,Math.round(e*1e5)/1e5},a.measureArea=function(r){var t=Ct(this.radius),e=0,n=r,s=n.length;if(s<3)return 0;var h;for(h=0;h<s-1;h++){var u=n[h],l=n[h+1];e+=u.x*t*Math.cos(Ct(u.y))*l.y*t-l.x*t*Math.cos(Ct(l.y))*u.y*t}return s=n[h],n=n[0],e+=s.x*t*Math.cos(Ct(s.y))*n.y*t-n.x*t*Math.cos(Ct(n.y))*s.y*t,.5*Math.abs(e)},a.locate=function(r,t,e,n){return n=n||new k(0,0),n.set(r.x,r.y),this._locate(n,t,e)},a._locate=function(r,t,e){if(!r)return null;if(t||(t=0),e||(e=0),!t&&!e)return r;var n,s,h=Ct(r.y);if(e!==0){var u=Math.abs(e),l=Math.sin(u/(2*this.radius))*2;h=h+l*(e>0?1:-1),s=ye(h*180/Math.PI,-90,90)}else s=r.y;if(t!==0){var f=Math.abs(t),c=Ct(r.x),d=2*Math.sqrt(Math.pow(Math.sin(f/(2*this.radius)),2)/Math.pow(Math.cos(h),2));c=c+d*(t>0?1:-1),n=ye(c*180/Math.PI,-180,180)}else n=r.x;return r.x=n,r.y=s,r},a.rotate=function(r,t,e){return r=new k(r),this._rotate(r,t,e)},a._rotate=function(r,t,e){var n=hl(t,r),s=n-e,h=this.measureLenBetween(t,r);return r.x=t.x,r.y=t.y,ul(r,h,s,this.radius)},o}();function hl(o,a,i){i===void 0&&(i={});var r;i.final?r=co(a,o):r=co(o,a);var t=r>180?-(360-r):r;return t}function co(o,a){var i=Ct(o.y),r=Ct(a.y),t=Ct(a.x-o.x);t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI);var e=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),n=Math.atan2(t,e);return(ns(n)+360)%360}function ul(o,a,i,r){var t=a/r,e=o.x*Math.PI/180,n=Ct(o.y),s=Ct(i),h=t*Math.cos(s),u=n+h;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var l=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),f=Math.abs(l)>1e-11?h/l:Math.cos(n),c=t*Math.sin(s)/f,d=e+c;return o.x=(d*180/Math.PI+540)%360-180,o.y=u*180/Math.PI,o}var Or=H({measure:"EPSG:4326",sphere:new Bs(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},ia),Ws=H({measure:"BAIDU",sphere:new Bs(637099681e-2),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},ia),ll=Or,yi={};function ra(o){yi[o.measure]=o}ra(Zs);ra(Or);ra(Ws);var un={getInstance:function(a){if(!a)return ll;for(var i in yi)if(Xe(yi,i)){var r=yi[i].measure;if(!r)continue;if(a.toLowerCase()===r.toLowerCase())return yi[i]}return null}},go=1e-7,Vs=H({},$e,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(a,i){var r=this.rad,t=this.metersPerDegree,e=this.maxLatitude,n=a.x,s=Math.max(Math.min(e,a.y),-e),h;s===0?h=0:h=Math.log(Math.tan((90+s)*r/2))/r;var u=n*t,l=h*t;return i?(i.x=u,i.y=l,i):new k(u,l)},unproject:function(a,i){var r=this.rad,t=this.metersPerDegree,e=a.x/t,n=a.y,s;n===0?s=0:(s=n/t,s=(2*Math.atan(Math.exp(s*r))-Math.PI/2)/r),Math.abs(Math.abs(e)-180)<go&&(e=yt(e)*180),Math.abs(Math.abs(s)-this.maxLatitude)<go&&(s=yt(s)*this.maxLatitude);var h=ye(e,-180,180),u=ye(s,-this.maxLatitude,this.maxLatitude);return i?(i.x=h,i.y=u,i):new k(h,u)}},Or),Us=H({},$e,{code:"EPSG:4326",project:function(a,i){return i?(i.x=a.x,i.y=a.y,i):new k(a)},unproject:function(a,i){return i?(i.x=a.x,i.y=a.y,i):new k(a)}},Or),fl=H({},Us,{code:"EPSG:4490"}),cl=H({},$e,{code:"BAIDU",project:function(a,i){return this.convertLL2MC(a,i)},unproject:function(a,i){return this.convertMC2LL(a,i)}},Ws,{EARTHRADIUS:637099681e-2,MCBAND:[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(a,i){for(var r,t=0,e=this.MCBAND.length;t<e;t++)if(Math.abs(a.y)>=this.MCBAND[t]){r=this.MC2LL[t];break}var n=this.convertor(a,r,i);return n},convertLL2MC:function(a,i){var r,t,e;a.x=this.getLoop(a.x,-180,180),a.y=this.getRange(a.y,-74,74);var n=new k(a.x,a.y);for(t=0,e=this.LLBAND.length;t<e;t++)if(n.y>=this.LLBAND[t]){r=this.LL2MC[t];break}if(!r){for(t=this.LLBAND.length-1;t>=0;t--)if(n.y<=-this.LLBAND[t]){r=this.LL2MC[t];break}}var s=this.convertor(a,r,i);return s},convertor:function(a,i,r){if(!a||!i)return null;var t=i[0]+i[1]*Math.abs(a.x),e=Math.abs(a.y)/i[9],n=i[2]+i[3]*e+i[4]*e*e+i[5]*e*e*e+i[6]*e*e*e*e+i[7]*e*e*e*e*e+i[8]*e*e*e*e*e*e;return t*=a.x<0?-1:1,n*=a.y<0?-1:1,r?(r.x=t,r.y=n,r):new k(t,n)},toRadians:function(a){return Math.PI*a/180},toDegrees:function(a){return 180*a/Math.PI},getRange:function(a,i,r){return i!=null&&(a=Math.max(a,i)),r!=null&&(a=Math.min(a,r)),a},getLoop:function(a,i,r){if(a===1/0)return r;if(a===-1/0)return i;for(;a>r;)a-=r-i;for(;a<i;)a+=r-i;return a}}),dl=H({},$e,{code:"IDENTITY",project:function(a,i){return i?(i.x=a.x,i.y=a.y,i):a.copy()},unproject:function(a,i){return i?(i.x=a.x,i.y=a.y,i):a.copy()}},Zs),Js=Vs,Wi=Object.freeze({EPSG3857:Vs,DEFAULT:Js,EPSG4326:Us,EPSG4490:fl,BAIDU:cl,IDENTITY:dl,Common:$e}),na=function(o){return function(a){z(i,a);function i(){return a.apply(this,arguments)||this}return i.registerRenderer=function(t,e){var n=this.prototype,s=Object.getPrototypeOf(n);return(!n._rendererClasses||n._rendererClasses===s._rendererClasses)&&(n._rendererClasses=n._rendererClasses?Object.create(n._rendererClasses):{}),n._rendererClasses[t.toLowerCase()]=e,this},i.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},i}(o)},vr={};function gl(o,a){vr[o]=a}var vl=`
    var adapters = {};
    onmessage = function (msg) {
        msg = msg.data;
        if (msg.messageType === 'batch') {
            const messages = msg.messages;
            if (messages) {
                for (let i = 0; i < messages.length; i++) {
                    dispatch(messages[i]);
                }
            }
        } else {
            dispatch(msg);
        }
    };

    function dispatch(msg) {
        var workerKey = msg.workerKey;
        var adapter = adapters[workerKey];
        if (!adapter) {
            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);
            return;
        }
        try {
            adapter.onmessage(msg, wrap(msg.callback));
        } catch (err) {
            post(msg.callback, workerKey + ':' + err.message);
            console.error(err);
            throw err;
        }
    }

    function post(callback, err, data, buffers) {
        var msg = {
            callback : callback
        };
        if (err) {
            msg.error = err;
        } else {
            msg.data = data;
        }
        if (buffers && buffers.length > 0) {
            postMessage(msg, buffers);
        } else {
            postMessage(msg);
        }
    }
    function wrap(callback) {
        return function (err, data, buffers) {
            post(callback, err, data, buffers);
        };
    }
    var workerExports;
`,ml=`
    workerExports = null;
`;function _l(){var o=vl;for(var a in vr){var i=vr[a];nt(i)&&i.length===0&&(i=i()),o+=`
    workerExports = {};
    (`+i+`)(workerExports, self);
    adapters['`+a+"'] = workerExports",o+=`
    workerExports.initialize && workerExports.initialize(self);
        `}return o+=ml,o}var ln;function pl(){if(typeof window>"u")return null;if(!ln){var o=_l();ln=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})),vr=null}return ln}var yl=typeof window<"u"?window.navigator.hardwareConcurrency||4:0,xl=Math.max(Math.floor(yl/2),1),vo=function(){function o(i){i===void 0&&(i=50),this._limit=i,this._messages=[],this.buffers=[]}var a=o.prototype;return a.addMessage=function(r,t){if(this._messages.push(r),!!Array.isArray(t))for(var e=0;e<t.length;e++)this.buffers.indexOf(t[e])<0&&this.buffers.push(t[e])},a.isFull=function(){return this._messages.length>=this._limit},a.getMessage=function(){return{messageType:"batch",messages:this._messages}},o}(),wl=function(){function o(){this.active={},this.workerCount=typeof window<"u"?window.MAPTALKS_WORKER_COUNT||xl:0,this._messages=[],this._messageBuffers=[]}var a=o.prototype;return a.acquire=function(r){if(!this.workers){this.workers=[];for(var t=pl(),e=0;e<this.workerCount;e++){var n=new Worker(t);n.id=e,this.workers.push(n)}URL.revokeObjectURL(t)}return this.active[r]=!0,this.workers.slice()},a.release=function(r){delete this.active[r],Object.keys(this.active).length===0&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},a.addMessage=function(r,t,e){var n=this._messages[r];(!n||!n.length)&&(n=this._messages[r]=[new vo]);var s=n[n.length-1];s.isFull()&&(s=new vo,this._messages[r].push(s)),s.addMessage(t,e)},a.commit=function(){if(this._messages.length){for(var r=0;r<this._messages.length;r++)if(!(!this._messages[r]||!this._messages[r].length)){var t=this._messages[r].shift();this.workers[r].postMessage(t.getMessage(),t.buffers)}}},o}(),fn;function Ys(){return fn||(fn=new wl),fn}function Xs(){Ys().commit(),Xt(Xs)}Xt&&Xt(Xs);var cn=0,mo=[],aa=function(){function o(i){var r=this;this.workerKey=i,this.workerPool=Ys(),this.currentActor=0,this.actorId=Ce(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach(function(t){t.addEventListener("message",r.receiveFn,!1)})}var a=o.prototype;return a.isActive=function(){return!!this.workers},a.broadcast=function(r,t,e){var n=this;return e=e||function(){},Cl(this.workers,function(s,h){n.send(r,t,h,s.id)},e),this},a.send=function(r,t,e,n){var s=e?this.actorId+":"+this.callbackID++:null;return e&&(this.callbacks[s]=e),this.post({data:r,callback:String(s)},t,n),this},a.receive=function(r){var t=this,e=r.data,n=e.callback,s=this.callbacks[n];delete this.callbacks[n],e.type==="<request>"?this.actorId===e.actorId&&this[e.command](e.params,function(h,u,l){var f={type:"<response>",callback:e.callback};h?f.error=h.message:f.data=u,t.post(f,l||mo,e.workerId)}):s&&e.error?s(e.error):s&&s(null,e.data)},a.remove=function(){var r=this;this.workers.forEach(function(t){t.removeEventListener("message",r.receiveFn,!1)}),this.workerPool.release(this.actorId),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},a.post=function(r,t,e){return(typeof e!="number"||isNaN(e))&&(e=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),r.workerId=e,r.workerKey=this.workerKey,r.actorId=this.actorId,this.workerPool.addMessage(e,r,t||mo),e},a.getDedicatedWorker=function(){return cn=(cn+1)%this.workerPool.workerCount,cn},o}();function Cl(o,a,i){o.length||i(null,[]);var r=o.length,t=new Array(o.length),e=null;o.forEach(function(n,s){a(n,function(h,u){h&&(e=h),t[s]=u,--r===0&&i(e,t)})})}var oa="core-fetch-image",Pl=[],Ml=function(o){z(a,o);function a(){return o.call(this,oa)||this}var i=a.prototype;return i.fetchImage=function(t,e){var n={url:t};this.send(n,Pl,e)},a}(aa),Qe=function(o){z(a,o);function a(r){var t;return t=o.call(this)||this,t.layer=r,t._painted=!1,t._drawTime=0,q.decodeImageInWorker&&(r.options.renderer==="gl"||!q.safari)&&(t._resWorkerConn=new Ml),t.setToRedraw(),t}var i=a.prototype;return i.render=function(t){this.prepareRender(),!(!this.getMap()||!this.layer.isVisible())&&(this.resources||(this.resources=new Oe),this.checkAndDraw(this._tryToDraw,t))},i.checkAndDraw=function(t){var e=this;this._toRedraw=!1;for(var n=arguments.length,s=new Array(n>1?n-1:0),h=1;h<n;h++)s[h-1]=arguments[h];if(this.checkResources){var u=this.checkResources();u.length>0?(this._loadingResource=!0,this.loadResources(u).then(function(){e._loadingResource=!1,e.layer&&(e.layer.fire("resourceload"),e.setToRedraw())})):t.call.apply(t,[this].concat(s))}else t.call.apply(t,[this].concat(s))},i.testIfNeedRedraw=function(){var t=this.getMap();return this._loadingResource?!1:this._toRedraw?!0:t.isInteracting()&&!this.drawOnInteracting?!1:!!this.needToRedraw()},i.needToRedraw=function(){var t=this.getMap();return t.isInteracting()||t.getRenderer().isViewChanged()?!(!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving):!1},i.onSkipDrawOnInteracting=function(){},i.isLoadingResource=function(){return this._loadingResource},i.isRenderComplete=function(){return!!this._renderComplete},i.mustRenderOnInteracting=function(){return!this._painted},i.setToRedraw=function(){return this._toRedraw=!0,this},i.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},i.isCanvasUpdated=function(){return!!this._canvasUpdated},i.remove=function(){this.onRemove(),delete this._loadingResource,delete this.southWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,delete this.layer},i.onRemove=function(){},i.onAdd=function(){},i.getMap=function(){return this.layer?this.layer.getMap():null},i.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D||this.isBlank()||this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.southWest)._add(0,-t.height);return{image:this.canvas,layer:this.layer,point:e}},i.clear=function(){this.clearCanvas()},i.isBlank=function(){return!this._painted},i.show=function(){this.setToRedraw()},i.hide=function(){this.clear(),this.setToRedraw()},i.setZIndex=function(){this.setToRedraw()},i.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var e=this.getMap(),n=e.getDevicePixelRatio(),s=e.getSize();if(t.x<0||t.x>s.width*n||t.y<0||t.y>s.height*n)return!1;var h=this.getImageData&&this.getImageData();if(h){var u=Math.round(n*t.x),l=Math.round(n*t.y),f=l*h.width*4+u*4;return h.data[f+3]>0}try{var c=this.context.getImageData(n*t.x,n*t.y,1,1).data;if(c[3]>0)return!0}catch{return this._errorThrown||(this._errorThrown=!0),!1}return!1},i.loadResources=function(t){this.resources||(this.resources=new Oe);var e=this.resources,n=[];if(rt(t))for(var s={},h=t.length-1;h>=0;h--){var u=t[h];!u||!u.length||s[u.join("-")]||(s[u.join("-")]=1,e.isResourceLoaded(u,!0)||n.push(new ho(this._promiseResource(u))))}return ho.all(n)},i.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t._get2DExtent(),this.southWest=t._containerPointToPoint(new S(0,t.height))},i.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),n=t.getDevicePixelRatio(),s=Math.round(n*e.width),h=Math.round(n*e.height);if(this.layer._canvas){var u=this.layer._canvas;u.width=s,u.height=h,u.style&&(u.style.width=e.width+"px",u.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=L.createCanvas(s,h,t.CanvasClass);this.onCanvasCreate()}},i.onCanvasCreate=function(){},i.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=this.canvas.getContext("2d"),!!this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();t!==1&&this.context.scale(t,t)}},i.resetCanvasTransform=function(){if(!!this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},i.resizeCanvas=function(t){var e=this.canvas;if(!!e){var n=t||this.getMap().getSize(),s=this.getMap().getDevicePixelRatio(),h=Zn(n,s),u=h.width,l=h.height,f=h.cssWidth,c=h.cssHeight;this.layer._canvas&&(e.style.width!==f||e.style.height!==c)&&(e.style.width=f,e.style.height=c),!(e.width===u&&e.height===l)&&(e.height=l,e.width=u,s!==1&&this.context&&this.context.scale(s,s))}},i.clearCanvas=function(){if(!(!this.context||!this.getMap())){var t=this.getMap().getDevicePixelRatio(),e=1/t,n=this.canvas.width*e,s=this.canvas.height*e;L.clearRect(this.context,0,0,Math.max(n,this.canvas.width),Math.max(s,this.canvas.height))}},i.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getMaskPainter().get2DExtent();return e.intersects(this._extent2D)?(this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e):(this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e)},i.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;var n=this.southWest,s=this.getMap();this.southWest=s._containerPointToPoint(new S(0,s.height)),t.save();var h=s.getDevicePixelRatio();if(h!==1&&(t.save(),t.scale(h,h)),e.getGeometries){t.isMultiClip=!0;var u=e.getGeometries()||[];t.beginPath(),u.forEach(function(f){var c=f._getMaskPainter();c.paint(null,t)}),t.stroke(),delete t.isMultiClip}else{var l=e._getMaskPainter();l.paint(null,t)}return h!==1&&t.restore(),t.clip(),this.southWest=n,!0},i.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this.southWest}},i.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},i.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},i.onZoomStart=function(){},i.onZoomEnd=function(){this.setToRedraw()},i.onZooming=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){this.setToRedraw()},i.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},i.onDragRotateStart=function(){},i.onDragRotating=function(){},i.onDragRotateEnd=function(){this.setToRedraw()},i.onSpatialReferenceChange=function(){},i.getDrawTime=function(){return this._drawTime},i._tryToDraw=function(t){if(this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()){this._renderComplete=!0;return}this._drawAndRecord(t)},i._drawAndRecord=function(t){if(!!this.getMap()){var e=this._painted;this._painted=!0;var n=lt();this.draw(t),n=lt()-n,this._drawTime=e?n:n/2,e&&this.layer&&this.layer.options.logDrawTime}},i._promiseResource=function(t){var e=this,n=this.resources,s=this.layer.options.crossOrigin,h=this.layer.options.renderer||"";return function(u){if(n.isResourceLoaded(t,!0)){u(t);return}if(!Se(t[0])&&e._resWorkerConn){var l=Nn(t[0]);e._resWorkerConn.fetchImage(l,function(c,d){if(c){u(t);return}Gn(d,function(g){e._cacheResource(t,g),u(t)})})}else{var f=new Image;C(s)?h!=="canvas"&&(f.crossOrigin=""):f.crossOrigin=s,Se(t[0])&&!pt&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),f.onload=function(){e._cacheResource(t,f),u(t)},f.onabort=function(c){u(t)},f.onerror=function(c){n.markErrorResource(t),u(t)},Pi(f,t)}}},i._cacheResource=function(t,e){if(!(!this.layer||!this.resources)){var n=t[1],s=t[2];if(this.layer.options.cacheSvgOnCanvas&&Se(t[0])===1&&(q.edge||q.ie)){C(n)&&(n=e.width||this.layer.options.defaultIconSize[0]),C(s)&&(s=e.height||this.layer.options.defaultIconSize[1]);var h=L.createCanvas(n,s);L.image(h.getContext("2d"),e,0,0,n,s),e=h}this.resources.addResource(t,e)}},a}(Nt),Oe=function(){function o(){this.resources={},this._errors={}}var a=o.prototype;return a.addResource=function(r,t){var e=this;if(this.resources[r[0]]={image:t,width:+r[1],height:+r[2],refCnt:0},t&&!t.close&&q.imageBitMap&&!q.safari){if(t.src&&Se(t.src))return;createImageBitmap(t).then(function(n){!e.resources[r[0]]||(e.resources[r[0]].image=n)})}},a.isResourceLoaded=function(r,t){if(!r)return!1;var e=this._getImgUrl(r);if(this._errors[e])return!0;var n=this.resources[e];return!(!n||t&&Se(r[0])&&(+r[1]>n.width||+r[2]>n.height))},a.login=function(r){var t=this.resources[r];t&&t.refCnt++},a.logout=function(r){var t=this.resources[r];t&&t.refCnt--<=0&&delete this.resources[r]},a.getImage=function(r){var t=this._getImgUrl(r);return!this.isResourceLoaded(r)||this._errors[t]?null:this.resources[t].image},a.markErrorResource=function(r){this._errors[this._getImgUrl(r)]=1},a.merge=function(r){if(!r)return this;for(var t in r.resources){var e=r.resources[t];this.addResource([t,e.width,e.height],e.image)}return this},a.forEach=function(r){if(!this.resources)return this;for(var t in this.resources)Xe(this.resources,t)&&r(t,this.resources[t]);return this},a._getImgUrl=function(r){return Array.isArray(r)?r[0]:r},a.remove=function(){for(var r in this.resources){var t=this.resources[r];t&&t.image&&t.image.close&&t.image.close()}this.resources={}},o}(),Be={markerWidth:10,markerHeight:10,markerLineWidth:1};function qs(){return .5}var Tl=new S(0,0);function sa(o,a,i,r,t,e,n){var s=Tl.set(a,i),h=o.set(s.x,s.y,s.x+e,s.y+n);return h._add(t),r&&bl(h,r),h}var Sl=[];function $s(o,a,i){i=i||eh(Sl,a);var r=th(a,i[0],i[1]);return sa(o,a.markerDx||0,a.markerDy||0,kr(a),r,i[0],i[1])}function Qs(o){return o==="rectangle"?"right":"middle"}function Ks(o){return o==="bar"||o==="pie"||o==="pin"?"top":o==="rectangle"?"bottom":"middle"}var We=new vt(0,0);function th(o,a,i){var r=qs(),t=2*(o.shadowBlur||0),e=t+r;We.width=a,We.height=i;var n=o.markerType,s=xe(We,o.markerHorizontalAlignment||Qs(n),o.markerVerticalAlignment||Ks(n));return s.x!==-a/2&&(s.x-=yt(s.x+a/2)*e),s.y!==-i/2&&(s.y-=yt(s.y+i/2)*e),s}function eh(o,a){var i=qs(),r=B(a.markerWidth,Be.markerWidth),t=B(a.markerHeight,Be.markerHeight),e=B(a.markerLineWidth,Be.markerLineWidth),n=2*((a.shadowBlur||0)+Math.max(Math.abs(a.shadowOffsetX||0)+Math.abs(a.shadowOffsetY||0))),s=Math.round(r+e+n+i*2),h=Math.round(t+e+n+i*2);return o[0]=s,o[1]=h,o}var _o=new Y;function bl(o,a){var i=o.xmin,r=o.ymin,t=o.xmax,e=o.ymax;return _o.set(i,r,t,e),_o.convertTo(function(n){return n._rotate(a)},o)}function kr(o,a){a===void 0&&(a="markerRotation");var i=o[a];return N(i)?-i*Math.PI/180:0}function Dn(o,a,i){var r=a.markerFile,t=i?i.getImage(r):null,e=a.markerWidth||(t?t.width:0),n=a.markerHeight||(t?t.height:0);We.width=e,We.height=n;var s=xe(We,a.markerHorizontalAlignment||"middle",a.markerVerticalAlignment||"top");return sa(o,a.markerDx||0,a.markerDy||0,kr(a),s,e,n)}function ih(o,a,i){var r=i.size,t=xe(r,a.textHorizontalAlignment,a.textVerticalAlignment);if(a.textHaloRadius){var e=a.textHaloRadius;r=r.add(e*2,e*2)}return sa(o,a.textDx||0,a.textDy||0,kr(a,"textRotation"),t,r.width,r.height)}var Vi=new Y;function Ln(o,a,i,r){var t=o||new Y;if(Array.isArray(a)){for(var e=a,n=0;n<e.length;n++)Ln(t,e[n],i,r[n]);return t}return mr(a)&&t._combine(ih(Vi,a,r)),ha(a)&&t._combine(Dn(Vi,a,i)),_r(a)&&t._combine($s(Vi,a)),ua(a)&&t._combine(Dn(Vi,a)),t}function mr(o){return o?!C(o.textName):!1}function ha(o){return o?!C(o.markerFile):!1}function _r(o){return o?!!(C(o.markerFile)&&!C(o.markerType)&&o.markerType!=="path"):!1}function ua(o){return o?!!(C(o.markerFile)&&o.markerType==="path"):!1}var dn=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation"],gn=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY"];function er(o,a,i,r){for(var t=[],e=0,n,s=0,h=o.length;s<h-1;s++)n=El(o[s],o[s+1],a,s,i,r),n&&(t[e]=t[e]||[],t[e].push({point:n[0],index:s}),(n[1]!==o[s+1]||s===h-2)&&(t[e].push({point:n[1],index:s+1}),e++));return t}var po;function El(o,a,i,r,t,e){var n=r?po:Ve(o,i),s=Ve(a,i),h,u,l;for(po=s;;){if(!(n|s))return[o,a];if(n&s)return!1;if(e)return[o,a];h=n||s,u=In(o,a,h,i,t),l=Ve(u,i),h===n?(o=u,n=l):(a=u,s=l)}}function ir(o,a,i){var r=[1,4,2,8],t,e,n,s,h,u,l,f,c;for(e=0,l=o.length;e<l;e++)o[e]._code=Ve(o[e],a);for(s=0;s<4;s++){for(f=r[s],t=[],e=0,l=o.length,n=l-1;e<l;n=e++)h=o[e],u=o[n],h._code&f?u._code&f||(c=In(u,h,f,a,i),c._code=Ve(c,a),t.push(c)):(u._code&f&&(c=In(u,h,f,a,i),c._code=Ve(c,a),t.push(c)),t.push(h));o=t}return o}function In(o,a,i,r,t){var e=a.x-o.x,n=a.y-o.y,s=r.getMin(),h=r.getMax(),u,l;i&8?(u=o.x+e*(h.y-o.y)/n,l=h.y):i&4?(u=o.x+e*(s.y-o.y)/n,l=s.y):i&2?(u=h.x,l=o.y+n*(h.x-o.x)/e):i&1&&(u=s.x,l=o.y+n*(s.x-o.x)/e);var f=new S(u,l);return t&&f._round(),f}function Ve(o,a){var i=0;return o.x<a.getMin().x?i|=1:o.x>a.getMax().x&&(i|=2),o.y<a.getMin().y?i|=4:o.y>a.getMax().y&&(i|=8),i}function rh(o,a,i,r){o=new S(o);var t=Math.abs(i.x-a.x),e=Math.abs(i.y-a.y),n=Math.sqrt(Math.abs(t*t-e*e)),s=t>=e,h,u,l;return s?(h=new S(a.x-n,a.y),u=new S(a.x+n,a.y),l=t*2):(h=new S(a.x,a.y-n),u=new S(a.x,a.y+n),l=e*2),o.distanceTo(h)+o.distanceTo(u)<=l+2*r}var Rl=function(){function o(){}var a=o.prototype;return a.getMap=function(){return this.geometry.getMap()},a.getPainter=function(){return this.painter},a.isDynamicSize=function(){return!1},o.testColor=function(r){return!r||!$(r)?!1:mu.indexOf(r)>=0},o}(),nh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i._prepareContext=function(t){if(_t(this.symbol.opacity)?this._opacityFn||(this._opacityFn=ms(this.symbol.opacity)):delete this._opacityFn,N(this.symbol.opacity))t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var e=this.getMap();t.globalAlpha=this._opacityFn(e.getZoom())}else t.globalAlpha!==1&&(t.globalAlpha=1)},i.prepareCanvas=function(t,e,n){t.setLineDash&&rt(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var s=this.getPainter().isHitTesting();L.prepareCanvas(t,e,n,s)},i.remove=function(){},i.setZIndex=function(){},i.show=function(){},i.hide=function(){},i._defineStyle=function(t){return lr(t,this.geometry)},a}(Rl);function Al(o,a){var i=o&&o.getImage(a);return i||null}function ah(o,a,i,r){var t=oh(i),e=i,n=e.markerType.toLowerCase(),s=sh(n,e.markerWidth,e.markerHeight),h=t.lineOpacity,u=t.polygonOpacity,l=ne(t.polygonFill);if(l){var f;ne(t.polygonFill)&&(f||(f=Ol(a,e.markerWidth,e.markerHeight)),t.polygonGradientExtent=f)}L.prepareCanvas(o,t,r);var c=e.markerWidth,d=e.markerHeight,g=e.markerLineWidth/2;if(n==="ellipse")L.ellipse(o,a,c/2,d/2,d/2,h,u);else if(n==="cross"||n==="x"){for(var v=s.length-1;v>=0;v--)s[v]._add(a);L.path(o,s.slice(0,2),h),L.path(o,s.slice(2,4),h)}else if(n==="diamond"||n==="bar"||n==="square"||n==="rectangle"||n==="triangle"){n==="bar"?a=a.add(0,-g):n==="rectangle"&&(a=a.add(g,g));for(var m=s.length-1;m>=0;m--)s[m]._add(a);L.polygon(o,s,h,u)}else if(n==="pin"){a=a.add(0,-g);for(var _=s.length-1;_>=0;_--)s[_]._add(a);var p=o.lineCap;o.lineCap="round",L.bezierCurveAndFill(o,s,h,u),o.lineCap=p}else if(n==="pie"){a=a.add(0,-g);var y=Math.atan(c/2/d)*180/Math.PI,x=o.lineCap;o.lineCap="round",L.sector(o,a,d,[90-y,90+y],h,u),o.lineCap=x}else throw new Error("unsupported markerType: "+n);return o.canvas}function Ol(o,a,i){var r=new Y;return r._combine(o),r.xmin+=-a/2,r.ymin+=-i/2,r.xmax+=a/2,r.ymax+=i/2,r}function oh(o){var a={lineColor:o.markerLineColor,linePatternFile:o.markerLinePatternFile,lineWidth:o.markerLineWidth,lineOpacity:o.markerLineOpacity,lineDasharray:o.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:o.markerFill,polygonPatternFile:o.markerFillPatternFile,polygonOpacity:o.markerFillOpacity};return a.lineWidth===0&&(a.lineOpacity=0),a}function sh(o,a,i){var r=i/2,t=a/2,e=0,n=0,s,h,u,l;if(o==="triangle")return s=new S(e,n-r),h=new S(e-t,n+r),u=new S(e+t,n+r),[s,h,u];if(o==="cross")return s=new S(e-t,n),h=new S(e+t,n),u=new S(e,n-r),l=new S(e,n+r),[s,h,u,l];if(o==="diamond")return s=new S(e-t,n),h=new S(e,n-r),u=new S(e+t,n),l=new S(e,n+r),[s,h,u,l];if(o==="square")return s=new S(e-t,n+r),h=new S(e+t,n+r),u=new S(e+t,n-r),l=new S(e-t,n-r),[s,h,u,l];if(o==="rectangle")return s=new S(e,n),h=s.add(a,0),u=s.add(a,i),l=s.add(0,i),[s,h,u,l];if(o==="x")return s=new S(e-t,n+r),h=new S(e+t,n-r),u=new S(e+t,n+r),l=new S(e-t,n-r),[s,h,u,l];if(o==="bar")return s=new S(e-t,n-i),h=new S(e+t,n-i),u=new S(e+t,n),l=new S(e-t,n),[s,h,u,l];if(o==="pin"||o==="pie"){var f=i*Math.atan(t/r);return s=new S(e,n),h=new S(e-f,n-i),u=new S(e+f,n-i),l=new S(e,n),[s,h,u,l]}return[]}var kl=new S(0,0),Dl=new S(0,0),Ll=new S(0,0),Il=new S(0,0),Ke=function(o){z(a,o);function a(r,t,e){var n;return n=o.call(this)||this,n.symbol=r,n.geometry=t,n.painter=e,n}var i=a.prototype;return i.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLRes(),n=new Y,s=this._getRenderPoints()[0],h=s.length-1;h>=0;h--)s[h]&&n._combine(t._pointAtResToPoint(s[h],e));return n},i.isDynamicSize=function(){var t=this.symbol;return _t(t.markerWidth)||_t(t.markerHeight)||_t(t.textSize)},i._rotateExtent=function(t,e){return t.convertTo(function(n){return n._rotate(e)})},i._getRenderPoints=function(){var t=this.getPainter(),e=t.isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(e)},i._getRenderContainerPoints=function(t){var e=this.getPainter();if(e.isSpriting())return this._getRenderPoints()[0];var n=this.geometry,s=this.getDxDy(),h;if(n._cPoint&&!t){var u=t?Ll:Il;u.set(n._cPoint.x,n._cPoint.y);var l=e.containerOffset;u._sub(l);var f=s.x,c=s.y;(f||c)&&u._add(f||0,c||0),h=[u]}else{var d=this._getRenderPoints()[0];h=this.painter._pointContainerPoints(d,s.x,s.y,t,!0,this.getPlacement())}if(!h||!Array.isArray(h[0]))return h;for(var g=[],v=0,m=h.length;v<m;v++)for(var _=0,p=h[v].length;_<p;_++)g.push(h[v][_]);return g},i.getPlacement=function(){return this.symbol.markerPlacement},i.getRotation=function(){return kr(this.style)},i.getDxDy=function(){var t=this.style,e=t.markerDx,n=t.markerDy;return new S(e,n)},i._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var n=this._getRenderPoints()[1];if(!n||!n[t])return e;var s=this.getMap(),h=n[t][0],u=n[t][1];if(s.isTransforming()){var l=s.getGLRes();return h=s._pointAtResToContainerPoint(n[t][0],l,0,kl),u=s._pointAtResToContainerPoint(n[t][1],l,0,Dl),e+hr(h.x,h.y,u.x,u.y)}else return e+-hr(h.x,h.y,u.x,u.y)},i._rotate=function(t,e,n){if(n){var s=this.getDxDy(),h=e.sub(s);return t.save(),t.translate(h.x,h.y),t.rotate(n),s}return null},a}(nh),zl=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.getPlacement=function(){return"point"},i.getDxDy=function(){return new S(0,0)},i.symbolize=function(t){var e=this.geometry,n=e.getLayer();if(!(!e.options.debug&&n&&!n.options.debug)){var s=this.getMap();if(!(!s||s.isZooming())){var h=n.options.debugOutline,u=1;t.strokeStyle=h,t.fillStyle=h;var l=e.getContainerExtent().toArray();L.polygon(t,[l],u,0);for(var f=this._getRenderContainerPoints(),c=this.geometry.getId(),d=sh("cross",10,10),g=0;g<f.length;g++){var v=f[g];C(c)||L.fillText(t,c,v.add(8,-4),h);for(var m=[],_=0;_<d.length;_++)m.push(d[_].add(v));L.path(t,m.slice(0,2),u),L.path(t,m.slice(2,4),u)}}}},a}(Ke),vn=new vt(1,1),la=function(o){z(a,o),a.test=function(t){return ha(t)};function a(r,t,e){var n;return n=o.call(this,r,t,e)||this,n.style=n._defineStyle(n.translate()),n}var i=a.prototype;return i.symbolize=function(t,e){var n=this.style;if(!(!this.painter.isHitTesting()&&(n.markerWidth===0||n.markerHeight===0||n.markerOpacity===0))){var s=this._getRenderContainerPoints();if(!!rt(s)){var h=this._getImage(e);if(!!h){this._prepareContext(t);var u=n.markerWidth,l=n.markerHeight;if(!N(u)||!N(l)){u=h.width,l=h.height,n.markerWidth=u,n.markerHeight=l;var f=n.markerFile;e.isResourceLoaded(f)||e.addResource(f,h);var c=this.getPainter();c.isSpriting()||c.removeCache()}var d;this.symbol.markerType!=="path"&&N(n.markerOpacity)&&n.markerOpacity<1&&(d=t.globalAlpha,t.globalAlpha*=n.markerOpacity),vn.width=u,vn.height=l;for(var g=xe(vn,n.markerHorizontalAlignment,n.markerVerticalAlignment),v=0,m=s.length;v<m;v++){var _=s[v],p=this.getRotation()?this._rotate(t,_,this._getRotationAt(v)):null;p&&(_=p),L.image(t,h,_.x+g.x,_.y+g.y,u,l),p&&t.restore()}d!==void 0&&(t.globalAlpha=d)}}}},i._getImage=function(t){return Al(t,this.style.markerFile)},i.getFixedExtent=function(t){return this._fixedExtent=this._fixedExtent||new Y,Dn(this._fixedExtent,this.style,t)},i.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:B(t.markerOpacity,1),markerWidth:B(t.markerWidth,null),markerHeight:B(t.markerHeight,null),markerRotation:B(t.markerRotation,0),markerDx:B(t.markerDx,0),markerDy:B(t.markerDy,0),markerHorizontalAlignment:B(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:B(t.markerVerticalAlignment,"top")}},a}(Ke),jl=new k(0,0),Hl=new k(0,0),hh=function(o){z(a,o),a.test=function(t,e){if(!t||e&&e.type==="Point")return!1;for(var n in t){var s=n.slice(0,4);if(s==="line"||s==="poly")return!0}return!1};function a(r,t,e){var n;return n=o.call(this)||this,n.symbol=r,n.geometry=t,n.painter=e,t.type==="Point"?xt(n):(n.style=n._defineStyle(n.translate()),n)}var i=a.prototype;return i.symbolize=function(t,e){var n=this.style;if(!(n.polygonOpacity===0&&n.lineOpacity===0&&!this.painter.isHitTesting())){var s=this._getPaintParams();if(!!s){this._prepareContext(t);var h=ne(n.lineColor),u=this.geometry.getJSONType()==="Polygon"||this.geometry.type==="LineString";h&&(n.lineColor.places||!u)&&(n.lineGradientExtent=this.geometry.getContainerExtent()._expand(n.lineWidth)),ne(n.polygonFill)&&(n.polygonGradientExtent=this.geometry.getContainerExtent());var l=s[0],f=this.geometry.getJSONType()==="Polygon"&&l.length>0&&Array.isArray(l[0][0])||this.geometry.type==="LineString"&&l.length>0&&Array.isArray(l[0]);if(f)for(var c=0;c<l.length;c++){this.prepareCanvas(t,n,e),h&&u&&!n.lineColor.places&&this._createGradient(t,l[c],n.lineColor);var d=[t,l[c]];s.length>1&&d.push.apply(d,s.slice(1)),d.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray),this.geometry._paintOn.apply(this.geometry,d)}else{this.prepareCanvas(t,n,e),h&&u&&!n.lineColor.places&&this._createGradient(t,l,n.lineColor);var g=[t];g.push.apply(g,s),g.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray),this.geometry._paintOn.apply(this.geometry,g)}t.setLineDash&&Array.isArray(n.lineDasharray)&&t.setLineDash([])}}},i.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;(!this._extMin||!this._extMax)&&(this._extMin=new k(0,0),this._extMax=new k(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var n=t._prjToPoint(this._extMin,void 0,jl),s=t._prjToPoint(this._extMax,void 0,Hl);return this._pxExtent?this._pxExtent.set(Math.min(n.x,s.x),Math.min(n.y,s.y),Math.max(n.x,s.x),Math.max(n.y,s.y)):this._pxExtent=new Y(n,s),this._pxExtent},i.getFixedExtent=function(){var t=this.style.lineWidth/2;return new Y(-t,-t,t,t)},i._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},i.translate=function(){var t=this.symbol,e={lineColor:B(t.lineColor,"#000"),lineWidth:B(t.lineWidth,2),lineOpacity:B(t.lineOpacity,1),lineDasharray:B(t.lineDasharray,[]),lineCap:B(t.lineCap,"butt"),lineJoin:B(t.lineJoin,"miter"),linePatternFile:B(t.linePatternFile,null),lineDx:B(t.lineDx,0),lineDy:B(t.lineDy,0),polygonFill:B(t.polygonFill,null),polygonOpacity:B(t.polygonOpacity,1),polygonPatternFile:B(t.polygonPatternFile,null),polygonPatternDx:B(t.polygonPatternDx,0),polygonPatternDy:B(t.polygonPatternDy,0),linePatternDx:B(t.linePatternDx,0),linePatternDy:B(t.linePatternDy,0)};return e.lineWidth===0&&(e.lineOpacity=0),this.geometry.type==="LineString"&&!e.polygonFill&&(e.polygonFill=e.lineColor),e},i._createGradient=function(t,e,n){if(!(!Array.isArray(e)||!e.length)){var s=e.length,h=t.createLinearGradient(e[0].x,e[0].y,e[s-1].x,e[s-1].y);n.colorStops.forEach(function(u){h.addColorStop.apply(h,u)}),t.strokeStyle=h}},a}(nh),Fl=function(o){z(a,o),a.test=function(t){return mr(t)};function a(r,t,e){var n;n=o.call(this,r,t,e)||this;var s=n.translate();return n._dynamic=vs(s),n.style=n._defineStyle(s),n.style.textWrapWidth===0?xt(n):(n.strokeAndFill=n._defineStyle(n.translateLineAndFill(n.style)),n)}var i=a.prototype;return i.symbolize=function(t,e){if(!(!this.painter.isHitTesting()&&(this.style.textSize===0||!this.style.textOpacity&&(!this.style.textHaloRadius||!this.style.textHaloOpacity)||this.style.textWrapWidth===0))){var n=this._getRenderContainerPoints();if(!!rt(n)){var s=this.style,h=this.strokeAndFill,u=cr(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var l=this._textDesc=this._textDesc||dr(u,this.style);this._prepareContext(t),this.prepareCanvas(t,h,e),L.prepareCanvasFont(t,s);for(var f=0,c=n.length;f<c;f++){var d=n[f],g=this.getRotation()?this._rotate(t,d,this._getRotationAt(f)):null;g&&(d=g),L.text(t,u,d,s,l),g&&t.restore()}}}},i.getPlacement=function(){return this.symbol.textPlacement},i.getRotation=function(){var t=this.style.textRotation;return N(t)?-t*Math.PI/180:null},i.getDxDy=function(){var t=this.style;return new S(t.textDx,t.textDy)},i.getFixedExtent=function(){var t=this.geometry.getTextDesc();return Array.isArray(t)&&(t=t[this._index]),this._fixedExtent=this._fixedExtent||new Y,t?ih(this._fixedExtent,this.style,t):this._fixedExtent},i.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:B(t.textFaceName,"monospace"),textWeight:B(t.textWeight,"normal"),textStyle:B(t.textStyle,"normal"),textSize:B(t.textSize,is),textFont:B(t.textFont,null),textFill:B(t.textFill,"#000"),textOpacity:B(t.textOpacity,1),textHaloFill:B(t.textHaloFill,"#ffffff"),textHaloRadius:B(t.textHaloRadius,0),textHaloOpacity:B(t.textHaloOpacity,1),textWrapWidth:B(t.textWrapWidth,null),textWrapCharacter:B(t.textWrapCharacter,`
`),textLineSpacing:B(t.textLineSpacing,0),textDx:B(t.textDx,0),textDy:B(t.textDy,0),textHorizontalAlignment:B(t.textHorizontalAlignment,"middle"),textVerticalAlignment:B(t.textVerticalAlignment,"middle"),textAlign:B(t.textAlign,"center"),textRotation:B(t.textRotation,0),textMaxWidth:B(t.textMaxWidth,0),textMaxHeight:B(t.textMaxHeight,0)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},i.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},a}(Ke),Gl=[],uh=function(o){z(a,o),a.test=function(t){return _r(t)};function a(r,t,e){var n;n=o.call(this,r,t,e)||this;var s=n.translate();return n._dynamic=vs(s),n.style=n._defineStyle(s),n.strokeAndFill=n._defineStyle(oh(n.style)),n.padding=0,n}var i=a.prototype;return i.symbolize=function(t,e){var n=this.style;if(!(!this.painter.isHitTesting()&&(n.markerWidth===0||n.markerHeight===0||n.polygonOpacity===0&&n.lineOpacity===0))){var s=this._getRenderContainerPoints();!rt(s)||(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||this.geometry.getLayer().options.cacheVectorOnCanvas===!1?this._drawMarkers(t,s,e):this._drawMarkersWithCache(t,s,e))}},i._drawMarkers=function(t,e,n){for(var s=e.length-1;s>=0;s--){var h=e[s],u=this.getRotation()?this._rotate(t,h,this._getRotationAt(s)):null;u&&(h=u),this._drawVectorMarker(t,h,n),u&&t.restore()}},i._drawMarkersWithCache=function(t,e,n){var s=this._stampSymbol(),h=n.getImage(s);h||(h=this._createMarkerImage(t,n),n.addResource([s,h.width,h.height],h));for(var u=th(this.style,h.width,h.height),l=e.length-1;l>=0;l--){var f=e[l],c=this.getRotation()?this._rotate(t,f,this._getRotationAt(l)):null;c&&(f=c),L.image(t,h,f.x+u.x,f.y+u.y),c&&t.restore()}},i._createMarkerImage=function(t,e){var n=t.canvas.constructor,s=eh(Gl,this.style),h=L.createCanvas(s[0],s[1],n),u=this._getCacheImageAnchor(s[0],s[1]),l=h.getContext("2d");return this._drawVectorMarker(l,u,e),h},i._stampSymbol=function(){return this._stamp||(this._stamp=qn([this.style.markerType,ne(this.style.markerFill)?Rn(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,ne(this.style.markerLineColor)?Rn(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},i._getCacheImageAnchor=function(t,e){var n=2*(this.symbol.shadowBlur||0),s=n+this.padding,h=this.style.markerType;return h==="bar"||h==="pie"||h==="pin"?new S(t/2,e-s):h==="rectangle"?new S(s,s):new S(t/2,e/2)},i._getGraidentExtent=function(t){var e=new Y,n=this.getDxDy(),s=this.getFixedExtent();if(Array.isArray(t))for(var h=t.length-1;h>=0;h--)e._combine(t[h]);else e._combine(t);return e.xmin+=s.xmin-n.x,e.ymin+=s.ymin-n.y,e.xmax+=s.xmax-n.x,e.ymax+=s.ymax-n.y,e},i._drawVectorMarker=function(t,e,n){ah(t,e,this.style,n)},i.getFixedExtent=function(){var t=this.isDynamicSize(),e=this.style.markerWidth,n=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new Y,$s(this._fixedExtent,this.style,t?[128,128*n/e]:null)},i.translate=function(){var t=this.symbol,e={markerType:B(t.markerType,"ellipse"),markerFill:B(t.markerFill,"#00f"),markerFillOpacity:B(t.markerFillOpacity,1),markerFillPatternFile:B(t.markerFillPatternFile,null),markerLineColor:B(t.markerLineColor,"#000"),markerLineWidth:B(t.markerLineWidth,Be.markerLineWidth),markerLineOpacity:B(t.markerLineOpacity,1),markerLineDasharray:B(t.markerLineDasharray,[]),markerLinePatternFile:B(t.markerLinePatternFile,null),markerDx:B(t.markerDx,0),markerDy:B(t.markerDy,0),markerWidth:B(t.markerWidth,Be.markerWidth),markerHeight:B(t.markerHeight,Be.markerHeight),markerRotation:B(t.markerRotation,0),shadowBlur:B(t.shadowBlur,0),shadowOffsetX:B(t.shadowOffsetX,0),shadowOffsetY:B(t.shadowOffsetY,0)},n=e.markerType,s=Qs(n),h=Ks(n);return e.markerHorizontalAlignment=B(t.markerHorizontalAlignment,s),e.markerVerticalAlignment=B(t.markerVerticalAlignment,h),N(t.markerOpacity)&&(N(t.markerFillOpacity)&&(e.markerFillOpacity*=t.markerOpacity),N(t.markerLineOpacity)&&(e.markerLineOpacity*=t.markerOpacity)),e},a}(Ke),lh=function(o){z(a,o),a.test=function(t){return ua(t)};function a(r,t,e){var n;C(r.markerWidth)&&(r.markerWidth=80),C(r.markerHeight)&&(r.markerHeight=80),n=o.call(this,r,t,e)||this,r=H(r,n.translate());var s=n.style=n._defineStyle(r);return q.gecko?n._url=[Ti(s,s.markerWidth,s.markerHeight),s.markerWidth,s.markerHeight]:n._url=[Ti(s),s.markerWidth,s.markerHeight],n}var i=a.prototype;return i._prepareContext=function(){},i._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var n=this.painter,s=new Image;return s.onload=function(){var h=n.getLayer()&&n.getLayer().getRenderer();h&&h.setToRedraw()},s.onerror=function(h){t.markErrorResource(e._url)},s.src=this._url[0],t&&t.addResource(this._url,s),s},a}(la),Nl={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},Zl=function(o){z(a,o),a.test=function(t,e){var n=e.getLayer();if(!n)return!1;var s=e.getJSONType();return s==="Marker"||s==="LineString"};function a(r,t,e){var n;return n=o.call(this,r,t,e)||this,n.style=t.getLayer().options.drawAltitude,(!n.style||!Gt(n.style))&&(n.style={lineWidth:2}),n.style.lineWidth||(n.style.lineWidth=0),n.dxdy=n._defineStyle({dx:r.textDx||r.markerDx,dy:r.textDy||r.markerDy}),n}var i=a.prototype;return i.symbolize=function(t){var e=this.geometry.getLayer();if(!!e.options.drawAltitude){var n=this.geometry.getProperties();if(!(!n||!n[e.options.altitudeProperty])){var s=this._getStyle();if(this._prepareContext(t),this.geometry.type==="LineString"){var h=this._getPaintParams(s.lineDx,s.lineDy,!1,!0);if(!h)return;var u=this.getPainter().getPaintParams(s.lineDx,s.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(t,h[0],u)}else{var l=this._getRenderContainerPoints(),f=this._getRenderContainerPoints(!0);if(!l||l.length===0)return;this._drawMarkerAltitude(t,l[0],f[0])}}}},i.getDxDy=function(){var t=this.dxdy;return new S(t.dx||0,t.dy||0)},i.get2DExtent=function(){return this.geometry.type==="LineString"?hh.prototype.get2DExtent.apply(this):o.prototype.get2DExtent.call(this)},i.getPlacement=function(){return"point"},i._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0,null,!0,"_altpt")},i._drawMarkerAltitude=function(t,e,n){var s=this._getStyle();this.prepareCanvas(t,s),L.path(t,[e,n],s.lineOpacity,null,s.lineDasharray)},i._drawLineAltitude=function(t,e,n){var s=this._getStyle(),h=e.length>0&&Array.isArray(e[0]);if(h)for(var u=0;u<e.length;u++)this._drawLine(t,e[u],n[u]);else this._drawLine(t,e,n);t.setLineDash&&Array.isArray(s.lineDasharray)&&t.setLineDash([])},i._drawLine=function(t,e,n){var s=this._getStyle();this.prepareCanvas(t,s);for(var h=0,u=e.length-1;h<u;h++)L.polygon(t,[e[h],e[h+1],n[h+1],n[h]],s.lineOpacity,s.polygonOpacity,s.lineDasharray)},i._getStyle=function(){var t=this.geometry.getLayer().options.drawAltitude;return Gt(t)||(t=Nl),t.lineWidth||(t.lineWidth=0,t.lineOpacity=0),t},a}(Ke),Bl=[Zl,hh,la,lh,uh,Fl],Me,yo=new S(0,0),Wl=new Y,Ui=new Y,jt=new Y,Vl=new Y,he=new Y,Ul={},si={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},fa=function(o){z(a,o);function a(r){var t;return t=o.call(this)||this,t.geometry=r,t.symbolizers=t._createSymbolizers(),t._altAtGL=t._getGeometryAltitude(),t}var i=a.prototype;return i.getMap=function(){return this.geometry.getMap()},i.getLayer=function(){return this.geometry.getLayer()},i._createSymbolizers=function(){var t=this.getSymbol(),e=[],n=Bl,s=t;Array.isArray(t)||(s=[t]);for(var h=s.length-1;h>=0;h--)for(var u=s[h],l=n.length-1;l>=0;l--)if(n[l].test(u,this.geometry)){var f=new n[l](u,this.geometry,this);f._index=h,e.push(f),f instanceof Ke&&(this._hasPoint=!0)}if(!e.length&&console)var c=this.geometry.getId();return this._debugSymbolizer=new zl(t,this.geometry,this),e},i.hasPoint=function(){return!!this._hasPoint},i.getRenderPoints=function(t){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},i.getPaintParams=function(t,e,n,s,h){h===void 0&&(h="_pt");var u=this.getLayer()._getRenderer(),l=u.mapStateCache,f,c,d,g,v,m=this.getMap();l&&!this._hitPoint?(f=l.resolution,c=l.pitch,d=l.bearing,g=l.glScale,v=l.containerExtent):(f=m.getResolution(),c=m.getPitch(),d=m.getBearing(),g=m.getGLScale(),v=m.getContainerExtent());var _=this.geometry,p=f,y=c!==0,x=d!==0,M=this._cachedParams,w=_._paintAsPath&&_._paintAsPath();if(w&&this._unsimpledParams&&p<=this._unsimpledParams._res)M=this._unsimpledParams;else if(!M||M._res!==f||this._pitched!==y&&_._redrawWhenPitch()||this._rotated!==x&&_._redrawWhenRotate()){if(M=_._getPaintParams(),!M)return null;M._res=p,!_._simplified&&w&&(this._unsimpledParams||(this._unsimpledParams=M),p>this._unsimpledParams._res&&(this._unsimpledParams._res=p)),this._cachedParams=M}if(!M)return null;this._pitched=y,this._rotated=x;var b=g,T=[],P=M[0],O=v,I=this._pointContainerPoints(P,t,e,n,s||this._hitPoint&&!O.contains(this._hitPoint),null,h);if(!I)return null;T.push(I);for(var E=1,D=M.length;E<D;E++)N(M[E])||M[E]instanceof vt?N(M[E])?T.push(M[E]/b):T.push(M[E].multi(1/b)):T.push(M[E]);return T},i._pointContainerPoints=function(t,e,n,s,h,u,l){if(l===void 0&&(l="_pt"),this._aboveCamera())return null;var f=this.getLayer()._getRenderer(),c=f.mapStateCache,d=this.getMap(),g=this.geometry,v=this.containerOffset,m,_;c?(m=c.glRes,_=c.containerExtent):(m=d.getGLRes(),_=d.getContainerExtent());var p,y=this.getLayer().options.roundPoint,x=1/0,M=1/0,w=-1/0,b=-1/0,T=!h,P=f.layer.options.clipBBoxBufferSize||3,O=this.symbolizers;function I(it,bt){it===void 0&&(it=[]),bt===void 0&&(bt=[]);var Q=Mi(it,l);Q=d._pointsAtResToContainerPoints(it,m,bt,Q);for(var wt=0,Ot=Q.length;wt<Ot;wt++){var ht=Q[wt];ht._sub(v),(e||n)&&ht._add(e||0,n||0),y&&(ht.x=Math.ceil(ht.x),ht.y=Math.ceil(ht.y)),x=Math.min(ht.x,x),M=Math.min(ht.y,M),w=Math.max(ht.x,w),b=Math.max(ht.y,b)}if(T&&Es(O)){if(he.ymin=_.ymin,he.ymin<P&&(he.ymin=_.ymin-P),he.xmin=_.xmin-P,he.xmax=_.xmax+P,he.ymax=_.ymax+P,g.getShell&&g.getHoles)return ir(Q,he);var Tt=er(Q,he,!1);if(Tt.length){var zt=[];return Tt.forEach(function(Kt){for(var at=0,se=Kt.length;at<se;at++)zt.push(Kt[at].point)}),zt}}return Q}var E=this.getAltitude();if(Array.isArray(t)){var D=this.geometry,R;!h&&D.options.enableClip?(R=this._clip(t,E),R.inView&&(T=!1)):R={points:t,altitude:E};var A=R.points;E=R.altitude,s&&(E=0);var G=E;p=[];for(var F=[],j=N(E),Z=0,V=A.length;Z<V;Z++){var J=A[Z];if(Array.isArray(J)){if(j){var ot=I(J,E);p.push(ot);continue}for(var ft=[],et=0,X=J.length;et<X;et++)Array.isArray(E)&&(E[Z]?G=E[Z][et]:G=0),ft.push(G);var tt=I(J,ft);p.push(tt)}else Array.isArray(E)&&(u==="vertex-last"?G=E[E.length-1-Z]:u==="line"?G=(E[Z]+E[Z+1])/2:G=E[Z]),F.push(G)}F.length&&(p=I(A,F))}else t instanceof S&&(s&&(E=0),p=d._pointAtResToContainerPoint(t,m,E)._sub(v),(e||n)&&p._add(e,n));return si.minx=x,si.miny=M,si.maxx=w,si.maxy=b,this._containerBbox=si,p},i._clip=function(t,e){if(N(e)&&e!==0)return{points:t,altitude:e};if(Array.isArray(e)){for(var n=!1,s=0,h=e.length;s<h;s++)if(e[s]!==0){n=!0;break}if(n)return{points:t,altitude:e}}var u=this.getMap(),l=this.geometry,f=this.getSymbol().lineWidth;N(f)||(f=4);var c=this.getLayer()._getRenderer(),d=c.mapStateCache,g,v,m;d?(g=d._2DExtent,v=d.glExtent,m=d.pitch):(g=u._get2DExtent(),v=u._get2DExtentAtRes(u.getGLRes()),m=u.getPitch());var _=g._expand(f);if(m>0&&e){var p=u.cameraLookAt,y=u.cameraPosition;yo.set(y.x,y.y),_=_._combine(yo._add(yt(p[0]-y[0]),yt(p[1]-y[1])))}var x=this.get2DExtent(null,Vl),M=t;if(x.within(_))return{points:M,altitude:e,inView:!0};var w=v._expand(f*u._glScale);jt.xmin=w.xmin,jt.xmax=w.xmax,jt.ymin=w.ymin,jt.ymax=w.ymax;var b=l.options.smoothness;if(l.getShell&&this.geometry.getHoles&&!b){var T=w.xmin,P=w.ymin,O=w.xmax,I=w.ymax,E=Math.abs(O-T),D=Math.abs(I-P),R=Math.sqrt(E*E+D*D),A=(R-E)/2,G=(R-D)/2;if(jt.xmin=w.xmin-A,jt.xmax=w.xmax+A,jt.ymin=w.ymin-G,jt.ymax=w.ymax+G,!Array.isArray(t[0]))M=ir(t,jt);else{M=[];for(var F=0;F<t.length;F++){var j=ir(t[F],jt);j.length&&M.push(j)}}}else if(l.getJSONType()==="LineString"&&!b){if(!Array.isArray(t[0]))M=er(t,jt,!1,!!b);else{M=[];for(var Z=0;Z<t.length;Z++)ke(M,er(t[Z],jt,!1,!!b))}return this._interpolateSegAlt(M,t,e)}return{points:M,altitude:e}},i._interpolateSegAlt=function(t,e,n){if(!Array.isArray(n)){var s=function(f){return f.point};return{points:t.map(function(l){return Array.isArray(l)?l.map(s):l.point}),altitude:n}}var h=fh(t,e,n);n=[];var u=h.map(function(l){if(Array.isArray(l)){var f=[],c=l.map(function(d){return f.push(d.altitude),d.point});return n.push(f),c}return n.push(l.altitude),l.point});return{points:u,altitude:n}},i.getSymbol=function(){return this.geometry._getInternalSymbol()},i.paint=function(t,e,n){if(!!this.symbolizers){var s=this.getLayer(),h=s._getRenderer();if(!(!h||!h.context&&!e)){var u=h.mapStateCache||{};if(!(!this.geometry._isCheck&&t&&!t.intersects(this.get2DExtent(h.resources,Wl)))){var l=this.getMap(),f=this.getMinAltitude(),c=l.getFrustumAltitude();if(!(f&&c&&c<f)){this.containerOffset=n||u.offset||l._pointToContainerPoint(h.southWest)._add(0,-l.height),this._beforePaint();for(var d=e||h.context,g=[d,h.resources],v=this.symbolizers.length-1;v>=0;v--)(d.shadowBlur||this.symbolizers[v].symbol.shadowBlur)&&this._prepareShadow(d,this.symbolizers[v].symbol),this.symbolizers[v].symbolize.apply(this.symbolizers[v],g);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||s.options.debug)&&this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,g)}}}}},i.getSprite=function(t,e){if(this.geometry.type!=="Point")return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var n=new Y;this.symbolizers.forEach(function(v){var m=v.getFixedExtent(t);n._combine(m)});var s=n.getMin().multi(-1),h=e||(this.getMap()?this.getMap().CanvasClass:null),u=L.createCanvas(n.getWidth(),n.getHeight(),h),l;this._renderPoints&&(l=this._renderPoints);for(var f=u.getContext("2d"),c=[f,t],d=this.symbolizers.length-1;d>=0;d--){var g=this.symbolizers[d].getDxDy();this._renderPoints={center:[[s.add(g)]]},this._prepareShadow(f,this.symbolizers[d].symbol),this.symbolizers[d].symbolize.apply(this.symbolizers[d],c)}l&&(this._renderPoints=l),this._sprite={canvas:u,offset:n.getCenter()}}return this._spriting=!1,this._sprite},i.isSpriting=function(){return!!this._spriting},i.hitTest=function(t,e){if((!e||e<.5)&&(e=.5),this._hitPoint=t.sub(e,e),!Me){var n=this.getMap()?this.getMap().CanvasClass:null;Me=L.createCanvas(1,1,n)}L.setHitTesting(!0),Me.width=Me.height=2*e;var s=Me.getContext("2d");try{this.paint(null,s,this._hitPoint)}catch(f){throw f}finally{L.setHitTesting(!1)}delete this._hitPoint;for(var h=s.getImageData(0,0,Me.width,Me.height).data,u=3,l=h.length;u<l;u+=4)if(h[u]>0)return!0;return!1},i.isHitTesting=function(){return!!this._hitPoint},i._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},i._eachSymbolizer=function(t,e){if(!!this.symbolizers){e||(e=this);for(var n=this.symbolizers.length-1;n>=0;n--)t.apply(e,[this.symbolizers[n]])}},i.get2DExtent=function(t,e){this._verifyProjection();var n=this.getMap();t=t||this.getLayer()._getRenderer().resources;var s=n.getZoom(),h=this._isDynamicSize();if((!this._extent2D||this._extent2D._zoom!==s||!this._fixedExtent)&&(this._extent2D&&this._extent2D._zoom!==s&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new Y),this._extent2D._zoom=s),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(t,new Y)))),!this._extent2D)return h&&delete this._fixedExtent,null;var u=this._fixedExtent,l=u.xmin,f=u.ymin,c=u.xmax,d=u.ymax;return h&&delete this._fixedExtent,Ui.set(l,-d,c,-f),e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(Ui),e):this._extent2D.add(Ui)},i._computeExtent2D=function(t){for(var e=this.symbolizers.length-1;e>=0;e--){var n=this.symbolizers[e];t._combine(n.get2DExtent())}return t},i._computeFixedExtent=function(t,e){for(var n=this.symbolizers.length-1;n>=0;n--){var s=this.symbolizers[n];s.getFixedExtent&&e._combine(s.getFixedExtent(t))}return e},i._isDynamicSize=function(){for(var t=this.symbolizers.length-1;t>=0;t--){var e=this.symbolizers[t];if(e.isDynamicSize())return!0}return!1},i._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap(),n=e.getFrustumAltitude();return t&&n&&n<t},i.getFixedExtent=function(){var t=this.getMap(),e=t.getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new Y):((!this._extent2D||this._extent2D._zoom!==e)&&this.get2DExtent(null,Ui),this._fixedExtent)},i.setZIndex=function(t){this._eachSymbolizer(function(e){e.setZIndex(t)})},i.show=function(){if(this._painted)this.removeCache(),this._eachSymbolizer(function(e){e.show()});else{var t=this.getLayer();t.isCanvasRender()||this.paint()}},i.hide=function(){this._eachSymbolizer(function(t){t.hide()})},i.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(!!t){var e=t.getRenderer();!e||!e.setToRedraw()||e.setToRedraw()}},i.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},i.remove=function(){this.removeCache(),this._removeSymbolizers()},i._removeSymbolizers=function(){this._eachSymbolizer(function(t){delete t.painter,t.remove()}),delete this.symbolizers},i.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},i.getAltitude=function(){var t=this.geometry.getAltitude();return t!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},i.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},i.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},i._getGeometryAltitude=function(){var t=this,e=this.getMap();if(!e)return 0;var n=this.geometry.getAltitude();if(this._propAlt=n,!n)return this.minAltitude=this.maxAltitude=0,0;var s=this.geometry.getCenter();return s?Array.isArray(n)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,n.map(function(h){var u=t._meterToPoint(s,h);return u<t.minAltitude&&(t.minAltitude=u),u>t.maxAltitude&&(t.maxAltitude=u),u})):(this.minAltitude=this.maxAltitude=this._meterToPoint(s,n),this.minAltitude):0},i._meterToPoint=function(t,e){var n=this.getMap(),s=n.getGLRes();return n.altitudeToPoint(e,s)*yt(e)},i._verifyProjection=function(){var t=this.geometry._getProjection()||Ul;this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},i._beforePaint=function(){},i._afterPaint=function(){},a}(Nt);function fh(o,a,i){if(!Array.isArray(i))return o;for(var r=[],t=0,e=o.length;t<e;t++)if(Array.isArray(o[t]))r.push(fh(o[t],a,i));else{var n=o[t];if(n.point.equals(a[n.index]))n.altitude=i[n.index],r.push(n);else{var s=void 0,h=void 0;n.index===0?(s=n.index,h=n.index+1):(s=n.index-1,h=n.index);var u=n.point.distanceTo(a[h]),l=u/(u+a[s].distanceTo(n.point)),f=or(i[s],i[h],1-l);n.altitude=f,r.push(n)}}return r}var Jl=new Y,ch=function(o){z(a,o);function a(r,t){var e;return e=o.call(this)||this,e.geometry=r,e.isMask=t,e}var i=a.prototype;return i._eachPainter=function(t){for(var e=this.geometry.getGeometries(),n,s=0,h=e.length;s<h&&(n=this.isMask?e[s]._getMaskPainter():e[s]._getPainter(),!(!!n&&n&&t.call(this,n)===!1));s++);},i.paint=function(t){!this.geometry||this._eachPainter(function(e){e.paint(t)})},i.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var n=e||new Y;return this._eachPainter(function(s){n=n._combine(s.get2DExtent(t,Jl))}),n},i.remove=function(){var t=arguments;this._eachPainter(function(e){e.remove.apply(e,t)})},i.setZIndex=function(){var t=arguments;this._eachPainter(function(e){e.setZIndex.apply(e,t)})},i.show=function(){var t=arguments;this._eachPainter(function(e){e.show.apply(e,t)})},i.hide=function(){var t=arguments;this._eachPainter(function(e){e.hide.apply(e,t)})},i.repaint=function(){var t=arguments;this._eachPainter(function(e){e.repaint.apply(e,t)})},i.refreshSymbol=function(){var t=arguments;this._eachPainter(function(e){e.refreshSymbol.apply(e,t)})},i.hasPoint=function(){var t=!1;return this._eachPainter(function(e){return e.hasPoint()?(t=!0,!1):!0}),t},i.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter(function(n){var s=n.getMinAltitude();(t||s<e)&&(t=!1,e=s)}),e},i.getMaxAltitude=function(){var t=0;return this._eachPainter(function(e){var n=e.getMaxAltitude();n>t&&(t=n)}),t},a}(Nt),hi=23,Ze={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var o=[],a=12756274*Math.PI,i=0;i<hi;i++)o[i]=a/(256*Math.pow(2,i));return o}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var o=[],a=0;a<hi;a++)o[a]=180/(Math.pow(2,a)*128);return o}()},BAIDU:{projection:"baidu",resolutions:function(){for(var o=Math.pow(2,18),a=[],i=0;i<hi;i++)a[i]=o,o*=.5;return a}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var o=Math.pow(2,8),a=[],i=0;i<hi;i++)a[i]=o,o*=.5;return a}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var o=[],a=6378137*Math.PI,i=0;i<hi;i++)o[i]=a/(256*Math.pow(2,i));return o}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}}};Ze["EPSG:4490"]=Ze["EPSG:4326"];var Yt=function(){function o(i){i===void 0&&(i={}),this.options=i,this._initSpatialRef()}o.getPreset=function(r){return Ze[r.toUpperCase()]},o.getAllPresets=function(){return Object.keys(Ze)},o.getProjectionInstance=function(r){if(!r)return null;if(Gt(r))return r.locate||(r=H({},r),r.measure==="identity"?H(r,un.getInstance("IDENTITY")):H(r,un.getInstance("EPSG:4326"))),r;r=(r+"").toLowerCase();for(var t in Wi)if(Xe(Wi,t)){var e=Wi[t].code;if(e&&e.toLowerCase()===r)return Wi[t]}return null},o.equals=function(r,t){if($(r)||$(t))return r===t;if(!r&&!t)return!0;if(!r||!t||r.projection!==t.projection)return!1;var e=r.fullExtent,n=t.fullExtent;if(e&&!n||!e&&n||e&&n&&(e.top!==n.top||e.bottom!==n.bottom||e.left!==n.left||e.right!==n.right))return!1;var s=r.resolutions,h=t.resolutions;if(s&&h){if(s.length!==h.length)return!1;for(var u=0;u<s.length;u++)if(s[u]!==h[u])return!1}else if(s||h)return!1;return!0};var a=o.prototype;return a._initSpatialRef=function(){var r=this.options.projection;if(r?r=o.getProjectionInstance(r):r=Js,!r)throw new Error("must provide a valid projection in map's spatial reference.");r=H({},$e,r),r.measureLength||H(r,un.DEFAULT),this._projection=r;var t,e=this.options.resolutions;if(!e&&(r.code&&(t=Ze[r.code.toUpperCase()],t&&(e=t.resolutions,this.isEPSG=r.code!=="IDENTITY")),!e))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=e,this._pyramid=!0,this._pyramid){for(var n=0;n<e.length;n++)if(e[n]&&e[n-1]&&e[n-1]/e[n]!==2){this._pyramid=!1;break}}var s=this.options.fullExtent;if(!s&&(r.code&&(t=Ze[r.code.toUpperCase()],t&&(s=t.fullExtent)),!s))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(C(s.left)?(this._fullExtent=new st(s),s.left=s.xmin,s.right=s.xmax,s.top=s.ymax,s.bottom=s.ymin):this._fullExtent=new st(new k(s.left,s.top),new k(s.right,s.bottom)),C(s.top)||C(s.bottom)||C(s.left)||C(s.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");H(this._fullExtent,s),this._projection.fullExtent=s;var h=s.right>=s.left?1:-1,u=s.top>=s.bottom?-1:1;this._transformation=new Ns([h,u,0,0])},a.getResolutions=function(){return this._resolutions||[]},a.getResolution=function(r){var t=r|0;t<0?t=0:t>this._resolutions.length-1&&(t=this._resolutions.length-1);var e=this._resolutions[t];if(t!==r&&r>0&&t<this._resolutions.length-1){var n=this._resolutions[t+1];return e+(n-e)*(r-t)}return e},a.getProjection=function(){return this._projection},a.getFullExtent=function(){return this._fullExtent},a.getTransformation=function(){return this._transformation},a.getMinZoom=function(){for(var r=0;r<this._resolutions.length;r++)if(!C(this._resolutions[r]))return r;return 0},a.getMaxZoom=function(){for(var r=this._resolutions.length-1;r>=0;r--)if(!C(this._resolutions[r]))return r;return this._resolutions.length-1},a.getZoomDirection=function(){return yt(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},a.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},a.isPyramid=function(){return this._pyramid},o}(),mn=new S(0,0),xo=new Y,Yl={id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"},K=function(o){z(a,o);function a(r){var t,e=H({},r),n=e.symbol,s=e.properties,h=e.id;return delete e.symbol,delete e.id,delete e.properties,t=o.call(this,e)||this,n?t.setSymbol(n):t._genSizeSymbol(),s&&t.setProperties(s),C(h)||t.setId(h),t}var i=a.prototype;return i.getFirstCoordinate=function(){if(this.type==="GeometryCollection"){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do e=e[0];while(Array.isArray(e)&&e.length>0);return e},i.getLastCoordinate=function(){if(this.type==="GeometryCollection"){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do e=e[e.length-1];while(Array.isArray(e)&&e.length>0);return e},i.addTo=function(t,e){return t.addGeometry(this,e),this},i.getLayer=function(){return this._layer?this._layer:null},i.getMap=function(){return this._layer?this._layer.getMap():null},i.getId=function(){return this._id},i.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},i.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},i.setProperties=function(t){var e=this.properties;return this.properties=Gt(t)?H({},t):t,this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},i.getType=function(){return this.type},i.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?Wt(t):H({},t):null},i.setSymbol=function(t){return this._symbolUpdated=t,this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},i.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=Ei(this._symbolUpdated)),this._symbolHash},i.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Parameter of updateSymbol is not an array.");for(var n=0;n<t.length;n++)mr(t[n])&&delete this._textDesc,e[n]&&t[n]&&(e[n]=Wt(e[n],t[n]))}else{if(Array.isArray(t))throw new Error("Geometry's symbol is not an array to update.");mr(e)&&delete this._textDesc,e?e=Wt(e,t):e=Wt(this._getInternalSymbol(),t)}return this._eventSymbolProperties=t,delete this._compiledSymbol,this.setSymbol(e)},i.getTextContent=function(){var t=this._getInternalSymbol();if(Array.isArray(t)){for(var e=[],n=!1,s=0;s<t.length;s++)e[s]=cr(t[s]&&t[s].textName,this.getProperties()),C(e[s])||(n=!0);return n?e:null}return cr(t&&t.textName,this.getProperties())},i.getTextDesc=function(){if(!this._textDesc){var t=this.getTextContent(),e=this._sizeSymbol,n=Array.isArray(t);Array.isArray(e)?this._textDesc=e.map(function(s,h){return dr(n?t[h]:"",s)}):this._textDesc=dr(t,e)}return this._textDesc},i.getCenter=function(){return this._computeCenter(this._getMeasurer())},i.getExtent=function(){var t=this._getPrjExtent(),e=this._getProjection();if(t&&e){var n=e.unproject(new k(t.xmin,t.ymin)),s=e.unproject(new k(t.xmax,t.ymax));return new st(n,s,e)}else return this._computeExtent(this._getMeasurer())},i.getContainerExtent=function(t){var e=this.get2DExtent();if(!e||!e.isValid())return null;var n=this.getMap(),s=n.getGLRes(),h=this.getMinAltitude(),u=n.altitudeToPoint(h,s)*yt(h),l=e.convertTo(function(m){return n._pointAtResToContainerPoint(m,s,u,mn)},t),f=this.getMaxAltitude();if(f!==h){f=n.altitudeToPoint(f,s)*yt(f);var c=e.convertTo(function(m){return n._pointAtResToContainerPoint(m,s,f,mn)},xo);l._combine(c)}var d=this.getLayer();if(d&&this.type==="LineString"&&f&&d.options.drawAltitude){var g=e.convertTo(function(m){return n._pointAtResToContainerPoint(m,s,0,mn)},xo);l._combine(g)}l&&l._add(this._getFixedExtent());var v=this.options.smoothness;return v&&l._expand(l.getWidth()*.15),l},i._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new Y);var t=this._sizeSymbol,e=(t&&t.lineWidth||1)/2;this._fixedExtent.set(-e,-e,e,e);var n=t&&t.lineDx||0;this._fixedExtent._add([n,0]);var s=t&&t.lineDy||0;return this._fixedExtent._add([0,s]),this._fixedExtent},i.get2DExtent=function(){var t=this.getMap();if(!t)return null;if(this._extent2d)return this._extent2d;var e=this._getPrjExtent();if(!e||!e.isValid())return null;var n=e.getMin(),s=e.getMax(),h=t.getGLRes();return t._prjToPointAtRes(n,h,n),t._prjToPointAtRes(s,h,s),this._extent2d=new Y(n,s),this._extent2d.z=t.getZoom(),this._extent2d},i.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},i.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof k&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},i._containsPoint=function(t,e){var n=this._getPainter();return n?(e=e||0,this._hitTestTolerance&&(e+=this._hitTestTolerance()),n.hitTest(t,e)):!1},i.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},i.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},i.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,n=t.length;e<n;e++)if(C(t[e].opacity)||t[e].opacity>0)return!0;return!1}else return C(t.opacity)||Gt(t.opacity)||N(t.opacity)&&t.opacity>0},i.getZIndex=function(){return this.options.zIndex||0},i.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},i.setZIndexSilently=function(t){return this.options.zIndex=t,this},i.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},i.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},i.translate=function(t,e){if(C(t))return this;var n=new k(t,e);if(n.x===0&&n.y===0)return this;var s=this.getCoordinates();if(this._silence=!0,s)if(Array.isArray(s)){var h=Re(s,function(u){return u.add(n)});this.setCoordinates(h)}else this.setCoordinates(s.add(n));return this._silence=!1,this._fireEvent("positionchange"),this},i.flash=function(t,e,n,s){return Fn.call(this,t,e,n,s)},i.copy=function(){var t=this.toJSON(),e=a.fromJSON(t);return e.options.visible=!0,e},i.remove=function(){var t=this.getLayer();return t?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},i.toGeoJSONGeometry=function(){var t=this._exportGeoJSONGeometry();return t},i.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(C(t.geometry)||t.geometry){var n=this._exportGeoJSONGeometry();e.geometry=n}var s=this.getId();C(s)||(e.id=s);var h;return(C(t.properties)||t.properties)&&(h=this._exportProperties()),e.properties=h,e},i.toJSON=function(t){t||(t={});var e=this._toJSON(t),n=this._exportGraphicOptions(t);return H(e,n),e},i.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},i.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},i.rotate=function(t,e){if(this.type==="GeometryCollection"){var n=this.getGeometries();return n.forEach(function(l){return l.rotate(t,e)}),this}e?e=new k(e):e=this.getCenter();var s=this._getMeasurer(),h=this.getCoordinates();if(!Array.isArray(h)){if(e.x!==h.x||e.y!==h.y){var u=s._rotate(h,e,t);this.setCoordinates(u)}return this}return Re(h,function(l){return s._rotate(l,e,t)}),this.setCoordinates(h),this},i._getConnectPoints=function(){return[this.getCenter()]},i._initOptions=function(t){var e=H({},t),n=e.symbol,s=e.properties,h=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),n&&this.setSymbol(n),s&&this.setProperties(s),C(h)||this.setId(h)},i._bindLayer=function(t){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._bindInfoWindow(),this._bindMenu()},i._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(fr(this._checkAndCopySymbol(t[n])));return e}else if(t)return t=this._checkAndCopySymbol(t),fr(t);return null},i._checkAndCopySymbol=function(t){var e={};for(var n in t)vu[n]&&$(t[n])?e[n]=+t[n]:e[n]=t[n];return e},i._getSymbol=function(){return this._symbol},i._setExternSymbol=function(t){return this._eventSymbolProperties=t,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},i._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},i._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},i._unbind=function(){var t=this.getLayer();!t||(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},i._getInternalId=function(){return this._internalId},i._setInternalId=function(t){this._internalId=t},i._getMeasurer=function(){return this._getProjection()?this._getProjection():Yt.getProjectionInstance(this.options.defaultProjection)},i._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i._verifyProjection=function(){var t=this._getProjection();this._projCode&&t&&this._projCode!==t.code&&this._clearProjection(),this._projCode=t?t.code:this._projCode},i._getExternalResources=function(){var t=this._getInternalSymbol();return bi(t)},i._getPainter=function(){var t=this.getLayer();if(!this._painter&&t){if(ts.indexOf(this.type)!==-1){if(t.constructor.getCollectionPainterClass){var e=t.constructor.getCollectionPainterClass();e&&(this._painter=new e(this))}}else if(t.constructor.getPainterClass){var n=t.constructor.getPainterClass();n&&(this._painter=new n(this))}}return this._painter},i._getMaskPainter=function(){return this._maskPainter?this._maskPainter:(this._maskPainter=this.getGeometries&&this.getGeometries()?new ch(this,!0):new fa(this),this._maskPainter)},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},i._paint=function(t){if(this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var e=this._getProjection();e&&(this._pcenter=e.project(this._coordinates),this._clearCache())}this._painter.paint(t)}},i._clearCache=function(){delete this._extent,delete this._extent2d},i._clearProjection=function(){delete this._extent,delete this._extent2d},i._repaint=function(){this._painter&&this._painter.repaint()},i.onHide=function(){this.closeMenu(),this.closeInfoWindow()},i.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},i.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},i.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var t={};this._eventSymbolProperties?(t.properties=H({},this._eventSymbolProperties),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",t)},i._genSizeSymbol=function(){var t=this._getInternalSymbol();if(!t){delete this._sizeSymbol;return}if(Array.isArray(t)){this._sizeSymbol=[];for(var e=!1,n=0;n<t.length;n++){var s=this._sizeSymbol[n]=this._getSizeSymbol(t[n]);!e&&s&&s._dynamic&&(e=!0)}this._sizeSymbol._dynamic=e}else this._sizeSymbol=this._getSizeSymbol(t)},i._getSizeSymbol=function(t){var e=lr({lineWidth:t.lineWidth,lineDx:t.lineDx,lineDy:t.lineDy},this);return(_t(t.lineWidth)||_t(t.lineDx)||_t(t.lineDy))&&(e._dynamic=!0),e},i._getCompiledSymbol=function(){return this._compiledSymbol?this._compiledSymbol:(this._compiledSymbol=lr(this._getInternalSymbol(),this),this._compiledSymbol)},i.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var n=!1;for(var s in t)if(t.hasOwnProperty(s)){var h=s.slice(0,5);if(h==="arrow"||h==="smoot"){n=!0;break}}e?(this.setProperties(e),this._repaint()):n&&this._repaint()},i._setParent=function(t){t&&(this._parent=t)},i._getParent=function(){return this._parent},i._fireEvent=function(t,e){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e))},i._toJSON=function(t){return{feature:this.toGeoJSON(t)}},i._exportGraphicOptions=function(t){var e={};return(C(t.options)||t.options)&&(e.options=this.config()),(C(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(C(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=k.toNumberArrays(t);return{type:this.getType(),coordinates:e}},i._exportProperties=function(){var t=null,e=this.getProperties();return C(e)||(Gt(e)?t=H({},e):t=e),t},i._hitTestTolerance=function(){var t=this.getLayer();return t&&t.options.geometryEventTolerance||0},i.getAltitude=function(){var t=this.getLayer();if(!t)return 0;var e=t.options,n=this.getProperties(),s=e.enableAltitude&&n?n[e.altitudeProperty]:0,h=t.getAltitude?t.getAltitude():0;return Array.isArray(s)?s.map(function(u){return u+h}):s+h},i._genMinMaxAlt=function(){var t=this,e=this.getAltitude();Array.isArray(e)?(this._minAlt=Number.MAX_VALUE,this._maxAlt=Number.MIN_VALUE,e.forEach(function(n){var s=n;s<t._minAlt&&(t._minAlt=s),s>t._maxAlt&&(t._maxAlt=s)})):this._minAlt=this._maxAlt=e},i.getMinAltitude=function(){return this._minAlt===void 0&&this._genMinMaxAlt(),this._minAlt?this._minAlt:0},i.getMaxAltitude=function(){return this._maxAlt===void 0&&this._genMinMaxAlt(),this._maxAlt?this._maxAlt:0},a}(Fs(oe(ea(Nt))));K.mergeOptions(Yl);var Xl={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:function(){return!q.mobile}()},At=function(o){z(a,o);function a(r,t){var e,n;return t&&(n=t.canvas,delete t.canvas),e=o.call(this,t)||this,e._canvas=n,e.setId(r),t&&(e.setZIndex(t.zIndex),t.mask&&e.setMask(K.fromJSON(t.mask))),e}var i=a.prototype;return i.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();C(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},i.getId=function(){return this._id},i.setId=function(t){var e=this._id;return C(t)||(t=t+""),this._id=t,this.fire("idchange",{old:e,new:t}),this},i.addTo=function(t){return t.addLayer(this),this},i.setZIndex=function(t){return this._zIndex=t,C(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this},i.getZIndex=function(){return this._zIndex||0},i.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},i.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),C(e)?1/0:e):e},i.getOpacity=function(){return this.options.opacity},i.setOpacity=function(t){return this.config("opacity",t),this},i.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof Qe},i.getMap=function(){return this.map?this.map:null},i.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(t.length===1||e===this)return this;var n=e.getZIndex();return this.setZIndex(n+1),this},i.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(t.length===1||e===this)return this;var n=e.getZIndex();return this.setZIndex(n-1),this},i.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var n=this.getMap();e&&n?n.once("renderend",function(){t.fire("show")}):this.fire("show")}return this},i.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var n=this.getMap();e&&n?n.once("renderend",function(){t.fire("hide")}):this.fire("hide")}return this},i.isVisible=function(){if(N(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!C(this.options.maxZoom)&&this.options.maxZoom<e||!C(this.options.minZoom)&&this.options.minZoom>e)return!1}return C(this.options.visible)&&(this.options.visible=!0),this.options.visible},i.remove=function(){return this.map&&this.map.removeLayer(this),this},i.getMask=function(){return this._mask},i.setMask=function(t){if(!(t.type==="Point"&&t._isVectorMarker()||t.type==="Polygon"||t.type==="MultiPolygon"))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(t._bindLayer(this),t.type==="Point"?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=t,this.options.mask=t.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},i.removeMask=function(){if(delete this._mask,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},i.onLoad=function(){return!0},i.onLoadEnd=function(){},i.isLoaded=function(){return!!this._loaded},i.getCollisionIndex=function(){if(this.options.collisionScope==="layer")return this._collisionIndex||(this._collisionIndex=new Gs),this._collisionIndex;var t=this.getMap();return t?t.getCollisionIndex():null},i.clearCollisionIndex=function(){return this.options.collisionScope==="layer"&&this._collisionIndex&&this._collisionIndex.clear(),this},i.getRenderer=function(){return this._getRenderer()},i.onConfig=function(t){if(N(t.opacity)||t.cssFilter){var e=this.getRenderer();e&&e.setToRedraw()}},i.onAdd=function(){},i.onRendererCreate=function(){},i.onCanvasCreate=function(){},i.onRemove=function(){},i._bindMap=function(t,e){!t||(this.map=t,C(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},i._initRenderer=function(){var t=this.options.renderer;if(!!this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},i._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},i._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()&&this.getMap()[t](e.getEvents(),e)},i._getRenderer=function(){return this._renderer},i._getLayerList=function(){return this.map?this.map._layers:[]},i._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getMaskPainter();return t?t.get2DExtent():null},a}(Fs(oe(na(Nt))));At.mergeOptions(Xl);var ql=At.prototype.fire;At.prototype.fire=function(o,a){return o==="layerload"&&(this._loaded=!0),this.map&&(a||(a={}),a.type=o,a.target=this,this.map._onLayerEvent(a)),ql.apply(this,arguments)};var $l=new k(0,0),Ql={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:function(){return!pt}(),zoomAnimationDuration:330,panAnimation:function(){return!pt}(),panAnimationDuration:600,rotateAnimation:function(){return!pt}(),zoomable:!0,enableInfoWindow:!0,hitDetect:function(){return!q.mobile}(),hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0},U=function(o){z(a,o);function a(r,t){var e;if(!t)throw new Error("Invalid options when creating map.");if(!t.center)throw new Error("Invalid center when creating map.");var n=H({},t),s=n.zoom;delete n.zoom;var h=new k(n.center);delete n.center;var u=n.baseLayer;delete n.baseLayer;var l=n.layers;return delete n.layers,e=o.call(this,n)||this,e.VERSION=a.VERSION,Object.defineProperty(xt(xt(e)),"id",{value:Ce(),writable:!1}),e._loaded=!1,e._initContainer(r),e._panels={},e._baseLayer=null,e._layers=[],e._zoomLevel=s,e._center=h,e.setSpatialReference(n.spatialReference||n.view),e._mapViewPoint=new S(0,0),e._initRenderer(),e._updateMapSize(e._getContainerDomSize()),u&&e.setBaseLayer(u),l&&e.addLayer(l),e.setMaxExtent(n.maxExtent),e._Load(),e}a.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),n=typeof t=="function"?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(n),this};var i=a.prototype;return i.isLoaded=function(){return!!this._loaded},i.getContainer=function(){return this._containerDOM},i.getSpatialReference=function(){return this._spatialReference},i.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&Yt.equals(e,t)?this:(this._updateSpatialReference(t,e),this)},i._updateSpatialReference=function(t,e){if($(t)&&(t=Yt.getPreset(t)),t=H({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new Yt(t),this.options.spatialReference&&nt(this.options.spatialReference.projection)){var n=this._spatialReference.getProjection();this.options.spatialReference.projection=n.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:e,new:H({},this.options.spatialReference)}),this},i.onConfig=function(t){var e=t.spatialReference||t.view;return C(e)||this._updateSpatialReference(e,null),this},i.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},i.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},i.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},i.resetCursor=function(){return this.setCursor(null)},i.getCenter=function(){if(!this._loaded||!this._prjCenter)return this._center;var t=this.getProjection();return t.unproject(this._prjCenter)},i.setCenter=function(t){if(!t)return this;t=new k(t);var e=this.getProjection(),n=e.project(t);return this._verifyExtent(n)?this._loaded?(this.onMoveStart(),this._setPrjCenter(n),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},i.getSize=function(){return C(this.width)||C(this.height)?this._getContainerDomSize():new vt(this.width,this.height)},i.getContainerExtent=function(){var t=this.height,e=this.getPitch(),n=this.options.maxVisualPitch;return n&&e>n&&(t=this._getVisualHeight(n)),new Y(0,this.height-t,this.width,this.height)},i._getVisualHeight=function(t){t=t||.01;var e=(90-this.getPitch())*Math.PI/180,n=this.getFov()*Math.PI/180;t*=Math.PI/180;var s=this.cameraCenterDistance/this.getGLScale(),h=Math.tan(n/2),u=Math.tan(t),l=s*h/(1/u-h)/Math.sin(t),f=s*(Math.sin(e)*l/(s+Math.cos(e)*l));return this.height/2+f},i.getExtent=function(){return this._pointToExtent(this._get2DExtent())},i.getProjExtent=function(){var t=this._get2DExtent();return new st(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},i.getPrjExtent=function(){return this.getProjExtent()},i.getMaxExtent=function(){return this.options.maxExtent?new st(this.options.maxExtent,this.getProjection()):null},i.setMaxExtent=function(t){if(t){var e=new st(t,this.getProjection());this.options.maxExtent=e;var n=this.getProjection();this._prjMaxExtent=e.convertTo(function(s){return n.project(s)}),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=n.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},i.getZoom=function(){return this._zoomLevel},i.getZoomForScale=function(t,e,n){var s=this.getZoom();if(C(e)&&(e=s),t===1&&e===s)return s;var h=this._getResolution(e),u=h/t,l=this.getZoomFromRes(u);if(n)return l;var f=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(l-f):Math.floor(l+f)},i.getZoomFromRes=function(t){var e=this._getResolutions(),n=this._getResolution(this.getMinZoom()),s=this._getResolution(this.getMaxZoom());if(n<=s){if(t<=n)return this.getMinZoom();if(t>=s)return this.getMaxZoom()}else{if(t>=n)return this.getMinZoom();if(t<=s)return this.getMaxZoom()}for(var h=e.length,u=0;u<h-1;u++)if(!!e[u]){var l=e[u+1]-e[u],f=t-e[u];if(yt(l)===yt(f)&&Math.abs(l)>=Math.abs(f))return u+f/l}return h-1},i.setZoom=function(t,e){return e===void 0&&(e={animation:!0}),isNaN(t)||C(t)?this:(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t),this)},i.getMaxZoom=function(){return C(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},i.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),t!==null&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},i.getMinZoom=function(){return C(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},i.setMinZoom=function(t){if(t!==null){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},i.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},i.getGLRes=function(){if(this._glRes)return this._glRes;var t=this.getSpatialReference().getFullExtent();return this._glRes=(t.right-t.left)/Math.pow(2,19),this._glRes},i.getGLScale=function(t){return C(t)&&(t=this.getZoom()),this._getResolution(t)/this.getGLRes()},i.zoomIn=function(){return this.setZoom(this.getZoom()+1)},i.zoomOut=function(){return this.setZoom(this.getZoom()-1)},i.isZooming=function(){return!!this._zooming},i.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},i.setCenterAndZoom=function(t,e){return!C(e)&&this._zoomLevel!==e?(this.setCenter(t),this.setZoom(e,{animation:!1})):this.setCenter(t),this},i.getFitZoom=function(t,e){var n=this;if(!t||!(t instanceof st))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var s=this.getSize(),h=t.convertTo(function(v){return n.coordToPoint(v)}),u=h.getWidth(),l=h.getHeight(),f=s.width/u,c=s.height/l,d=this.getSpatialReference().getZoomDirection()<0?Math.max(f,c):Math.min(f,c),g=this.getZoomForScale(d,null,e);return g},i.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},i.setView=function(t){return t?(t.center&&this.setCenter(t.center),t.zoom!==null&&!isNaN(+t.zoom)&&this.setZoom(+t.zoom,{animation:!1}),t.pitch!==null&&!isNaN(+t.pitch)&&this.setPitch(+t.pitch),t.pitch!==null&&!isNaN(+t.bearing)&&this.setBearing(+t.bearing),this):this},i.getResolution=function(t){return this._getResolution(t)},i.getScale=function(t){var e=C(t)?this.getZoom():t,n=this._getResolution(this.getMaxNativeZoom()),s=this._getResolution(e);return s/n},i.fitExtent=function(t,e,n,s){if(n===void 0&&(n={}),!t)return this;t=new st(t,this.getProjection());var h=this.getFitZoom(t)+(e||0),u=t.getCenter();return typeof n.animation>"u"||n.animation?this._animateTo({center:u,zoom:h},{duration:n.duration||this.options.zoomAnimationDuration,easing:n.easing||"out"},s):this.setCenterAndZoom(u,h)},i.getBaseLayer=function(){return this._baseLayer},i.setBaseLayer=function(t){var e=!1;if(this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!t)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;this._baseLayer=t,t._bindMap(this,-1);function n(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))}return this._baseLayer.on("layerload",n,this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},i.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},i.getLayers=function(t){return this._getLayers(function(e){return e===this._baseLayer||e.getId().indexOf(Si)>=0?!1:t?t(e):!0})},i.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var n=this.getBaseLayer();return n&&n.getId()===t?n:null},i.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return t=Array.prototype.slice.call(arguments,0),this.addLayer(t);this._layerCache||(this._layerCache={});for(var e=this._layers,n=0,s=t.length;n<s;n++){var h=t[n],u=h.getId();if(C(u))throw new Error("Invalid id for the layer: "+u);if(h.getMap()!==this){if(this._layerCache[u])throw new Error("Duplicate layer id in the map: "+u);this._layerCache[u]=h,h._bindMap(this),e.push(h),this._loaded&&h.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},i.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],n=0,s=t.length;n<s;n++){var h=t[n];if(h instanceof At||(h=this.getLayer(h)),!!h){var u=h.getMap();if(!(!u||u!==this)){e.push(h),this._removeLayer(h,this._layers),this._loaded&&h._doRemove();var l=h.getId();this._layerCache&&delete this._layerCache[l]}}}if(e.length>0){var f=this.getRenderer();f&&f.setLayerCanvasUpdated(),this.once("frameend",function(){e.forEach(function(c){c.fire("remove")})})}return this._fireEvent("removelayer",{layers:t}),this},i.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],n=Number.MAX_VALUE,s=0,h=t.length;s<h;s++){var u=t[s];if($(t[s])&&(u=this.getLayer(u)),!(u instanceof At)||!u.getMap()||u.getMap()!==this)throw new Error("It must be a layer added to this map to order.");u.getZIndex()<n&&(n=u.getZIndex()),e.push(u)}for(var l=0,f=e.length;l<f;l++)e[l].setZIndex(n+l);return this},i.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var n=t.save,s=this._getRenderer();if(s&&s.toDataURL){var h=t.fileName;h||(h="export");var u=s.toDataURL(e,t.quality||.92);if(n&&u){var l;if(typeof Blob<"u"&&typeof atob<"u"){var f=ls(u.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),e);l=URL.createObjectURL(f)}else l=u;var c=document.createElement("a");c.download=h,c.href=l,document.body.appendChild(c),c.click(),document.body.removeChild(c)}return u}return null},i.coordToPoint=function(t,e,n){return this.coordinateToPoint(t,e,n)},i.coordToPointAtRes=function(t,e,n){return this.coordinateToPointAtRes(t,e,n)},i.pointToCoord=function(t,e,n){return this.pointToCoordinate(t,e,n)},i.pointAtResToCoord=function(t,e,n){return this.pointAtResToCoordinate(t,e,n)},i.coordToViewPoint=function(t,e,n){return this.coordinateToViewPoint(t,e,n)},i.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},i.coordToContainerPoint=function(t,e,n){return this.coordinateToContainerPoint(t,e,n)},i.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},i.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},i.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},i.checkSize=function(t){var e=lt()-this._initTime<1500&&this.width===0||this.height===0,n=this._getContainerDomSize(),s=this.height,h=this.width;if(!t&&n.width===h&&n.height===s)return this;Ri(this._containerDOM);var u=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(n);else{var l=this._getVisualHeight(this.getPitch()),f=new S(0,this.height-l),c=this._containerPointToPrj(f);this._updateMapSize(n);var d=this._getVisualHeight(this.getPitch()),g=new S(0,this.height-d);this._setPrjCoordAtContainerPoint(c,g),this._mapViewCoord=this._getPrjCenter()}var v=n.width===0||n.height===0||h===0||s===0;return(e||v)&&(this._eventSilence=!0,this.setCenter(u),delete this._eventSilence),this._fireEvent("resize"),this},i.locate=function(t,e,n){return this.getProjection()._locate(new k(t),e,n)},i.getMainPanel=function(){return this._getRenderer().getMainPanel()},i.getPanels=function(){return this._panels},i.remove=function(){var t=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var e=this.getLayers(),n=0;n<e.length;n++)e[n].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter(function(s){return s.className==="maptalks-wrapper"}).forEach(function(s){return t._containerDOM.removeChild(s)}),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),q.removeDPRListening&&q.removeDPRListening(this),this},i.isRemoved=function(){return!this._containerDOM},i.isMoving=function(){return!!this._moving},i.onMoveStart=function(t){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var e=this._getPrjCenter();(!this._originCenter||this._verifyExtent(e))&&(this._originCenter=e),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},i.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},i.onMoveEnd=function(t){if(this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),!this._verifyExtent(this._getPrjCenter())&&this._originCenter){var e=this._originCenter;this._panTo(e)}},i.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},i.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},i.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},i.isDragRotating=function(){return!!this._dragRotating},i.isOffscreen=function(t,e){e===void 0&&(e=0);var n=this.width,s=this.height,h=n+e,u=s+e,l=t.xmin,f=t.ymin,c=t.xmax,d=t.ymax;return Array.isArray(t)&&(l=t[0],f=t[1],c=t[2],d=t[3]),c<e||l>=h||d<e||f>u},i.getRenderer=function(){return this._getRenderer()},i.getDevicePixelRatio=function(){return this.options.devicePixelRatio||q.devicePixelRatio||1},i.setDevicePixelRatio=function(t){return N(t)&&t>0&&t!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=t,this.checkSize(!0)),this},i._initContainer=function(t){if($(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,pt&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&this._containerDOM.childNodes[0].className==="maptalks-wrapper")throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},i._trySetCursor=function(t){return!this._cursor&&!this._priorityCursor&&(t||(t="default"),this._setCursorToPanel(t)),this},i._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},i._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},i._removeLayer=function(t,e){if(!(!t||!e)){var n=e.indexOf(t);n>-1&&e.splice(n,1)}},i._sortLayersByZIndex=function(){if(!!this._layers){for(var t=0,e=this._layers.length;t<e;t++)this._layers[t]._order=t,this._layers[t].sortLayersByZIndex&&this._layers[t].sortLayersByZIndex();this._layers.sort(function(n,s){var h=n.getZIndex()-s.getZIndex();return h===0?n._order-s._order:h})}},i._fireEvent=function(t,e){this._eventSilence||(this.fire("_"+t,e),this.fire(t,e))},i._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=lt()},i._initRenderer=function(){var t=this.options.renderer,e=a.getRendererClass(t);this._renderer=new e(this),this._renderer.load()},i._getRenderer=function(){return this._renderer},i._loadAllLayers=function(){function t(e){e&&e.load()}this._baseLayer&&this._baseLayer.load(),this._eachLayer(t,this.getLayers())},i._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,n=[],s=0;s<e.length;s++)(!t||t.call(this,e[s]))&&n.push(e[s]);return n},i._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var n=[],s=0,h=e.length;s<h;s++)n=n.concat(e[s]);for(var u=0,l=n.length;u<l;u++)t.call(t,n[u])}},i._onLayerEvent=function(t){!t||t.type==="idchange"&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},i._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),n=this._spatialReference.getMaxZoom(),s=this._spatialReference.getMinZoom();(C(t)||t===-1||t>n)&&this.setMaxZoom(n),(C(e)||e===-1||e<s)&&this.setMinZoom(s),t=this.getMaxZoom(),e=this.getMinZoom(),t<e&&this.setMaxZoom(e),(C(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter;var h=this.getProjection();this._prjCenter=h.project(this._center),this._calcMatrices();var u=this._getRenderer();u&&u.resetContainer()},i._getContainerDomSize=function(){if(!this._containerDOM)return null;var t=this._containerDOM,e,n;if(this._containerDomContentRect)return e=this._containerDomContentRect.width,n=this._containerDomContentRect.height,new vt(e,n);if(!C(t.width)&&!C(t.height)){e=t.width,n=t.height;var s=this.getDevicePixelRatio();s!==1&&t.layer&&(e/=s,n/=s)}else if(!C(t.clientWidth)&&!C(t.clientHeight))e=parseInt(t.clientWidth,0),n=parseInt(t.clientHeight,0);else throw new Error("can not get size of container");return new vt(e,n)},i._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},i._getPrjCenter=function(){return this._prjCenter},i._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},i._setPrjCoordAtContainerPoint=function(t,e){if(e.x===this.width/2&&e.y===this.height/2)return this;var n=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),s=this._pointToPrj(this._prjToPoint(t).sub(n));return this._setPrjCenter(s),this},i._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return e?e.contains(t):!0},i._offsetCenterByPixel=function(t){var e=new S(this.width/2-t.x,this.height/2-t.y),n=this._containerPointToPrj(e);return this._setPrjCenter(n),n},i.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},i.getViewPoint=function(){var t=this._getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},i._resetMapViewPoint=function(){this._mapViewPoint=new S(0,0),this._mapViewCoord=this._getPrjCenter()},i._getResolution=function(t){return(t===void 0||t===this._zoomLevel)&&this._mapRes!==void 0?this._mapRes:(C(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t))},i._getResolutions=function(){return this._spatialReference.getResolutions()},i._prjToPoint=function(t,e,n){e=C(e)?this.getZoom():e;var s=this._getResolution(e);return this._prjToPointAtRes(t,s,n)},i._prjToPointAtRes=function(t,e,n){return this._spatialReference.getTransformation().transform(t,e,n)},i._prjsToPointsAtRes=function(t,e,n){n===void 0&&(n=[]);for(var s=this._spatialReference.getTransformation(),h=[],u=0,l=t.length;u<l;u++){var f=s.transform(t[u],e,n[u]);h.push(f)}return h},i._pointToPrj=function(t,e,n){e=C(e)?this.getZoom():e;var s=this._getResolution(e);return this._pointToPrjAtRes(t,s,n)},i._pointToPrjAtRes=function(t,e,n){return this._spatialReference.getTransformation().untransform(t,e,n)},i._pointToPoint=function(t,e,n){return C(e)?(n?(n.x=t.x,n.y=t.y):n=t.copy(),n):this._pointAtResToPoint(t,this._getResolution(e),n)},i._pointAtResToPoint=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(e/this._getResolution())},i._pointToPointAtRes=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(this._getResolution()/e)},i._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},i._callOnLoadHooks=function(){var t=a.prototype;if(!!t._onLoadHooks)for(var e=0,n=t._onLoadHooks.length;e<n;e++)t._onLoadHooks[e].call(this)},i._fixPrjOnWorldWide=function(t){var e=this.getProjection();if(e&&e.fullExtent&&t){var n=e.fullExtent||{},s=n.left,h=n.bottom,u=n.top,l=n.right;N(s)&&(t.x=Math.max(s,t.x)),N(l)&&(t.x=Math.min(l,t.x)),N(h)&&(t.y=Math.max(h,t.y)),N(u)&&(t.y=Math.min(u,t.y))}return this},a}(ea(oe(na(Nt))));U.include({coordinateToPoint:function(a,i,r){var t=this._getResolution(i);return this.coordinateToPointAtRes(a,t,r)},coordinateToPointAtRes:function(){var o=new k(0,0);return function(a,i,r){var t=this.getProjection().project(a,o);return this._prjToPointAtRes(t,i,r)}}(),pointToCoordinate:function(){var o=new k(0,0);return function(a,i,r){var t=this._pointToPrj(a,i,o);return this.getProjection().unproject(t,r)}}(),pointAtResToCoordinate:function(){var o=new k(0,0);return function(a,i,r){var t=this._pointToPrjAtRes(a,i,o);return this.getProjection().unproject(t,r)}}(),coordinateToViewPoint:function(){var o=new k(0,0);return function(a,i,r){return this._prjToViewPoint(this.getProjection().project(a,o),i,r)}}(),viewPointToCoordinate:function(){var o=new k(0,0);return function(a,i){return this.getProjection().unproject(this._viewPointToPrj(a,o),i)}}(),coordinateToContainerPoint:function(a,i,r){var t=this._getResolution(i);return this.coordinateToContainerPointAtRes(a,t,r)},coordinateToContainerPointAtRes:function(){var o=new k(0,0);return function(a,i,r){var t=this.getProjection().project(a,o);return this._prjToContainerPointAtRes(t,i,r)}}(),coordinatesToContainerPoints:function(a,i){var r=this._getResolution(i);return this.coordinatesToContainerPointsAtRes(a,r)},coordinatesToContainerPointsAtRes:function(){return function(o,a){for(var i=[],r=this._spatialReference.getTransformation(),t=a/this._getResolution(),e=this.getProjection(),n=new k(0,0),s=this.isTransforming(),h=this._prjToPoint(this._getPrjCenter(),void 0,$l),u=0,l=o.length;u<l;u++){var f=e.project(o[u],n),c=r.transform(f,a);c=c._multi(t),this._toContainerPoint(c,s,t,0,h),i.push(c)}return i}}(),containerPointToCoordinate:function(){var o=new k(0,0);return function(a,i){var r=this._containerPointToPrj(a,o);return this.getProjection().unproject(r,i)}}(),containerToExtent:function(){var o=new S(0,0),a=new S(0,0);return function(i){var r=new Y(this._containerPointToPoint(i.getMin(o),void 0,o),this._containerPointToPoint(i.getMax(a),void 0,a));return this._pointToExtent(r)}}(),distanceToPixel:function(){var o=new S(0,0),a=new S(0,0);return function(i,r,t){var e=this.getProjection();if(!e)return null;var n=this.getScale()/this.getScale(t),s=this.getCenter(),h=e.locate(s,i,r),u=this.coordToContainerPoint(s,void 0,o),l=this.coordToContainerPoint(h,void 0,a);return l._sub(u)._multi(n)._abs(),new vt(l.x,l.y)}}(),distanceToPoint:function(a,i,r,t){var e=this._getResolution(r);return this.distanceToPointAtRes(a,i,e,t)},distanceToPointAtRes:function(){var o=new S(0,0),a=new k(0,0);return function(i,r,t,e,n){var s=this.getProjection();if(!s)return null;var h=e||this.getCenter(),u=s.locate(h,i,r,a),l=this.coordToPointAtRes(h,t,o),f=this.coordToPointAtRes(u,t,n);return f._sub(l)._abs(),f}}(),altitudeToPoint:function(){var o=new k(0,40),a=new S(0,0);return function(i,r,t){i===void 0&&(i=0);var e=this.distanceToPointAtRes(i,i,r,t||o,a);i<0&&e.x>0&&(e.x=-e.x);var n=this.options.heightFactor;return n&&n!==1&&(e.x*=n,e.y*=n),e.x}}(),pointAtResToAltitude:function(){var o=new k(0,40);return function(a,i,r){a===void 0&&(a=0);var t=this.pointAtResToDistance(a,0,i,r||o);return t}}(),pixelToDistance:function(){var o=new k(0,0),a=new k(0,0);return function(i,r){var t=this.getProjection();if(!t)return null;var e=this.getFullExtent(),n=e.top>e.bottom?-1:1,s=o.set(this.width/2+i,this.height/2+n*r),h=this.containerPointToCoord(s,a);return t.measureLength(this.getCenter(),h)}}(),pointToDistance:function(a,i,r){var t=this.getResolution(r);return this.pointAtResToDistance(a,i,t)},pointAtResToDistance:function(){var o=new S(0,0),a=new k(0,0),i=new k(0,0),r=new k(0,0);return function(t,e,n,s){var h=this.getProjection();if(!h)return null;var u=s?h.project(s,a):this._getPrjCenter(),l=this._prjToPointAtRes(u,n,o);l._add(t,e);var f=this.pointAtResToCoord(l,n,i),c=s||h.unproject(u,r);return h.measureLength(c,f)}}(),locateByPoint:function(){var o=new S(0,0);return function(a,i,r){var t=this.coordToContainerPoint(a,void 0,o);return this.containerPointToCoord(t._add(i,r))}}(),_get2DExtent:function(a,i){var r;if((a===void 0||a===this._zoomLevel)&&this._mapExtent2D&&(r=this._mapExtent2D),r)return i?(i.set(r.xmin,r.ymin,r.xmax,r.ymax),i):r.copy();var t=this._getResolution(a);return this._get2DExtentAtRes(t,i)},_get2DExtentAtRes:function(){var o=new S(0,0);return function(a,i){var r=this;if(a===this._mapGlRes&&this._mapGlExtent2D)return this._mapGlExtent2D;var t=this.getContainerExtent();return t.convertTo(function(e){return r._containerPointToPointAtRes(e,a,o)},i)}}(),_pointToExtent:function(){var o=new k(0,0),a=new k(0,0);return function(i){var r=i.getMin(),t=i.getMax(),e=this.getFullExtent(),n=!e||e.left<=e.right?[r.x,t.x]:[t.x,r.x],s=n[0],h=n[1],u=!e||e.top>e.bottom?[t.y,r.y]:[r.y,t.y],l=u[0],f=u[1],c=r.set(s,f),d=t.set(h,l);return new st(this.pointToCoord(c,void 0,o),this.pointToCoord(d,void 0,a),this.getProjection())}}(),_getViewPointFrameOffset:function(){var o=new S(0,0);return function(){if(this.isZooming())return null;var a=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(a)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(a,void 0,o)):null}}(),_viewPointToPrj:function(){var o=new S(0,0);return function(a,i){return this._containerPointToPrj(this.viewPointToContainerPoint(a,o),i)}}(),_prjToContainerPoint:function(a,i,r,t){var e=this._getResolution(i);return this._prjToContainerPointAtRes(a,e,r,t)},_prjToContainerPointAtRes:function(){var o=new S(0,0);return function(a,i,r,t){return this._pointAtResToContainerPoint(this._prjToPointAtRes(a,i,o),i,t||0,r)}}(),_prjToViewPoint:function(){var o=new S(0,0);return function(a,i,r){var t=this._prjToContainerPoint(a,void 0,o,r);return this.containerPointToViewPoint(t,i)}}(),_viewPointToPoint:function(){var o=new S(0,0);return function(a,i,r){return this._containerPointToPoint(this.viewPointToContainerPoint(a,o),i,r)}}(),_pointToViewPoint:function(){var o=new k(0,0);return function(a,i,r){return this._prjToViewPoint(this._pointToPrj(a,i,o),r)}}()});U.mergeOptions(Ql);var Kl=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){!this.target||this.target.on("_dblclick",this._onDoubleClick,this)},i.removeHooks=function(){!this.target||this.target.off("_dblclick",this._onDoubleClick,this)},i._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var n=e.getZoom(),s=t.domEvent.shiftKey?Math.ceil(n)-1:Math.floor(n)+1;e._zoomAnimation(s,t.containerPoint)}},a}(Ut);U.mergeOptions({doubleClickZoom:!0});U.addOnLoadHook("addHandler","doubleClickZoom",Kl);var tf=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){var t=this.target;if(!!t){var e=t._panels.mapWrapper||t._containerDOM;this._dragHandler=new qe(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},i.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},i._cancelOn=function(t){return!!(this.target.isZooming()||this._ignore(t))},i._ignore=function(t){return t?(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t)):!1},i._onMouseDown=function(t){delete this.startDragTime,delete this._mode,t.domEvent.button===2||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),It(t.domEvent)},i._onDragStart=function(t){this.startDragTime=lt(),this._mode==="move"?this._moveStart(t):this._mode==="rotatePitch"&&this._rotateStart(t)},i._onDragging=function(t){var e=this.target;e._isEventOutMap(t.domEvent)||(this._mode==="move"?this._moving(t):this._mode==="rotatePitch"&&this._rotating(t))},i._onDragEnd=function(t){this._mode==="move"?this._moveEnd(t):this._mode==="rotatePitch"&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},i._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},i._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var n=Et(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=e._containerPointToPrj(n)},i._moving=function(t){if(!!this.startDragTime){var e=this.target,n=Et(e._getActualEvent(t.domEvent),e.getContainer());e._setPrjCoordAtContainerPoint(this.startPrjCoord,n),e.onMoving(t)}},i._moveEnd=function(t){if(!!this.startDragTime){var e=t.domEvent.type==="touchend",n=this.target,s=lt()-this.startDragTime,h=t.mousePos.x,u=t.mousePos.y,l=h-this.startX,f=u-this.startY,c=n._getPrjCenter(),d=c.sub(this._startPrjCenter);if(this._clear(),n.options.panAnimation&&!t.interupted&&n._verifyExtent(n._getPrjCenter())&&s<280&&Math.abs(f)+Math.abs(l)>5){s=5*s;var g=e?5:2.8,v=c.add(d._multi(g));n._panTo(v,{duration:e?s*3:s*2,easing:"outExpo"})}else n.onMoveEnd(t)}},i._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},i._rotating=function(t){var e=this.target,n=t.mousePos.x,s=t.mousePos.y,h=e.getPitch(),u=e.getBearing(),l=Math.abs(n-this.preX),f=Math.abs(s-this.preY);if(this._rotateMode||(e.options.dragRotatePitch?this._rotateMode="rotate_pitch":l>f?this._rotateMode="rotate":l<f?this._rotateMode="pitch":this._rotateMode="rotate"),!(this._rotateMode==="pitch"&&h===0&&f<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var c=0;e.options.dragPitch||l>f?c=-.6*(this.preX-n):n>e.width/2?c=.6*(this.preY-s):c=-.6*(this.preY-s);var d=e.getBearing()+c;this._db=this._db||0,this._db+=c,e._setBearing(d)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e._setPitch(e.getPitch()+(this.preY-s)*.4),this.preX=n,this.preY=s,(e.getBearing()!==u||e.getPitch()!==h)&&e.onDragRotating(t)}},i._rotateEnd=function(t){var e=this.target,n=e.getBearing();this._clear();var s=lt()-this.startDragTime;if(e.onDragRotateEnd(t),e.options.rotateAnimation&&Math.abs(n-this.startBearing)>20&&(this._rotateMode==="rotate"||this._rotateMode==="rotate_pitch")&&!t.interupted&&s<400){var h=e.getBearing();e._animateTo({bearing:h+this._db/1.5},{easing:"outQuint",duration:1600})}},i._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},a}(Ut);U.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0});U.addOnLoadHook("addHandler","draggable",tf);var wo="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",ef=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;ct(e,wo,this._identifyGeometryEvents,this)},i.removeHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;ut(e,wo,this._identifyGeometryEvents)},i._identifyGeometryEvents=function(t,e){var n=this.target;if(n.isInteracting()||n._ignoreEvent(t))return;var s=null,h=e||t.type,u=h==="mousedown"||h==="touchstart"&&t.touches&&t.touches.length===1;if(u)this._mouseDownTime=lt();else if((h==="click"||h==="touchend")&&this._mouseDownTime){var l=this._mouseDownTime;delete this._mouseDownTime;var f=lt();if(f-l>300){if(h==="click")return}else h==="touchend"&&(s="click")}var c=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(!c)return;var d=Et(c,n._containerDOM);h==="touchstart"&&It(t);for(var g=null,v=this.target.getRenderer().getTopElements(),m=u&&t.button!==2,_=0;_<v.length;_++)if(v[_].hitTest(d)){var p=v[_].options.cursor;if(p&&(g=p),m||v[_].events&&v[_].events.indexOf(h)>=0){var y={target:n,type:h,domEvent:t,containerPoint:d};if(m){n._setPriorityCursor(g),v[_].mousedown(y);return}else v[_].onEvent(y)}}var x=n._getLayers(function(T){return!!(T.identify&&T.options.geometryEvents)});if(n._setPriorityCursor(g),!x.length)return;var M={includeInternals:!0,filter:function(P){if(!(P instanceof K))return!1;var O=P._getEventTypeToFire(t);if(h==="mousemove"){if(!g&&P.options.cursor&&(g=P.options.cursor),!P.listens("mousemove")&&!P.listens("mouseover")&&!P.listens("mouseenter"))return!1}else if(!P.listens(O)&&!P.listens(s))return!1;return!0},count:1,containerPoint:d,onlyVisible:n.options.onlyVisibleGeometryEvents,layers:x},w=b.bind(this);h==="mousemove"||h==="touchmove"?this._queryIdentifyTimeout=n.getRenderer().callInNextFrame(function(){n.isInteracting()||n.identifyAtPoint(M,w)}):n.identifyAtPoint(M,w);function b(T){var P=!0;if(h==="mousemove"){var O={};if(T.length>0)for(var I=T.length-1;I>=0;I--){var E=T[I];if(E instanceof K){var D=E._getInternalId();O[D]=E,E._onEvent(t),(!this._prevOverGeos||!this._prevOverGeos.geomap[D])&&E._onEvent(t,"mouseenter"),P=E._onEvent(t,"mouseover")}}n._setPriorityCursor(g);var R=this._prevOverGeos&&this._prevOverGeos.geos;if(this._prevOverGeos={geos:T,geomap:O},R&&R.length>0)for(var A=R.length-1;A>=0;A--){var G=R[A];if(G instanceof K){var F=R[A]._getInternalId();O[F]||(P=G._onEvent(t,"mouseout"))}}}else{if(!T||!T.length)return;for(var j=T.length-1;j>=0;j--)if(T[j]instanceof K){P=T[j]._onEvent(t),s&&T[j]._onEvent(t,s);break}}P===!1&&Lt(t)}},a}(Ut);U.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0});U.addOnLoadHook("addHandler","geometryEvents",ef);var Co=4.000244140625,rf=1/100,nf=1/450,af=2,of=function(o){z(a,o);function a(r){var t;return t=o.call(this,r)||this,t._thisScrollZoom=t._scrollZoom.bind(xt(xt(t))),t._wheelZoomRate=nf,t._defaultZoomRate=rf,t._delta=0,t}var i=a.prototype;return i.addHooks=function(){re(this.target._containerDOM,"wheel",this._onWheelScroll,this)},i.removeHooks=function(){Pe(this.target._containerDOM,"wheel",this._onWheelScroll)},i._onWheelScroll=function(t){It(t),Lt(t);var e=this.target;if(e._ignoreEvent(t)||!e.options.zoomable)return!1;var n=e._containerDOM,s=e._checkZoomOrigin(Et(t,n));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,s)):this._interval(t,s)},i._seamless=function(t,e){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?t.deltaY*60:t.deltaY;if(n%Co!==0&&(this._ensureTrackpad||(Math.abs(n)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(n*=14)),t.shiftKey&&n&&(n=n/4),this._lastWheelEvent=t,this._delta-=n,!this._zooming&&this._delta){var s=this.target;this._zoomOrigin=e,s.onZoomStart(null,e)}this._start()},i._start=function(){if(!!this._delta){this._zooming=!0;var t=this.target;this._active||(t.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0)}},i._scrollZoom=function(){var t=this;if(this._active=!1,!!this._delta){var e=Math.abs(this._delta)>Co?this._wheelZoomRate:this._defaultZoomRate,n=af/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&n!==0&&(n=1/n);var s=this.target,h=s.getZoom(),u=s.getZoomForScale(n,h,!0);this._delta=0,s.onZooming(u,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){t._zooming=!1,delete t._timeout,s.onZoomEnd(s.getZoom(),t._zoomOrigin)},210)}},i._interval=function(t,e){var n=this,s=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var h=(t.deltaY?t.deltaY*-1:t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(h*=-1);var u=s.getZoom(),l=u+h;if(l=s._checkZoom(h>0?Math.ceil(l):Math.floor(l)),l===u)return!1;this._zooming=!0,this._delta||(s.onZoomStart(null,e),this._origin=e,this._delta=h,this._startZoom=s.getZoom());var f=90;return s._animateTo({zoom:l-this._delta*1/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:f,wheelZoom:!0},function(c){if(c.state.playState!=="finished"){c.state.playState!=="running"&&(delete n._zooming,delete n._requesting);return}n._requesting<1||Math.abs(l-n._startZoom)>2||l===s.getMaxZoom()||l===s.getMinZoom()?(s._animateTo({zoom:l,around:n._origin},{continueOnViewChanged:!0,duration:100},function(d){d.state.playState!=="running"&&(delete n._zooming,delete n._requesting)}),delete n._startZoom,delete n._origin,delete n._delta,n._requesting=0):C(n._requesting)||(delete n._zooming,n._onWheelScroll(t))}),!1},a}(Ut);U.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0});U.addOnLoadHook("addHandler","scrollWheelZoom",of);var sf=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){re(this.target.getContainer(),"touchstart",this._onTouchStart,this)},i.removeHooks=function(){Pe(this.target.getContainer(),"touchstart",this._onTouchStart)},i._onTouchStart=function(t){var e=this.target;if(!(!t.touches||t.touches.length<2)){var n=e.getContainer(),s=Et(t.touches[0],n),h=Et(t.touches[1],n);this.preY=s.y,this._startP1=s,this._startP2=h,this._startDist=s.distanceTo(h),this._startVector=s.sub(h),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),ut(document,"touchmove",this._onTouchMove),ut(document,"touchend",this._onTouchEnd),re(document,"touchmove",this._onTouchMove,this),re(document,"touchend",this._onTouchEnd,this),It(t),e._fireEvent("touchactstart")}},i._onTouchMove=function(t){var e=this.target;if(!(!t.touches||t.touches.length<2)){var n=e.getContainer(),s=Et(t.touches[0],n),h=Et(t.touches[1],n),u=s.sub(this._startP1),l=h.sub(this._startP2),f=s.sub(h),c=s.distanceTo(h)/this._startDist,d=f.angleWith(this._startVector)*180/Math.PI,g=this.preY||s.y,v=(g-s.y)*.4;this.preY=s.y;var m={domEvent:t,mousePos:[s,h]};if(this.mode||(e.options.touchRotate&&Math.abs(d)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&u.y*l.y>0&&Math.abs(u.y)>10&&Math.abs(l.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-c)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(m)),this.mode==="zoom"||this.mode==="rotate_zoom"){this._scale=c;var _=e._getResolution(this._startZoom)/c,p=e.getZoomFromRes(_);e.onZooming(p,this._Origin)}this.mode==="rotate"||this.mode==="rotate_zoom"?(e._setBearing(this._startBearing+d),e.onDragRotating(m)):this.mode==="pitch"&&(e._setPitch(e.getPitch()+v),e.onDragRotating(m)),e._fireEvent("touchactinging")}},i._startTouching=function(t){var e=this.target;if(this.mode==="zoom"||this.mode==="rotate_zoom"){var n=e.getSize();this._Origin=new S(n.width/2,n.height/2),e.onZoomStart(null,this._Origin)}(this.mode==="rotate"||this.mode==="pitch"||this.mode==="rotate_zoom")&&e.onDragRotateStart(t)},i._onTouchEnd=function(t){delete this.preY;var e=this.target;if(ut(document,"touchmove",this._onTouchMove),ut(document,"touchend",this._onTouchEnd),this.mode==="zoom"||this.mode==="rotate_zoom"){var n=this._scale,s=e._getResolution(this._startZoom)/n,h=e.getZoomFromRes(s);e.onZoomEnd(h,this._Origin)}(this.mode==="pitch"||this.mode==="rotate"||this.mode==="rotate_zoom")&&e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},a}(Ut);U.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1});U.addOnLoadHook("addHandler","touchGesture",sf);var Ji="__anim_player",Ee={outExpo:function(a){return a===1?1:1-Math.pow(2,-10*a)},outQuint:function(a){return 1-Math.pow(1-a,5)},in:function(a){return Math.pow(a,2)},out:function(a){return 1-Ee.in(1-a)},inAndOut:function(a){return 3*a*a-2*a*a*a},linear:function(a){return a},upAndDown:function(a){return a<.5?Ee.inAndOut(2*a):1-Ee.inAndOut(2*(a-.5))}},dh=function(a,i){this.state=a,this.styles=i},ca=function(a,i,r,t){this._animation=a,this.options=i,this._onFrame=r,this.playState="idle",this.ready=!0,this.finished=!1,this.target=t},Pt={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(a){if(!a)return null;function i(f){if(!Array.isArray(f))return Pt._resolveStyles(f);for(var c=[],d=[],g=[],v=0;v<f.length;v++){var m=Pt._resolveStyles(f[v]);m&&(c.push(m[0]),d.push(m[1]),g.push(m[2]))}return c.length?[c,d,g]:null}function r(f){var c=f,d;Array.isArray(f)||(N(f)?c=[0,f]:f instanceof S||f instanceof k?(d=f.constructor,c=[new d(0,0),f]):c=[f,f]);var g=c[0],v=c[1];return N(g)&&N(v)?g===v?null:[g,v-g,v]:Array.isArray(g)&&N(g[0])||g instanceof k||g instanceof S?(Array.isArray(g)?(g=new k(g),v=new k(v)):(d=g.constructor,g=new d(g),v=new d(v)),g.equals(v)?null:[g,v.sub(g),v]):[g,v,v]}function t(f){return!Array.isArray(f)&&f.constructor===Object?!0:!!(Array.isArray(f)&&f[0].constructor===Object)}var e={},n={},s={};for(var h in a)if(a.hasOwnProperty(h)){var u=a[h];if(u){if(Array.isArray(u)&&(C(u[0])||C(u[1])))continue}else continue;var l=void 0;t(u)?l=i(u):l=r(u),l&&(n[h]=l[0],e[h]=l[1],s[h]=l[2])}return[n,e,s]},framing:function(a,i){i||(i={});var r=i.easing?Ee[i.easing]:Ee.linear;r||(r=Ee.linear);var t,e,n;a=Pt._resolveStyles(a),a&&(e=a[0],t=a[1],n=a[2]);var s=function h(u,l,f){if(!l||!f)return null;var c={};for(var d in f)if(f.hasOwnProperty(d)){if(l[d]===n[d]){c[d]=l[d];continue}var g=l[d],v=f[d];if(N(v))c[d]=g+u*v;else if(Array.isArray(v)){for(var m=[],_=0;_<v.length;_++)m.push(h(u,g[_],v[_]));c[d]=m}else{var p=v.constructor;p===Object?c[d]=h(u,g,v):g instanceof S||g instanceof k?c[d]=g.add(v.multi(u)):c[d]=v}}return c};return function(h,u){var l,f;if(h<0)l={playState:"idle",delta:0},f=e;else if(h<u){var c=r(h/u);l={playState:"running",delta:c},f=s(c,e,t)}else l={playState:"finished",delta:1},f=n;return l.startStyles=e,l.destStyles=n,l.progress=h,l.remainingMs=u-h,new dh(l,f)}},_requestAnimFrame:function(a){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(a),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=Xt(Pt._frameFn))},_run:function(){if(this._frameQueue.length){var a=this._frameQueue;this._frameQueue=[];for(var i=0,r=a.length;i<r;i++)a[i]();this._frameQueue.length?this._animationFrameId=Xt(Pt._frameFn):delete this._animationFrameId}},animate:function(a,i,r,t){i||(i={});var e=Pt.framing(a,i),n=new ca(e,i,r,t);return n}};Pt._frameFn=Pt._run.bind(Pt);H(ca.prototype,{_prepare:function(){var a=this.options,i=a.speed||a.duration;$(i)&&(i=Pt.speed[i],i||(i=+i)),i||(i=Pt.speed.normal),this.duration=i,this._framer=a.framer||Pt._requestAnimFrame.bind(Pt)},play:function(){if(this.playState!=="idle"&&this.playState!=="paused"||this.target&&this.target[Ji])return this;this.target&&(this.target[Ji]=1),this.playState==="idle"&&(this.currentTime=0,this._prepare());var a=lt();if(!this.startTime){var i=this.options;this.startTime=i.startTime?i.startTime:a}return this._playStartTime=Math.max(a,this.startTime),this.playState==="paused"&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return this.playState==="paused"?this:(this.playState="paused",this._run(),this)},cancel:function(){return this.playState==="idle"?this:(this.playState="idle",this.finished=!1,this._run(),this)},finish:function(){return this.playState==="finished"?this:(this.playState="finished",this.finished=!0,this._run(),this)},reverse:function(){},_run:function(){var a=this,i=this._onFrame,r=lt(),t=r-this._playStartTime;if(this.options.repeat&&t>=this.duration&&(this._playStartTime=r,t=0),this.playState!=="running"){if(this.target&&delete this.target[Ji],i){this.playState==="finished"?t=this.duration:this.playState==="idle"&&(t=0);var e=this._animation(t,this.duration);e.state.playState=this.playState,i(e)}return}var n=this._animation(t,this.duration);this.playState=n.state.playState,this.playState!=="running"&&this.target&&delete this.target[Ji],this.playState==="idle"?this.startTime>r&&setTimeout(this._run.bind(this),this.startTime-r):this.playState==="running"?this._framer(function(){a.playState==="running"&&(a.currentTime=t,i&&i(n),a._run())}):this.playState==="finished"&&(this.finished=!0,i&&i(n))}});var md=Object.freeze({Animation:Pt,Easing:Ee,Player:ca,Frame:dh}),hf={smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}},Dr=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.animateShow=function(t,e){var n=this;t===void 0&&(t={}),this._showPlayer&&this._showPlayer.finish(),nt(t)&&(t={},e=t);var s=this.getCoordinates();if(s.length===0)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var h=!!this.getShell,u=h?this.getShell().concat(this.getShell()[0]):s,l=this._getProjection(),f=l.projectCoords(u,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=l.unproject(this._prjAniShowCenter);var c=t.duration||1e3,d=t.easing||"out";this.setCoordinates([]);var g=0;f.length&&(f[0]._distance=0);for(var v=1;v<f.length;v++){var m=f[v].distanceTo(f[v-1]);f[v]._distance=m,g+=m}this._tempCoord=new k(0,0),this._tempPrjCoord=new S(0,0);var _=this._showPlayer=Pt.animate({t:c},{duration:c,easing:d},function(p){if(!n.getMap()){if(_.playState!=="finished"&&(_.finish(),e)){var y=n.getCoordinates();e(p,y[y.length-1])}return}var x=n._drawAnimShowFrame(p.styles.t,c,g,u,f);p.state.playState==="finished"&&(delete n._showPlayer,delete n._aniShowCenter,delete n._prjAniShowCenter,delete n._animIdx,delete n._animLenSoFar,delete n._animTailRatio,delete n._tempCoord,delete n._tempPrjCoord,n.setCoordinates(s)),e&&e(p,x)},this);return _.play(),_},i._drawAnimShowFrame=function(t,e,n,s,h){if(t===0)return s[0];var u=t/e*n,l=0,f,c;for(f=this._animIdx+1,c=h.length;f<c&&(l=h[f]._distance,!(this._animLenSoFar+l>u));f++)this._animLenSoFar+=l;if(this._animIdx=f-1,this._animIdx>=c-1)return this.setCoordinates(s),s[s.length-1];var d=this._animIdx,g=h[d],v=h[d+1],m=u-this._animLenSoFar,_=m/l;this._animTailRatio=_;var p=g.x+(v.x-g.x)*_,y=g.y+(v.y-g.y)*_;this._tempPrjCoord.x=p,this._tempPrjCoord.y=y;var x=this._tempPrjCoord,M=s[d],w=s[d+1],b=M.x+(w.x-M.x)*_,T=M.y+(w.y-M.y)*_;this._tempCoord.x=b,this._tempCoord.y=T;var P=this._tempCoord,O=!!this.getShell;if(!O&&this.options.smoothness>0){for(var I=[],E=[],D=0;D<=this._animIdx;D++)I.push(s[D]),E.push(h[D]);I.push(P,P),E.push(x,x),this.setCoordinates(I),this._setPrjCoordinates(E)}else{var R=s.slice(0,this._animIdx+1);R.push(P);var A=h.slice(0,this._animIdx+1);A.push(x),O?(this.setCoordinates([this._aniShowCenter].concat(R)),this._setPrjCoordinates([this._prjAniShowCenter].concat(A))):(this.setCoordinates(R),this._setPrjCoordinates(A))}return P},i._getCenterInExtent=function(t,e,n){var s=this.getExtent();if(!t.intersects(s))return null;var h=n(e,t);if(h.length===0)return null;var u=0,l=0,f=0;h.forEach(function(d){Array.isArray(d)?d.forEach(function(g){g.point&&(g=g.point),u+=g.x,l+=g.y,f++}):(d.point&&(d=d.point),u+=d.x,l+=d.y,f++)});var c=new k(u,l)._multi(1/f);return c.count=f,c},i._getPath2DPoints=function(t,e,n){if(!rt(t))return[];var s=this.getMap(),h=!e&&this._shouldSimplify(),u=this.options.simplifyTolerance*s._getResolution(),l=Array.isArray(t[0]);if(delete this._simplified,h&&!l){var f=t.length;t=uu(t,u,!1),this._simplified=t.length<f}if(n||(n=s._getResolution()),Array.isArray(t)){var c=[],d="_glPt";if(!Array.isArray(t[0]))return c=Mi(t,d),s._prjsToPointsAtRes(t,n,c);for(var g=[],v=0,m=t.length;v<m;v++){var _=t[v];c=Mi(_,d);var p=s._prjsToPointsAtRes(_,n,c);g.push(p)}return g}else return s._prjToPointAtRes(t,n)},i._shouldSimplify=function(){var t=this.getLayer(),e=this.getProperties(),n=e&&t.options.enableAltitude&&!C(e[t.options.altitudeProperty])&&e[t.options.altitudeProperty]!==0;return t&&t.options.enableSimplify&&!n&&this.options.enableSimplify&&!this._showPlayer},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},i._updateCache=function(){this._clearCache();var t=this._getProjection();!t||this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},i._clearProjection=function(){this._prjCoords=null,o.prototype._clearProjection.call(this)},i._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t,this.options.antiMeridian):[]},i._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},i._computeCenter=function(){var t=this._coordinates;if(!rt(t))return null;for(var e=0,n=0,s=0,h=t.length,u=0;u<h;u++)t[u]&&N(t[u].x)&&N(t[u].y)&&(e+=t[u].x,n+=t[u].y,s++);return new k(e/s,n/s)},i._computeExtent=function(){var t=this._coordinates;if(!rt(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._coords2Extent(e,this._getProjection())},i._computePrjExtent=function(){var t=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this._getPrjHoles()),this._coords2Extent(t)},i._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,n=1,s=t.length;n<s;n++)e+=t[n].distanceTo(t[n-1]);return e},i._hitTestTolerance=function(){var t=this._getInternalSymbol(),e;if(Array.isArray(t)){e=0;for(var n=0;n<t.length;n++)N(t[n].lineWidth)&&t[n].lineWidth>e&&(e=t[n].lineWidth)}else e=t.lineWidth;return o.prototype._hitTestTolerance.call(this)+(N(e)?e/2:1.5)},i._coords2Extent=function(t,e){if(!t||t.length===0||Array.isArray(t[0])&&t[0].length===0)return null;for(var n=new st(e),s=0,h=t.length;s<h;s++)for(var u=0,l=t[s].length;u<l;u++)n._combine(t[s][u]);return n},a}(K);Dr.mergeOptions(hf);var gh="Polygon",mt=function(o){z(a,o);function a(r,t){var e;return e=o.call(this,t)||this,e.type="Polygon",r&&e.setCoordinates(r),e}var i=a.prototype;return i.getOutline=function(){var t=this._getPainter();if(!t)return null;var e=this.getExtent();return new a(e.toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}})},i.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=k.toCoordinates(t),n=e.length;if(!Array.isArray(e[0]))this._coordinates=this._trimRing(e);else if(this._coordinates=this._trimRing(e[0]),n>1){for(var s=[],h=1;h<n;h++)!e[h]||s.push(this._trimRing(e[h]));this._holes=s}return this._projectRings(),this},i.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],n=0,s=t.length;n<s;n++)e.push(this._copyAndCloseRing(t[n]));return e},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),ir)},i.getShell=function(){return this._coordinates||[]},i.getHoles=function(){return this._holes||[]},i.hasHoles=function(){return this.getHoles().length>0},i._projectRings=function(){if(!this.getMap()){this.onShapeChanged();return}this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},i._checkRing=function(t){if(this._cleanRing(t),!t||!rt(t))return!1;var e=t[t.length-1],n=!0;return(t[0].x!==e.x||t[0].y!==e.y)&&(n=!1),n},i._trimRing=function(t){var e=this._checkRing(t);return rt(t)&&e&&t.splice(t.length-1,1),t},i._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return rt(t)&&!e&&t.push(t[0].copy()),t},i._getPrjShell=function(){return this.getJSONType()===gh?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this.getShell())),this._prjShell)},i._getPrjHoles=function(){var t=this._getProjection();return this._verifyProjection(),t&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},i._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!rt(e))return 0;for(var n=0,s=0,h=e.length;s<h;s++)n+=t.measureLength(e[s]);return n},i._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!rt(e))return 0;for(var n=t.measureArea(e[0]),s=1,h=e.length;s<h;s++)n-=t.measureArea(e[s]);return n},i._updateCache=function(){o.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},i._clearCache=function(){return delete this._prjShell,o.prototype._clearCache.call(this)},i._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),o.prototype._clearProjection.call(this)},a}(Dr);mt.registerJSONType(gh);function da(o){return function(a){z(i,a);function i(){return a.apply(this,arguments)||this}var r=i.prototype;return r.getCoordinates=function(){return this._coordinates},r.setCoordinates=function(e){var n=e instanceof k?e:new k(e);if(n.equals(this._coordinates))return this;if(this._coordinates=n,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var s=this._getProjection();return this._setPrjCoordinates(s.project(this._coordinates)),this},r._getCenter2DPoint=function(e){var n=this.getMap();if(!n)return null;var s=this._getPrjCoordinates();return s?(e||(e=n._getResolution()),n._prjToPointAtRes(s,e)):null},r._getPrjCoordinates=function(){var e=this._getProjection();return this._verifyProjection(),!this._pcenter&&e&&this._coordinates&&(this._pcenter=e.project(this._coordinates)),this._pcenter},r._setPrjCoordinates=function(e){this._pcenter=e,this.onPositionChanged()},r._updateCache=function(){this._clearCache();var e=this._getProjection();this._pcenter&&e&&(this._coordinates=e.unproject(this._pcenter))},r._clearProjection=function(){this._pcenter=null,a.prototype._clearProjection.call(this)},r._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},i}(o)}var Po=new Y,uf={symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1},gt=function(o){z(a,o);function a(r,t){var e;return e=o.call(this,t)||this,e.type="Point",r&&e.setCoordinates(r),e}var i=a.prototype;return i.getOutline=function(){var t=this.getCoordinates(),e=this.getContainerExtent(),n=this.getMap().coordToContainerPoint(t);return new a(t,{symbol:{markerType:"square",markerWidth:e.getWidth(),markerHeight:e.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:e.xmin-(n.x-e.getWidth()/2),markerDy:e.ymin-(n.y-e.getHeight()/2)}})},i.setSymbol=function(){var t;delete this._fixedExtent;for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(t=o.prototype.setSymbol).call.apply(t,[this].concat(n))},i._getSizeSymbol=function(t){for(var e={},n=!1,s=!1,h=0;h<dn.length;h++){var u=t[dn[h]];C(u)||(!n&&_t(u)&&(n=!0,s=!0),e[dn[h]]=u)}for(var l=0;l<gn.length;l++){var f=t[gn[l]];C(f)||(!n&&_t(f)&&(n=!0),e[gn[l]]=f)}var c;return n?(c=lr(e,this),s&&(c._dynamic=!0)):c=e,c},i._setExternSymbol=function(t){return this._symbol||delete this._fixedExtent,o.prototype._setExternSymbol.call(this,t)},i._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},i._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new Y,this._fixedExtent.set(null,null,null,null);var t=this._sizeSymbol;if(!t)return this._fixedExtent;var e=this.getLayer()&&this.getLayer().getRenderer(),n=e&&e.resources,s=this.getTextDesc();if(Array.isArray(t)){Po.set(1/0,1/0,-1/0,-1/0);for(var h=0;h<t.length;h++)!t[h]||this._fixedExtent._combine(Ln(Po,t[h],n,s&&s[h]))}else this._fixedExtent=Ln(this._fixedExtent,t,n,s);return this._fixedExtent},i._isVectorMarker=function(){var t=this._getInternalSymbol();return Array.isArray(t)?!1:_r(t)},i._canEdit=function(){var t=this._getInternalSymbol();return Array.isArray(t)?!1:_r(t)||ua(t)||ha(t)},i._containsPoint=function(t,e){var n=this.getContainerExtent();return e&&(n=n.expand(e)),n.contains(t)?this.options.hitTestForEvent?o.prototype._containsPoint.call(this,t,e):!0:!1},i._computeExtent=function(){return Mo.call(this,"getCenter")},i._computePrjExtent=function(){return Mo.call(this,"_getPrjCoordinates")},i._computeGeodesicLength=function(){return 0},i._computeGeodesicArea=function(){return 0},i._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new fa(this).getSprite(t,e)},a}(da(K));gt.mergeOptions(uf);gt.registerJSONType("Marker");function Mo(o){var a=this[o]();return a?new st(a,a,this._getProjection()):null}var lf={arrowStyle:null,arrowPlacement:"vertex-last"},dt=function(o){z(a,o);function a(r,t){var e;return e=o.call(this,t)||this,e.type="LineString",r&&e.setCoordinates(r),e}var i=a.prototype;return i.getOutline=function(){return mt.prototype.getOutline.call(this)},i.setCoordinates=function(t){return t?(this._coordinates=k.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},i.getCoordinates=function(){return this._coordinates||[]},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),er)},i._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},i._computeGeodesicArea=function(){return 0},a}(Dr);dt.mergeOptions(lf);dt.registerJSONType("LineString");var ff=new Y,pr=function(o){z(a,o);function a(r,t){var e;return e=o.call(this,t)||this,e.type="GeometryCollection",e.setGeometries(r),e}var i=a.prototype;return i.getContainerExtent=function(t){var e=t||new Y;return this.forEach(function(n){e._combine(n.getContainerExtent(ff))}),e},i.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),n=this._getSymbol(),s=this.config(),h=e.length-1;h>=0;h--)e[h]._initOptions(s),e[h]._setParent(this),e[h]._setEventParent(this),n&&e[h].setSymbol(n);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},i.getGeometries=function(){return this._geometries||[]},i.forEach=function(t,e){for(var n=this.getGeometries(),s=0,h=n.length;s<h;s++)!n[s]||(e?t.call(e,n[s],s):t(n[s],s));return this},i.filter=function(t,e){if(!t)return new a;var n=[],s=nt(t),h=s?t:Vn(t);return this.forEach(function(u){var l=s?u:bn(u);(e?h.call(e,l):h(l))&&n.push(u)},this),new a(n)},i.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach(function(n){n&&n.translate&&n.translate.apply(n,e)}),this},i.isEmpty=function(){return!rt(this.getGeometries())},i.remove=function(){return this.forEach(function(t){t._unbind()}),K.prototype.remove.apply(this,arguments)},i.show=function(){return this.options.visible=!0,this.forEach(function(t){t.show()}),this},i.hide=function(){return this.options.visible=!1,this.forEach(function(t){t.hide()}),this},i.onConfig=function(t){this.forEach(function(e){e.config(t)})},i.getSymbol=function(){var t=o.prototype.getSymbol.call(this);if(!t){var e=[],n=!1;this.forEach(function(s){var h=s.getSymbol();h&&!n&&(n=!0),e.push(s.getSymbol())}),n&&(t={children:e})}return t},i.setSymbol=function(t){if(t&&t.children)this._symbol=null,this.forEach(function(n,s){n.setSymbol(t.children[s])});else{var e=this._prepareSymbol(t);this._symbol=e,this.forEach(function(n){n.setSymbol(e)})}return this.onSymbolChanged(),this},i._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach(function(e){e._setExternSymbol(t)}),this.onSymbolChanged(),this},i._bindLayer=function(){o.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},i._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach(function(e){e._bindLayer(t)})},i._checkGeometries=function(t){var e="The geometry added to collection is invalid.";if(t&&!Array.isArray(t)){if(t instanceof K)return[t];throw new Error(e)}else{for(var n=0,s=t.length;n<s;n++)if(!this._checkGeo(t[n]))throw new Error(e+" Index: "+n);return t}},i._checkGeo=function(t){return t instanceof K},i._updateCache=function(){this._clearCache(),!this.isEmpty()&&this.forEach(function(t){t&&t._updateCache&&t._updateCache()})},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach(function(t){t._removePainter()})},i._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,n=0,s=0,h=this.getGeometries(),u=0,l=h.length;u<l;u++)if(!!h[u]){var f=h[u]._computeCenter(t);f&&(e+=f.x,n+=f.y,s++)}return s===0?null:new k(e/s,n/s)},i._containsPoint=function(t,e){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var n=this.getGeometries(),s=0,h=n.length;s<h;s++)if(n[s]._containsPoint(t,e))return this._pickGeometryIndex=s,!0;return!1},i._computeExtent=function(t){return To.call(this,t,"_computeExtent")},i._computePrjExtent=function(t){return To.call(this,t,"_computePrjExtent")},i._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,s=0,h=e.length;s<h;s++)!e[s]||(n+=e[s]._computeGeodesicLength(t));return n},i._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,s=0,h=e.length;s<h;s++)!e[s]||(n+=e[s]._computeGeodesicArea(t));return n},i._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),n=0,s=e.length;n<s;n++)!e[n]||t.push(e[n]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},i._toJSON=function(t){var e={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter(function(h){return h&&h._toJSON}).map(function(h){var u=h._toJSON();return u.subType?u:h._exportGeoJSONGeometry()})}},n=this.getId();C(n)||(e.id=n);var s;return(C(t.properties)||t.properties)&&(s=this._exportProperties()),e.properties=s,t.feature=e,t},i._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)!t[e]||t[e]._clearProjection()},i._getConnectPoints=function(){var t=this.getExtent(),e=[new k(t.xmin,t.ymax),new k(t.xmax,t.ymin),new k(t.xmin,t.ymin),new k(t.xmax,t.ymax)];return e},i._getExternalResources=function(){if(this.isEmpty())return[];for(var t=this.getGeometries(),e=[],n={},s,h,u,l=0,f=t.length;l<f;l++)if(!!t[l]){s=t[l]._getInternalSymbol(),h=bi(s);for(var c=0,d=h.length;c<d;c++)u=h[c].join(),n[u]||(e.push(h[c]),n[u]=1)}return e},i.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var n=this.getGeometries(),s=0,h=n.length;s<h;s++)n[s].startEdit(t);return this._editing=!0,this.hide(),setTimeout(function(){e.fire("editstart")},1),this},i.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},i.isEditing=function(){return!!this._editing},a}(K);pr.registerJSONType("GeometryCollection");function To(o,a){if(this.isEmpty())return null;for(var i=new st,r=this.getGeometries(),t=0,e=r.length;t<e;t++)if(!!r[t]){var n=r[t][a](o);n&&i._combine(n)}return i}var vh=function(o){z(a,o);function a(r,t,e,n){var s;return s=o.call(this,null,n)||this,s.GeometryType=r,s.type=t,s._initData(e),s}var i=a.prototype;return i.getCoordinates=function(){for(var t=[],e=this.getGeometries(),n=0,s=e.length;n<s;n++){var h=e[n];t.push(h.getShell&&h.getJSONType()!=="Polygon"?[h.getShell()]:h.getCoordinates())}return t},i.setCoordinates=function(t){t=t||[];for(var e=[],n=0,s=t.length;n<s;n++){var h=new this.GeometryType(t[n],this.config());e.push(h)}return this.setGeometries(e),this},i._initData=function(t){t=t||[],t.length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},i._checkGeo=function(t){return t instanceof this.GeometryType},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=k.toNumberArrays(t);return{type:this.getType(),coordinates:e}},i._toJSON=function(t){return{feature:this.toGeoJSON(t)}},a}(pr),yr=function(o){z(a,o);function a(r,t){return o.call(this,gt,"MultiPoint",r,t)||this}var i=a.prototype;return i.findClosest=function(t){if(!t)return null;var e=this.getCoordinates(),n=null,s=1/0;return e.forEach(function(h){var u=cf(h,t);u<s&&(n=h,s=u)}),n},a}(vh);yr.registerJSONType("MultiPoint");function cf(o,a){var i=a.x-o.x,r=a.y-o.y;return Math.sqrt(i*i+r*r)}var mh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.getCenterInExtent=function(t){var e=this.getGeometries(),n=0,s=0,h=0;return e.forEach(function(u){var l=u.getCenterInExtent(t);l&&(n+=l.x*l.count,s+=l.y*l.count,h+=l.count)}),h===0?null:new k(n,s)._multi(1/h)},a}(vh),xr=function(o){z(a,o);function a(i,r){return o.call(this,dt,"MultiLineString",i,r)||this}return a}(mh);xr.registerJSONType("MultiLineString");var _h=function(o){z(a,o);function a(i,r){return o.call(this,mt,"MultiPolygon",i,r)||this}return a}(mh);_h.registerJSONType("MultiPolygon");var df={Marker:gt,LineString:dt,Polygon:mt,MultiPoint:yr,MultiLineString:xr,MultiPolygon:_h},ve={toGeometry:function(a,i){if($(a)&&(a=Tr(a)),Array.isArray(a)){for(var r=[],t=0,e=a.length;t<e;t++){var n=ve._convert(a[t],i);Array.isArray(n)?ke(r,n):r.push(n)}return r}else{var s=ve._convert(a,i);return s}},_convert:function(a,i){if(!a||C(a.type))return null;var r=a.type;if(r==="Feature"){var t=a.geometry,e=ve._convert(t);return e?(e.setId(a.id),e.setProperties(a.properties),i&&i(e),e):null}else if(r==="FeatureCollection"){var n=a.features;return n?ve.toGeometry(n,i):null}else if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(r)>=0){var s=r==="Point"?"Marker":r,h=new df[s](a.coordinates);return i&&i(h),h}else if(r==="GeometryCollection"){var u=a.geometries;if(!rt(u)){var l=new pr;return i&&i(l),l}for(var f=[],c=u.length,d=0;d<c;d++)u[d].subType?f.push(K.getJSONClass(u[d].subType).fromJSON(u[d])):f.push(ve._convert(u[d]));var g=new pr(f);return i&&i(g),g}return null}},gf={numberOfShellPoints:60},qt=function(o){z(a,o),a.fromJSON=function(t){var e=t.feature,n=new a(t.coordinates,t.radius,t.options);return n.setProperties(e.properties),n};function a(r,t,e){var n;return n=o.call(this,null,e)||this,r&&n.setCoordinates(r),n._radius=t,n}var i=a.prototype;return i.getRadius=function(){return this._radius},i.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},i.getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),n=this.options.numberOfShellPoints,s=this.getRadius(),h=[],u,l,f,c=0,d=n-1;c<d;c++){u=360*c/d*Math.PI/180,l=s*Math.cos(u),f=s*Math.sin(u);var g=t.locate(e,l,f);h.push(g)}return h.push(h[0]),h},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(t,e){var n=this.getMap();if(n.getPitch())return o.prototype._containsPoint.call(this,t,e);var s=n._pointToContainerPoint(this._getCenter2DPoint()),h=this.getSize(),u=C(e)?this._hitTestTolerance():e,l=s.add(h.width/2,h.height/2);return rh(t,s,l,u)},i._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var n=this._getPrjCoordinates(),s=e.map(function(c){return t.project(c)}),h=s[0].x-n.x,u=s[1].x-n.x,l=s[2].y-n.y,f=s[3].y-n.y;return new st(n.add(h,l),n.add(u,f))},i._computeExtent=function(t){var e=this._getMinMax(t);return e?new st(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},i._getMinMax=function(t){if(!t||!this._coordinates||C(this._radius))return null;var e=this._radius,n=t.locate(this._coordinates,-e,0),s=t.locate(this._coordinates,e,0),h=t.locate(this._coordinates,0,e),u=t.locate(this._coordinates,0,-e);return[n,s,h,u]},i._computeGeodesicLength=function(){return C(this._radius)?0:Math.PI*2*this._radius},i._computeGeodesicArea=function(){return C(this._radius)?0:Math.PI*Math.pow(this._radius,2)},i._exportGeoJSONGeometry=function(){var t=k.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:t}},i._toJSON=function(t){var e=this.getCenter(),n=H({},t);n.geometry=!1;var s=this.toGeoJSON(n);return s.geometry={type:"Polygon"},{feature:s,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},a}(da(mt));qt.mergeOptions(gf);qt.registerJSONType("Circle");var vf={numberOfShellPoints:80},ae=function(o){z(a,o),a.fromJSON=function(t){var e=t.feature,n=new a(t.coordinates,t.width,t.height,t.options);return n.setProperties(e.properties),n};function a(r,t,e,n){var s;return s=o.call(this,null,n)||this,r&&s.setCoordinates(r),s.width=t,s.height=e,s}var i=a.prototype;return i.getWidth=function(){return this.width},i.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},i.getHeight=function(){return this.height},i.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},i.getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),n=this.options.numberOfShellPoints,s=this.getWidth(),h=this.getHeight(),u=[],l=Math.pow(s/2,2)*Math.pow(h/2,2),f=Math.pow(s/2,2),c=Math.pow(h/2,2),d,g,v,m,_=0;_<n;_++){d=360*_/n,g=d*Math.PI/180,v=Math.sqrt(l/(f*Math.pow(Math.tan(g),2)+c)),m=Math.sqrt(l/(c*Math.pow(1/Math.tan(g),2)+f)),d>90&&d<270&&(v*=-1),d>180&&d<360&&(m*=-1);var p=t.locate(e,v,m);u.push(p)}return u},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(t,e){var n=this.getMap();if(n.isTransforming())return o.prototype._containsPoint.call(this,t,e);var s=n.getProjection(),h=C(e)?this._hitTestTolerance():e,u=s.projectCoords([this._coordinates,n.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian),l=n._prjToContainerPoint(u[0]),f=n._prjToContainerPoint(u[1]);return rh(t,l,f,h)},i._computePrjExtent=function(){return qt.prototype._computePrjExtent.apply(this,arguments)},i._computeExtent=function(){return qt.prototype._computeExtent.apply(this,arguments)},i._getMinMax=function(t){if(!t||!this._coordinates||C(this.width)||C(this.height))return null;var e=this.getWidth(),n=this.getHeight(),s=t.locate(this._coordinates,-e/2,0),h=t.locate(this._coordinates,e/2,0),u=t.locate(this._coordinates,0,-n/2),l=t.locate(this._coordinates,0,n/2);return[s,h,u,l]},i._computeGeodesicLength=function(){if(C(this.width)||C(this.height))return 0;var t=this.width>this.height?this.width:this.height;return 2*Math.PI*t/2-4*Math.abs(this.width-this.height)},i._computeGeodesicArea=function(){return C(this.width)||C(this.height)?0:Math.PI*this.width*this.height/4},i._exportGeoJSONGeometry=function(){var t=k.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:t}},i._toJSON=function(t){var e=H({},t),n=this.getCenter();e.geometry=!1;var s=this.toGeoJSON(e);return s.geometry={type:"Polygon"},{feature:s,subType:"Ellipse",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},a}(da(mt));ae.mergeOptions(vf);ae.registerJSONType("Ellipse");var Ue=function(o){z(a,o),a.fromJSON=function(t){var e=t.feature,n=new a(t.coordinates,t.width,t.height,t.options);return n.setProperties(e.properties),n};function a(r,t,e,n){var s;return s=o.call(this,null,n)||this,r&&s.setCoordinates(r),s._width=t,s._height=e,s}var i=a.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(t){if(this._coordinates=t instanceof k?t:new k(t),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var e=this._getProjection();return this._setPrjCoordinates(e.project(this._coordinates)),this},i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},i.getShell=function(){var t=this._getMeasurer(),e=this._coordinates,n=this.getMap(),s=1,h=-1;if(n){var u=n.getFullExtent();u.left>u.right&&(s=-1),u.bottom>u.top&&(h=1)}var l=[];return l.push(e),l.push(t.locate(e,s*this._width,0)),l.push(t.locate(e,s*this._width,h*this._height)),l.push(t.locate(e,0,h*this._height)),l.push(e),l},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pnw&&t&&this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw},i._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},i._getPrjShell=function(){var t=o.prototype._getPrjShell.call(this),e=this._getProjection();if(!e.isSphere())return t;for(var n=e.getSphereExtent(),s=n.sx,h=n.sy,u=this._getProjection().getCircum(),l=t[0],f=1,c=t.length;f<c;f++){var d=t[f],g=0,v=0;s*(l.x-d.x)>0&&(g=u.x*s),h*(l.y-d.y)<0&&(v=u.y*h),t[f]._add(g,v)}return t},i._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},i._clearProjection=function(){this._pnw=null,o.prototype._clearProjection.call(this)},i._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},i._containsPoint=function(t,e){var n=this.getMap();if(n.isTransforming())return o.prototype._containsPoint.call(this,t,e);var s=C(e)?this._hitTestTolerance():e,h=n._getResolution()*s,u=this._getPrjExtent().expand(h),l=n._containerPointToPrj(t);return u.contains(l)},i._computePrjExtent=function(t){var e=this._getSouthEast(t);if(!e)return null;var n=t.projectCoords([new k(this._coordinates.x,e.y),new k(e.x,this._coordinates.y)],this.options.antiMeridian);return new st(n[0],n[1])},i._computeExtent=function(t){var e=this._getSouthEast(t);return e?new st(this._coordinates,e,this._getProjection()):null},i._getSouthEast=function(t){if(!t||!this._coordinates||C(this._width)||C(this._height))return null;var e=this.getWidth(),n=this.getHeight(),s=e,h=-n;if(t.fullExtent){var u=t.fullExtent,l=u.right>u.left?1:-1,f=u.top>u.bottom?1:-1;s*=l,h*=f}var c=t.locate(this._coordinates,s,0),d=t.locate(this._coordinates,0,h);return c.y=d.y,c},i._computeGeodesicLength=function(){return C(this._width)||C(this._height)?0:2*(this._width+this._height)},i._computeGeodesicArea=function(){return C(this._width)||C(this._height)?0:this._width*this._height},i._exportGeoJSONGeometry=function(){var t=k.toNumberArrays([this.getShell()]);return{type:"Polygon",coordinates:t}},i._toJSON=function(t){var e=H({},t),n=this.getCoordinates();e.geometry=!1;var s=this.toGeoJSON(e);return s.geometry={type:"Polygon"},{feature:s,subType:"Rectangle",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},a}(mt);Ue.registerJSONType("Rectangle");var mf={numberOfShellPoints:60},ti=function(o){z(a,o),a.fromJSON=function(t){var e=t.feature,n=new a(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return n.setProperties(e.properties),n};function a(r,t,e,n,s){var h;return h=o.call(this,r,t,s)||this,h.startAngle=e,h.endAngle=n,h}var i=a.prototype;return i.getStartAngle=function(){return this.startAngle},i.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},i.getEndAngle=function(){return this.endAngle},i.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},i.getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),n=this.options.numberOfShellPoints-2,s=this.getRadius(),h=[e.copy()],u=this.getStartAngle(),l=this.getEndAngle()-u,f,c,d,g=0;g<n;g++){f=(l*g/(n-1)+u)*Math.PI/180,c=s*Math.cos(f),d=s*Math.sin(f);var v=t.locate(e,c,d);h.push(v)}return h.push(e.copy()),h},i._containsPoint=function(t,e){var n=this.getMap();if(n.isTransforming())return o.prototype._containsPoint.call(this,t,e);var s=n._pointToContainerPoint(this._getCenter2DPoint()),h=C(e)?this._hitTestTolerance():e,u=this.getSize(),l=s,f=t,c=f.x-l.x,d=l.y-f.y,g=Math.atan2(d,c),v=g<0?(g+2*Math.PI)*360/(2*Math.PI):g*360/(2*Math.PI),m=this.startAngle%360,_=this.endAngle%360,p=!1;return m>_?p=!(v>_&&v<m):p=v>=m&&v<=_,f.distanceTo(l)<=u.width/2+h&&p},i._computeGeodesicLength=function(){return C(this._radius)?0:Math.PI*2*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},i._computeGeodesicArea=function(){return C(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},i._toJSON=function(t){var e=H({},t),n=this.getCenter();e.geometry=!1;var s=this.toGeoJSON(e);return s.geometry={type:"Polygon"},{feature:s,subType:"Sector",coordinates:[n.x,n.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},a}(qt);ti.mergeOptions(mf);ti.registerJSONType("Sector");var _f={enableSimplify:!1,enableClip:!1},Ai=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i._arc=function(t,e,n){for(var s=this.options.arcDegree*Math.PI/180,h=1,u=e.length;h<u;h++){var l=L._arcBetween(t,e[h-1],e[h],s),f=[e[h-1].x+e[h].x-l[0],e[h-1].y+e[h].y-l[1]];e[h-1].nextCtrlPoint=f,e[h].prevCtrlPoint=f,L._stroke(t,n)}},i._quadraticCurve=function(t,e){if(e.length<=2){L._path(t,e);return}var n,s;for(n=2,s=e.length;n<s;n+=2)t.quadraticCurveTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y);if(n-=1,n<s)for(;n<s;n++)t.lineTo(e[n].x,e[n].y)},i._bezierCurve=function(t,e){if(e.length<=3){L._path(t,e);return}var n,s;for(n=1,s=e.length;n+2<s;n+=3)t.bezierCurveTo(e[n].x,e[n].y,e[n+1].x,e[n+1].y,e[n+2].x,e[n+2].y);if(n<s)for(;n<s;n++)t.lineTo(e[n].x,e[n].y)},i._getCurveArrowPoints=function(t,e,n,s,h,u){var l=e.length,f;for(f=u;f<l;f+=u){var c=this._getArrowShape(e[f-1],e[f],n,s,h);c&&t.push(c)}if(f-=u,f<l-1)for(f+=1;f<l;f++){var d=this._getArrowShape(e[f-1],e[f],n,s,h);d&&t.push(d)}},a}(dt);Ai.mergeOptions(_f);var pf={arcDegree:90},Lr=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},i._paintOn=function(t,e,n){t.beginPath(),this._arc(t,e,n),L._stroke(t,n),this._paintArrow(t,e,n)},a.fromJSON=function(t){var e=t.feature,n=new a(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n},a}(Ai);Lr.registerJSONType("ArcCurve");Lr.mergeOptions(pf);var ph=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}a.fromJSON=function(t){var e=t.feature,n=new a(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n};var i=a.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},i._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),L._stroke(t,n),this._paintArrow(t,e,n)},i._getArrowPoints=function(t,e,n,s,h){return this._getCurveArrowPoints(t,e,n,s,h,3)},a}(Ai);ph.registerJSONType("CubicBezierCurve");var yh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}a.fromJSON=function(t){var e=t.feature,n=new a(e.geometry.coordinates,t.options);return n.setProperties(e.properties),n};var i=a.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},i._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,n),L._stroke(t,n),this._paintArrow(t,e,n)},i._getArrowPoints=function(t,e,n,s,h){return this._getCurveArrowPoints(t,e,n,s,h,2)},a}(Ai);yh.registerJSONType("QuadBezierCurve");var yf={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:`
`,textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},xf={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},ga=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.getContent=function(){return this._content},i.setContent=function(t){var e=this._content;return this._content=br(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},i.onAdd=function(){this._refresh()},i.toJSON=function(){var t=o.prototype.toJSON.call(this);return delete t.symbol,t},i.setSymbol=function(t){if(this._refreshing||!t)return o.prototype.setSymbol.call(this,t);var e=this._parseSymbol(t);if(this.setTextStyle){var n=this.getTextStyle()||{};n.symbol=e[0],this.setTextStyle(n)}else this.setTextSymbol&&this.setTextSymbol(e[0]);if(this.setBoxStyle){var s=this.getBoxStyle()||{};s.symbol=e[1],this.setBoxStyle(s)}else this.setBoxSymbol&&this.setBoxSymbol(e[1]);return this},i._parseSymbol=function(t){var e={},n={};for(var s in t)Xe(t,s)&&(s.indexOf("text")===0?e[s]=t[s]:n[s]=t[s]);return[e,n]},i._getTextSize=function(t){return Xn(this._content,t).size},i._getInternalSymbol=function(){return this._symbol},i._getDefaultTextSymbol=function(){return H({},yf)},i._getDefaultBoxSymbol=function(){return H({},xf)},i._getDefaultPadding=function(){return[12,8]},a}(gt),wf={textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null},wr=function(o){z(a,o);function a(r,t,e,n,s){var h;return s===void 0&&(s={}),h=o.call(this,t,s)||this,h._content=br(r),h._width=C(e)?100:e,h._height=C(n)?40:n,s.boxSymbol&&h.setBoxSymbol(s.boxSymbol),s.textStyle&&h.setTextStyle(s.textStyle),h._refresh(),h}var i=a.prototype;return i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this._refresh(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this._refresh(),this},i.getBoxSymbol=function(){return H({},this.options.boxSymbol)},i.setBoxSymbol=function(t){return this.options.boxSymbol=t&&H({},t),this.getSymbol()&&this._refresh(),this},i.getTextStyle=function(){return this.options.textStyle?H({},this.options.textStyle):null},i.setTextStyle=function(t){return this.options.textStyle=t&&H({},t),this.getSymbol()&&this._refresh(),this},a.fromJSON=function(t){var e=t.feature,n=new a(t.content,e.geometry.coordinates,t.width,t.height,t.options);return n.setProperties(e.properties),n.setId(e.id),t.symbol&&n.setSymbol(t.symbol),n},i._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},i._refresh=function(){var t=this.getTextStyle()||{},e=t.padding||[12,8],n=this._width-2*e[0],s=this._height-2*e[1],h=H({},t.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:n,textMaxHeight:s});t.wrap&&!h.textWrapWidth&&(h.textWrapWidth=n);var u=t.horizontalAlignment;h.textDx=h.markerDx||0;var l=h.markerWidth/2-e[0];u==="left"?(h.textHorizontalAlignment="right",h.textDx=h.textDx-l):u==="right"&&(h.textHorizontalAlignment="left",h.textDx=h.textDx+l);var f=t.verticalAlignment;h.textDy=h.markerDy||0;var c=h.markerHeight/2-e[1];f==="top"?(h.textVerticalAlignment="bottom",h.textDy-=c):f==="bottom"&&(h.textVerticalAlignment="top",h.textDy+=c),this._refreshing=!0,this.updateSymbol(h),delete this._refreshing},a}(ga);wr.mergeOptions(wf);wr.registerJSONType("TextBox");var Cf={boxStyle:null,textSymbol:null},Je=function(o){z(a,o);function a(r,t,e){var n;return e===void 0&&(e={}),n=o.call(this,t,e)||this,e.textSymbol&&n.setTextSymbol(e.textSymbol),e.boxStyle&&n.setBoxStyle(e.boxStyle),n._content=br(r),n._refresh(),n}var i=a.prototype;return i.getBoxStyle=function(){return this.options.boxStyle?H({},this.options.boxStyle):null},i.setBoxStyle=function(t){return this.options.boxStyle=t&&H({},t),this._refresh(),this},i.getTextSymbol=function(){return H({},this._getDefaultTextSymbol(),this.options.textSymbol)},i.setTextSymbol=function(t){return this.options.textSymbol=t&&H({},t),this._refresh(),this},a.fromJSON=function(t){var e=t.feature,n=new a(t.content,e.geometry.coordinates,t.options);return n.setProperties(e.properties),n.setId(e.id),t.symbol&&n.setSymbol(t.symbol),n},i._canEdit=function(){return!1},i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},i._refresh=function(){var t=H({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){H(t,e.symbol);var n=this._getBoxSize(t),s=n[1],h=e.padding||this._getDefaultPadding(),u=n[0];t.markerWidth=u.width,t.markerHeight=u.height;var l=t.textDx||0,f=t.textDy||0,c=xe(s,t.textHorizontalAlignment,t.textVerticalAlignment)._add(l,f),d=e.horizontalAlignment||"middle";t.markerDx=c.x,d==="left"?t.markerDx+=t.markerWidth/2-h[0]:d==="right"?t.markerDx-=t.markerWidth/2-s.width-h[0]:t.markerDx+=s.width/2;var g=e.verticalAlignment||"middle";t.markerDy=c.y,g==="top"?t.markerDy+=t.markerHeight/2-h[1]:g==="bottom"?t.markerDy-=t.markerHeight/2-s.height-h[1]:t.markerDy+=s.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},i._getBoxSize=function(t){t.markerType||(t.markerType="square");var e=this.getBoxStyle(),n=this._getTextSize(t),s,h,u=e.padding||this._getDefaultPadding();return s=n.width+u[0]*2,h=n.height+u[1]*2,e.minWidth&&(!s||s<e.minWidth)&&(s=e.minWidth),e.minHeight&&(!h||h<e.minHeight)&&(h=e.minHeight),[new vt(s,h),n]},a}(ga);Je.mergeOptions(Cf);Je.registerJSONType("Label");var xh=function(a){return function(i){z(r,i);function r(){return i.apply(this,arguments)||this}r._hasConnectors=function(n){return!C(n.__connectors)&&n.__connectors.length>0},r._getConnectors=function(n){return n.__connectors};var t=r.prototype;return t.getConnectSource=function(){return this._connSource},t.setConnectSource=function(n){var s=this._connTarget;return this.onRemove(),this._connSource=n,this._connTarget=s,this.onAdd(),this},t.getConnectTarget=function(){return this._connTarget},t.setConnectTarget=function(n){var s=this._connSource;return this.onRemove(),this._connSource=s,this._connTarget=n,this._updateCoordinates(),this._registerEvents(),this},t._updateCoordinates=function(){var n=this.getMap();if(!n&&this._connSource&&(n=this._connSource.getMap()),!n&&this._connTarget&&(n=this._connTarget.getMap()),!!n&&!(!this._connSource||!this._connTarget)){for(var s=this._connSource._getConnectPoints(),h=this._connTarget._getConnectPoints(),u=0,l=this.getCoordinates(),f,c,d=0,g=s.length;d<g;d++)for(var v=s[d],m=0,_=h.length;m<_;m++){var p=h[m],y=n.computeLength(v,p);d===0&&m===0?(f=v,c=p,u=y):y<u&&(f=v,c=p)}(!rt(l)||!l[0].equals(f)||!l[1].equals(c))&&this.setCoordinates([f,c])}},t.onAdd=function(){this._registerEvents(),this._updateCoordinates()},t.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&ar(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(ar(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof K)||!(this._connTarget instanceof K)){var n=this.getMap();n&&n.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},t._showConnect=function(){!this._connSource||!this._connTarget||this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},t._registerEvents=function(){if(!(!this._connSource||!this._connTarget)){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var n=this.options.showOn;if(this.hide(),n==="moving"?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):n==="click"?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):n==="mouseover"?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof K)||!(this._connTarget instanceof K)){var s=this.getMap();s&&s.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},r}(a)},wh={showOn:"always"},Cr=function(o){z(a,o);function a(i,r,t){var e;return e=o.call(this,null,t)||this,arguments.length===1&&(t=i,i=null,r=null),e._connSource=i,e._connTarget=r,e}return a}(xh(dt));Cr.mergeOptions(wh);Cr.registerJSONType("ConnectorLine");var Ch=function(o){z(a,o);function a(i,r,t){var e;return e=o.call(this,null,t)||this,arguments.length===1&&(t=i,i=null,r=null),e._connSource=i,e._connTarget=r,e}return a}(xh(Lr));Ch.mergeOptions(wh);Ch.registerJSONType("ArcConnectorLine");var Pf={drawImmediate:!1},Ph=function(o){z(a,o);function a(r,t,e){var n;t&&!(t instanceof K)&&!Array.isArray(t)&&du.indexOf(t.type)<0&&(e=t,t=null),n=o.call(this,r,e)||this,n._maxZIndex=0,n._minZIndex=0,n._initCache(),t&&n.addGeometry(t);var s=n.options.style;return s&&n.setStyle(s),n}var i=a.prototype;return i.getGeometryById=function(t){return C(t)||t===""||!this._geoMap[t]?null:this._geoMap[t]},i.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var n=[],s,h,u=0,l=this._geoList.length;u<l;u++)s=this._geoList[u],e?h=t.call(e,s):h=t(s),h&&n.push(s);return n},i.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},i.getLastGeometry=function(){var t=this._geoList.length;return t===0?null:this._geoList[t-1]},i.getCount=function(){return this._geoList.length},i.getExtent=function(){if(this.getCount()===0)return null;var t=new st(this.getProjection());return this.forEach(function(e){t._combine(e.getExtent())}),t},i.forEach=function(t,e){for(var n=this._geoList.slice(0),s=0,h=n.length;s<h;s++)e?t.call(e,n[s],s):t(n[s],s);return this},i.filter=function(t,e){var n=[],s=nt(t),h=s?t:Vn(t);return this.forEach(function(u){var l=s?u:bn(u);(e?h.call(e,l):h(l))&&n.push(u)},this),n},i.isEmpty=function(){return!this._geoList.length},i.addGeometry=function(t,e){if(!t)return this;if(t.type==="FeatureCollection")return this.addGeometry(ve.toGeometry(t),e);if(Array.isArray(t)){if(t.length===0)return this}else{var n=arguments.length,s=arguments[n-1];return t=Array.prototype.slice.call(arguments,0,n-1),e=s,s&&Gt(s)&&("type"in s||s instanceof K)&&(t.push(s),e=!1),this.addGeometry(t,e)}this._initCache();var h;e&&(h=new st),this._toSort=this._maxZIndex>0;for(var u=[],l=0,f=t.length;l<f;l++){var c=t[l];if(!c)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+l);if(!(c instanceof K)&&(c=K.fromJSON(c),Array.isArray(c)))for(var d=0,g=c.length;d<g;d++)this._add(c[d],h,l),u.push(c[d]);Array.isArray(c)||(this._add(c,h,l),u.push(c))}var v=this.getMap();if(v&&(this._getRenderer().onGeometryAdd(u),h&&!C(h.xmin))){var m=h.getCenter(),_=v.getFitZoom(h);if(Gt(e)){var p=nt(e.step)?e.step:function(){};v.animateTo({center:m,zoom:_},H({duration:v.options.zoomAnimationDuration,easing:"out"},e),p)}else e===!0&&v.setCenterAndZoom(m,_)}return this.fire("addgeo",{geometries:t}),this},i.getGeoMinZIndex=function(){return this._minZIndex},i.getGeoMaxZIndex=function(){return this._maxZIndex},i._add=function(t,e,n){this._toSort||(this._toSort=t.getZIndex()!==0),this._updateZIndex(t.getZIndex());var s=t.getId();if(!C(s)){if(!C(this._geoMap[s]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+s+", at index:"+n);this._geoMap[s]=t}var h=Ce();t._setInternalId(h),this._geoList.push(t),this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(t)},i.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof K||(t[e]=this.getGeometryById(t[e])),!(!t[e]||this!==t[e].getLayer())&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},i.clear=function(){this._clearing=!0,this.forEach(function(n){n.remove()}),this._geoMap={};var t=this._geoList;this._geoList=[];var e=this._getRenderer();return e&&(e.onGeometryRemove(t),e.clearImageData&&e.clearImageData()),this._clearing=!1,this.fire("clear"),this},i.onRemoveGeometry=function(t){if(!(!t||this._clearing)&&this===t.getLayer()){var e=t._getInternalId();if(!C(e)){var n=t.getId();C(n)||delete this._geoMap[n];var s=this._findInList(t);s>=0&&this._geoList.splice(s,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}}},i.getStyle=function(){return this.options.style?this.options.style:null},i.setStyle=function(t){return this.options.style=t,t=Ts(t),this._cookedStyles=xs(t),this.forEach(function(e){this._styleGeometry(e)},this),this.fire("setstyle",{style:t}),this},i._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=bn(t),n=0,s=this._cookedStyles.length;n<s;n++)if(this._cookedStyles[n].filter(e)===!0)return t._setExternSymbol(this._cookedStyles[n].symbol),!0;return!1},i.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach(function(t){t._setExternSymbol(null)},this),this.fire("removestyle"),this):this},i.onAddGeometry=function(t){var e=this.getStyle();e&&this._styleGeometry(t)},i.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return At.prototype.hide.call(this)},i._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},i._updateZIndex=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,e)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,e))},i._sortGeometries=function(){var t=this;!this._toSort||(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort(function(e,n){return t._updateZIndex(e.getZIndex(),n.getZIndex()),t._compare(e,n)}),this._toSort=!1)},i._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},i._findInList=function(t){var e=this._geoList.length;if(e===0)return-1;this._sortGeometries();for(var n=0,s=e-1,h;n<=s;){if(h=Math.floor((n+s)/2),this._geoList[h]===t)return h;this._compare(this._geoList[h],t)>0?s=h-1:n=h+1}return-1},i._onGeometryEvent=function(t){if(!(!t||!t.target)){var e=t.type;e==="idchange"?this._onGeometryIdChange(t):e==="zindexchange"?this._onGeometryZIndexChange(t):e==="positionchange"?this._onGeometryPositionChange(t):e==="shapechange"?this._onGeometryShapeChange(t):e==="symbolchange"?this._onGeometrySymbolChange(t):e==="show"?this._onGeometryShow(t):e==="hide"?this._onGeometryHide(t):e==="propertieschange"&&this._onGeometryPropertiesChange(t)}},i._onGeometryIdChange=function(t){if(!(t.new===t.old&&this._geoMap[t.old]&&this._geoMap[t.old]===t.target)){if(!C(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}!C(t.old)&&t.new!==t.old&&delete this._geoMap[t.old]}},i._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},i._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},i._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},i._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},i._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},i._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},i._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},a}(At);Ph.mergeOptions(Pf);var Mf=new Y,Tf={debug:!1,enableSimplify:!0,geometryEvents:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:q.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,geometryEventTolerance:1},$t=function(o){z(a,o);function a(r,t,e){return o.call(this,r,t,e)||this}var i=a.prototype;return i.onConfig=function(t){if(o.prototype.onConfig.call(this,t),t.enableAltitude||t.drawAltitude||t.altitudeProperty){var e=this.getRenderer();e&&e.setToRedraw&&e.setToRedraw()}},i.identify=function(t,e){e===void 0&&(e={});var n=this.getRenderer();t instanceof k||(t=new k(t));var s=this.getMap().coordToContainerPoint(t);return e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(s,e):this._hitGeos(this._geoList,s,e)},i.identifyAtPoint=function(t,e){e===void 0&&(e={});var n=this.getRenderer();return t instanceof S||(t=new S(t)),e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(t,e):this._hitGeos(this._geoList,t,e)},i._hitGeos=function(t,e,n){n===void 0&&(n={});var s=n.filter,h=[],u=n.tolerance,l=this.getMap(),f=this.getRenderer(),c=f&&f.getImageData&&f.getImageData();if(c){for(var d=0,g=t.length-1;g>=0;g--){var v=t[g]._hitTestTolerance()+(u||0);v>d&&(d=v)}var m=l.getDevicePixelRatio();c.r=m;for(var _=!1,p=e.x-d,y=e.y-d,x=-d;x<=d;x++){for(var M=-d;M<=d;M++){var w=Math.round((p+x)*m),b=Math.round((y+M)*m),T=b*c.width*4+w*4;if(c.data[T+3]>0){_=!0;break}}if(_)break}if(!_)return h}for(var P=t.length-1;P>=0;P--){var O=t[P];if(!(!O||!O.isVisible()||!O._getPainter()||!O.options.interactive)){if(!(O instanceof dt)||!O._getArrowStyle()&&!(O instanceof Ai)){var I=O.getContainerExtent(Mf);if(u&&(I=I._expand(u)),!I||!I.contains(e))continue}if(O._containsPoint(e,u)&&(!s||s(O))&&(h.push(O),n.count&&h.length>=n.count))break}}return h},i.getAltitude=function(){return this.options.altitude||0},i.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if(C(t.geometries)||t.geometries){var n;if(t.clipExtent){var s=this.getMap(),h=s?s.getProjection():null;n=new st(t.clipExtent,h)}for(var u=[],l=this.getGeometries(),f=0,c=l.length;f<c;f++){var d=l[f],g=d.getExtent();if(!(!g||n&&!n.intersects(g))){var v=d.toJSON(t.geometries);u.push(v)}}e.geometries=u}return e},a.fromJSON=function(t){if(!t||t.type!=="VectorLayer")return null;for(var e=new a(t.id,t.options),n=t.geometries,s=[],h=0;h<n.length;h++){var u=K.fromJSON(n[h]);u&&s.push(u)}return e.addGeometry(s),e},a.getPainterClass=function(){return fa},a.getCollectionPainterClass=function(){return ch},a}(Ph);$t.mergeOptions(Tf);$t.registerJSONType("VectorLayer");var Yi="_map_tool",So=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.addTo=function(t){return t?(this._map=t,t[Yi]&&t[Yi].disable(),this.onAdd&&this.onAdd(),this.enable(),t[Yi]=this,this._fireEvent("add"),this):this},i.getMap=function(){return this._map},i.enable=function(){var t=this._map;return!t||this._enabled?this:(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable"),this)},i.disable=function(){return!this._enabled||!this._map?this:(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this)},i.isEnabled=function(){return!!this._enabled},i.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[Yi],delete this._map),this._fireEvent("remove"),this):this},i._registerEvents=function(){this._switchEvents("on")},i._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},i._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},a}(oe(Nt)),Sf={symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1},bo={},Mt=function(o){z(a,o),a.registerMode=function(t,e){bo[t.toLowerCase()]=e},a.getRegisterMode=function(t){return bo[t.toLowerCase()]};function a(r){var t;return t=o.call(this,r)||this,t._checkMode(),t._events={click:t._clickHandler,"mousemove touchmove":t._mouseMoveHandler,dblclick:t._doubleClickHandler,"mousedown touchstart":t._mouseDownHandler,"mouseup touchend":t._mouseUpHandler,mousemove:t._mouseMoveHandler,mousedown:t._mouseDownHandler,mouseup:t._mouseUpHandler},t}var i=a.prototype;return i.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},i.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},i.getSymbol=function(){var t=this.options.symbol;return Wt(t||this.options.symbol)},i.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},i.getCurrentGeometry=function(){return this._geometry},i.onAdd=function(){this._checkMode()},i.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var t=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})),this._geometryEvents=t.options.geometryEvents,this.options.blockGeometryEvents&&t.config("geometryEvents",!1),this},i.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw(),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&t.config("geometryEvents",this._geometryEvents),this},i.undo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||!this._historyPointer)return this;var n=this._clickCoords.slice(0,--this._historyPointer);return t.update(this.getMap().getProjection(),n,this._geometry),this},i.redo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||C(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var n=this._clickCoords.slice(0,++this._historyPointer);return t.update(this.getMap().getProjection(),n,this._geometry),this},i._shouldRecordHistory=function(t){return Array.isArray(t)&&t[0]==="click"&&t[1]==="mousemove"&&t[2]==="dblclick"},i._checkMode=function(){this._getRegisterMode()},i._saveMapCfg=function(){var t=this.getMap();this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom});for(var e=this._getRegisterMode().action,n=!1,s=0;s<e.length;s++)if(e[s].indexOf("mousedown")>=0||e[s].indexOf("touchstart")>=0){n=!0;break}if(n){var h=this.getMap();this._mapDraggable=h.options.draggable,h.config({draggable:!1})}},i._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),C(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},i._loadResources=function(){var t=this.getSymbol(),e=bi(t);e.length>0&&this._drawToolLayer._getRenderer().loadResources(e)},i._getProjection=function(){return this._map.getProjection()},i._getRegisterMode=function(){var t=this.getMode(),e=a.getRegisterMode(t);if(!e)throw new Error(t+" is not a valid mode of DrawTool.");return e},i.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var n=0;n<t.length;n++)e[t[n]]=this._events[t[n]];return e}return null},i._mouseDownHandler=function(t){this._createGeometry(t)},i._mouseUpHandler=function(t){this.endDraw(t)},i._clickHandler=function(t){var e=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var n=this._clickCoords.length,s=this.getMap()._pointToPrj(t.point2d);if(this._clickCoords[n-1].equals(s))return}if(!this._geometry)this._createGeometry(t);else{var h=this.getMap()._pointToPrj(t.point2d),u=this._geometry.snapTo;if(u&&nt(u)){var l=this._geometry.snapTo(t.containerPoint)||t.containerPoint;h=this.getMap()._containerPointToPrj(l)}if(C(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer)),this._clickCoords.push(h),this._historyPointer=this._clickCoords.length,t.drawTool=this,e.update(this.getMap().getProjection(),this._clickCoords,this._geometry,t),this.getMode()==="point"){this.endDraw(t);return}this._clickCoords.length<=1?this._fireEvent("drawstart",t):this._fireEvent("drawvertex",t),e.clickLimit&&e.clickLimit===this._historyPointer&&this.endDraw(t)}},i._createGeometry=function(t){var e=this.getMode(),n=this._getRegisterMode(),s=this.getMap()._pointToPrj(t.point2d),h=this.getSymbol();this._geometry||(this._clickCoords=[s],t.drawTool=this,this._geometry=n.create(this.getMap().getProjection(),this._clickCoords,t),h&&e!=="point"?this._geometry.setSymbol(h):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t)),e==="point"&&t.type!=="mousemove"&&this.endDraw(t)},i._mouseMoveHandler=function(t){var e=this.getMap();if(!(!e||e.isInteracting())){if(this.getMode()==="point"&&!this._geometry){this._createGeometry(t);return}if(!!this._geometry){var n=this._getMouseContainerPoint(t);if(!!this._isValidContainerPoint(n)){var s=this.getMap()._pointToPrj(t.point2d);this._geometry.snapTo&&(n=this._geometry.snapTo(n)||n,s=e._containerPointToPrj(n));var h=e.getProjection();t.drawTool=this;var u=this._getRegisterMode();if(this._shouldRecordHistory(u.action)){var l=this._clickCoords.slice(0,this._historyPointer);if(l&&l.length>0&&s.equals(l[l.length-1]))return;u.update(h,l.concat([s]),this._geometry,t)}else u.update(h,s,this._geometry,t);this._fireEvent("mousemove",t)}}}},i._doubleClickHandler=function(t){if(!!this._geometry){var e=this._getMouseContainerPoint(t);if(!!this._isValidContainerPoint(e)){var n=this._getRegisterMode(),s=this._clickCoords;if(!(s.length<2)){var h=this.getMode();if(!(h&&h.indexOf("polygon")>-1&&s.length<3)){for(var u=this.getMap().getProjection(),l=[s[0]],f=1,c=s.length;f<c;f++)(s[f].x!==s[f-1].x||s[f].y!==s[f-1].y)&&l.push(s[f]);l.length<2||this._geometry&&this._geometry instanceof mt&&l.length<3||(t.drawTool=this,n.update(u,l,this._geometry,t),this.endDraw(t))}}}}},i._addGeometryToStage=function(t){var e=this._getDrawLayer();e.addGeometry(t)},i.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},i._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},i._getMouseContainerPoint=function(t){var e=this._getRegisterMode().action;return(e[0].indexOf("mousedown")>=0||e[0].indexOf("touchstart")>=0)&&Lt(t.domEvent),t.containerPoint},i._isValidContainerPoint=function(t){var e=this._map.getSize(),n=e.width,s=e.height;return t.x<0||t.y<0?!1:!(t.x>n||t.y>s)},i._getDrawLayer=function(){var t=Si+"drawtool",e=this._map.getLayer(t);return e||(e=new $t(t,{enableSimplify:!1,enableAltitude:this.options.enableAltitude}),this._map.addLayer(e)),e},i._fireEvent=function(t,e){e||(e={}),e=H({},e),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),e.tempGeometry=this._geometry),So.prototype._fireEvent.call(this,t,e)},a}(So);Mt.mergeOptions(Sf);var bf=function(o){z(a,o);function a(r){var t;return t=o.call(this,r)||this,t.drawTool=new Mt({mode:"boxZoom",ignoreMouseleave:!1}),t}var i=a.prototype;return i.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},i.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},i._onMouseDown=function(t){!this.target.options.boxZoom||t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},i._boxZoom=function(t){var e=this.target;this.drawTool.remove();var n=t.geometry,s=n.getCenter(),h=n.getSymbol(),u=h.markerWidth,l=h.markerHeight,f=new st(s,e.locateByPoint(s,u,l),e.getProjection()),c=e.getFitZoom(f);e._animateTo({center:f.getCenter(),zoom:c})},a}(Ut);U.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}});U.addOnLoadHook("addHandler","boxZoom",bf);var ue=30,Ef=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.addHooks=function(){!this.target||this.target.on("_mousemove",this._onMouseMove,this)},i.removeHooks=function(){!this.target||this.target.off("_mousemove",this._onMouseMove,this)},i._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var n=t.containerPoint,s=e.getContainerExtent();if(s){var h=n.x,u=n.y,l=s.xmax,f=s.ymax,c;h<ue&&(c=[Math.abs(h-ue),0]),u<ue&&(c=[0,Math.abs(u-ue)]),h+ue>l&&(c=[-Math.abs(h+ue-l),0]),u+ue>f&&(c=[0,-Math.abs(u+ue-f)]),c&&e.panBy(c,{duration:1})}}},a}(Ut);U.mergeOptions({autoPanAtEdge:!1});U.addOnLoadHook("addHandler","autoPanAtEdge",Ef);U.include({animateTo:function(a,i,r){var t=this;i===void 0&&(i={}),nt(i)&&(r=i,i={});var e=this.getProjection(),n=this.getView(),s={},h=!0;for(var u in a)if(Xe(a,u)&&!C(a[u])&&(u==="prjCenter"||!C(n[u])))if(h=!1,u==="center"){var l=new k(n[u]),f=new k(a[u]);l.equals(f)||(s.center=[l,f])}else if(u==="prjCenter"){var c=new k(this._getPrjCenter()),d=new k(a[u]);c.equals(d)||(s.prjCenter=[c,d])}else n[u]!==a[u]&&u!=="around"&&(s[u]=[n[u],a[u]]);if(h)return null;this._animPlayer&&(this._isInternalAnimation?this._animPlayer.playState==="running"&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var g=a.around||new S(this.width/2,this.height/2),v=this._getRenderer(),m=function(y){v.callInNextFrame(y)},_=this._animPlayer=Pt.animate(s,{easing:i.easing||"out",duration:i.duration||this.options.zoomAnimationDuration,framer:m,repeat:i.repeat},function(p){if(t.isRemoved()){_.finish();return}if(_.playState==="running"){if(p.styles.center){var y=p.styles.center;t._setPrjCenter(e.project(y)),t.onMoving(t._parseEventFromCoord(t.getCenter()))}else if(p.styles.prjCenter){var x=p.styles.prjCenter;t._setPrjCenter(x),t.onMoving(t._parseEventFromCoord(t.getCenter()))}C(p.styles.zoom)||t.onZooming(p.styles.zoom,g),C(p.styles.pitch)||t._setPitch(p.styles.pitch),C(p.styles.bearing)||t._setBearing(p.styles.bearing),t._fireEvent("animating")}else(_.playState!=="paused"||_===t._mapAnimPlayer)&&(_._interupted||(s.center?t._setPrjCenter(e.project(s.center[1])):s.prjCenter&&t._setPrjCenter(s.prjCenter[1]),C(s.pitch)||t._setPitch(s.pitch[1]),C(s.bearing)||t._setBearing(s.bearing[1])),t._endAnim(_,s,g,i));r&&r(p)},this);return this._startAnim(s,g),_},_animateTo:function(a,i,r){return i===void 0&&(i={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(a,i,r),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(a,i,r){var t=this;i===void 0&&(i={}),this._animPlayer&&(this._isInternalAnimation?this._animPlayer.playState==="running"&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),nt(i)&&(r=i,i={}),i=H({curve:1.42},i);var e=this;function n(X,tt){return e.getResolution(tt)/e.getResolution(X)}var s=a.around||new S(this.width/2,this.height/2),h=this.getMinZoom(),u=this.getMaxZoom(),l=this.getProjection(),f=this.getView(),c=f.zoom,d=f.bearing,g=f.pitch,v="zoom"in a?sr(+a.zoom,h,u):c,m="bearing"in a?+a.bearing:d,_="pitch"in a?+a.pitch:g,p=l.project(a.center&&new k(a.center)||this.getCenter()),y=n(v,c),x=l.project(this.getCenter()),M=p.sub(x),w=i.curve,b=Math.max(this.width,this.height),T=b/y,P=M.mag();if("minZoom"in i){var O=sr(Math.min(i.minZoom,c,v),h,u),I=b/n(O,c);w=Math.sqrt(I/P*2)}var E=w*w;function D(X){var tt=(T*T-b*b+(X?-1:1)*E*E*P*P)/(2*(X?T:b)*E*P);return Math.log(Math.sqrt(tt*tt+1)-tt)}function R(X){return(Math.exp(X)-Math.exp(-X))/2}function A(X){return(Math.exp(X)+Math.exp(-X))/2}function G(X){return R(X)/A(X)}var F=D(0),j=function(tt){return A(F)/A(F+w*tt)},Z=function(tt){return b*((A(F)*G(F+w*tt)-R(F))/E)/P},V=(D(1)-F)/w;if(Math.abs(P)<1e-6||!isFinite(V)){if(Math.abs(b-T)<1e-6)return this.animateTo(a,i,r);var J=T<b?-1:1;V=Math.abs(Math.log(T/b))/w,Z=function(){return 0},j=function(tt){return Math.exp(J*w*tt)}}var ot=this._getRenderer(),ft=function(tt){ot.callInNextFrame(tt)},et=this._animPlayer=Pt.animate({k:[0,1]},{easing:i.easing||"out",duration:i.duration||8,framer:ft},function(X){if(t.isRemoved()){et.finish();return}var tt=X.styles.k,it=tt*V,bt=1/j(it),Q={};if(a.center){var wt=tt===1?p:x.add(M.multi(Z(it)));Q.prjCenter=[p,wt]}if(c!==v){var Ot=tt===1?v:t.getZoomForScale(bt,c,!0);Q.zoom=[c,Ot]}if(g!==_){var ht=Eo(g,_,tt);Q.pitch=[_,ht]}if(d!==m){var Tt=Eo(d,m,tt);Q.bearing=[m,Tt]}if(et.playState==="running"){if(Q.prjCenter){var zt=Q.prjCenter;t._setPrjCenter(zt[1]),t.onMoving(t._parseEventFromCoord(t.getCenter()))}Q.zoom&&t.onZooming(Q.zoom[1],s),Q.pitch&&t._setPitch(Q.pitch[1]),Q.bearing&&t._setBearing(Q.bearing[1]),t._fireEvent("animating")}else(et.playState!=="paused"||et===t._mapAnimPlayer)&&(et._interupted||(Q.prjCenter&&t._setPrjCenter(Q.prjCenter[1]),Q.pitch&&t._setPitch(Q.pitch[1]),Q.bearing&&t._setBearing(Q.bearing[1])),t._endAnim(et,Q,s,i));r&&r(X)});return this._startAnim({center:a.center,zoom:a.zoom!==c,pitch:_!==g,bearing:m!==d},s),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(a,i,r,t){delete this._animRotating;var e=a._interupted?"animateinterrupted":"animateend";if(a===this._animPlayer&&delete this._animPlayer,a===this._mapAnimPlayer&&delete this._mapAnimPlayer,i.center){var n;a._interupted?n=this.getCenter():n=i.center[1],this.onMoveEnd(this._parseEventFromCoord(n))}else if(i.prjCenter){var s;a._interupted?s=this._getPrjCenter():s=i.prjCenter[1];var h=this._parseEventFromCoord(this.getProjection().unproject(s));h.point2d=this._prjToPoint(s),this.onMoveEnd(h)}C(i.zoom)||(a._interupted?this.onZoomEnd(this.getZoom(),r):t.wheelZoom?this.onZooming(i.zoom[1],r):this.onZoomEnd(i.zoom[1],r)),e&&this._fireEvent(e),!C(i.pitch)&&!this.getPitch()&&this.getRenderer().setToRedraw(),t.wheelZoom||this._resumePrev(a)},_startAnim:function(a,i){!this._animPlayer||(a.center&&this.onMoveStart(),a.zoom&&!this.isZooming()&&this.onZoomStart(a.zoom[1],i),(a.pitch||a.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(a){!a||(delete this._animRotating,a.playState!=="finished"&&(a._interupted=!0,a.cancel()),a===this._animPlayer&&delete this._animPlayer,a===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(a){if(!!this._prevAnimPlayer){var i=this._prevAnimPlayer;i.playState!=="paused"&&delete this._prevAnimPlayer,a!==i&&(this._animPlayer=i,i.play())}}});function Eo(o,a,i){return o*(1-i)+a*i}var Ro="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";U.include({_registerDomEvents:function(){var a=this._panels.mapWrapper||this._containerDOM;re(a,Ro,this._handleDOMEvent,this)},_removeDomEvents:function(){var a=this._panels.mapWrapper||this._containerDOM;Pe(a,Ro,this._handleDOMEvent)},_handleDOMEvent:function(a){var i=this.options.clickTimeThreshold,r=a.type,t=r==="mousedown"||r==="touchstart"&&(!a.touches||a.touches.length===1);t&&(this._domMouseDownTime=lt(),this._domMouseDownView=this.getView());var e=r==="contextmenu"&&Rf(this);if(r==="contextmenu"){It(a);var n=this._domMouseDownTime,s=lt();s-n<=i&&!e&&this._fireDOMEvent(this,a,"dom:"+a.type)}else this._fireDOMEvent(this,a,"dom:"+a.type);if(!this._ignoreEvent(a)){var h=!1;if(t)this._mouseDownTime=lt();else if(r==="click"||r==="touchend"||r==="contextmenu")if(this._mouseDownTime){var u=this._mouseDownTime;delete this._mouseDownTime;var l=lt();if(l-u>i){if(r==="click"||r==="contextmenu")return}else if(r==="contextmenu"){if(e)return}else r==="touchend"&&(h=!0)}else return;var f;h&&(this._clickTime&&lt()-this._clickTime<=i?(delete this._clickTime,f="dblclick",this._fireDOMEvent(this,a,"dom:dblclick")):(this._clickTime=lt(),f="click",this._fireDOMEvent(this,a,"dom:click"))),!this._ignoreEvent(a)&&(this._fireDOMEvent(this,a,r),f&&this._fireDOMEvent(this,a,f))}},_ignoreEvent:function(a){if(!a||!this._panels.control)return!1;if(this._isEventOutMap(a))return!0;var i=a.srcElement||a.target,r;if(i)for(;i&&i!==this._containerDOM;){if(i.className&&i.className.indexOf&&(i.className.indexOf("maptalks-control")>=0||i.className.indexOf("maptalks-ui")>=0&&r&&!r.eventsPropagation))return!0;r=i,i=i.parentNode}return!1},_isEventOutMap:function(a){if(this.getPitch()>this.options.maxVisualPitch){var i=this._getActualEvent(a),r=Et(i,this._containerDOM);if(!this.getContainerExtent().contains(r))return!0}return!1},_parseEvent:function(a,i){if(!a)return null;var r={domEvent:a};if(i!=="keypress"){var t=this._getActualEvent(a);if(t&&t.clientX!==void 0){var e=Et(t,this._containerDOM);r=H(r,{containerPoint:e,viewPoint:this.containerPointToViewPoint(e)});var n=this.options.maxVisualPitch;(this.getPitch()<=n||e.y>=this.height-this._getVisualHeight(n))&&(r=H(r,{coordinate:this.containerPointToCoord(e),point2d:this._containerPointToPoint(e)}))}}return r},_parseEventFromCoord:function(a){var i=this.coordToContainerPoint(a),r=this.containerPointToViewPoint(i),t={coordinate:a,containerPoint:i,viewPoint:r,point2d:this.coordToPoint(a)};return t},_getActualEvent:function(a){return a.touches&&a.touches.length>0?a.touches[0]:a.changedTouches&&a.changedTouches.length>0?a.changedTouches[0]:a},_fireDOMEvent:function(a,i,r){if(!this.isRemoved()){var t=this._parseEvent(i,r);this._fireEvent(r,t)}},_getEventParams:function(a){var i=this,r={domEvent:a},t=a.touches&&a.touches.length>0?a.touches[0]:a.changedTouches&&a.changedTouches.length>0?a.changedTouches[0]:a;if(t){var e=Et(t,i._containerDOM);r.coordinate=i.containerPointToCoordinate(e),r.containerPoint=e,r.viewPoint=i.containerPointToViewPoint(e),r.pont2d=i._containerPointToPoint(e)}return r}});U.addOnLoadHook("_registerDomEvents");function Rf(o){if(!o._domMouseDownView)return!0;var a=o.getView(),i=o._domMouseDownView;return a.bearing!==i.bearing||a.pitch!==i.pitch}U.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(a){return this._fireEvent("fullscreenstart"),this._requestFullScreen(a||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(a){if(a.requestFullscreen)a.requestFullscreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else if(a.webkitRequestFullScreen)a.webkitRequestFullScreen();else if(a.msRequestFullScreen)a.msRequestFullScreen();else{var i="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45),r=window.open(location.href,"_blank",i);r!==null&&(window.opener=null,window.close())}},_cancelFullScreen:function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else{var a="fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes",i=window.open(location.href,"_blank",a);i!==null&&(window.opener=null,window.close())}}});U.include({panTo:function(a,i,r){if(i===void 0&&(i={}),!a)return this;if(nt(i)&&(r=i,i={}),a=new k(a),typeof i.animation>"u"||i.animation){var t=this.getProjection().project(a);return this._panAnimation(t,i.duration,r)}else this.setCenter(a);return this},_panTo:function(a,i){return i===void 0&&(i={}),typeof i.animation>"u"||i.animation?this._panAnimation(a,i.duration):(this.onMoveStart(),this._setPrjCenter(a),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(a,i,r){if(i===void 0&&(i={}),!a)return this;nt(i)&&(r=i,i={}),a=new S(a);var t=this.getContainerExtent(),e=t.ymin;if(e>0&&a.y>30){var n=a.y;a.y=30,a.x=a.x*30/n}if(this.onMoveStart(),typeof i.animation>"u"||i.animation){a=a.multi(-1);var s=this._containerPointToPrj(new S(this.width/2+a.x,this.height/2+a.y));this._panAnimation(s,i.duration,r)}else this._offsetCenterByPixel(a),this.onMoveEnd(this._parseEventFromCoord(this.getCenter()));return this},_panAnimation:function(a,i,r){return this._animateTo({prjCenter:a},{duration:i||this.options.panAnimationDuration},r)}});K.fromJSON=function(o){if(Array.isArray(o)){for(var a=[],i=0,r=o.length;i<r;i++){var t=K.fromJSON(o[i]);Array.isArray(o)?a=a.concat(t):a.push(t)}return a}if(o&&!o.feature)return ve.toGeometry(o);var e;return o.subType?(e=K.getJSONClass(o.subType).fromJSON(o),C(o.feature.id)||e.setId(o.feature.id)):(e=ve.toGeometry(o.feature),o.options&&e.config(o.options)),o.symbol&&e.setSymbol(o.symbol),o.infoWindow&&e.setInfoWindow(o.infoWindow),e};At.fromJSON=function(o){if(!o)return null;var a=o.type,i=At.getJSONClass(a);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+a);return i.fromJSON(o)};U.include({JSON_VERSION:"1.0",toJSON:function(a){a||(a={});var i={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};i.options=this.config(),i.options.center=this.getCenter(),i.options.zoom=this.getZoom(),i.options.bearing=this.getBearing(),i.options.pitch=this.getPitch();var r=this.getBaseLayer();(C(a.baseLayer)||a.baseLayer)&&r&&(i.baseLayer=r.toJSON(a.baseLayer));var t={};a.clipExtent&&(a.clipExtent===!0?t.clipExtent=this.getExtent():t.clipExtent=a.clipExtent);var e=[];if(C(a.layers)||a.layers&&!Array.isArray(a.layers)){for(var n=this.getLayers(),s=0,h=n.length;s<h;s++)if(!!n[s].toJSON){var u=H({},Gt(a.layers)?a.layers:{},t);e.push(n[s].toJSON(u))}i.layers=e}else if(rt(a.layers)){for(var l=a.layers,f=0;f<l.length;f++){var c=l[f],d=this.getLayer(c.id);if(!!d.toJSON){var g=H({},c.options,t);e.push(d.toJSON(g))}}i.layers=e}else i.layers=[];return i}});U.fromJSON=function(o,a,i){if(!o||!a)return null;i||(i={});var r=new U(o,a.options);if(C(i.baseLayer)||i.baseLayer){var t=At.fromJSON(a.baseLayer);t&&r.setBaseLayer(t)}if(C(i.layers)||i.layers){for(var e=[],n=a.layers,s=0;s<n.length;s++){var h=At.fromJSON(n[s]);e.push(h)}r.addLayer(e)}return r};U.include({computeLength:function(a,i){if(!this.getProjection())return null;var r=new k(a),t=new k(i);return r.equals(t)?0:this.getProjection().measureLength(r,t)},computeGeometryLength:function(a){return a._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(a){return a._computeGeodesicArea(this.getProjection())},identify:function(a,i){a=a||{};var r=new k(a.coordinate);return this._identify(a,i,function(t){return t.identify(r,a)})},identifyAtPoint:function(a,i){a=a||{};var r=new S(a.containerPoint),t=this.containerPointToCoord(r);return this._identify(a,i,function(e){return e.identifyAtPoint?e.identifyAtPoint(r,a):t?e.identify(t,a):[]})},_identify:function(a,i,r){var t=a.layers;if(!rt(t))return this;for(var e=[],n=0,s=t.length;n<s;n++)$(t[n])?e.push(this.getLayer(t[n])):e.push(t[n]);for(var h=[],u=e.length-1;u>=0&&!(a.count&&h.length>=a.count);u--){var l=e[u];if(!(!l||!l.getMap()||!a.includeInvisible&&!l.isVisible()||!a.includeInternals&&l.getId().indexOf(Si)>=0)){var f=r(l);f&&(Array.isArray(f)?ke(h,f):h.push(f))}}return i.call(this,h),this}});U.include({_zoom:function(a,i){!this.options.zoomable||this.isZooming()||(i=this._checkZoomOrigin(i),a=this._checkZoom(a),this.onZoomStart(a,i),this._frameZoom=this.getZoom(),this.onZoomEnd(a,i))},_zoomAnimation:function(a,i,r){!this.options.zoomable||this.isZooming()||(a=this._checkZoom(a),this.getZoom()!==a&&(i=this._checkZoomOrigin(i),this._startZoomAnim(a,i,r)))},_checkZoomOrigin:function(a){return(!a||this.options.zoomInCenter)&&(a=new S(this.width/2,this.height/2)),this.options.zoomOrigin&&(a=new S(this.options.zoomOrigin)),a},_startZoomAnim:function(a,i,r){C(r)&&(r=1);var t=this._getResolution(this._startZoomVal)/this._getResolution(a),e=this.options.zoomAnimationDuration*Math.abs(t-r)/Math.abs(t-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:a,around:i},{continueOnViewChanged:!0,duration:e})},onZoomStart:function(a,i){!this.options.zoomable||this.isZooming()||(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(i),this._fireEvent("zoomstart",{from:this._startZoomVal,to:a}))},onZooming:function(a,i,r){if(!!this.options.zoomable){var t=this._frameZoom;if(t!==a){C(r)&&(r=1),this._zoomTo(a,i);var e=this.getResolution(a),n=this.getResolution(this._startZoomVal),s=n/e/r,h=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),u=this.getViewPoint();if(!this.isRotating()&&!h.equals(i)&&s!==1){var l=this.getPitch(),f=h._sub(i)._multi(1/(1-s));l&&(f.y/=Math.cos(l*Math.PI/180)),i=i.add(f)}var c={view:[s,0,0,s,(i.x-u.x)*(1-s),(i.y-u.y)*(1-s)]},d=this.getDevicePixelRatio();d!==1&&(i=i.multi(d)),c.container=[s,0,0,s,i.x*(1-s),i.y*(1-s)],this._fireEvent("zooming",{from:this._startZoomVal,to:a,origin:i,matrix:c}),this._frameZoom=a}}},onZoomEnd:function(a,i){if(!!this.options.zoomable){var r=this._startZoomVal;this._zoomTo(a,i),this._zooming=!1,this._getRenderer().onZoomEnd(),this._fireEvent("zoomend",{from:r,to:a}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(a,i){this._zoomLevel=a,this._calcMatrices(),i&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,i)},_checkZoom:function(a){var i=this.getMaxZoom(),r=this.getMinZoom();return a<r&&(a=r),a>i&&(a=i),a}});function Ao(o,a,i,r,t){var e=1/Math.tan(a/2),n=1/(r-t);return o[0]=e/i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(t+r)*n,o[11]=-1,o[12]=0,o[13]=0,o[14]=2*t*r*n,o[15]=0,o}function Mh(o,a,i){var r=i[0],t=i[1],e=i[2],n,s,h,u,l,f,c,d,g,v,m,_;return a===o?(o[12]=a[0]*r+a[4]*t+a[8]*e+a[12],o[13]=a[1]*r+a[5]*t+a[9]*e+a[13],o[14]=a[2]*r+a[6]*t+a[10]*e+a[14],o[15]=a[3]*r+a[7]*t+a[11]*e+a[15]):(n=a[0],s=a[1],h=a[2],u=a[3],l=a[4],f=a[5],c=a[6],d=a[7],g=a[8],v=a[9],m=a[10],_=a[11],o[0]=n,o[1]=s,o[2]=h,o[3]=u,o[4]=l,o[5]=f,o[6]=c,o[7]=d,o[8]=g,o[9]=v,o[10]=m,o[11]=_,o[12]=n*r+l*t+g*e+a[12],o[13]=s*r+f*t+v*e+a[13],o[14]=h*r+c*t+m*e+a[14],o[15]=u*r+d*t+_*e+a[15]),o}function zn(o,a,i){var r=i[0],t=i[1],e=i[2];return o[0]=a[0]*r,o[1]=a[1]*r,o[2]=a[2]*r,o[3]=a[3]*r,o[4]=a[4]*t,o[5]=a[5]*t,o[6]=a[6]*t,o[7]=a[7]*t,o[8]=a[8]*e,o[9]=a[9]*e,o[10]=a[10]*e,o[11]=a[11]*e,o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o}function Af(o,a,i){var r=Math.sin(i),t=Math.cos(i),e=a[4],n=a[5],s=a[6],h=a[7],u=a[8],l=a[9],f=a[10],c=a[11];return a!==o&&(o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15]),o[4]=e*t+u*r,o[5]=n*t+l*r,o[6]=s*t+f*r,o[7]=h*t+c*r,o[8]=u*t-e*r,o[9]=l*t-n*r,o[10]=f*t-s*r,o[11]=c*t-h*r,o}function Of(o,a,i){var r=Math.sin(i),t=Math.cos(i),e=a[0],n=a[1],s=a[2],h=a[3],u=a[4],l=a[5],f=a[6],c=a[7];return a!==o&&(o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15]),o[0]=e*t+u*r,o[1]=n*t+l*r,o[2]=s*t+f*r,o[3]=h*t+c*r,o[4]=u*t-e*r,o[5]=l*t-n*r,o[6]=f*t-s*r,o[7]=c*t-h*r,o}function xi(o,a,i){var r=a[0],t=a[1],e=a[2],n=a[3],s=a[4],h=a[5],u=a[6],l=a[7],f=a[8],c=a[9],d=a[10],g=a[11],v=a[12],m=a[13],_=a[14],p=a[15],y=i[0],x=i[1],M=i[2],w=i[3];return o[0]=y*r+x*s+M*f+w*v,o[1]=y*t+x*h+M*c+w*m,o[2]=y*e+x*u+M*d+w*_,o[3]=y*n+x*l+M*g+w*p,y=i[4],x=i[5],M=i[6],w=i[7],o[4]=y*r+x*s+M*f+w*v,o[5]=y*t+x*h+M*c+w*m,o[6]=y*e+x*u+M*d+w*_,o[7]=y*n+x*l+M*g+w*p,y=i[8],x=i[9],M=i[10],w=i[11],o[8]=y*r+x*s+M*f+w*v,o[9]=y*t+x*h+M*c+w*m,o[10]=y*e+x*u+M*d+w*_,o[11]=y*n+x*l+M*g+w*p,y=i[12],x=i[13],M=i[14],w=i[15],o[12]=y*r+x*s+M*f+w*v,o[13]=y*t+x*h+M*c+w*m,o[14]=y*e+x*u+M*d+w*_,o[15]=y*n+x*l+M*g+w*p,o}function Oo(o,a){var i=a[0],r=a[1],t=a[2],e=a[3],n=a[4],s=a[5],h=a[6],u=a[7],l=a[8],f=a[9],c=a[10],d=a[11],g=a[12],v=a[13],m=a[14],_=a[15],p=i*s-r*n,y=i*h-t*n,x=i*u-e*n,M=r*h-t*s,w=r*u-e*s,b=t*u-e*h,T=l*v-f*g,P=l*m-c*g,O=l*_-d*g,I=f*m-c*v,E=f*_-d*v,D=c*_-d*m,R=p*D-y*E+x*I+M*O-w*P+b*T;return R?(R=1/R,o[0]=(s*D-h*E+u*I)*R,o[1]=(t*E-r*D-e*I)*R,o[2]=(v*b-m*w+_*M)*R,o[3]=(c*w-f*b-d*M)*R,o[4]=(h*O-n*D-u*P)*R,o[5]=(i*D-t*O+e*P)*R,o[6]=(m*x-g*b-_*y)*R,o[7]=(l*b-c*x+d*y)*R,o[8]=(n*E-s*O+u*T)*R,o[9]=(r*O-i*E-e*T)*R,o[10]=(g*w-v*x+_*p)*R,o[11]=(f*x-l*w-d*p)*R,o[12]=(s*P-n*I-h*T)*R,o[13]=(i*I-r*P+t*T)*R,o[14]=(v*y-g*M-m*p)*R,o[15]=(l*M-f*y+c*p)*R,o):null}function va(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ko(o,a){return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o}function Ft(o,a,i,r){return o[0]=a,o[1]=i,o[2]=r,o}function kf(o,a,i){return o[0]=a[0]+i[0],o[1]=a[1]+i[1],o[2]=a[2]+i[2],o}function rr(o,a,i){return o[0]=a[0]-i[0],o[1]=a[1]-i[1],o[2]=a[2]-i[2],o}function Do(o){var a=o[0],i=o[1],r=o[2];return Math.sqrt(a*a+i*i+r*r)}function nr(o,a){var i=a[0],r=a[1],t=a[2],e=i*i+r*r+t*t;return e>0&&(e=1/Math.sqrt(e),o[0]=a[0]*e,o[1]=a[1]*e,o[2]=a[2]*e),o}function Df(o,a){return o[0]*a[0]+o[1]*a[1]+o[2]*a[2]}function Lf(o,a,i){return o[0]=a[0]*i,o[1]=a[1]*i,o[2]=a[2]*i,o}function _n(o,a,i){var r=a[0],t=a[1],e=a[2],n=i[0],s=i[1],h=i[2];return o[0]=t*h-e*s,o[1]=e*n-r*h,o[2]=r*s-t*n,o}function Pr(o,a){var i=a[0]-o[0],r=a[1]-o[1],t=a[2]-o[2];return Math.hypot?Math.hypot(i,r,t):zf(i,r,t)}function If(o,a,i){var r=a[0],t=a[1],e=a[2],n=i[3]*r+i[7]*t+i[11]*e+i[15];return n=n||1,o[0]=(i[0]*r+i[4]*t+i[8]*e+i[12])/n,o[1]=(i[1]*r+i[5]*t+i[9]*e+i[13])/n,o[2]=(i[2]*r+i[6]*t+i[10]*e+i[14])/n,o}function zf(){for(var o=0,a=arguments.length;a--;)o+=arguments[a]*arguments[a];return Math.sqrt(o)}function pn(o,a,i){var r=a[0],t=a[1],e=a[2],n=1/(i[3]*r+i[7]*t+i[11]*e+i[15]);return o[0]=(i[0]*r+i[4]*t+i[8]*e+i[12])*n,o[1]=(i[1]*r+i[5]*t+i[9]*e+i[13])*n,o[2]=(i[2]*r+i[6]*t+i[10]*e+i[14])*n,o}function jf(o,a){var i=a[0],r=a[4],t=a[8],e=a[1],n=a[5],s=a[9],h=a[2],u=a[6],l=a[10],f=i+n+l,c;return f>0?(c=.5/Math.sqrt(f+1),o.w=.25/c,o.x=(u-s)*c,o.y=(t-h)*c,o.z=(e-r)*c):i>n&&i>l?(c=2*Math.sqrt(1+i-n-l),o.w=(u-s)/c,o.x=.25*c,o.y=(r+e)/c,o.z=(t+h)/c):n>l?(c=2*Math.sqrt(1+n-i-l),o.w=(t-h)/c,o.x=(r+e)/c,o.y=.25*c,o.z=(s+u)/c):(c=2*Math.sqrt(1+l-i-n),o.w=(e-r)/c,o.x=(t+h)/c,o.y=(s+u)/c,o.z=.25*c),this}function Hf(o,a){var i=o,r=a.x,t=a.y,e=a.z,n=a.w,s=r+r,h=t+t,u=e+e,l=r*s,f=r*h,c=r*u,d=t*h,g=t*u,v=e*u,m=n*s,_=n*h,p=n*u;return i[0]=1-(d+v),i[4]=f-p,i[8]=c+_,i[1]=f+p,i[5]=1-(l+v),i[9]=g-m,i[2]=c-_,i[6]=g+m,i[10]=1-(l+d),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ff(o,a){var i=o;return i[12]=a[0],i[13]=a[1],i[14]=a[2],o}function Gf(o,a,i,r){var t=[0,0,0],e=[0,0,0],n=[0,0,0];return rr(n,a,i),Do(n)===0&&(n[2]=1),nr(n,n),_n(t,r,n),Do(n)===0&&(Math.abs(r[2])===1?n[0]+=1e-4:n[2]+=1e-4,nr(n,n),_n(t,r,n)),nr(t,t),_n(e,n,t),o[0]=t[0],o[4]=e[0],o[8]=n[0],o[1]=t[1],o[5]=e[1],o[9]=n[1],o[2]=t[2],o[6]=e[2],o[10]=n[2],o}var le=Math.PI/180,Nf=.6435011087932844,Lo=new k(0,0);U.include({getFov:function(){return this._fov||(this._fov=Nf),this._fov/le},setFov:function(a){if(this.isZooming())return this;if(a=Math.max(.01,Math.min(60,a)),this._fov===a)return this;var i=this.getFov();return this._fov=a*le,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:i,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/le:0},setBearing:function(a){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(a)},_setBearing:function(a){if(q.ie9)throw new Error("map can't rotate in IE9.");var i=-ye(a,-180,180)*le;if(this._angle===i)return this;var r=this.getBearing();return this._fireEvent("rotatestart",{from:r,to:i}),this._angle=i,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:r,to:i}),this._fireEvent("rotateend",{from:r,to:i}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(a){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(a)},_setPitch:function(a){if(q.ie9)throw new Error("map can't tilt in IE9.");var i=sr(a,0,this.options.maxPitch)*le;if(this._pitch===i)return this;var r=this.getPitch();return this._fireEvent("pitchstart",{from:r,to:i}),this._pitch=i,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:r,to:i}),this._fireEvent("pitchend",{from:r,to:i}),this},isTransforming:function(){return!!(this._pitch||this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var a=90-this.getPitch(),i=this.getFov()/2,r=this.cameraPosition?this.cameraPosition[2]:0;if(i<=a)return r;i=Math.PI*i/180;var t=new S(this.cameraPosition).distanceTo(new S(this.cameraLookAt)),e=r*Math.tan(i*2),n=Math.tan(i)*(t+e);return r+n},_pointToContainerPoint:function(a,i,r,t){r===void 0&&(r=0);var e=this._getResolution(i);return this._pointAtResToContainerPoint(a,e,r,t)},_pointAtResToContainerPoint:function(a,i,r,t){r===void 0&&(r=0),t||(t=new S(0,0)),a=this._pointAtResToPoint(a,i,t);var e=this.isTransforming(),n=i/this._getResolution(),s;return!e&&!r&&(s=this._prjToPoint(this._getPrjCenter(),void 0,Lo)),this._toContainerPoint(t,e,n,r,s),t},_pointsAtResToContainerPoints:function(a,i,r,t){r===void 0&&(r=[]),t===void 0&&(t=[]);var e=this.getPitch(),n=this.getBearing();if(e===0&&n===0){var s=this._get2DExtent(),h=s.xmin,u=s.ymin,l=s.xmax,f=s.ymax;if(l>h&&f>u){for(var c=i/this._getResolution(),d=this.getSize(),g=d.width,v=d.height,m=(l-h)/g,_=(f-u)/v,p=0,y=a.length;p<y;p++){if(!a[p]){t[p]=null;continue}var x=t[p];x.x=a[p].x,x.y=a[p].y,x._multi(c),x.x=(x.x-h)*m,x.y=v-(x.y-u)*_}return t}}for(var M=Array.isArray(r),w=this.isTransforming(),b=i/this._getResolution(),T=this._prjToPoint(this._getPrjCenter(),void 0,Lo),P=0,O=a.length;P<O;P++){if(!a[P]){t[P]=null;continue}var I=t[P];I.x=a[P].x,I.y=a[P].y,I._multi(b);var E=M?r[P]||0:r;this._toContainerPoint(I,w,b,E,T)}return t},_toContainerPoint:function(){var o=[0,0,0];return function(a,i,r,t,e){var n=this.width/2,s=this.height/2;if(i||t){t*=r;var h=this._glScale;Ft(o,a.x*h,a.y*h,t*h);var u=this._projIfBehindCamera(o,this.cameraPosition,this.cameraForward);pn(u,u,this.projViewMatrix),a.x=u[0]*n+n,a.y=-(u[1]*s)+s}else a._sub(e.x,e.y),a.set(a.x,-a.y),a._add(n,s)}}(),_projIfBehindCamera:function(){var o=new Array(3),a=new Array(3),i=new Array(3);return function(r,t,e){rr(o,r,t);var n=Df(e,o);return n<=0&&(Lf(a,e,n*1.01),kf(r,t,rr(i,o,a))),r}}(),_containerPointToPoint:function(a,i,r){var t=this._getResolution(i);return this._containerPointToPointAtRes(a,t,r)},_containerPointToPointAtRes:function(){var o=[0,0,0],a=[0,0,0,1],i=[0,0,0,1];return function(r,t,e){if(this.isTransforming()){var n=this.width/2||1,s=this.height/2||1;Ft(o,(r.x-n)/n,(s-r.y)/s,0),Ft(a,o[0],o[1],0),Ft(i,o[0],o[1],1),a[3]=i[3]=1,pn(a,a,this.projViewMatrixInverse),pn(i,i,this.projViewMatrixInverse);var h=a[0],u=i[0],l=a[1],f=i[1],c=a[2],d=i[2],g=c===d?0:(0-c)/(d-c),v=or(h,u,g),m=or(l,f,g);return e?(e.x=v,e.y=m):e=new S(v,m),e._multi(1/this._glScale),this._getResolution()===t?e:this._pointToPointAtRes(e,t,e)}var _=this._prjToPointAtRes(this._getPrjCenter(),t,e),p=this._getResolution()/t,y=p*(r.x-this.width/2),x=p*(r.y-this.height/2);return _._add(y,-x)}}(),_calcMatrices:function(){var o=Ht();return function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var a=this.getSize(),i=a.width||1,r=a.height||1;this._glScale=this.getGLScale();var t=this._getCameraWorldMatrix(),e=this.getFov()*Math.PI/180,n=this._getCameraFar(e,this.getPitch());this.cameraFar=n,this.cameraNear=this.cameraCenterDistance/20;var s=this.projMatrix||Ht();Ao(s,e,i/r,this.cameraNear,n),this.projMatrix=s,this.viewMatrix=Oo(this.viewMatrix||Ht(),t),this.projViewMatrix=xi(this.projViewMatrix||Ht(),s,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=xi(this.projViewMatrixInverse||Ht(),t,Oo(o,s)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtentAtRes(this._mapGlRes)}}(),_getCameraFar:function(a,i){var r=this.cameraCenterDistance=Pr(this.cameraPosition,this.cameraLookAt),t=r,e=(this.options.cameraInfiniteFar?10:4)*r;if(i>0&&(i=i*Math.PI/180,2/Math.PI-i>a/2)){var n=Math.tan(a/2),s=Math.tan(i);e=Math.max(r*n/(1/s-n),e)}return t+=e,t+1},_calcCascadeMatrixes:function(){var o=Ht();function a(i,r,t){var e=this.width,n=this.height,s=this.getFov()*Math.PI/180,h=this._getCameraFar(s,r),u=this.cameraCenterDistance;h=u+(h-u)/Math.cos((90-r)*Math.PI/180)*Math.cos((90-i)*Math.PI/180),Ao(o,s,e/n,.1,h);var l=this.viewMatrix;return xi(t,o,l)}return function(){var i=this.getPitch(),r=this.options.cascadePitches[0],t=this.options.cascadePitches[1],e=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||Ht(),n=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||Ht();i>r?a.call(this,i,r,e):ko(this.cascadeFrustumMatrix0,this.projViewMatrix),i>t?a.call(this,i,t,n):ko(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var o=Ht(),a=Ht(),i=[1,-1,1],r=[0,0,0];return function(){var t=this.width||1,e=this.height||1,n=.5/Math.tan(this._fov/2)*e;return zn(o,this.projMatrix,i),Mh(o,o,Ft(r,0,0,-n)),this._pitch&&Af(o,o,this._pitch),this._angle&&Of(o,o,this._angle),va(a),zn(a,a,Ft(r,t/2,-e/2,1)),xi(this.domCssMatrix||Ht(),a,o)}}(),_getFovZ:function(a){var i=this.getGLScale(a),r=this._getFovRatio();return i*(this.height||1)/2/r},_getCameraWorldMatrix:function(){var o={};return function(){var a=this.getGLRes(),i=this._prjToPointAtRes(this._prjCenter,a);this.cameraLookAt=Ft(this.cameraLookAt||[0,0,0],i.x,i.y,0);var r=this.getPitch()*le,t=this.getBearing()*le,e=this._getFovZ(),n=e*Math.cos(r),s=Math.sin(r)*e,h=i.x-s*Math.sin(t),u=i.y-s*Math.cos(t);this.cameraPosition=Ft(this.cameraPosition||[0,0,0],h,u,n),this.cameraToCenterDistance=Pr(this.cameraPosition,this.cameraLookAt);var l=s||1,f=this.cameraUp=Ft(this.cameraUp||[0,0,0],Math.sin(t)*l,Math.cos(t)*l,0),c=this.cameraWorldMatrix=this.cameraWorldMatrix||Ht();Gf(c,this.cameraPosition,this.cameraLookAt,f);var d=this.cameraForward||[0,0,0];return rr(d,this.cameraLookAt,this.cameraPosition),this.cameraForward=nr(d,d),jf(o,c),Hf(c,o),Ff(c,this.cameraPosition),c}}(),_getFovRatio:function(){var a=this.getFov();return Math.tan(a/2*le)},_renderLayers:function(){if(!this.isInteracting()){var a=this._getLayers();a.forEach(function(i){if(!!i){var r=i._getRenderer();r&&r.setToRedraw&&r.setToRedraw()}})}}});function Ht(){return va(new Array(16))}U.include({_onViewChange:function(a){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var i=this._getCurrentView(),r=this._viewHistory.length-1;r>=0;r--)if(ur(a,this._viewHistory[r])){this._viewHistoryPointer=r,this._fireViewChange(i,a);return}this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(a);var t=this.options.viewHistoryCount;t>0&&this._viewHistory.length>t&&this._viewHistory.splice(0,this._viewHistory.length-t),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(i,a)},zoomToPreviousView:function(a){if(a===void 0&&(a={}),!this.hasPreviousView())return null;var i=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(i,a),i},hasPreviousView:function(){return!(!this._viewHistory||this._viewHistoryPointer===0)},zoomToNextView:function(a){if(a===void 0&&(a={}),!this.hasNextView())return null;var i=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(i,a),i},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(a,i){var r=this,t=this.getView();i.animation?this._animateTo(a,{duration:i.duration},function(e){e.state.playState==="finished"&&r._fireViewChange(t,a)}):(this.setView(a),this._fireViewChange(t,a))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(a,i){this._fireEvent("viewchange",{old:a,new:i})},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}});U.mergeOptions({viewHistory:!0,viewHistoryCount:10});U.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new Gs,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this}});var Zf={mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]},Th=function(o){z(a,o);function a(r){var t;return t=o.call(this,r)||this,t.on("enable",t._afterEnable,xt(xt(t))).on("disable",t._afterDisable,xt(xt(t))),t._measureLayers=[],t}var i=a.prototype;return i.clear=function(){if(rt(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},i.getMeasureLayers=function(){return this._measureLayers},i.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},i.undo=function(){o.prototype.undo.call(this);var t=this._historyPointer;if(t!==this._vertexes.length)for(var e=t;e<this._vertexes.length;e++)this._vertexes[e].label&&this._vertexes[e].label.remove(),this._vertexes[e].marker.remove();return this},i.redo=function(){o.prototype.redo.call(this);var t=this._historyPointer-1;return this._vertexes[t]&&(this._vertexes[t].marker.getLayer()||(this._vertexes[t].label&&this._vertexes[t].label.addTo(this._measureMarkerLayer),this._vertexes[t].marker.addTo(this._measureMarkerLayer))),this},i._measure=function(t){var e=this.getMap(),n;t instanceof K?n=e.computeGeometryLength(t):Array.isArray(t)&&(n=e.getProjection().measureLength(t)),this._lastMeasure=n;var s;this.options.language==="zh-CN"?s=[" \u7C73"," \u516C\u91CC"," \u82F1\u5C3A"," \u82F1\u91CC"]:s=[" m"," km"," feet"," mile"];var h="";return this.options.metric&&(h+=n<1e3?n.toFixed(0)+s[0]:(n/1e3).toFixed(2)+s[1]),this.options.imperial&&(n*=3.2808399,h.length>0&&(h+=`
`),h+=n<5280?n.toFixed(0)+s[2]:(n/5280).toFixed(2)+s[3]),h},i._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},i._afterEnable=function(){this._registerMeasureEvents()},i._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},i._msOnDrawStart=function(t){var e=this.getMap(),n=e._pointToPrj(t.point2d),s=Ce(),h="distancetool_"+s,u="distancetool_markers_"+s;e.getLayer(h)?(this._measureLineLayer=e.getLayer(h),this._measureMarkerLayer=e.getLayer(u)):(this._measureLineLayer=new $t(h).addTo(e),this._measureMarkerLayer=new $t(u).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer);var l=new gt(t.coordinate,{symbol:this.options.vertexSymbol});l._setPrjCoordinates(n);var f=this.options.language==="zh-CN"?"\u8D77\u70B9":"start",c=new Je(f,t.coordinate,this.options.labelOptions);c._setPrjCoordinates(n),this._lastVertex=c,this._addVertexMarker(l,c)},i._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var n=Wt(this.options.vertexSymbol);n.markerWidth/=2,n.markerHeight/=2,this._tailMarker=new gt(t.coordinate,{symbol:n}).addTo(this._measureMarkerLayer),this._tailLabel=new Je(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var s=this._geometry._getPrjCoordinates(),h=s[s.length-1];this._tailMarker.setCoordinates(t.coordinate),this._tailMarker._setPrjCoordinates(h),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(t.coordinate),this._tailLabel._setPrjCoordinates(h)},i._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this._geometry._getPrjCoordinates(),n=e[e.length-1],s=t.geometry,h=new gt(t.coordinate,{symbol:this.options.vertexSymbol}),u=this._measure(s),l=new Je(u,t.coordinate,this.options.labelOptions);this._addVertexMarker(h,l),l._setPrjCoordinates(n),h._setPrjCoordinates(n),this._lastVertex=l},i._addVertexMarker=function(t,e){this._vertexes||(this._vertexes=[]),this._historyPointer!==void 0&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:e,marker:t}),this._measureMarkerLayer.addGeometry(t),e&&this._measureMarkerLayer.addGeometry(e)},i._msOnDrawEnd=function(t){if(this._clearTailMarker(),t.geometry._getPrjCoordinates().length<2){this._lastMeasure=0,this._clearMeasureLayers();return}var e=this._lastVertex.getSize();e||(e=new vt(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),e.width);var n=t.geometry.copy();n._setPrjCoordinates(t.geometry._getPrjCoordinates()),n.addTo(this._measureLineLayer),this._lastMeasure=n.getLength()},i._addClearMarker=function(t,e,n){var s=this.options.clearButtonSymbol,h={markerDx:(s.markerDx||0)+n,textDx:(s.textDx||0)+n};Array.isArray(s)&&(h=s.map(function(c){return c?{markerDx:(c.markerDx||0)+n,textDx:(c.textDx||0)+n}:null})),s=Wt(s,h);var u=new gt(t,{symbol:s}),l=this._measureLineLayer,f=this._measureMarkerLayer;u.on("click",function(){return l.remove(),f.remove(),!1},this),u.addTo(this._measureMarkerLayer),u._setPrjCoordinates(e)},i._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},i._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},a}(Mt);Th.mergeOptions(Zf);var Bf={mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}},Wf=function(o){z(a,o);function a(r){var t;return t=o.call(this,r)||this,t._measureLayers=[],t}var i=a.prototype;return i._measure=function(t){var e=this.getMap(),n;t instanceof K?n=e.computeGeometryArea(t):Array.isArray(t)&&(n=e.getProjection().measureArea(t)),this._lastMeasure=n;var s;this.options.language==="zh-CN"?s=[" \u5E73\u65B9\u7C73"," \u5E73\u65B9\u516C\u91CC"," \u5E73\u65B9\u82F1\u5C3A"," \u5E73\u65B9\u82F1\u91CC"]:s=[" sq.m"," sq.km"," sq.ft"," sq.mi"];var h="";if(this.options.metric&&(h+=n<1e6?n.toFixed(0)+s[0]:(n/1e6).toFixed(2)+s[1]),this.options.imperial){n*=3.2808399,h.length>0&&(h+=`
`);var u=5280*5280;h+=n<u?n.toFixed(0)+s[2]:(n/u).toFixed(2)+s[3]}return h},i._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this.getMap()._pointToPrj(t.point2d),n=new gt(t.coordinate,{symbol:this.options.vertexSymbol});n._setPrjCoordinates(e),this._measure(t.geometry),this._lastVertex=n,this._addVertexMarker(n)},i._msOnDrawEnd=function(t){this._clearTailMarker();var e;if(t.point2d)e=this.getMap()._pointToPrj(t.point2d);else{var n=t.geometry._getPrjCoordinates();n=n.slice(0,n.length-1),t.geometry._setPrjCoordinates(n),e=n[n.length-1]}if(t.geometry._getPrjCoordinates().length<3){this._lastMeasure=0,this._clearMeasureLayers();return}var s=this._measure(t.geometry),h=this.getMap().getProjection(),u=h.unproject(e),l=new Je(s,u,this.options.labelOptions).addTo(this._measureMarkerLayer);l._setPrjCoordinates(e);var f=l.getSize();f||(f=new vt(10,10)),this._addClearMarker(u,e,f.width);var c=t.geometry.copy();c._setPrjCoordinates(t.geometry._getPrjCoordinates()),c.addTo(this._measureLineLayer),this._lastMeasure=c.getArea()},a}(Th);Wf.mergeOptions(Bf);var Sh={create:function(a,i){var r=a.unproject(i[0]),t=new qt(r,0);return t._setPrjCoordinates(i[0]),t},update:function(a,i,r){var t=r.getMap(),e=Array.isArray(i)?i[i.length-1]:i,n=a.unproject(e),s=t.computeLength(r.getCenter(),n);r.setRadius(s)},generate:function(a){return a}};Mt.registerMode("circle",H({clickLimit:2,action:["click","mousemove","click"]},Sh));Mt.registerMode("freeHandCircle",H({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Sh));var bh={create:function(a,i){var r=a.unproject(i[0]),t=new ae(r,0,0);return t._setPrjCoordinates(i[0]),t},update:function(a,i,r){var t=r.getMap(),e=r.getCenter(),n=Array.isArray(i)?i[i.length-1]:i,s=a.unproject(n),h=t.computeLength(e,new k({x:s.x,y:e.y})),u=t.computeLength(e,new k({x:e.x,y:s.y}));r.setWidth(h*2),r.setHeight(u*2)},generate:function(a){return a}};Mt.registerMode("ellipse",H({clickLimit:2,action:["click","mousemove","click"]},bh));Mt.registerMode("freeHandEllipse",H({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},bh));var Eh={create:function(a,i){var r=new mt([]);return r._firstClick=i[0],r},update:function(a,i,r,t){var e=r.getMap(),n=t.containerPoint,s=e._prjToContainerPoint(r._firstClick),h=[[s.x,s.y],[n.x,s.y],[n.x,n.y],[s.x,n.y]];r.setCoordinates(h.map(function(u){return e.containerPointToCoord(new S(u))})),r._setPrjCoordinates(h.map(function(u){return e._containerPointToPrj(new S(u))}))},generate:function(a){return a}};Mt.registerMode("rectangle",H({clickLimit:2,action:["click","mousemove","click"]},Eh));Mt.registerMode("freeHandRectangle",H({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Eh));Mt.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(a,i){var r=a.unproject(i[0]),t=new gt(r);return t._setPrjCoordinates(i[0]),t},generate:function(a){return a},update:function(a,i,r){if(Array.isArray(i)&&(i=i[i.length-1]),!i)return r;var t=a.unproject(i);return r.setCoordinates(t),r}});var Rh={create:function(a,i){var r=i.map(function(e){return a.unproject(e)}),t=new dt(r);return t._setPrjCoordinates(i),t},update:function(a,i,r){var t=r.getSymbol(),e;Array.isArray(i)?e=i:(e=r._getPrjCoordinates(),e.push(i));var n=e.map(function(l){return a.unproject(l)});r.setCoordinates(n),r._setPrjCoordinates(e);var s=r.getLayer();if(s){var h=s.getGeometryById("polygon");if(!h&&e.length>=3){if(h=new mt([n],{id:"polygon"}),t){var u=Wt(t,{lineOpacity:0});h.setSymbol(u)}h.addTo(s)}h&&h._setPrjCoordinates(e)}},generate:function(a){var i=new mt(a.getCoordinates(),{symbol:a.getSymbol()});return i._setPrjCoordinates(a._getPrjCoordinates()),i._projCode=a._projCode,i}};Mt.registerMode("polygon",H({action:["click","mousemove","dblclick"]},Rh));Mt.registerMode("freeHandPolygon",H({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Rh));var Oi={create:function(a,i){var r=i.map(function(e){return a.unproject(e)}),t=new dt(r);return t._setPrjCoordinates(i),t},update:function(a,i,r){var t;Array.isArray(i)?t=i:(t=r._getPrjCoordinates(),t.push(i));var e=t.map(function(n){return a.unproject(n)});r.setCoordinates(e),r._setPrjCoordinates(t)},generate:function(a){return a}};Mt.registerMode("linestring",H({action:["click","mousemove","dblclick"]},Oi));Mt.registerMode("freeHandLinestring",H({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Oi));Mt.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(a,i){var r=i.map(function(e){return a.unproject(e)}),t=new Lr(r);return t._setPrjCoordinates(i),t},update:Oi.update,generate:function(a){return a}});Mt.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(a,i){var r=i.map(function(e){return a.unproject(e)}),t=new yh(r);return t._setPrjCoordinates(i),t},update:Oi.update,generate:function(a){return a}});Mt.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(a,i){var r=i.map(function(e){return a.unproject(e)}),t=new ph(r);return t._setPrjCoordinates(i),t},update:Oi.update,generate:function(a){return a}});Mt.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(a,i){i=i[0];var r=a.unproject(i),t=new gt(r);return t._firstClick=i,t},update:function(a,i,r,t){var e=r.getMap(),n=e._prjToContainerPoint(r._firstClick),s=t.containerPoint;i=e._containerPointToPrj(new k(Math.min(n.x,s.x),Math.min(n.y,s.y)));var h=a.unproject(i);r.setCoordinates(h)._setPrjCoordinates(i),r.updateSymbol({markerWidth:Math.abs(n.x-s.x),markerHeight:Math.abs(n.y-s.y)})},generate:function(a){return a}});function Io(o){for(var a=o.tileInfo,i=[a.cols,a.rows],r=[],t=a.lods,e=0,n=t.length;e<n;e++)r.push(t[e].resolution);var s=o.fullExtent,h=a.origin,u=[1,-1,h.x,h.y];return delete s.spatialReference,{spatialReference:{resolutions:r,fullExtent:s},tileSystem:u,tileSize:i}}Yt.loadArcgis=function(o,a,i){if(i===void 0&&(i={jsonp:!0}),$(o)&&o.substring(0,1)!=="{")Dt.getJSON(o,function(t,e){if(t){a(t);return}var n=Io(e);a(null,n)},i);else{$(o)&&(o=Tr(o));var r=Io(o);a(null,r)}return this};function Vf(o){for(var a="",i=o.split(""),r=i.length,t=r-1;t>=0&&!isNaN(i[t]);t--)a=i[t]+a;return a}function Uf(o){var a=o.indexOf("EPSG")>-1?o:"EPSG:"+o;return a=Ah(a,[["4490","4326"],["102100","3857"],["900913","3857"]]),a}function Ah(o,a){return a===void 0&&(a=[]),a.forEach(function(i){var r=i[0],t=i[1];o=o.replace(r,t)}),o}function Jf(o){var a=o.projection,i=o.isArcgis,r=o.isGeoServer,t=o.isSuperMap,e=.0002645833333333333;return(i||r||t)&&(e=28e-5),a&&a.indexOf("4326")>-1&&(e=23767925226029154e-25,(i||t)&&(e=2518101729011901e-24),r&&(e=251528279553466e-23)),e}var Yf="wmts";function me(o,a){var i=o.getElementsByTagName(a);if(i&&i.length)return i;var r=Yf+":"+a;return o.getElementsByTagName(r)}function Xf(o,a){for(var i=0;i<o.length;i++){var r=o[i];if(r=r.getElementsByTagName("ows:Identifier")[0],r&&r.textContent===a)return o[i]}return null}function qf(o,a,i){i.isArcgis==null&&(i.isArcgis=o.indexOf("arcgis")>-1),i.isSuperMap==null&&(i.isSuperMap=o.indexOf("supermap")>-1);var r=new DOMParser,t=r.parseFromString(o,"text/xml"),e=t.querySelectorAll("Contents")[0];if(!e)return[];var n=me(e,"Layer");if(!n.length)return[];for(var s=[],h=0,u=e.childNodes.length;h<u;h++)e.childNodes[h].localName==="TileMatrixSet"&&s.push(e.childNodes[h]);if(!s.length)return[];for(var l=[],f=0,c=n.length;f<c;f++){var d=n[f],g=d.querySelectorAll("Style")[0];g&&(g=g.getElementsByTagName("ows:Identifier")[0],g&&(g=g.textContent));var v=d.getElementsByTagName("ows:Identifier")[0];v&&(v=v.textContent);var m=me(d,"TileMatrixSetLink");if(m.length!==0)for(var _=0,p=m.length;_<p;_++){var y=m[_];y=me(y,"TileMatrixSet")[0],y&&(y=y.textContent);var x=Xf(s,y);if(!!x){var M=d.querySelectorAll("ResourceURL")[0],w="";M&&(w=M.attributes.template.value);var b=$f(x,i),T=b.resolutions,P=b.tileSize,O=b.tileSystem,I=b.projection,E=b.TileMatrixSet,D=b.isGeoServer,R=b.levelStr;w.length||(w=a.substr(0,a.lastIndexOf("?")),w+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var A=Ah(w,[["{LAYER}",v],["{Layer}",v],["{layer}",v],["{STYLE}",g],["{Style}",g],["{style}",g],["{TileMatrixSet}",E],["{TileMatrix}",D?R+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",D?"image/png":"tiles"]]);l.push({tileSize:P,tileSystem:O,spatialReference:{resolutions:T,projection:I},urlTemplate:A,info:{layerName:v,TileMatrixSet:E,style:g,tileSize:P,tileSystem:O,resolutions:T,projection:I,urlTemplate:A}})}}}return l}function $f(o,a){a===void 0&&(a={});var i=me(o,"TileMatrix"),r=[],t=[],e=[],n,s,h=!1,u;if(!n){var l=o.getElementsByTagName("ows:SupportedCRS")[0];l&&(n=l.textContent,n=n.split("EPSG")[1],n=Vf(n),n=Uf(n))}s||(s=o.getElementsByTagName("ows:Identifier")[0],s&&(s=s.textContent)),a.projection=n;for(var f=1/0,c=0;c<i.length;c++){var d=i[c],g=d.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(g))?(u=g.substr(0,g.lastIndexOf(":")),g=g.split(":"),g=g[g.length-1],g=parseInt(g),h=!0,a.isGeoServer=!0):g=parseInt(g),f=Math.min(f,g);var v=me(d,"ScaleDenominator")[0].textContent,m=me(d,"TopLeftCorner")[0].textContent,_=me(d,"TileWidth")[0].textContent,p=me(d,"TileHeight")[0].textContent;if(e.length===0&&e.push(parseInt(_),parseInt(p)),t.length===0){var y=m.split(" ").filter(function(O){return O!==""}).map(function(O){return parseFloat(O)}),x=y[0],M=y[1];x>0?t.push(1,-1,M,x):t.push(1,-1,x,M)}var w=Jf(a),b=parseFloat(v)*w;r.push(b)}if(f>0)for(var T=r[0],P=f-1;P>=0;P--)T=T*2,r.splice(0,0,T);return{resolutions:r,tileSize:e,tileSystem:t,projection:n,TileMatrixSet:s,isGeoServer:h,levelStr:u}}Yt.loadWMTS=function(o,a,i){return i===void 0&&(i={jsonp:!0}),$(o)&&Dt.get(o,function(r,t){if(r){a(r);return}var e=qf(t,o,i);a(null,e)},i),this};var Qf={eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1},we=function(o){z(a,o);function a(r){return o.call(this,r)||this}var i=a.prototype;return i.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},i.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},i.show=function(t){var e=this.getMap();if(!e)return this;this.options.visible=!0,t=t||this._coordinate||this._owner.getCenter();var n=this.isVisible();this._showBySymbolChange||this.fire("showstart");var s=this._getUIContainer();this._coordinate=t,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var h=this.__uiDOM=this.buildOn(e);if(h.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(h),!h)return this._showBySymbolChange||this.fire("showend"),this;this._measureSize(h),this._singleton()&&(h._uiComponent=this,e[this._uiDomKey()]=h),this._setPosition(),h.style[_i]=null,s.appendChild(h);var u=this._getAnimation();if(n&&(u.ok=!1),u.ok&&(u.fade&&(h.style.opacity=0),u.scale)){if(this.getTransformOrigin){var l=this.getTransformOrigin();h.style[Rs]=l}h.style[Bt]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(h.style.display=""),this.options.eventsToStop&&ct(h,this.options.eventsToStop,Lt),this.options.autoPan&&this._autoPan();var f=u.transition;return u.ok&&f&&(h.offsetHeight,f&&(h.style[_i]=f),u.fade&&(h.style.opacity=1),u.scale&&(h.style[Bt]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this},i.hide=function(){var t=this;if(!this.getDOM())return this;this.options.visible=!1;var e=this._getAnimation(),n=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(n.offsetHeight,n.style[_i]=e.transition,setTimeout(function(){n.style.display="none",t.fire("hide")},this.options.animationDuration)):(n.style.display="none",this.fire("hide")),e.fade&&(n.style.opacity=0),e.scale&&(n.style[Bt]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this},i.isVisible=function(){if(!this.options.visible)return!1;var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&t.style.display!=="none"},i.remove=function(){return delete this._mapEventsOn,this._owner?(this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this):this},i.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},i.getOwner=function(){return this._owner},i.getDOM=function(){return this.__uiDOM},i._roundPoint=function(t){return this.options.roundPoint&&(t=t._round()),t},i.getPosition=function(){if(!this.getMap())return null;var t=this._roundPoint(this._getViewPoint());if(this.getOffset){var e=this._roundPoint(this.getOffset());e&&t._add(e)}return t},i._getAnimation=function(){for(var t={fade:!1,scale:!1},e=this.options.animation?this.options.animation.split(","):[],n=0;n<e.length;n++){var s=Un(e[n]);s==="fade"?t.fade=!0:s==="scale"&&(t.scale=!0)}var h=null;return t.fade&&(h="opacity "+this.options.animationDuration+"ms"),t.scale&&(h=h?h+",":"",h+=Bt+" "+this.options.animationDuration+"ms"),t.transition=h,t.ok=h!==null,t},i._getViewPoint=function(){var t=0,e=this._coordinate||{};N(e.z)?t=e.z:this._owner&&this._owner.getAltitude&&(t=this._owner.getAltitude()||0);var n=this._meterToPoint(this._coordinate,t);return this.getMap().coordToViewPoint(this._coordinate,void 0,n)._add(this.options.dx,this.options.dy)},i._meterToPoint=function(t,e){var n=this.getMap();return n.altitudeToPoint(e,n._getResolution())*yt(e)},i._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(!t.isMoving()){var n=this._getViewPoint()._round(),s=t.width,h=t.height,u=t.viewPointToContainerPoint(n),l=this.getOffset(),f=u.add(l),c=t._viewPointToPrj(n),d=parseInt(e.clientWidth),g=parseInt(e.clientHeight),v=50,m=0,_=0;if(f.x<0?m=-f.x+v:f.x+d>s&&(m=-(f.x+d-s)-v),f.y-g<0?_=Math.abs(f.y-g)+v:f.y+g>h&&(_=h-(f.y+g)-v),d>=s&&(m=s/2-u.x),_!==0||m!==0){var p=u.add(m,_),y=t._containerPointToPoint(p)._sub(t._prjToPoint(t._getPrjCenter())),x=t._pointToPrj(t._prjToPoint(c).sub(y));t._panAnimation(x)}}},i._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute";var n=t.style.bottom?"bottom":"top";if(t.style.display="",e.appendChild(t),t.getBoundingClientRect){var s=t.getBoundingClientRect();this._size=new vt(s.width,s.height)}else this._size=new vt(t.clientWidth,t.clientHeight);return t.style.display="none",t.style.left="0px",t.style[n]="0px",this._size},i._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),n=this._uiDomKey();if(e[n]){t&&ut(e[n],t,Lt);var s=e[n]._uiComponent;s&&s!==this&&s.isVisible()&&s.fire("hide"),Ae(e[n]),s&&!this.hideDom&&s._switchMapEvents("off"),delete e[n]}delete this.__uiDOM}else this.__uiDOM&&(t&&ut(this.__uiDOM,t,Lt),Ae(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},i._uiDomKey=function(){return"__ui_"+this._getClassName()},i._singleton=function(){return this.options.single},i._getUIContainer=function(){return this.getMap()._panels.ui},i._getClassName=function(){return"UIComponent"},i._switchMapEvents=function(t){var e=this.getMap();if(!!e){this._mapEventsOn=t==="on";var n=this._getDefaultEvents();if(this.getEvents&&H(n,this.getEvents()),n)for(var s in n)n.hasOwnProperty(s)&&e[t](s,n[s],this)}},i._switchEvents=function(t){var e=this._getOwnerEvents();if(this._owner)for(var n in e)e.hasOwnProperty(n)&&this._owner[t](n,e[n],this)},i._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},i._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof K&&(t.positionchange=this.onGeometryPositionChange,t.symbolchange=this._updatePosition),this.getOwnerEvents&&H(t,this.getOwnerEvents()),t},i.onGeometryPositionChange=function(t){this._owner&&this.isVisible()&&(this._showBySymbolChange=!0,this.show(t.target.getCenter()),delete this._showBySymbolChange)},i.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},i.onEvent=function(){this.isVisible()&&this._updatePosition()},i.onZoomEnd=function(){this.isVisible()&&this._setPosition()},i.onResize=function(){this.isVisible()&&this._setPosition()},i.onDomSizeChange=function(){this.isVisible()&&this._setPosition()},i._updatePosition=function(){if(!this.getMap())return this;var t=this.getMap()._getRenderer();return t.callInNextFrame(this._setPosition.bind(this)),this},i._setPosition=function(){var t=this.getDOM();if(!!t){t.style[_i]=null;var e=this.getPosition();this._pos=e,t.style[Bt]=this._toCSSTranslate(e)+" scale(1)"}},i._toCSSTranslate=function(t){if(!t)return"";if(q.any3d){var e=this.getMap(),n=e?e.getBearing():0,s=e?e.getPitch():0,h="";return this.options.pitchWithMap&&s&&(h+=" rotateX("+Math.round(s)+"deg)"),this.options.rotateWithMap&&n&&(h+=" rotateZ("+Math.round(-n)+"deg)"),"translate3d("+t.x+"px,"+t.y+"px, 0px)"+h}else return"translate("+t.x+"px,"+t.y+"px)"},i._observerDomSize=function(t){var e=this;return!t||!q.resizeObserver||this._resizeObserver?this:(this._resizeObserver=new ResizeObserver(function(n){n.length?e._domContentRect=n[0].contentRect:delete e._domContentRect,e.onDomSizeChange&&e.onDomSizeChange()}),this._resizeObserver.observe(t),this)},i.isSupportZoomFilter=function(){return!1},a.isSupport=function(t){return!!(t&&nt(t.on)&&nt(t.off)&&nt(t.getCenter))},a}(oe(Nt));we.mergeOptions(Qf);var Kf={containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null},zo="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",Ir=function(o){z(a,o);function a(r,t){var e;return e=o.call(this,t)||this,e._markerCoord=new k(r),e}var i=a.prototype;return i._getClassName=function(){return"UIMarker"},i.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition()),this},i.getCoordinates=function(){return this._markerCoord},i.getCenter=function(){return this.getCoordinates()},i.getAltitude=function(){var t=this.getCoordinates()||{};return N(t.z)?t.z:this.options.altitude||0},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},i.getContent=function(){return this.options.content},i.onAdd=function(){this.show()},i.show=function(){return o.prototype.show.call(this,this._markerCoord)},i.flash=function(t,e,n,s){return Fn.call(this,t,e,n,s)},i.buildOn=function(){var t,e=this.options.content,n=$(e);return n||nt(e)?(t=W("div"),n?t.innerHTML=this.options.content:e.bind(this)(t)):t=this.options.content,this.options.containerClass&&(t.className=this.options.containerClass),this._registerDOMEvents(t),t},i.getOffset=function(){var t=this.getSize();return new S(-t.width/2,-t.height/2)},i.getTransformOrigin=function(){return"center center"},i.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},i.isDragging=function(){return this.draggable?this.draggable.isDragging():!1},i._registerDOMEvents=function(t){ct(t,zo,this._onDomEvents,this)},i._onDomEvents=function(t){var e=this.getMap()._parseEvent(t,t.type),n=t.type;if(n==="mousedown"&&(this._mousedownEvent=t),n==="mouseup"&&(this._mouseupEvent=t),!(n==="click"&&this._mouseClickPositionIsChange())&&(n==="touchstart"&&(this._touchstartTime=lt()),this.fire(t.type,e),n==="touchend"&&q.touch)){var s=this.getMap().options.clickTimeThreshold||280;lt()-this._touchstartTime<s&&this._onDomEvents(H({},t,{type:"click"}))}},i._removeDOMEvents=function(t){ut(t,zo,this._onDomEvents)},i._mouseClickPositionIsChange=function(){var t=this._mousedownEvent||{},e=t.x,n=t.y,s=this._mouseupEvent||{},h=s.x,u=s.y;return e!==h||n!==u},i._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),n=this.getSize(),s=n.width,h=n.height,u=[t.containerPointToCoordinate(e.add(-s/2,0)),t.containerPointToCoordinate(e.add(s/2,0)),t.containerPointToCoordinate(e.add(0,h/2)),t.containerPointToCoordinate(e.add(0,-h/2))];return u},i._getViewPoint=function(){var t=0;if(this._owner){var e=this.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},i._getDefaultEvents=function(){return H({},o.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},i._setPosition=function(){this.onZoomFilter(),o.prototype._setPosition.call(this)},i.onZoomFilter=function(){var t=this.getDOM();!t||(!this.isVisible()&&t.style.display!=="none"?t.style.display="none":this.isVisible()&&t.style.display==="none"&&(t.style.display=""))},i.isVisible=function(){var t=this.getMap();if(!t||!this.options.visible)return!1;var e=t.getZoom(),n=this.options,s=n.minZoom,h=n.maxZoom;if(!C(s)&&e<s||!C(h)&&e>h)return!1;var u=this.getDOM();return u&&!0},i.isSupportZoomFilter=function(){return!0},a}(ea(we));Ir.mergeOptions(Kf);var jo=q.touch?"touchstart mousedown":"mousedown",tc=function(o){z(a,o);function a(r){return o.call(this,r)||this}var i=a.prototype;return i.addHooks=function(){this.target.on(jo,this._startDrag,this)},i.removeHooks=function(){this.target.off(jo,this._startDrag,this)},i._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||e.button===2||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},i._prepareDragHandler=function(){this._dragHandler=new qe(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},i._cancelOn=function(t){var e=t.srcElement||t.target,n=e.tagName.toLowerCase();return n==="button"||n==="input"||n==="select"||n==="option"||n==="textarea"},i._onMouseDown=function(t){Lt(t.domEvent)},i._dragging=function(t){var e=this.target,n=e.getMap(),s=n._parseEvent(t.domEvent),h=s.domEvent;if(!(h.touches&&h.touches.length>1)){if(!this._isDragging){this._isDragging=!0;return}var u=s.coordinate,l=s.containerPoint;this._lastCoord||(this._lastCoord=u),this._lastPoint||(this._lastPoint=l);var f=u.sub(this._lastCoord),c=l.sub(this._lastPoint);this._lastCoord=u,this._lastPoint=l,this.target.setCoordinates(this.target.getCoordinates().add(f)),s.coordOffset=f,s.pointOffset=c,e.fire("dragging",s)}},i._endDrag=function(t){var e=this.target,n=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,!!n){var s=n._parseEvent(t.domEvent);e&&e._mouseClickPositionIsChange&&e._mouseClickPositionIsChange()&&e.fire("dragend",s)}},i.isDragging=function(){return!!this._isDragging},a}(Ut);Ir.addInitHook("addHandler","draggable",tc);var ec=/\{ *([\w_]+) *\}/g,Oh={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},ic=new vt(0,0),Mr=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i._getClassName=function(){return"InfoWindow"},i.addTo=function(t){return t instanceof K&&(t.getInfoWindow()&&t.getInfoWindow()!==this&&t.removeInfoWindow(),t._infoWindow=this),o.prototype.addTo.call(this,t)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getContent=function(){return this.options.content},i.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getTitle=function(){return this.options.title},i.buildOn=function(){var t=nt(this.options.content),e=$(this.options.content);if(this.options.custom)if(e||t){var n=W("div");return e?(n.innerHTML=this.options.content,this._replaceTemplate(n)):this.options.content.bind(this)(n),n}else return this._replaceTemplate(this.options.content),this.options.content;var s=W("div");this.options.containerClass&&(s.className=this.options.containerClass);var h=this._getWindowWidth();s.style.width=N(h)?h+"px":"auto",s.style.bottom="0px";var u='<em class="maptalks-ico"></em>';this.options.title&&(u+="<h2>"+this.options.title+"</h2>"),u+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',s.innerHTML=u,this._replaceTemplate(s);var l=s.querySelector(".maptalks-msgContent");e||t?e?l.innerHTML=this.options.content:this.options.content.bind(this)(l):l.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this);var f=s.querySelector(".maptalks-close");return re(f,"click touchend",this._onCloseBtnClick),t||this._replaceTemplate(l),s},i._replaceTemplate=function(t){if(this.options.enableTemplate&&this._owner&&this._owner.getProperties&&t&&t.innerHTML){var e=this._owner.getProperties()||{};if(Gt(e)){var n=t.innerHTML;t.innerHTML=n.replace(ec,function(s,h){return e[h]})}}return this},i.getTransformOrigin=function(){var t=this.getSize();return t.width/2+"px bottom"},i.getOffset=function(){var t=this.getSize(),e=new S(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var n=this.getOwner();if(n instanceof gt||n instanceof yr){var s,h;if(n instanceof gt)s=n._getPainter(),h=n.getSize();else{var u=n.getGeometries();if(!u||!u.length)return e;s=u[0]._getPainter(),h=u[0].getSize()}if(h||(h=ic),s){var l=s.getFixedExtent();e._add(l.xmax-h.width/2,l.ymin)}else e._add(0,-h.height)}return e},i.show=function(t){return this.getMap()?this.getMap().options.enableInfoWindow?o.prototype.show.call(this,t):this:this},i.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},i.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},i.onRemove=function(){this.onDomRemove()},i.onDomRemove=function(){if(this._onCloseBtnClick){var t=this.getDOM(),e=t.childNodes[2];Pe(e,"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick}},i._onAutoOpen=function(t){var e=this,n=this.getOwner();setTimeout(function(){n instanceof gt||n instanceof we?e.show(n.getCoordinates()):n instanceof yr?e.show(n.findClosest(t.coordinate)):((n instanceof dt||n instanceof xr)&&e.getMap().getScale()>=8&&(t.coordinate=e._rectifyMouseCoordinte(n,t.coordinate)),e.show(t.coordinate))},1)},i._rectifyMouseCoordinte=function(t,e){var n=this;return t instanceof dt?this._rectifyLineStringMouseCoordinate(t,e).coordinate:t instanceof xr?t.getGeometries().map(function(s){return n._rectifyLineStringMouseCoordinate(s,e)}).sort(function(s,h){return s.dis-h.dis})[0].coordinate:e},i._rectifyLineStringMouseCoordinate=function(t,e){for(var n=this,s=t.getCoordinates().map(function(ot){return n.getMap().coordToContainerPoint(ot)}),h=this.getMap().coordToContainerPoint(e),u=1/0,l=-1,f=0,c=s.length;f<c;f++){var d=s[f],g=h.distanceTo(d);g<u&&(u=g,l=f)}var v=[];l===0?v.push(s[0],s[1]):l===s.length-1?v.push(s[l-1],s[l]):v.push(s[l-1],s[l],s[l+1]);for(var m=[],_=this.getMap().getSize(),p=_.width,y=_.height,x=0,M=v.length-1;x<M;x++){var w=v[x],b=v[x+1];if(w.x===b.x)for(var T=Math.max(0,Math.min(w.y,b.y)),P=Math.min(y,Math.max(w.y,b.y)),O=T;O<=P;O++)m.push(new S(w.x,O));else for(var I=(b.y-w.y)/(b.x-w.x),E=Math.max(0,Math.min(w.x,b.x)),D=Math.min(p,Math.max(w.x,b.x)),R=E;R<=D;R++){var A=I*(R-w.x)+w.y;m.push(new S(R,A))}}for(var G=1/0,F=-1,j=0,Z=m.length;j<Z;j++){var V=m[j],J=h.distanceTo(V);J<G&&(G=J,F=j)}return{dis:G,coordinate:F<0?e:this.getMap().containerPointToCoord(m[F])}},i._getWindowWidth=function(){var t=Oh.width,e=this.options.width;return e||(e=t),e},a}(we);Mr.mergeOptions(Oh);var Ho="remove hide shapechange positionchange dragend animatestart",rc={width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400},kh=function(o){z(i,o);var a=i.prototype;a._getClassName=function(){return"ToolTip"};function i(r,t){var e;return t===void 0&&(t={}),e=o.call(this,t)||this,e._content=r,e}return a.addTo=function(t){if(i.isSupport(t))return t.on("mousemove",this.onMouseMove,this),t.on("mouseout",this.onMouseOut,this),t.on(Ho,this.hideDom,this),o.prototype.addTo.call(this,t);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},a.setStyle=function(t){return this.options.containerClass=t,this},a.getStyle=function(){return this.options.containerClass},a.getContent=function(){return this._content},a.buildOn=function(){var t=W("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var n=e.containerClass||e.cssName;return!n&&e.height&&(t.style.lineHeight=e.height+"px"),nt(this._content)?this._content.bind(this)(t):t.innerHTML='<div class="'+n+'">'+this._content+"</div>",t},a.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},a.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var n=this.getMap();if(!!n){var s=n.locateByPoint(t.coordinate,-5,25);this.options.showTimeout===0?this.show(s):this._timeout=setTimeout(function(){n&&e.show(s)},this.options.showTimeout)}},a.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(Ho,this.hideDom,this))},a.hideDom=function(){return this.hide()},a.onEvent=function(){return o.prototype.onEvent.call(this),this.hideDom(),this},a._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},i}(we);kh.mergeOptions(rc);var nc={containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]},ma=function(o){z(a,o);function a(r){return o.call(this,r)||this}var i=a.prototype;return i._getClassName=function(){return"Menu"},i.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,this._owner=t,we.prototype.addTo.apply(this,arguments)},i.setItems=function(t){return this.options.items=t,this},i.getItems=function(){return this.options.items||[]},i.buildOn=function(){if(this.options.custom)if($(this.options.items)){var t=W("div");return t.innerHTML=this.options.items,t}else return this.options.items;else{var e=W("div");this.options.containerClass&&be(e,this.options.containerClass),e.style.width=this._getMenuWidth()+"px";var n=this._createMenuItemDom();return e.appendChild(n),ct(e,"contextmenu",It),e}},i.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),n=this.getSize(),s=0,h=0;return e.x+n.width>t.width&&(s=-n.width),e.y+n.height>t.height&&(h=-n.height),new S(s,h)},i.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},i.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},i._createMenuItemDom=function(){var t=this,e=this.getMap(),n=W("ul");be(n,"maptalks-menu-items");var s=this.getItems();function h(v){return function(m){var _=e._parseEvent(m,"click");_.target=t,_.owner=t._owner,_.index=v;var p=this._callback(_);p!==!1&&(t.hide(),t._owner&&t._owner.fire("closemenu"))}}for(var u,l,f=0,c=s.length;f<c;f++){if(u=s[f],u==="-"||u==="_")l=W("li"),be(l,"maptalks-menu-splitter");else{l=W("li");var d=u.item;nt(d)&&(d=d({owner:this._owner,index:f})),l.innerHTML=d,l._callback=u.click,ct(l,"click",h(f))}n.appendChild(l)}var g=this.options.maxHeight||0;return g>0&&Rr(n,"max-height: "+g+"px; overflow-y: auto;"),n},i._getMenuWidth=function(){var t=160,e=this.options.width||t;return e},a}(we);ma.mergeOptions(nc);var _a={setMenu:function(a){return this._menuOptions=a,this._menu?this._menu.setOptions(a):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(a){var i=this instanceof U?this:this.getMap();return a||(a=this.getCenter()),this._menu?this._menu.show(a):this._menuOptions&&i&&(this._bindMenu(),this._menu.show(a)),this.fire("openmenu",{coordinate:a}),this},setMenuItems:function(a){return this._menuOptions||(this._menuOptions={}),Array.isArray(a)&&(this._menuOptions.custom=!1),this._menuOptions.items=a,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions?this._menuOptions.items||[]:[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new ma(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(a){return this.openMenu(a.coordinate),!1}};U.include(_a);K.include(_a);var ac=Object.freeze({UIComponent:we,UIMarker:Ir,InfoWindow:Mr,ToolTip:kh,Menuable:_a,Menu:ma}),Qt=function(o){z(a,o);function a(r){return r&&r.position&&!$(r.position)&&(r.position=H({},r.position)),o.call(this,r)||this}var i=a.prototype;return i.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t._panels.control;return this.__ctrlContainer=W("div"),Rr(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},i.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},i.getMap=function(){return this._map},i.getPosition=function(){return H({},this._parse(this.options.position))},i.setPosition=function(t){return $(t)?this.options.position=t:this.options.position=H({},t),this._updatePosition(),this},i.getContainerPoint=function(){var t=this.getPosition(),e=this.getMap().getSize(),n,s;return C(t.left)?C(t.right)||(n=e.width-parseInt(t.right)):n=parseInt(t.left),C(t.top)?C(t.bottom)||(s=e.height-parseInt(t.bottom)):s=parseInt(t.top),new S(n,s)},i.getContainer=function(){return this.__ctrlContainer},i.getDOM=function(){return this._controlDom},i.show=function(){return this.__ctrlContainer.style.display="",this},i.hide=function(){return this.__ctrlContainer.style.display="none",this},i.isVisible=function(){return this.__ctrlContainer&&this.__ctrlContainer.style.display===""},i.remove=function(){return this._map?(Ae(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},i._parse=function(t){var e=t;return $(t)&&(e=a.positions[e]),e},i._updatePosition=function(){var t=this.getPosition();t||(t={top:20,left:20});for(var e in t)t.hasOwnProperty(e)&&(t[e]=parseInt(t[e]),this.__ctrlContainer.style[e]=t[e]+"px");this.fire("positionchange",{position:H({},t)})},a}(oe(Nt));Qt.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}};U.mergeOptions({control:!0});U.include({addControl:function(a){return this._containerDOM.getContext?this:(a.addTo(this),this)},removeControl:function(a){return!a||a.getMap()!==this?this:(a.remove(),this)}});var oc={position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'},Fo="addlayer removelayer setbaselayer baselayerremove",pa=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){return this._attributionContainer=W("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},i.onAdd=function(){this.getMap().on(Fo,this._update,this)},i.onRemove=function(){this.getMap().off(Fo,this._update,this)},i._update=function(){var t=this.getMap();if(!!t){var e=t._getLayers(function(s){return s.options.attribution}).reverse().map(function(s){return s.options.attribution}),n=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+n+"</span>"}},a}(Qt);pa.mergeOptions(oc);U.mergeOptions({attribution:!0});U.addOnLoadHook(function(){var o=this.options.attribution||this.options.attributionControl;o&&(this.attributionControl=new pa(o),this.addControl(this.attributionControl))});var sc={position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"},ya=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){var t=this.container=W("div",this.options.containerClass),e=this.panel=W("div","panel"),n=this.button=W("button");return t.appendChild(n),t.appendChild(e),t},i.onAdd=function(){ct(this.button,"mouseover",this._show,this),ct(this.panel,"mouseleave",this._hide,this),ct(this.getMap(),"click",this._hide,this)},i.onRemove=function(){this.panel&&(ut(this.button,"mouseover",this._show),ut(this.panel,"mouseleave",this._hide),ut(this.getMap(),"click",this._hide),Ae(this.panel),Ae(this.button),delete this.panel,delete this.button,delete this.container)},i._show=function(){Kn(this.container,"shown")||(be(this.container,"shown"),this._createPanel())},i._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||Ar(this.container,this.options.containerClass)},i._createPanel=function(){this.panel.innerHTML="";var t=W("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},i._renderLayers=function(t,e){var n=this,s=t.getBaseLayer(),h=t.getLayers(),u=h.length;if(s){var l=s.layers||[s],f=W("li","group"),c=W("ul"),d=W("label");d.innerHTML=this.options.baseTitle,f.appendChild(d);for(var g=0,v=l.length;g<v;g++){var m=l[g];this._isExcluded(m)&&(c.appendChild(this._renderLayer(l[g],!0)),f.appendChild(c),e.appendChild(f))}}if(u){var _=W("li","group"),p=W("ul"),y=W("label"),x=W("input");x.type="checkbox",x.checked=!0,y.innerHTML=this.options.overlayTitle,_.appendChild(x),_.appendChild(y);for(var M=function(P){var O=P.target.checked,I=P.target.parentNode;if(!!I){var E=I.getElementsByTagName("ul")[0];if(!!E){var D=function(G){var F=G._layer;F&&F[O?"show":"hide"]()},R=function(G){var F=G._layer,j=G.childNodes[0];j&&(j.checked=O),F&&F[O?"show":"hide"]()};D(I),E.childNodes.forEach(function(A){R(A);var G=A.getElementsByTagName("ul")[0];!G||(D(A),G.childNodes.forEach(function(F){R(F)}))})}}},w=0;w<u;w++){var b=h[w];this._isExcluded(b)&&(b.getLayers?function(){var T=W("li","group"),P=W("ul"),O=W("label"),I=W("input");O.innerHTML=b.getId(),I.type="checkbox",I.checked=b.isVisible(),I.onchange=M,T.appendChild(I),T.appendChild(O),T.appendChild(P),T._layer=b,p.appendChild(T);var E=b.getLayers()||[];E.forEach(function(D){P.appendChild(n._renderLayer(D,!1,I.checked))})}():p.appendChild(this._renderLayer(b)),b&&!b.isVisible()&&(x.checked=!1))}_.appendChild(p),e.appendChild(_),x.onchange=M}},i._isExcluded=function(t){var e=t.getId(),n=this.options.excludeLayers;return!(n.length&&n.indexOf(e)>=0)},i._renderLayer=function(t,e,n){var s=this;n===void 0&&(n=!0);var h=W("li","layer"),u=W("label"),l=W("input"),f=this.getMap(),c=t.options.visible;t.options.visible=!0;var d=t.isVisible();return t.options.visible=c,h.className="layer",e?(l.type="radio",l.name="base"):l.type="checkbox",l.checked=c&&d,n||(l.checked=!1),d||l.setAttribute("disabled","disabled"),l.onchange=function(g){if(g.target.type==="radio"){var v=f.getBaseLayer(),m=v.layers;if(m)for(var _=0,p=m.length;_<p;_++){var y=m[_];y[y===t?"show":"hide"]()}else v.isVisible()||v.show();f._fireEvent("setbaselayer")}else t[g.target.checked?"show":"hide"]();s.fire("layerchange",{target:t})},h.appendChild(l),u.innerHTML=t.getId(),h.appendChild(u),h._layer=t,h},a}(Qt);ya.mergeOptions(sc);U.mergeOptions({layerSwitcherControl:!1});U.addOnLoadHook(function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new ya(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))});var hc={level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"},xa=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=W("div"),n=this.mapContainer=W("div");n.style.width=t[0]+"px",n.style.height=t[1]+"px",n.className=this.options.containerClass;var s=this.button=W("div");return s.className=this.options.buttonClass,e.appendChild(n),e.appendChild(s),e},i.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),ct(this.button,"click",this._onButtonClick,this),this._updateButtonText()},i.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),ut(this.button,"click",this._onButtonClick)},i.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},i.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width=0+"px",t.style.height=0+"px",this},i.getOverviewMap=function(){return this._overview},i._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},i._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},i._createOverview=function(){var t=this.getMap(),e=this.mapContainer,n=t.config();H(n,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new U(e,n),this._updateBaseLayer(),this._perspective=new mt(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new $t("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},i._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),n=t.getMinZoom(),s=this.options.level;if(s>0){for(var h=s;h>0;h--)if(e-h>=n)return e-h}else for(var u=s;u<0;u++)if(e-u>=n)return e-u;return e},i._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},i._getPerspectiveCoords=function(){var t=this.getMap(),e=t.getProjection();return t.getContainerExtent().toArray().map(function(n){if(e){var s=t._containerPointToPrj(n);return t._fixPrjOnWorldWide(s),e.unproject(s)}return t.containerPointToCoordinate(n)})},i._update=function(){if(!!this._overview){Ri(this._overview._containerDOM);var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},i._updateSpatialReference=function(){if(!!this._overview){var t=this.getMap(),e=t.options.spatialReference;this._overview.setSpatialReference(e)}},i._updateBaseLayer=function(){if(!!this._overview){var t=this.getMap(),e=t.getBaseLayer();if(!e){this._overview.setBaseLayer(null);return}var n=e.layers,s=0;if(n)for(var h=0,u=n.length;h<u;h++){var l=n[h];if(l.isVisible()){s=h;break}}var f=e.toJSON(),c=null;n?(c=f.layers[s].options,c.visible=!0):c=f.options,this._overview.setMinZoom(c.minZoom||null).setMaxZoom(c.maxZoom||null),delete c.minZoom,delete c.maxZoom,delete f.options.canvas,f.options.visible=!0,f.options.renderer="canvas";var d=At.fromJSON(f);for(var g in e)nt(e[g])&&e.hasOwnProperty(g)&&e[g]!==e.constructor.prototype[g]&&(d[g]=e[g]);this._overview.setBaseLayer(d)}},a}(Qt);xa.mergeOptions(hc);U.mergeOptions({overviewControl:!1});U.addOnLoadHook(function(){this.options.overviewControl&&(this.overviewControl=new xa(this.options.overviewControl),this.addControl(this.overviewControl))});var uc={position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0},Dh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(){var t;if(this.options.custom)$(this.options.content)?(t=W("div"),t.innerHTML=this.options.content):t=this.options.content;else{if(t=W("div","maptalks-panel"),this.options.closeButton){var e=W("a","maptalks-close");e.href="javascript:;",e.onclick=function(){t.style.display="none"},t.appendChild(e)}var n=W("div","maptalks-panel-content");n.innerHTML=this.options.content,t.appendChild(n)}return this.draggable=new qe(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},i.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),Qt.prototype.update.call(this)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},i.getContent=function(){return this.options.content},i._cancelOn=function(t){var e=t.srcElement||t.target,n=e.tagName.toLowerCase();return n==="button"||n==="input"||n==="select"||n==="option"||n==="textarea"},i._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=H({},this.getPosition()),this.fire("dragstart",t)},i._onDragging=function(t){var e=t.mousePos,n=e.sub(this._startPos),s=this._startPosition,h=this.getPosition();C(h.top)||(h.top=parseInt(s.top)+n.y),C(h.bottom)||(h.bottom=parseInt(s.bottom)-n.y),C(h.left)||(h.left=parseInt(s.left)+n.x),C(h.right)||(h.right=parseInt(s.right)-n.x),this.setPosition(h),this.fire("dragging",t)},i._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},i._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),n=this.getDOM(),s=parseInt(n.clientWidth),h=parseInt(n.clientHeight),u=[t.containerPointToCoordinate(e.add(s/2,0)),t.containerPointToCoordinate(e.add(s,h/2)),t.containerPointToCoordinate(e.add(s/2,h)),t.containerPointToCoordinate(e.add(0,h/2))];return u},a}(Qt);Dh.mergeOptions(uc);var lc={position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null},wa=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(t){return this._map=t,this._scaleContainer=W("div",this.options.containerClass),this._addScales(),t.on("zoomend",this._update,this),this._map._loaded&&this._update(),this._scaleContainer},i.onRemove=function(){this.getMap().off("zoomend",this._update,this)},i._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=On("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=On("div",this.options.containerClass?null:t,this._scaleContainer))},i._update=function(){var t=this._map,e=t.pixelToDistance(this.options.maxWidth,0);this._updateScales(e)},i._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},i._updateMetric=function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},i._updateImperial=function(t){var e=t*3.2808399,n,s,h;e>5280?(n=e/5280,s=this._getRoundNum(n),this._updateScale(this._iScale,s+" mile",s/n)):(h=this._getRoundNum(e),this._updateScale(this._iScale,h+" feet",h/e))},i._updateScale=function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},i._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n},a}(Qt);wa.mergeOptions(lc);U.mergeOptions({scaleControl:!1});U.addOnLoadHook(function(){this.options.scaleControl&&(this.scaleControl=new wa(this.options.scaleControl),this.addControl(this.scaleControl))});var fc={height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}},Lh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(t){this._map=t;var e=W("div"),n=W("ul","maptalks-toolbar-hx");e.appendChild(n),this.options.vertical?be(e,"maptalks-toolbar-vertical"):be(e,"maptalks-toolbar-horizonal");var s=this;function h(m,_,p,y){var x=s._getItems()[_];return function(M){return Lt(M),m({target:x,index:_,childIndex:p,dom:y})}}var u=this.options.items;if(rt(u))for(var l=0,f=u.length;l<f;l++){var c=u[l],d=W("li");if(this.options.height!==28&&(d.style.lineHeight=this.options.height+"px"),d.style.height=this.options.height+"px",d.style.cursor="pointer",ks(c.item)){d.style.textAlign="center";var g=Ds("div",c.item);d.innerHTML='<div style="margin-top:'+(this.options.height-g.height)/2+'px;">'+c.item+"</div>"}else d.innerHTML=c.item;if(c.click&&ct(d,"click",h(c.click,l,null,d)),rt(c.children)){var v=this._createDropMenu(l);d.appendChild(v),d._menu=v,ct(d,"mouseover",function(){this._menu.style.display=""}),ct(d,"mouseout",function(){this._menu.style.display="none"})}n.appendChild(d)}return e},i._createDropMenu=function(t){var e=this;function n(M,w,b){var T=e._getItems()[w].children[b];return function(P){return Lt(P),M({target:T,index:w,childIndex:b})}}var s=W("div","maptalks-dropMenu"),h=this._getItems(),u=h.length,l=W("ul"),f=h[t].children;t===u-1&&f&&(s.style.cssText="right: 0px;",l.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(l.style.bottom=0)),s.appendChild(W("em","maptalks-ico"));for(var c=0,d=0,g=f.length;d<g;d++){var v=Jn(f[d].item,"12px");v.width>c&&(c=v.width)}for(var m=0,_=f.length;m<_;m++){var p=f[m],y=W("li");y.innerHTML='<a href="javascript:;">'+p.item+"</a>",y.style.cursor="pointer",y.style.width=c+24+"px",ct(y.childNodes[0],"click",n(p.click,t,m)),l.appendChild(y)}if(this.options.vertical){var x=c<95?95:c;this.options.reverseMenu?s.style.right=-(x+10*2)+"px":s.style.left=-(x+10*2)+"px"}else this.options.reverseMenu?s.style.bottom="28px":s.style.top="28px";return s.appendChild(l),s.style.display="none",s},i._getItems=function(){return this.options.items||[]},a}(Qt);Lh.mergeOptions(fc);var cc={position:"top-left",slider:!0,zoomLevel:!0,seamless:!1},Te=10,Ca=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.buildOn=function(t){var e=this.options,n=W("div","maptalks-zoom");if(e.zoomLevel){var s=W("span","maptalks-zoom-zoomlevel");n.appendChild(s),this._levelDOM=s}var h=W("div","maptalks-zoom-slider"),u=W("a","maptalks-zoom-zoomin");if(u.href="javascript:;",u.innerHTML="+",h.appendChild(u),this._zoomInButton=u,e.slider){var l=W("div","maptalks-zoom-slider-box"),f=W("div","maptalks-zoom-slider-ruler"),c=W("span","maptalks-zoom-slider-reading"),d=W("span","maptalks-zoom-slider-dot");f.appendChild(c),l.appendChild(f),l.appendChild(d),h.appendChild(l),this._sliderBox=l,this._sliderRuler=f,this._sliderReading=c,this._sliderDot=d}var g=W("a","maptalks-zoom-zoomout");return g.href="javascript:;",g.innerHTML="-",h.appendChild(g),this._zoomOutButton=g,n.appendChild(h),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),n},i.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._zoomInButton&&ut(this._zoomInButton,"click",this._onZoomInClick),this._zoomOutButton&&ut(this._zoomOutButton,"click",this._onZoomOutClick),this._sliderRuler&&(ut(this._sliderRuler,"click",this._onClickRuler),this.dotDragger.disable(),delete this.dotDragger)},i._update=function(){var t=this.getMap();if(this._sliderBox){var e=(t.getMaxZoom()-t.getMinZoom())*Te;this._sliderBox.style.height=e+16+"px",this._sliderRuler.style.height=e+8+"px",this._sliderRuler.style.cursor="pointer";var n=(t.getMaxZoom()-t.getZoom())*Te;this._sliderReading.style.height=(t.getZoom()-t.getMinZoom()+1)*Te+"px",this._sliderDot.style.top=n+"px"}this._updateText()},i._updateText=function(){if(this._levelDOM){var t=this.getMap(),e=t.getZoom();ie(e)||(e=Math.floor(e*10)/10),this._levelDOM.innerHTML=e}},i._registerDomEvents=function(){this._zoomInButton&&ct(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&ct(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(ct(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger=new qe(this._sliderDot,{ignoreMouseleave:!0}),this.dotDragger.on("dragstart",this._onDotDragstart,this).on("dragging dragend",this._onDotDrag,this).enable())},i._onZoomInClick=function(t){It(t),this.getMap().zoomIn()},i._onZoomOutClick=function(t){It(t),this.getMap().zoomOut()},i._onClickRuler=function(t){It(t);var e=this.getMap(),n=Et(t,this._sliderRuler),s=n.y,h=e.getMaxZoom(),u=Math.floor(h-s/Te);e.setZoom(u)},i._onDotDragstart=function(t){It(t.domEvent);var e=this.getMap(),n=e.getSize().toPoint()._multi(1/2);e.onZoomStart(e.getZoom(),n)},i._onDotDrag=function(t){It(t.domEvent);var e=this.getMap(),n=e.getSize().toPoint()._multi(1/2),s=Et(t.domEvent,this._sliderRuler),h=e.getMaxZoom(),u=e.getMinZoom(),l=s.y,f=h-l/Te;h<f?(f=h,l=0):u>f&&(f=u,l=(h-u)*Te),t.type==="dragging"?e.onZooming(f,n,1):t.type==="dragend"&&(this.options.seamless?e.onZoomEnd(f,n):e.onZoomEnd(Math.round(f),n)),this._sliderDot.style.top=l+"px",this._sliderReading.style.height=(e.getZoom()-u+1)*Te+"px",this._updateText()},a}(Qt);Ca.mergeOptions(cc);U.mergeOptions({zoomControl:!1});U.addOnLoadHook(function(){this.options.zoomControl&&(this.zoomControl=new Ca(this.options.zoomControl),this.addControl(this.zoomControl))});var _d=Object.freeze({Control:Qt,Attribution:pa,LayerSwitcher:ya,Overview:xa,Panel:Dh,Scale:wa,Toolbar:Lh,Zoom:Ca}),_e=function(){function o(a,i,r,t){Array.isArray(a)?(this.scale={x:a[0],y:a[1]},this.origin={x:a[2],y:a[3]}):(this.scale={x:a,y:i},this.origin={x:r,y:t})}return o.getDefault=function(i){return i.code.toLowerCase()==="baidu"?"baidu":i.code.toLowerCase()==="EPSG:4326".toLowerCase()?"tms-global-geodetic":i.code.toLowerCase()==="identity"?[1,-1,0,0]:"web-mercator"},o}(),Xi=6378137*Math.PI;H(_e,{"web-mercator":new _e([1,-1,-Xi,Xi]),"tms-global-mercator":new _e([1,1,-Xi,-Xi]),"tms-global-geodetic":new _e([1,1,-180,-90]),baidu:new _e([1,1,0,0])});var Go=function(){function o(i,r,t,e){this.map=i,this.tileSize=e,this.fullExtent=t,this.prepareTileInfo(r,t),this._xScale=t.right>=t.left?1:-1,this._yScale=t.top>=t.bottom?1:-1;var n=i.getGLRes();this._pointOrigin=i._prjToPointAtRes(new S(this.tileSystem.origin),n),this._glRes=n}var a=o.prototype;return a.prepareTileInfo=function(r,t){if($(r)?r=_e[r.toLowerCase()]:Array.isArray(r)&&(r=new _e(r)),!r)throw new Error("Invalid TileSystem");this.tileSystem=r;var e=t.right>t.left?1:-1,n=t.top>t.bottom?-1:1,s=r.origin.x,h=r.origin.y;this.transformation=new Ns([e,n,s,h])},a._getTileNum=function(r,t){var e=this.tileSystem,n=this.tileSize,s=1e-7,h=Math.floor(s*e.scale.x+r.x/(n.width*t)),u=Math.ceil(s*e.scale.y+r.y/(n.height*t));return{x:e.scale.x*h,y:e.scale.y*u}},a.getTileIndex=function(r,t,e){var n=this.tileSystem,s=this.transformation.transform(r,1),h=this._getTileNum(s,t);return n.scale.x<0&&(h.x-=1),n.scale.y>0&&(h.y-=1),this.getNeighorTileIndex(h.x,h.y,0,0,t,e)},a.getNeighorTileIndex=function(r,t,e,n,s,h){var u=this.tileSystem,l=r+u.scale.x*e,f=t-u.scale.y*n,c=!1,d=l,g=f,v=this._getTileFullIndex(s);return h&&((h===!0||h==="x")&&(v.xmax===v.xmin?l=v.xmin:l<v.xmin?(l=v.xmax-(v.xmin-l)%(v.xmax-v.xmin),l===v.xmax&&(l=v.xmin)):l>=v.xmax&&(l=v.xmin+(l-v.xmin)%(v.xmax-v.xmin))),(h===!0||h==="y")&&(v.ymax===v.ymin?f=v.ymin:f>=v.ymax?f=v.ymin+(f-v.ymin)%(v.ymax-v.ymin):f<v.ymin&&(f=v.ymax-(v.ymin-f)%(v.ymax-v.ymin),f===v.ymax&&(f=v.ymin)))),(l<v.xmin||l>v.xmax||f>v.ymax||f<v.ymin)&&(c=!0),{x:l,y:f,idx:d,idy:g,out:c}},a._getTileFullIndex=function(r){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[r])return this._tileFullIndex[r];var t=this.fullExtent,e=this.transformation,n=this._getTileNum(e.transform(new k(t.left,t.top),1),r),s=this._getTileNum(e.transform(new k(t.right,t.bottom),1),r),h=this.tileSystem;return h.scale.x<0&&(n.x-=1,s.x-=1),h.scale.y>0&&(n.y-=1,s.y-=1),this._tileFullIndex[r]=new st(n,s),this._tileFullIndex[r]},a.getTilePrjNW=function(r,t,e){var n=this.tileSystem,s=this.tileSize,h=n.origin.y+this._yScale*n.scale.y*(t+(n.scale.y===1?1:0))*e*s.height,u=n.origin.x+this._xScale*n.scale.x*(r+(n.scale.x===1?0:1))*e*s.width;return new k(u,h)},a.getTilePointNW=function(r,t,e){var n=this._glRes/e,s=this.tileSystem,h=this.tileSize,u=this._pointOrigin.y*n+this._yScale*s.scale.y*(t+(s.scale.y===1?1:0))*h.height,l=this._pointOrigin.x*n+this._xScale*s.scale.x*(r+(s.scale.x===1?0:1))*h.width;return new S(l,u)},a.getTilePrjSE=function(r,t,e){var n=this.tileSystem,s=this.tileSize,h=n.origin.y+this._yScale*n.scale.y*(t+(n.scale.y===1?0:1))*e*s.height,u=n.origin.x+this._xScale*n.scale.x*(r+(n.scale.x===1?1:0))*e*s.width;return new k(u,h)},a.getTilePointSE=function(r,t,e){var n=this._glRes/e,s=this.tileSystem,h=this.tileSize,u=this._pointOrigin.y*n+this._yScale*s.scale.y*(t+(s.scale.y===1?0:1))*h.height,l=this._pointOrigin.x*n+this._xScale*s.scale.x*(r+(s.scale.x===1?1:0))*h.width;return new S(l,u)},a.getTilePrjExtent=function(r,t,e){var n=this.getTilePrjNW(r,t,e),s=this.getTilePrjSE(r,t,e);return new st(n,s)},o}(),dc=1,ui=new S(0,0),gc=32,qi=typeof Set<"u",No=function(){function o(){this._table=qi?new Set:{}}var a=o.prototype;return a.add=function(r){qi?this._table.add(r):this._table[r]=!0},a.has=function(r){return qi?this._table.has(r):this._table[r]},a.reset=function(){qi?this._table.clear():this._table={}},o}(),vc={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,backgroundZoomDiff:6,loadingLimitOnInteracting:3,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!pt,debug:!1,spatialReference:null,maxCacheSize:256,renderer:function(){return q.webgl?"gl":"canvas"}(),clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,backZoomOffset:0},mc=/\{ *([\w_]+) *\}/g,_c=new S(0,0),$i=new S(0,0),li=new S(0,0),fe=new S(0,0),pc=new S(0,0),yc=new S(0,0),St=[[0,0,0],[0,0,0]],yn=[0,0,0],xn=[0,0,0],wn=[],Vt=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}a.fromJSON=function(t){return!t||t.type!=="TileLayer"?null:new a(t.id,t.options)};var i=a.prototype;return i.getTileSize=function(){if(this._tileSize)return this._tileSize;var t=this.options.tileSize;return N(t)&&(t=[t,t]),this._tileSize=new vt(t),this._tileSize},i.getTiles=function(t,e){return this._coordCache={},this._isPyramidMode()?this._getPyramidTiles(t,e):this._getCascadeTiles(t,e)},i._isPyramidMode=function(){var t=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&t&&t.isPyramid()},i._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var t=this.getSpatialReference(),e=t.getFullExtent(),n=t.getResolution(0),s=this.getMap();return this._tileFullExtent=e.convertTo(function(h){return s._prjToPointAtRes(h,n,ui)}),this._tileFullExtent},i._getRootNodes=function(t){var e=this.getMap();if(this._rootNodes){var n=this._rootNodes,s=n.tiles,h=n.mapWidth,u=n.mapHeight;if(e.width!==h||e.height!==u){for(var l=this._getRootError(),f=0;f<s.length;f++)s[f].error=l;this._rootNodes.mapWidth=e.width,this._rootNodes.mapHeight=e.height}for(var c=0;c<s.length;c++)s[c].offset[0]=t[0],s[c].offset[1]=t[1];return this._rootNodes}var d=this.getSpatialReference(),g=d.getResolution(0),v=this._getTileConfig(),m=d.getFullExtent(),_=v.tileSystem,p=_.origin,y=_.scale,x=v.getTilePrjExtent(0,0,g),M=x.getWidth(),w=x.getHeight(),b=1e-5,T=Math.abs((p.x-m.left)/M);T=Math.ceil(T-b);var P=Math.abs((m.right-p.x)/M);P=Math.ceil(P-b);var O=Math.ceil(Math.abs(m.top-p.y)/w);O=Math.ceil(O-b);var I=Math.ceil(Math.abs(m.bottom-p.y)/w);if(I=Math.ceil(I-b),(P+T)*(I+O)>gc)return{status:0,error:"Too many root nodes"};for(var E=this._getRootError(),D=[],R=0,A=-T;A<P;A++)for(var G=-O;G<I;G++){var F=y.y<0?G:-(G+1);D.push({x:A,y:F,z:R,idx:A,idy:F,res:g,extent2d:v.getTilePrjExtent(A,F,g).convertTo(function(j){return e._prjToPointAtRes(j,g,ui)}),id:this._getTileId(A,F,R),url:this.getTileUrl(A,F,R+this.options.zoomOffset),offset:[0,0],error:E,children:[]})}return this._rootNodes={status:1,tiles:D,mapWidth:e.width,mapHeight:e.height},this._getRootNodes(t)},i._getRootError=function(){var t=this.getMap(),e=Ct(t.getFov()),n=t.width/t.height,s=t.cameraPosition[2],h=s*Math.tan(.5*e),u=h*n,l=Math.sqrt(s*s+h*h+u*u),f=t._getFovZ(0),c=f*(l/s),d=this.getSpatialReference(),g=d.getResolution(0);return c*g/t.getResolution(0)},i._getPyramidTiles=function(t,e){var n=this.getMap();isNaN(+t)&&(t=this._getTileZoom(n.getZoom()));var s=this.getSpatialReference(),h=Math.min(t,this.getMaxZoom()),u=n.projViewMatrix,l=this._getTileFullExtent(),f=this._getTileOffset(0),c;if(this.options.repeatWorld){var d=n.getContainerExtent(),g=this._convertToExtent2d(d),v=s.getResolution(0)/n.getResolution();if(g.within(l.copy()._scale(v))){var w=this._getRootNodes(f);if(w.status!==1)return this._disablePyramid=!0,this.getTiles(t,e);c=w.tiles.concat()}else{var m=n.getPitch(),_=n.options.cascadePitches[1],p=Math.floor(n._getVisualHeight(_)),y=m<=_?d:new Y(0,n.height-p,n.width,n.height);this._visitedTiles=new No;var x=this._getTiles(0,y,2,e&&e.getRenderer(),!0),M=this._getRootError();x.tiles.forEach(function(R){R.error=M}),c=x.tiles}}else{var b=this._getRootNodes(f);if(b.status!==1)return this._disablePyramid=!0,this.getTiles(t,e);c=b.tiles.concat()}for(var T=n.getGLRes(),P={0:f},O=this.options.backZoomOffset+t,I=new Y,E=[];c.length>0;){var D=c.pop();if(D.z===h){I._combine(D.extent2d),E.push(D);continue}P[D.z+1]||(P[D.z+1]=this._getTileOffset(D.z+1)),this._splitNode(D,u,c,E,I,h,P[D.z+1],e&&e.getRenderer(),T),O<t&&E[E.length-1]!==D&&O===D.z&&E.push(D)}return{tileGrids:[{extent:I,count:E.length,tiles:E,offset:[0,0],zoom:t}],count:E.length}},i._splitNode=function(t,e,n,s,h,u,l,f,c){for(var d=this._getTileConfig().tileSystem,g=d.scale.y,v=t.z+1,m=this.getSpatialReference(),_=t.x,p=t.y,y=t.extent2d,x=t.idx,M=t.idy,w=2,b=y.getWidth()/2*w,T=y.getHeight()/2*w,P=y.xmin*w,O=y.ymax*w,I=y.ymin*w,E=f||this.getRenderer(),D=!1,R=[],A=m.getResolution(v),G=A/c,F=0;F<4;F++){var j=F%2,Z=F>>1,V=(_<<1)+j,J=(p<<1)+Z,ot=(x<<1)+j,ft=(M<<1)+Z;t.children||(t.children=[]);var et=t.children[F];et||(et=this._getTileId(ot,ft,v),t.children[F]=et);var X=E.isTileCachedOrLoading(et),tt=void 0,it=X&&X.info;if(!it){if(this.tileInfoCache||(this.tileInfoCache=new Hs(this.options.maxCacheSize*4)),it=this.tileInfoCache.get(et),!it){if(g<0){var bt=P+j*b,Q=O-Z*T;tt=new Y(bt,Q-T,bt+b,Q)}else{var wt=P+j*b,Ot=I+Z*T;tt=new Y(wt,Ot,wt+b,Ot+T)}it={x:V,y:J,idx:ot,idy:ft,z:v,extent2d:tt,error:t.error/2,res:A,id:et,parentNodeId:t.id,children:[],url:this.getTileUrl(V,J,v+this.options.zoomOffset),offset:l},this.tileInfoCache.add(et,it)}f&&(it.layer=this.getId())}it.error=t.error/2,it.offset[0]=l[0],it.offset[1]=l[1];var ht=this._isTileVisible(it,e,G,u,l);if(ht===1)D=!0;else{if(ht===-1)continue;if(ht===0&&v!==u){s.push(t),h._combine(t.extent2d);return}}R.push(it)}v===u?D?n.push.apply(n,R):(s.push(t),h._combine(t.extent2d)):n.push.apply(n,R)},i._isTileVisible=function(t,e,n,s,h){if(t.z===0)return 1;if(!this._isTileInFrustum(t,e,n,h))return-1;var u=this.options.maxError;C(u)&&(u=dc);var l=this._getScreenSpaceError(t,n,s,h);return l>=u?1:0},i._isTileInFrustum=function(t,e,n,s){if(!this._zScale){var h=this.getMap(),u=h.getGLRes();this._zScale=h.altitudeToPoint(100,u)/100}var l=t.extent2d,f=l.xmin,c=l.ymin,d=l.xmax,g=l.ymax;return St[0][0]=(f-s[0])*n,St[0][1]=(c-s[1])*n,St[0][2]=(t.minAltitude||0)*this._zScale,St[1][0]=(d-s[0])*n,St[1][1]=(g-s[1])*n,St[1][2]=(t.maxAltitude||0)*this._zScale,Br(e,St)},i._getScreenSpaceError=function(t,e,n,s){var h=t.error,u=this.getMap(),l=t.extent2d,f=l.xmin,c=l.ymin,d=l.xmax,g=l.ymax;yn[0]=(f-s[0])*e,yn[1]=(c-s[1])*e,xn[0]=(d-s[0])*e,xn[1]=(g-s[1])*e;var v=xc(yn,xn,u.cameraPosition),m=Math.max(Math.abs(v),1e-7),_=Math.abs(t.z-n),p;u.height<1e3?p=1:p=_<=1?1:_<=2?.7:.605;var y=h*p/m;return y},i._getCascadeTiles=function(t,e){var n=this.getMap(),s=n.getPitch(),h=e&&e.getRenderer(),u=n.getContainerExtent(),l=[],f=0,c=this.getMinZoom(),d=n.options.cascadePitches[0],g=n.options.cascadePitches[1],v=Math.floor(n._getVisualHeight(g)),m=C(t)?this._getTileZoom(n.getZoom()):t;if(this._visitedTiles=new No,!C(t)||!this.options.cascadeTiles||s<=d||!C(c)&&m<=c){var _=s<=g?u:new Y(0,n.height-v,n.width,n.height),p=this._getTiles(m,_,2,h);return p&&(f+=p.tiles.length,l.push(p)),{tileGrids:l,count:f}}var y=Math.floor(n._getVisualHeight(d)),x=new Y(0,n.height-y,n.width,n.height),M=this._getTiles(m,x,0,h);f+=M?M.tiles.length:0,l.push(M);var w=x.ymin,b=n.getSpatialReference().getZoomDirection(),T=b,P;if(s>g){m-T<=c&&(T=0);var O=new Y(0,n.height-v,n.width,w);P=this._getTiles(m-T,O,1,h),f+=P?P.tiles.length:0,w=O.ymin,T+=4*b,l.push(P)}var I;if(m-T>=c){var E=new Y(0,u.ymin,n.width,w);I=this._getTiles(m-T,E,2,h),f+=I?I.tiles.length:0,l.push(I)}return P&&I&&(l[1]=I,l[2]=P),{tileGrids:l,count:f}},i.getTileUrl=function(t,e,n){var s=this.options.urlTemplate,h="";if(this.options.subdomains){var u=this.options.subdomains;if(rt(u)){var l=u.length,f=(t+e)%l;f<0&&(f=0),h=u[f]}}if(nt(s))return s(t,e,n,h);var c={x:t,y:e,z:n,s:h};return this.options.token&&(c.token=this.options.token),this.options.customTags&&H(c,this.options.customTags),s.replace(mc,function(d,g){var v=c[g];if(v===void 0)throw new Error("No value provided for variable "+d);return typeof v=="function"&&(v=v(c)),v})},i.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},i.toJSON=function(){var t={type:this.getJSONType(),id:this.getId(),options:this.config()};return t},i.getSpatialReference=function(){var t=this.getMap();if(t&&(!this.options.spatialReference||Yt.equals(this.options.spatialReference,t.options.spatialReference)))return t.getSpatialReference();if(this._sr)return this._sr;var e=this.options.spatialReference;if($(e)&&(e=Yt.getPreset(e),!e))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+Yt.getAllPresets().join());return this._sr=new Yt(e),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==t.getSpatialReference().toJSON().projection,this._sr},i.getMinZoom=function(){var t=this.getSpatialReference();return t!==this.getMap().getSpatialReference()?Math.max(o.prototype.getMinZoom.call(this),this._srMinZoom):o.prototype.getMinZoom.call(this)},i.getMaxZoom=function(){var t=this.getSpatialReference();return t!==this.getMap().getSpatialReference()?Math.min(o.prototype.getMaxZoom.call(this),this._srMaxZoom):o.prototype.getMaxZoom.call(this)},i._getTileZoom=function(t){if(!this._hasOwnSR){var e=this.getMap().getResolution(t),n=this.getSpatialReference().getResolution(t),s=Math.log(n/e)*Math.LOG2E;t+=s}var h=this.options.maxAvailableZoom;return!C(h)&&t>h&&(t=h),ie(t)||(t=Math.round(t)),t=Math.max(0,t),t},i._getTiles=function(t,e,n,s,h){var u=this.getMap(),l=t,f=u.projViewMatrix,c=u.getResolution(t)/u.getResolution(t-1)===.5;n<2&&(n===0&&c&&(l-=1),f=n===0?u.cascadeFrustumMatrix0:n===1?u.cascadeFrustumMatrix1:u.projViewMatrix);var d=l+this.options.zoomOffset,g=this._getTileOffset(d),v=g[0]||g[1],m={zoom:l,extent:null,offset:g,tiles:[]};if(d<0||!u||!this.isVisible()||!u.width||!u.height)return m;if(!h){var _=this.getMinZoom(),p=this.getMaxZoom();if(!C(_)&&l<_||!C(p)&&l>p)return m}var y=this._getTileConfig();if(!y)return m;var x={zoom:g},M=this.getSpatialReference(),w=M.getResolution(d),b;this._hasOwnSR?b=u.getGLScale(l):b=w/u.getGLRes();var T=!this._hasOwnSR&&this.options.repeatWorld,P=this._convertToExtent2d(e),O=this._getMask2DExtent();if(O){var I=O.intersection(P);if(!I)return m;e=I.convertTo(function(De){return u._pointToContainerPoint(De,void 0,0,ui)})}var E=u._containerPointToPrj(e.getCenter(),_c),D=u._prjToPoint(E,d,$i),R;v?R=this._project(u._pointToPrj(D._add(g),d,$i),$i):R=this._project(E,$i);var A=u.getGLScale()/u.getGLScale(d);li.x=P.xmin*A,li.y=P.ymax*A,fe.x=P.xmax*A,fe.y=P.ymin*A;for(var G=this._project(u._pointToPrj(li._add(g),d,li),li),F=this._project(u._pointToPrj(fe._add(g),d,fe),fe),j=y.getTileIndex(R,w,T),Z=y.getTileIndex(G,w,T),V=y.getTileIndex(F,w,T),J=Math.ceil(Math.abs(j.idy-Z.idy)),ot=Math.ceil(Math.abs(j.idx-Z.idx)),ft=Math.ceil(Math.abs(j.idy-V.idy)),et=Math.ceil(Math.abs(j.idx-V.idx)),X=(J+ft+1)*(ot+et+1),tt=this.getTileSize(),it=this.getRenderer()||s,bt=this._getTileConfig().tileSystem.scale,Q=[],wt=new Y,Ot=new S(0,0),ht=-J;ht<=ft;ht++)for(var Tt=-ot,zt=-1/0,Kt=!1;Tt>=zt&&Tt<=et;){var at=y.getNeighorTileIndex(j.idx,j.idy,Tt,ht,w,T);zt===-1/0?Tt++:Tt--;var se=this._getTileId(at.idx,at.idy,l);if(!(at.out||this._visitedTiles&&this._visitedTiles.has(se))){var kt=it&&it.isTileCachedOrLoading(se);kt&&(kt=kt.info);var Jt=void 0;if(kt){var Qh=kt,ka=Qh.extent2d;Ot.set(ka.xmin,ka.ymax),Jt=Ot}else if(!this._hasOwnSR)Jt=y.getTilePointNW(at.x,at.y,w);else{var Kh=y.getTilePrjNW(at.x,at.y,w);Jt=u._prjToPoint(this._unproject(Kh,fe),l)}var ki=void 0,Di=void 0;if(!this._hasOwnSR)ki=tt.width,Di=tt.height;else{var Li=void 0;if(!this._hasOwnSR)Li=y.getTilePointSE(at.x,at.y,w);else{var tu=y.getTilePrjSE(at.x,at.y,w);Li=u._prjToPoint(this._unproject(tu,fe),l,fe)}ki=Math.ceil(Math.abs(Li.x-Jt.x)),Di=Math.ceil(Math.abs(Li.y-Jt.y))}var Hr=bt.x*(at.idx-at.x)*ki,Fr=bt.y*(at.idy-at.y)*Di;!kt&&(Hr||Fr)&&Jt._add(Hr,Fr);var ei=kt&&kt.extent2d||new Y(Jt.x,Jt.y-Di,Jt.x+ki,Jt.y);if(X<=4||Kt||this._isTileInExtent(f,ei,g,b)){var Da=this._hasOwnSR?u._getResolution(l):w;this._visitedTiles&&n===0&&this._visitedTiles.add(se),c&&n===0?(this._splitTiles(f,Q,it,at,l+1,Da,ei,Hr,Fr,x,s),wt._combine(ei)):(kt?(kt.offset[0]=g[0],kt.offset[1]=g[1]):(kt={z:l,x:at.x,y:at.y,idx:at.idx,idy:at.idy,extent2d:ei,offset:g,id:se,res:Da,url:this.getTileUrl(at.x,at.y,l)},s&&(kt.layer=this.getId())),Q.push(kt),wt._combine(ei)),zt===-1/0?(zt=Tt,Tt=et):Kt||(Kt=!0)}}}if(Q.length){var La=u._containerPointToPoint(e.getCenter(),l,ui)._add(g),Ia=new S(0,0),za=new S(0,0);Q.sort(function(De,Ii){return Ia.set((De.extent2d.xmin+De.extent2d.xmax)/2,(De.extent2d.ymin+De.extent2d.ymax)/2),za.set((Ii.extent2d.xmin+Ii.extent2d.xmax)/2,(Ii.extent2d.ymin+Ii.extent2d.ymax)/2),Ia.distanceTo(La)-za.distanceTo(La)})}return{offset:g,zoom:t,extent:wt,tiles:Q}},i._convertToExtent2d=function(t){var e=this,n=this.getMap();return t.convertTo(function(s){var h;if(s.y>0&&s.y<n.height){var u=(s.x===0?0:1)+s.y;e._coordCache[u]||(e._coordCache[u]=n._containerPointToPoint(s)),h=e._coordCache[u]}return h=n._containerPointToPoint(s,void 0,ui),h})},i._splitTiles=function(t,e,n,s,h,u,l,f,c,d,g){var v=this._getTileConfig().tileSystem.scale.y,m=this.getMap().getGLScale(h),_=pc.set(l.xmin*2,v<0?l.ymax*2:l.ymin*2),p=l.getWidth(),y=l.getHeight(),x=s.idx*2,M=s.idy*2,w=s.x*2,b=s.y*2,T=this._checkAndAddTile(t,n,x,M,w,b,h,u,0,0,p,y,_,m,d,g);T&&e.push(T),T=this._checkAndAddTile(t,n,x,M,w,b,h,u,0,1,p,y,_,m,d,g),T&&e.push(T),T=this._checkAndAddTile(t,n,x,M,w,b,h,u,1,0,p,y,_,m,d,g),T&&e.push(T),T=this._checkAndAddTile(t,n,x,M,w,b,h,u,1,1,p,y,_,m,d,g),T&&e.push(T)},i._checkAndAddTile=function(t,e,n,s,h,u,l,f,c,d,g,v,m,_,p,y){var x=this._getTileId(n+c,s+d,l);if(this._visitedTiles&&this._visitedTiles.has(x))return null;var M=p[l];M||(M=p[l]=this._getTileOffset(l));var w=this._getTileConfig().tileSystem.scale.y,b=new Y(m.x+c*g,m.y+w*d*v,m.x+(c+1)*g,m.y+w*(d+1)*v);if(!this._isSplittedTileInExtent(t,b,M,_))return null;var T=f/2,P=e&&e.isTileCachedOrLoading(x);return P?P=P.info:(P={z:l,x:h+c,y:u+d,extent2d:b,id:x,offset:M,res:T,url:this.getTileUrl(h+c,u+d,l+this.options.zoomOffset)},y&&(P.layer=this.getId())),P},i._getTileOffset=function(t){var e=this.options.offset;return nt(e)&&(e=e.call(this,t)),N(e)?[e,e]:e||[0,0]},i._getTileId=function(t,e,n,s){return(s||this.getId())+"_"+e+"_"+t+"_"+n},i._project=function(t,e){if(this._hasOwnSR){var n=this.getMap(),s=n.getProjection(),h=this.getSpatialReference().getProjection();return h.project(s.unproject(t,e),e)}else return t},i._unproject=function(t,e){if(this._hasOwnSR){var n=this.getMap(),s=this.getSpatialReference(),h=n.getProjection(),u=s.getProjection();return h.project(u.unproject(t,e),e)}else return t},i._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),n=this.getSpatialReference(),s=n.getProjection(),h=n.getFullExtent();this._defaultTileConfig=new Go(t,_e.getDefault(s),h,e),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new Go(t,this.options.tileSystem,h,e)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},i._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},i._bindMap=function(t){var e=t.getBaseLayer();return e===this&&(e.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),this._onSpatialReferenceChange(),o.prototype._bindMap.apply(this,arguments)},i._isTileInExtent=function(t,e,n,s){var h=this.getMap(),u;if(t!==h.projViewMatrix){var l=e.getCenter(yc)._sub(n[0],n[1])._multi(s);Ft(wn,l.x,l.y,0);var f=If(wn,wn,h.projViewMatrix);u=f[1]<0?h.projViewMatrix:t}else u=h.projViewMatrix;return St[0][0]=(e.xmin-n[0])*s,St[0][1]=(e.ymin-n[1])*s,St[1][0]=(e.xmax-n[0])*s,St[1][1]=(e.ymax-n[1])*s,Br(u,St)},i._isSplittedTileInExtent=function(t,e,n,s){var h=this.getMap();return St[0][0]=(e.xmin-n[0])*s,St[0][1]=(e.ymin-n[1])*s,St[1][0]=(e.xmax-n[0])*s,St[1][1]=(e.ymax-n[1])*s,Br(h.projViewMatrix,St)},i.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},i._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var t=this.getRenderer();t&&t.clear()},a}(At);Vt.registerJSONType("TileLayer");Vt.mergeOptions(vc);function xc(o,a,i){var r=Math.max(o[0]-i[0],0,i[0]-a[0]),t=Math.max(o[1]-i[1],0,i[1]-a[1]),e=Math.max(o[2]-i[2],0,i[2]-a[2]);return Math.sqrt(r*r+t*t+e*e)}var wc=`
function (exports) {
    exports.onmessage = function (msg, postResponse) {
        var url = msg.data.url;
        var fetchOptions = msg.data.fetchOptions;
        requestImageOffscreen(url, function (err, data) {
            var buffers = [];
            if (data && data.data && data.data.buffer) {
                buffers.push(data.data.buffer);
            }
            postResponse(err, data, buffers);
        }, fetchOptions);
    };

    var offCanvas, offCtx;
    function requestImageOffscreen(url, cb, fetchOptions) {
        if (!offCanvas) {
            offCanvas = new OffscreenCanvas(2, 2);
            offCtx = offCanvas.getContext('2d');
        }
        fetch(url, fetchOptions ? fetchOptions : {})
            .then(response => response.blob())
            .then(blob => createImageBitmap(blob))
            .then(bitmap => {
                var { width, height } = bitmap;
                offCanvas.width = width;
                offCanvas.height = height;
                offCtx.drawImage(bitmap, 0, 0);
                bitmap.close();
                var imgData = offCtx.getImageData(0, 0, width, height);
                // debugger
                cb(null, { width, height, data: new Uint8Array(imgData.data) });
            }).catch(err => {
                console.warn('error when loading tile:', url);
                console.warn(err);
                cb(err);
            });
    }
}`;function Cc(){!q.decodeImageInWorker||gl(oa,function(){return wc})}Cc();var Pc={maxCacheSize:1024},Mc=new vt(256,256),fi="show hide remove";function Zo(o){return Array.isArray(o)||(o=[o]),o}var Pa=function(o){z(a,o),a.fromJSON=function(t){if(!t||t.type!=="GroupTileLayer")return null;var e=t.layers.map(function(n){return At.fromJSON(n)});return new a(t.id,e,t.options)};function a(r,t,e){var n;return n=o.call(this,r,e)||this,n.layers=t||[],n._checkChildren(),n.layerMap={},n._groupChildren=[],n}var i=a.prototype;return i.getLayers=function(){return this.layers},i.addLayer=function(t){var e=this;t===void 0&&(t=[]),t=Zo(t);var n=this.layers.length;return t.forEach(function(s){s instanceof Vt&&e.layers.indexOf(s)===-1&&!e.layerMap[s.getId()]&&e.layers.push(s)}),n!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},i.removeLayer=function(t){var e=this;t===void 0&&(t=[]),t=Zo(t);var n=this.layers.length;return t.forEach(function(s){if(s instanceof Vt||(s=e.layerMap[s]),s instanceof Vt){var h=e.layers.indexOf(s);h>=0&&(e.layers.splice(h,1),s._doRemove(),s.off(fi,e._onLayerShowHide,e))}}),n!==this.layers.length&&(this._refresh(),this._renderLayers()),this},i.clearLayers=function(){var t=this;return this.layers.forEach(function(e){e._doRemove(),e.off(fi,t._onLayerShowHide,t)}),this.layers=[],this._refresh(),this._renderLayers(),this},i.toJSON=function(){var t={type:this.getJSONType(),id:this.getId(),layers:this.layers.map(function(e){return e.toJSON()}),options:this.config()};return t},i.getTileSize=function(t){var e=this.getLayer(t);return e?e.getTileSize():Mc},i.getTiles=function(t,e){for(var n=this.layers,s=[],h=0,u=0,l=n.length;u<l;u++){var f=n[u];if(!(!f||!f.options.visible||!f.isVisible()||!f.getMap())){var c=f.getTiles(t,e||this);!c||c.count===0||(h+=c.count,ke(s,c.tileGrids))}}return{count:h,tileGrids:s}},i.onAdd=function(){this._sortLayers(),this._refresh(),o.prototype.onAdd.call(this)},i.onRemove=function(){var t=this;this.layers.forEach(function(e){e._doRemove(),e.off(fi,t._onLayerShowHide,t)}),this.layerMap={},this._groupChildren=[],o.prototype.onRemove.call(this)},i.getLayer=function(t){return this.getChildLayer(t)},i.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var n=0;n<this._groupChildren.length;n++){var s=this._groupChildren[n].getChildLayer(t);if(s)return s}return null},i._onLayerShowHide=function(t){var e=t||{},n=e.type,s=e.target;return n==="remove"&&s&&(this.layers.splice(this.layers.indexOf(s),1),s._doRemove(),s.off(fi,this._onLayerShowHide,this),this._refresh()),this._renderLayers(),this},i._renderLayers=function(){var t=this.getRenderer();return t&&t.setToRedraw(),this},i._refresh=function(){var t=this,e=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach(function(n){t.layerMap[n.getId()]=n,n.getChildLayer&&t._groupChildren.push(n),n.getMap()||n._bindMap(e),n.on(fi,t._onLayerShowHide,t)}),this},i.isVisible=function(){if(!o.prototype.isVisible.call(this))return!1;for(var t=this.layers,e=0,n=t.length;e<n;e++)if(t[e].isVisible())return!0;return!1},i._checkChildren=function(){var t=this,e={};this.layers.forEach(function(n){var s=n.getId();if(e[s])throw new Error("Duplicate child layer id ("+s+") in the GroupTileLayer ("+t.getId()+")");e[s]=1})},i._sortLayers=function(){this.layers.sort(function(t,e){return t.options.zIndex-e.options.zIndex})},a}(Vt);Pa.registerJSONType("GroupTileLayer");Pa.mergeOptions(Pc);var Ih={crs:null,uppercase:!1,detectRetina:!1},Tc={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},zh=function(o){z(a,o);function a(r,t){var e;e=o.call(this,r)||this;var n=H({},Tc);for(var s in t)s in e.options||(n[s]=t[s]);e.setOptions(t),e.setZIndex(t.zIndex);var h=e.getTileSize();return n.width=h.width,n.height=h.height,e.wmsParams=n,e._wmsVersion=parseFloat(n.version),e}var i=a.prototype;return i.onAdd=function(){var t=this.getMap().getDevicePixelRatio(),e=Ih.detectRetina?t:1;this.wmsParams.width*=e,this.wmsParams.height*=e;var n=this.options.crs||this.getMap().getProjection().code,s=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[s]=n,o.prototype.onAdd.call(this)},i.getTileUrl=function(t,e,n){var s=this.getSpatialReference().getResolution(n),h=this._getTileConfig(),u=h.getTilePrjExtent(t,e,s),l=u.getMax(),f=u.getMin(),c=(this._wmsVersion>=1.3&&this.wmsParams.crs==="EPSG:4326"?[f.y,f.x,l.y,l.x]:[f.x,f.y,l.x,l.y]).join(","),d=o.prototype.getTileUrl.call(this,t,e,n);return d+Sc(this.wmsParams,d,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+c},i.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},a.fromJSON=function(t){return!t||t.type!=="WMSTileLayer"?null:new a(t.id,t.options)},a}(Vt);zh.registerJSONType("WMSTileLayer");zh.mergeOptions(Ih);function Sc(o,a,i){var r=[];for(var t in o)r.push(encodeURIComponent(i?t.toUpperCase():t)+"="+encodeURIComponent(o[t]));return(!a||a.indexOf("?")===-1?"?":"&")+r.join("&")}var Ma=function(o){z(a,o);function a(r,t){var e;return e=o.call(this,r,t)||this,e.options.hasOwnProperty("forceRenderOnMoving")||(e.options.forceRenderOnMoving=!1),e}var i=a.prototype;return i.drawTile=function(){},i.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},a.fromJSON=function(t){return!t||t.type!=="CanvasTileLayer"?null:new a(t.id,t.options)},a}(Vt);Ma.registerJSONType("CanvasTileLayer");function bc(o,a){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},r=["webgl","experimental-webgl"],t=null,e=0;e<r.length;++e){try{t=o.getContext(r[e],a||i)}catch{}if(t)break}return t}function Bo(o,a,i){var r=o.createShader(a);o.shaderSource(r,i),o.compileShader(r);var t=o.getShaderParameter(r,o.COMPILE_STATUS);if(!t){var e=o.getShaderInfoLog(r);throw o.deleteShader(r),new Error("Failed to compile shader: "+e)}return r}function jh(o,a,i){var r=Bo(o,o.VERTEX_SHADER,a),t=Bo(o,o.FRAGMENT_SHADER,i);if(!r||!t)return null;var e=o.createProgram();return e?(o.attachShader(e,r),o.attachShader(e,t),o.linkProgram(e),{program:e,vertexShader:r,fragmentShader:t}):null}function Hh(o,a,i){if(Array.isArray(i[0])){for(var r=Float32Array.BYTES_PER_ELEMENT,t=0,e=0;e<i.length;e++)t+=i[e][1]||0;for(var n=0,s=0;s<i.length;s++){var h=o.getAttribLocation(a,i[s][0]);if(h<0)throw new Error("Failed to get the storage location of "+i[s][0]);o.vertexAttribPointer(h,i[s][1],o[i[s][2]||"FLOAT"],!1,r*t,r*n),n+=i[s][1]||0,o.enableVertexAttribArray(h)}}else{var u=o.getAttribLocation(a,i[0]);o.vertexAttribPointer(u,i[1],o[i[2]||"FLOAT"],!1,0,0),o.enableVertexAttribArray(u)}}var Wo={vertexShader:`
        attribute vec2 a_position;

        attribute vec2 a_texCoord;

        uniform mat4 u_matrix;

        varying vec2 v_texCoord;

        void main() {
            gl_Position = u_matrix * vec4(a_position, 0., 1.);

            v_texCoord = a_texCoord;
        }
    `,fragmentShader:`
        precision mediump float;

        uniform sampler2D u_image;

        uniform float u_opacity;
        uniform float u_debug_line;

        varying vec2 v_texCoord;

        void main() {
            if (u_debug_line == 1.) {
                gl_FragColor = vec4(0., 1., 0., 1.);
            } else {
                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
            }
        }
    `},Qi=[0,0],Cn=[0,0,0],Ec=new Array(16),Rc=new S(20,20),Ta=function(a){var i=function(r){z(t,r);function t(){return r.apply(this,arguments)||this}var e=t.prototype;return e.drawGLImage=function(s,h,u,l,f,c,d,g){this.gl.program!==this.program&&this.useProgram(this.program);var v=this.gl;this.loadTexture(s);var m=this.canvas.gl&&this.canvas.gl.wrap;if(m){var _=this.layer&&this.layer.options.opacity;C(_)&&(_=1),d*=_}Cn[0]=h||0,Cn[1]=u||0;var p=va(Ec);Mh(p,p,Cn),zn(p,p,[c,c,1]),xi(p,this.getMap().projViewMatrix,p),v.uniformMatrix4fv(this.program.u_matrix,!1,p),v.uniform1f(this.program.u_opacity,d),v.uniform1f(this.program.u_debug_line,0);var y=s.glBuffer;y&&(y.width!==l||y.height!==f)&&(this.saveImageBuffer(y),delete s.glBuffer),s.glBuffer?v.bindBuffer(v.ARRAY_BUFFER,y):s.glBuffer=this.bufferTileData(0,0,l,f),Qi[0]="a_position",Qi[1]=2,Qi[2]=s.glBuffer.type,this.enableVertexAttrib(Qi),v.drawArrays(v.TRIANGLE_STRIP,0,4),g&&this.drawDebug(p,0,0,l,f,g)},e.drawDebug=function(s,h,u,l,f,c){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),d.bufferData(d.ARRAY_BUFFER,new Float32Array([h,u,h+l,u,h+l,u-f,h,u-f,h,u]),d.DYNAMIC_DRAW),d.uniformMatrix4fv(this.program.u_matrix,!1,s),d.uniform1f(this.program.u_opacity,1),d.uniform1f(this.program.u_debug_line,1),d.drawArrays(d.LINE_STRIP,0,5);var g=this._debugInfoCanvas;if(!g){var v=this.getMap().getDevicePixelRatio()>1?2:1;g=this._debugInfoCanvas=document.createElement("canvas"),g.width=256*v,g.height=32*v;var m=g.getContext("2d");m.font="20px monospace",m.scale(v,v)}var _=g.getContext("2d");_.clearRect(0,0,g.width,g.height);var p=this.layer.options.debugOutline;L.fillText(_,c,Rc,p),this.loadTexture(g),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,g),l=256;var y=h,x=h+l,M=u-f+32,w=u-f;d.bufferData(d.ARRAY_BUFFER,this.set8(y,M,y,w,x,M,x,w),d.DYNAMIC_DRAW),d.uniform1f(this.program.u_debug_line,0),d.drawArrays(d.TRIANGLE_STRIP,0,4)},e.bufferTileData=function(s,h,u,l,f){var c=s,d=s+u,g=h,v=h-l,m;ie(c)&&ie(d)&&ie(g)&&ie(v)?m=this.set8Int(c,g,c,v,d,g,d,v):m=this.set8(c,g,c,v,d,g,d,v);var _=this.loadImageBuffer(m,f);return _.width=u,_.height=l,_.type=m instanceof Int16Array?"SHORT":"FLOAT",_},e.drawTinImage=function(s,h,u,l,f){var c=this.gl;this.loadTexture(s),c.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),c.uniform1f(this.program.u_opacity,f),c.bindBuffer(c.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),c.bufferData(c.ARRAY_BUFFER,new Float32Array(h),c.DYNAMIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),c.bufferData(c.ARRAY_BUFFER,new Float32Array(u),c.DYNAMIC_DRAW),c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),c.DYNAMIC_DRAW),c.drawElements(c.TRIANGLES,l.length,c.UNSIGNED_SHORT,0)},e.createCanvas2=function(){this.canvas2=L.createCanvas(this.canvas.width,this.canvas.height)},e.createGLContext=function(){this.canvas.gl&&this.canvas.gl.wrap?this.gl=this.canvas.gl.wrap():this.gl=bc(this.canvas2||this.canvas,this.layer.options.glOptions);var s=this.gl;s.clearColor(0,0,0,0),s.disable(s.DEPTH_TEST),s.enable(s.STENCIL_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(Wo.vertexShader,this.layer.options.fragmentShader||Wo.fragmentShader),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),s.bufferData(s.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),s.STATIC_DRAW),this.enableSampler("u_image"),s.activeTexture(s.TEXTURE0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},e.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),!!this.canvas2&&(this.canvas2.width!==this.canvas.width||this.canvas2.height!==this.canvas.height)&&(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height)},e.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))},e.disposeImage=function(s){!s||(s.texture&&this.saveTexture(s.texture),s.glBuffer&&this.saveImageBuffer(s.glBuffer),delete s.texture,delete s.glBuffer)},e._createTexture=function(s){var h=this.gl,u=this.getTexture()||h.createTexture();return h.bindTexture(h.TEXTURE_2D,u),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,s),ie(Sn(s.width))&&ie(Sn(s.width))&&h.generateMipmap(h.TEXTURE_2D),u},e.getTexture=function(){this._textures||(this._textures=[]);var s=this._textures;return s&&s.length>0?s.pop():null},e.saveTexture=function(s){this._textures.push(s)},e.loadTexture=function(s){var h=this.gl,u=s.texture;return u||(u=this._createTexture(s),s.texture=u),h.bindTexture(h.TEXTURE_2D,u),u},e.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var s=this._imageBuffers;return s&&s.length>0?s.pop():null},e.saveImageBuffer=function(s){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(s)},e.loadImageBuffer=function(s,h){var u=this.gl,l=h||this.createImageBuffer();return u.bindBuffer(u.ARRAY_BUFFER,l),u.bufferData(u.ARRAY_BUFFER,s,u.STATIC_DRAW),l},e.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},e.removeGLCanvas=function(){var s=this.gl;if(!!s){if(this._debugBuffer&&(s.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach(function(l){s.deleteBuffer(l)}),delete this._buffers),this._textures&&(this._textures.forEach(function(l){return s.deleteTexture(l)}),delete this._textures),this._debugInfoCanvas){var h=this._debugInfoCanvas.texture;h&&s.deleteTexture(h),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var u=s.program;s.deleteShader(u.fragmentShader),s.deleteShader(u.vertexShader),s.deleteProgram(u),delete this.gl,delete this.canvas2}},e.createBuffer=function(){var s=this.gl,h=s.createBuffer();if(!h)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(h),h},e.enableVertexAttrib=function(s){Hh(this.gl,this.gl.program,s)},e.createProgram=function(s,h){for(var u=this.gl,l=jh(u,s,h),f=l.program,c=l.vertexShader,d=l.fragmentShader,g=u.getProgramParameter(f,35718),v=[],m=0;m<g;++m){var _=u.getActiveUniform(f,m);v.push(_.name)}return f.vertexShader=c,f.fragmentShader=d,this._initUniforms(f,v),f},e.useProgram=function(s){var h=this.gl;return h.useProgram(s),h.program=s,this},e.enableSampler=function(s,h){var u=this.gl,l=this._getUniform(u.program,s);return h||(h=0),u.uniform1i(l,h),l},e._initUniforms=function(s,h){for(var u=0;u<h.length;u++){var l=h[u],f=h[u],c=l.indexOf("[");c>=0&&(l=l.substring(0,c),pt||(f=f.substring(0,c))),s[l]=this._getUniform(s,f)}},e._getUniform=function(s,h){var u=this.gl,l=u.getUniformLocation(s,h);if(!l)throw new Error("Failed to get the storage location of "+h);return l},t}(a);return H(i.prototype,{set8:function(){var r=q.ie9?null:new Float32Array(8);return function(t,e,n,s,h,u,l,f){return r[0]=t,r[1]=e,r[2]=n,r[3]=s,r[4]=h,r[5]=u,r[6]=l,r[7]=f,r}}(),set8Int:function(){var r=q.ie9?null:new Int16Array(8);return function(t,e,n,s,h,u,l,f){return r[0]=t,r[1]=e,r[2]=n,r[3]=s,r[4]=h,r[5]=u,r[6]=l,r[7]=f,r}}()}),i},Ac={renderer:q.webgl?"gl":"canvas",crossOrigin:null},Oc=new S(0,0),Sa=function(o){z(a,o);function a(r,t,e){var n;return t&&!Array.isArray(t)&&!t.url&&(e=t,t=null),n=o.call(this,r,e)||this,n._images=t,n}var i=a.prototype;return i.onAdd=function(){this._prepareImages(this._images)},i.setImages=function(t){return this._images=t,this._prepareImages(t),this},i.getImages=function(){return this._images},i._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap(),n=e.getGLRes();this._imageData=t.map(function(h){var u=new st(h.extent);return H({},h,{extent:u,extent2d:u.convertTo(function(l){return e.coordToPointAtRes(l,n)})})}),this._images=t;var s=this.getRenderer();s&&s.refreshImages()},a}(At);Sa.mergeOptions(Ac);var kc=[],ba=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.isDrawable=function(){return!this.getMap().getPitch()},i.checkResources=function(){var t=this;if(this._imageLoaded)return kc;var e=this.layer,n=e._imageData.map(function(u){return[u.url,null,null]});if(this.resources){var s=[],h=new Oe;n.forEach(function(u){if(t.resources.isResourceLoaded(u)){var l=t.resources.getImage(u);h.addResource(u,l)}else s.push(u)}),this.resources.forEach(function(u,l){h.isResourceLoaded(u)||t.retireImage(l.image)}),this.resources=h,n=s}return this._imageLoaded=!0,n},i.retireImage=function(t){t.close&&t.close()},i.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},i.draw=function(){!this.isDrawable()||(this.prepareCanvas(),this._painted=!1,this._drawImages(),this.completeRender())},i._drawImages=function(){var t=this.layer._imageData,e=this.getMap(),n=e._get2DExtentAtRes(e.getGLRes());if(t&&t.length)for(var s=0;s<t.length;s++){var h=t[s].extent2d,u=this.resources&&this.resources.getImage(t[s].url);u&&n.intersects(h)&&(this._painted=!0,this._drawImage(u,h,t[s].opacity||1))}},i._drawImage=function(t,e,n){var s=0,h=this.context;n<1&&(s=h.globalAlpha,h.globalAlpha=n);var u=this.getMap(),l=Oc.set(e.xmin,e.ymax),f=u._pointAtResToContainerPoint(l,u.getGLRes()),c=f.x,d=f.y,g=u.getBearing();g&&(h.save(),h.translate(c,d),g&&h.rotate(-g*Math.PI/180),c=d=0);var v=u.getGLScale();h.drawImage(t,c,d,e.getWidth()/v,e.getHeight()/v),g&&h.restore(),s&&(h.globalAlpha=s)},i.drawOnInteracting=function(){this.draw()},a}(Qe),Fh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.isDrawable=function(){return!0},i._drawImage=function(t,e,n){this.drawGLImage(t,e.xmin,e.ymax,e.getWidth(),e.getHeight(),1,n)},i.createContext=function(){this.createGLContext()},i.resizeCanvas=function(t){!this.canvas||(o.prototype.resizeCanvas.call(this,t),this.resizeGLCanvas())},i.clearCanvas=function(){!this.canvas||(o.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.retireImage=function(t){t.close&&t.close(),this.disposeImage(t)},i.onRemove=function(){this.removeGLCanvas(),o.prototype.onRemove.call(this)},a}(Ta(ba));Sa.registerRenderer("canvas",ba);Sa.registerRenderer("gl",Fh);var Ea=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.getPrepareParams=function(){return[]},i.getDrawParams=function(){return[]},i.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=L.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},i.needToRedraw=function(){if(this.layer.options.animation)return!0;var t=this.getMap();return t.isInteracting()&&!this.layer.drawOnInteracting?!1:o.prototype.needToRedraw.call(this)},i.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer.apply(this,arguments)},i.drawOnInteracting=function(){this._drawLayerOnInteracting.apply(this,arguments)},i.getCanvasImage=function(){var t=o.prototype.getCanvasImage.call(this);if(t&&t.image&&this.layer.options.doubleBuffer){var e=t.image;(this.buffer.width!==e.width||this.buffer.height!==e.height)&&(this.buffer.width=e.width,this.buffer.height=e.height);var n=this.buffer.getContext("2d"),s=this.layer.doubleBuffer(n,this.context);(s===void 0||s)&&(L.image(n,e,0,0),t.image=this.buffer)}return t},i.remove=function(){return delete this._drawContext,o.prototype.remove.call(this)},i.onZoomStart=function(t){this.layer.onZoomStart(t),o.prototype.onZoomStart.call(this,t)},i.onZooming=function(t){this.layer.onZooming(t),o.prototype.onZooming.call(this,t)},i.onZoomEnd=function(t){this.layer.onZoomEnd(t),o.prototype.onZoomEnd.call(this,t)},i.onMoveStart=function(t){this.layer.onMoveStart(t),o.prototype.onMoveStart.call(this,t)},i.onMoving=function(t){this.layer.onMoving(t),o.prototype.onMoving.call(this,t)},i.onMoveEnd=function(t){this.layer.onMoveEnd(t),o.prototype.onMoveEnd.call(this,t)},i.onResize=function(t){this.layer.onResize(t),o.prototype.onResize.call(this,t)},i.prepareDrawContext=function(){if(!this._predrawed){var t=Vo(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(t)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},i._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],n=Vo(this.getDrawParams());return e.push.apply(e,n),e.push.apply(e,this._drawContext),e},i._drawLayer=function(){var t=this._prepareDrawParams();if(!!t){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];this.layer.draw.apply(this.layer,t.concat(n)),this.completeRender()}},i._drawLayerOnInteracting=function(){if(!!this.layer.drawOnInteracting){var t=this._prepareDrawParams();if(!!t){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];this.layer.drawOnInteracting.apply(this.layer,t.concat(n)),this.completeRender()}}},a}(Qe);function Vo(o){return o||(o=[]),Array.isArray(o)||(o=[o]),o}var Dc={doubleBuffer:!1,animation:!1},Ra=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.isCanvasRender=function(){return!0},i.prepareToDraw=function(){},i.draw=function(){},i.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},i.play=function(){return this.config("animation",!0),this},i.pause=function(){return this.config("animation",!1),this},i.isPlaying=function(){return this.options.animation},i.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},i.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},i.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},i.onCanvasCreate=function(){return this},i.onZoomStart=function(){},i.onZooming=function(){},i.onZoomEnd=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){},i.onResize=function(){},i.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},a}(At);Ra.mergeOptions(Dc);Ra.registerRenderer("canvas",Ea);var Lc=new S(0,0),Ic={animation:!0},Gh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.getParticles=function(){},i.draw=function(t,e){var n=this.getParticles(lt());if(!n||n.length===0){var s=this._getRenderer();s&&(this._getRenderer()._shouldClear=!0);return}var h=this.getMap(),u=e.extent;e.maskExtent&&(u=e.extent.intersection(e.maskExtent)),u=u.convertTo(function(m){return h._pointToContainerPoint(m,void 0,0,Lc)});for(var l=2*Math.PI,f=0,c=n.length;f<c;f++){var d=n[f].point;if(u.contains(d)){var g=n[f].color||this.options.lineColor||"#fff",v=n[f].r;t.fillStyle!==g&&(t.fillStyle=g),v<=2?t.fillRect(d.x-v/2,d.y-v/2,v,v):(t.beginPath(),t.arc(d.x,d.y,v/2,0,l),t.fill())}}this._fillCanvas(t)},i._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out";var n=this.options.trail||30;t.fillStyle="rgba(0, 0, 0, "+1/n+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},a}(Ra);Gh.mergeOptions(Ic);Gh.registerRenderer("canvas",function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.draw=function(){(!this.canvas||!this.layer.options.animation||this._shouldClear)&&(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},i.onSkipDrawOnInteracting=function(){this._shouldClear=!0},a}(Ea));var ci=new Oe,di,gi,zc=function(o){z(a,o);function a(r,t,e){var n;n=o.call(this,e)||this,n.target=r,r.once("remove",n.delete,xt(xt(n)));var s=n.options.symbol,h=s.markerLineWidth||1;return n.w=s.markerWidth+h,n.h=s.markerHeight+h,n.opacity=C(s.opacity)?1:s.opacity,n.map=t,n.events=e.events,n._fetchImage(),n.addTo(t),n}var i=a.prototype;return i.getCursor=function(){return this.options.cursor||"default"},i._fetchImage=function(){var t=this.map,e=this.options.symbol,n=e.markerFile;this.url=n||Ei(e);var s=ci.getImage(this.url);if(!s){var h=this.w,u=this.h;if(n)s=new Image,s.onload=function(){var c=t.getRenderer();c&&c.setToRedraw()},s.src=this.url;else{var l=document.createElement("canvas");l.width=h,l.height=u;var f=l.getContext("2d");s=ah(f,{x:h/2,y:u/2},e,ci)}ci.addResource([this.url,h,u],s)}ci.login(this.url),this._img=s},i.setContainerPoint=function(t){this._point=t,this._point._sub(this.w/2,this.h/2)},i.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},i.offset=function(t){this._point._add(t)},i.render=function(t){if(!this._img)return!1;var e=this.options.symbol,n=e.markerDx||0,s=e.markerDy||0,h=this.map,u=this._point,l=u.x,f=u.y,c=this.w,d=this.h;if(l+c>0&&l<h.width&&f+d>0&&f<h.height){var g=h.getDevicePixelRatio();return t.globalAlpha=this.opacity,t.drawImage(this._img,Math.round((l+n)*g),Math.round((f+s)*g),Math.round(c*g),Math.round(d*g)),!0}return!1},i.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}ci.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},i.hitTest=function(t){var e=this.options.symbol,n=e.markerDx||0,s=e.markerDy||0,h=this.w,u=this.h,l=this._point.x+n,f=this._point.y+s;return t.x>=l&&t.x<=l+h&&t.y>=f&&t.y<=f+u},i.addTo=function(t){this.map=t;var e=t.getRenderer();e.addTopElement(this)},i.onEvent=function(t){this.fire(t.type,t)},i.mousedown=function(t){var e=t.target,n=this.options.cursor;n&&e.setCursor(n),this.onDragstart(t)},i.onDragstart=function(t){var e=t.containerPoint,n=t.target,s=n._panels.mapWrapper||n._containerDOM,h=this._dragger=new qe(s);h.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),h.type="handle",h.onMouseDown(t.domEvent),di=e.x,gi=e.y,this.fire("dragstart",{containerPoint:e})},i.onDragging=function(t){if(!!this._dragger){var e=this.map,n=Et(t.domEvent,e._containerDOM),s={x:n.x-di,y:n.y-gi},h=e.containerPointToCoord(new S(di,gi)),u=e.containerPointToCoord(n);di=n.x,gi=n.y,this.offset(s),this.fire("dragging",{containerPoint:n,coordOffset:u._sub(h)})}},i.onDragend=function(t){if(!!this._dragger){var e=this.map;e.resetCursor();var n=Et(t.domEvent,e._containerDOM),s={x:n.x-di,y:n.y-gi};this.offset(s),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:n})}},a}(oe(Nt)),jc=function(){function o(i,r){this.target=i,i.once("remove",this.delete,this),this.map=r,this.addTo(r)}var a=o.prototype;return a.setPoints=function(r){this.points=r;var t=r.map(function(n){return n.x}),e=r.map(function(n){return n.y});this.xmin=Math.min.apply(Math,t),this.xmax=Math.max.apply(Math,t),this.ymin=Math.min.apply(Math,e),this.ymax=Math.max.apply(Math,e)},a.hitTest=function(){return!1},a.render=function(r){var t=this.map;if(this.xmax<=0||this.xmin>=t.width||this.ymax<=0||this.ymin>=t.height)return;var e=t.getDevicePixelRatio(),n=.5;function s(l){return Math.round(l)*e+n}r.lineWidth=1,r.strokeStyle="#000",r.globalAlpha=1,r.beginPath();var h=this.points;r.moveTo(s(h[0].x),s(h[0].y));for(var u=1;u<this.points.length;u++)r.lineTo(s(h[u].x),s(h[u].y));r.closePath(),r.stroke()},a.addTo=function(r){this.map=r;var t=r.getRenderer();t.addTopElement(this)},a.delete=function(){if(this.map){var r=this.map.getRenderer();r&&r.removeTopElement(this)}},o}(),Hc=Si+"_edit_stage_";function Pn(o,a){return{markerType:o,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:a}}var Fc={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:Pn("ellipse",1),vertexHandleSymbol:Pn("square",1),newVertexHandleSymbol:Pn("square",.4)},Nh=function(o){z(a,o);function a(r,t){var e;return e=o.call(this,t)||this,e._geometry=r,e._geometry?e:xt(e)}var i=a.prototype;return i.getMap=function(){return this._geometry.getMap()},i.prepare=function(){var t=this.getMap();!t||(t.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},i._prepareEditStageLayer=function(){var t=this._geometry.getLayer();if(t.options.renderer==="canvas"){var e=this.getMap(),n=Ce(),s=Hc+n+"_shadow";if(this._shadowLayer=e.getLayer(s),!this._shadowLayer){var h=t.constructor;this._shadowLayer=new h(s),e.addLayer(this._shadowLayer)}}},i.start=function(){if(!(!this._geometry||!this._geometry.getMap()||this._geometry.editing)){this.editing=!0,this.prepare();var t=this._geometry,e,n=this._geometry.getLayer(),s=n.options.renderer==="canvas";this._geometryDraggble=t.options.draggable,s?(t.config("draggable",!1),e=t.copy(),e.setSymbol(t._getInternalSymbol()),e.copyEventListeners(t),t._getParent()&&e.copyEventListeners(t._getParent()),e._setEventTarget(t),e.setId(null).config({draggable:!1}),this._shadow=e,t.hide()):t instanceof gt&&t.config("draggable",!0),this._switchGeometryEvents("on"),(t instanceof gt||t instanceof qt||t instanceof Ue||t instanceof ae)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(e),t instanceof gt?e&&(e.config("draggable",!0),e.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),t instanceof gt&&this.options.resize!==!1?this.createMarkerEditor():t instanceof qt?this.createCircleEditor():t instanceof Ue?this.createEllipseOrRectEditor():t instanceof ae?this.createEllipseOrRectEditor():t instanceof ti||(t instanceof mt||t instanceof dt)&&this.createPolygonEditor()}},i.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off");var t=this.getMap();if(!t){this.fire("remove");return}this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")},i.isEditing=function(){return C(this.editing)?!1:this.editing},i._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},i._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var n in e)this._geometry[t](n,e[n],this)}},i._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},i._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},i._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;e||(this._editOutline=new jc(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var n=this._editOutline.points;if(t instanceof gt)this._editOutline.setPoints(t.getContainerExtent().toArray(n));else{var s=this.getMap(),h=t._getPrjExtent();n=h.toArray(n),n.forEach(function(u){return s._prjToContainerPoint(u,null,u)}),this._editOutline.setPoints(n)}return e},i._createCenterHandle=function(){var t=this,e=this.getMap(),n=this.options.centerHandleSymbol,s,h=e.coordToContainerPoint(this._geometry.getCenter()),u=this.createHandle(h,{symbol:n,cursor:"move",onDown:function(){if(t._shadow){s=t._shadow.copy();var f=gr(s._getInternalSymbol(),.5);s.setSymbol(f).addTo(t._geometry.getLayer())}},onMove:function(f){var c=f.coordOffset;s?s.translate(c):t._geometry.translate(c)},onUp:function(){var f=s||t._geometry;t._update("setCoordinates",k.toNumberArrays(f.getCoordinates())),s&&s.remove()}});this._addRefreshHook(function(){var l=t._geometry.getCenter();u.setContainerPoint(e.coordToContainerPoint(l))})},i._createHandleInstance=function(t,e){var n=this.getMap(),s=Bn(e.symbol,function(){return[n.getZoom(),{"{bearing}":n.getBearing(),"{pitch}":n.getPitch(),"{zoom}":n.getZoom()}]}),h=this.options.removeVertexOn,u=new zc(this,n,{symbol:s,cursor:e.cursor,events:h});return u.setContainerPoint(t),u},i.createHandle=function(t,e){e||(e={});var n=this._createHandleInstance(t,e),s=this;function h(f){return this._updating=!0,e.onDown&&(this._geometry.fire("handledragstart"),e.onDown.call(s,f.containerPoint,f)),!1}function u(f){return s._hideContext(),e.onMove&&(this._geometry.fire("handledragging"),e.onMove.call(s,f)),!1}function l(f){return e.onUp&&(this._geometry.fire("handledragend"),e.onUp.call(s,f)),this._updating=!1,!1}return n.on("dragstart",h,this),n.on("dragging",u,this),n.on("dragend",l,this),e.onRefresh&&(n.refresh=e.onRefresh),n},i._createResizeHandles=function(t,e,n){var s=this,h=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],u=[null,"y",null,"x","x",null,"y",null],l=this._geometry,f=l instanceof gt;function c(){if(f){var y=l.getContainerExtent();return[new S(y.xmin,y.ymin),new S((y.xmax+y.xmin)/2,y.ymin),new S(y.xmax,y.ymin),new S(y.xmin,(y.ymin+y.ymax)/2),new S(y.xmax,(y.ymin+y.ymax)/2),new S(y.xmin,y.ymax),new S((y.xmax+y.xmin)/2,y.ymax),new S(y.xmax,y.ymax)]}var x=l._getPrjExtent();return[new S(x.xmin,x.ymax),new S((x.xmax+x.xmin)/2,x.ymax),new S(x.xmax,x.ymax),new S(x.xmin,(x.ymax+x.ymin)/2),new S(x.xmax,(x.ymax+x.ymin)/2),new S(x.xmin,x.ymin),new S((x.xmax+x.xmin)/2,x.ymin),new S(x.xmax,x.ymin)]}t||(t=[]);var d=this,g=[],v={},m=this.getMap(),_=this.options.vertexHandleSymbol,p=function(){for(var x=c(),M=function(P){if(Array.isArray(t)){var O=t.some(function(R){return R===P});if(O)return"continue"}var I=x[P],E=f?I:m._prjToContainerPoint(I);if(g.length<x.length-t.length){var D=s.createHandle(E,{symbol:_,cursor:h[P],axis:u[P],onMove:function(R){return function(A){d._updating=!0,e(A.containerPoint,R),l.fire("resizing")}}(P),onUp:function(){d._updating=!1,n()}});v[P]=g.length,g.push(D)}else g[v[P]].setContainerPoint(E)},w=0;w<x.length;w++)var b=M(w)};return p(),this._addRefreshHook(p),g},i.createMarkerEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();if(!e._canEdit())return;this._history||this._recordHistory(_());var s=e._getInternalSymbol(),h=new S(0,0);N(s.markerDx)&&(h.x=s.markerDx),N(s.markerDy)&&(h.y=s.markerDy);var u=null,l="middle",f="middle";if(uh.test(s)){var c=s.markerType;c==="pin"||c==="pie"||c==="bar"?(u=[5,6,7],l="bottom"):c==="rectangle"&&(u=[0,1,2,3,5],l="top",f="left")}else(la.test(s)||lh.test(s))&&(l="bottom",u=[5,6,7]);var d=[2,1,2,0,0,2,1,2],g;if(this.options.fixAspectRatio){var v=e.getSize();g=v.width/v.height}var m=this._createResizeHandles(u,function(p,y){if(u&&u.indexOf(y)>=0){var x=n.containerPointToCoordinate(p.sub(h)),M=e.getCoordinates();x.x=M.x,e.setCoordinates(x),t._updateCoordFromShadow(!0);var w=m[m.length-1-y],b=w.getContainerPoint();p=b}var T=n.coordToContainerPoint(e.getCoordinates()).add(h),P=e._getInternalSymbol(),O=p.sub(T);l==="bottom"&&p.y>T.y&&(O.y=0);var I=l==="middle"?2:1,E=f==="left"?1:2,D=Math.abs(O.x)*E,R=Math.abs(O.y)*I;g&&(D=Math.max(D,R*g),R=D/g);var A=d[y];e instanceof wr?((g||A===0||A===2)&&(e.setWidth(D),e!==t._geometry&&t._geometry.setWidth(D)),(g||A===1||A===2)&&(e.setHeight(R),e!==t._geometry&&t._geometry.setHeight(R))):((g||A===0||A===2)&&(P.markerWidth=Math.min(D,t._geometry.options.maxMarkerWidth||1/0)),(g||A===1||A===2)&&(P.markerHeight=Math.min(R,t._geometry.options.maxMarkerHeight||1/0)),e.setSymbol(P),e!==t._geometry&&t._geometry.setSymbol(P))},function(){t._update(_())});function _(){var p=[["setCoordinates",e.getCoordinates().toArray()]];return e instanceof wr?(p.push(["setWidth",e.getWidth()]),p.push(["setHeight",e.getHeight()])):p.push(["setSymbol",e.getSymbol()]),p}},i.createCircleEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();this._history||this._recordHistory([["setCoordinates",e.getCoordinates().toArray()],["setRadius",e.getRadius()]]),this._createResizeHandles(null,function(s){var h=e.getCenter(),u=n.containerPointToCoord(s),l=new dt([[h.x,h.y],[u.x,h.y]]),f=new dt([[h.x,h.y],[h.x,u.y]]),c=Math.max(n.computeGeometryLength(l),n.computeGeometryLength(f));e.setRadius(c),e!==t._geometry&&t._geometry.setRadius(c)},function(){t._update("setRadius",e.getRadius())})},i.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],n=this._shadow||this._geometry;this._history||this._recordHistory(f());var s=this.getMap(),h=this._geometry instanceof Ue,u;this.options.fixAspectRatio&&(u=n.getWidth()/n.getHeight());var l=this._createResizeHandles(null,function(c,d){var g=h?1:2,v,m,_,p=l[d],y=p.getContainerPoint(),x=e[d];if(h){var M=l[7-d],w=M.getContainerPoint();v=y.sub(w);var b=v.abs();m=s.pixelToDistance(b.x,0),_=s.pixelToDistance(0,b.y);var T=n.getSize(),P=n.getCoordinates(),O=n.getWidth(),I=n.getHeight(),E=s.containerPointToCoord(c),D=s.containerPointToCoord(w),R=new dt([[D.x,D.y],[E.x,D.y]]),A=new dt([[D.x,D.y],[D.x,E.y]]);if(m=s.computeGeometryLength(R),_=s.computeGeometryLength(A),x===0)if(u&&(b.y=b.x/u,T.height=Math.abs(b.y),_=m/u),y.y=w.y-T.height/2,E.y=P.y,d===4)E.x=Math.min(E.x,P.x);else{var G=s.locate(P,O,0);E.x=s.locate(new k(G.x,E.y),-m,0).x}else if(x===1)u&&(b.x=b.y*u,T.width=Math.abs(b.x),m=_*u),y.x=w.x-T.width/2,E.x=P.x,E.y=Math.max(E.y,D.y);else{if(u&&(m>_*u?(_=m/u,y.y=w.y+b.x*yt(v.y)/u):(m=_*u,y.x=w.x+b.y*yt(v.x)*u)),d===0||d===5){var F=d===0?s.locate(P,O,0):s.locate(P,O,-I);E.x=s.locate(new k(F.x,E.y),-m,0).x}else E.x=Math.min(E.x,D.x);E.y=Math.max(E.y,D.y)}n.setCoordinates(E),t._updateCoordFromShadow(!0)}else{var j=n.getCenter(),Z=s.containerPointToCoord(y),V=new dt([[j.x,j.y],[Z.x,j.y]]),J=new dt([[j.x,j.y],[j.x,Z.y]]);m=s.computeGeometryLength(V),_=s.computeGeometryLength(J),u&&(m=Math.max(m,_*u),_=m/u)}(u||x===0||x===2)&&(n.setWidth(m*g),n!==t._geometry&&t._geometry.setWidth(m*g)),(u||x===1||x===2)&&(n.setHeight(_*g),n!==t._geometry&&t._geometry.setHeight(_*g))},function(){t._update(f())});function f(){return[["setCoordinates",n.getCoordinates().toArray()],["setWidth",n.getWidth()],["setHeight",n.getHeight()]]}},i.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow||this._geometry,n=this;this._history||this._recordHistory("setCoordinates",k.toNumberArrays(e.getCoordinates()));var s=e instanceof mt?3:2,h="maptalks--editor-vertex-index",u={0:[]},l={0:[]};function f(R){if(R===void 0&&(R=0),e instanceof mt){var A=e.getCoordinates()[R]||[];return A.slice(0,A.length-1)}else return e.getCoordinates()}function c(R){return R===void 0&&(R=0),R===0?e._getPrjCoordinates():e._getPrjHoles()[R-1]}function d(){for(var R in u){for(var A=u[R].length-1;A>=0;A--)u[R][A][h]=A;for(var G=l[R].length-1;G>=0;G--)l[R][G][h]=G}n._updateCoordFromShadow()}function g(R){n._updating=!0;var A=R.target,G=A[h],F=N(A._ringIndex)?A._ringIndex:0,j=c(F);if(!(j.length<=s)){var Z=e instanceof dt&&(G===0||G===j.length-1);j.splice(G,1),F>0?e._prjHoles[F-1]=j:e._setPrjCoordinates(j),e._updateCache(),u[F].splice(G,1)[0].delete(),G<l[F].length&&l[F].splice(G,1)[0].delete();var V;G===0?V=l[F].length-1:V=G-1,l[F].splice(V,1)[0].delete(),Z||l[F].splice(V,0,x.call(n,V,F)),d(),n._updating=!1}}function v(R,A,G){G===void 0&&(G=0);var F=n._geometry.snapTo;F&&nt(F)&&(R=n._geometry.snapTo(R)||R);var j=c(G),Z=t._containerPointToPrj(R.sub(_())),V=j[A];V.x=Z.x,V.y=Z.y,e._updateCache(),e.onShapeChanged(),n._updateCoordFromShadow(!0);var J;A===0?J=l[G].length-1:J=A-1,l[G][A]&&l[G][A].refresh(),l[G][J]&&l[G][J].refresh()}var m=new S(0,0);function _(){var R=e._getCompiledSymbol();return m.x=R.lineDx||0,m.y=R.lineDy||0,m}function p(R,A,G){A===void 0&&(A=0);var F=(G||f(A))[R],j=n.createHandle(t.coordToContainerPoint(F)._add(_()),{symbol:n.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){v(j.getContainerPoint(),j[h],A)},onRefresh:function(V,J){F=(J||f(A))[j[h]];var ot=t.coordToContainerPoint(F);j.setContainerPoint(ot._add(_()))},onUp:function(){n._updateCoordFromShadow()},onDown:function(V,J){J&&J.domEvent&&J.domEvent.button}});return j[h]=R,j._ringIndex=A,j.on(n.options.removeVertexOn,g),j}var y=!1;function x(R,A,G){A===void 0&&(A=0);var F=G||f(A),j;R+1>=F.length?j=F[0]:j=F[R+1];var Z=F[R].add(j).multi(1/2),V=n.createHandle(Z,{symbol:n.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(ot,ft){if(!(ft&&ft.domEvent&&ft.domEvent.button===2)){var et=c(A),X=V[h],tt=V.getContainerPoint(),it=t._containerPointToPrj(tt);et.splice(X+1,0,it),A>0?e._prjHoles[A-1]=et:e._setPrjCoordinates(et),e._updateCache(),V.opacity=1,l[A].splice(X,0,x.call(n,X,A),x.call(n,X+1,A)),y=!0}},onMove:function(){v(V.getContainerPoint(),V[h]+1,A)},onUp:function(ot){if(ot&&ot.domEvent&&ot.domEvent.button===2){y=!1;return}var ft=V[h];ar(V,l[A]),V.delete(),u[A].splice(ft+1,0,p.call(n,ft+1,A)),d(),n._updateCoordFromShadow(),y=!1},onRefresh:function(ot,ft){F=ft||f(ot);var et=V[h],X;et===F.length-1?X=0:X=et+1;var tt=F[et].add(F[X]).multi(1/2),it=t.coordToContainerPoint(tt);V.setContainerPoint(it._add(_()))}});return V[h]=R,V}if(e instanceof mt)for(var M=e.getHoles().length+1,w=0;w<M;w++){u[w]=[],l[w]=[];for(var b=f(w),T=0,P=b.length;T<P;T++)u[w].push(p.call(this,T,w,b)),T<P-1&&l[w].push(x.call(this,T,w,b));l[w].push(x.call(this,b.length-1,w,b))}else{for(var O=0,I=f(O),E=0,D=I.length;E<D;E++)u[O].push(p.call(this,E,O,I)),E<D-1&&l[O].push(x.call(this,E,O,I));l[O].length&&e.getCoordinates().length===2&&(l[O][0].options.symbol.markerDx=12)}this._addRefreshHook(function(){if(!y){for(var R in l)for(var A=f(R),G=l[R].length-1;G>=0;G--)l[R][G].refresh(R,A);l[0].length&&e instanceof dt&&(e.getCoordinates().length===2?l[0][0].options.symbol.markerDx=12:e.getCoordinates().length>2&&(l[0][0].options.symbol.markerDx=0));for(var F in u)for(var j=f(F),Z=u[F].length-1;Z>=0;Z--)u[F][Z].refresh(F,j)}})},i._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},i._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},i._addRefreshHook=function(t){!t||(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},i._update=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];this._exeHistory([t,n]),this._recordHistory.apply(this,[t].concat(n))},i._updateCoordFromShadow=function(t){var e=this._shadow||this._geometry,n=e.getCoordinates(),s=this._geometry,h=this._updating;this._updating=!0,s.setCoordinates(n),t||this._recordHistory("setCoordinates",k.toNumberArrays(s.getCoordinates())),this._updating=h},i._recordHistory=function(t){this._history||(this._history=[],this._historyPointer=0);for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];if(this._history.length){var h=this._history[this._history.length-1];if(h[0]===t&&JSON.stringify(h[1])===JSON.stringify(n))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([t,n]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},i.cancel=function(){if(!this._history||this._historyPointer===0)return this;this._historyPointer=0;var t=this._history[0];return this._exeAndReset(t),this},i.undo=function(){if(!this._history||this._historyPointer===0)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},i.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},i._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,n=this._historyPointer;this.stop(),this._history=e,this._historyPointer=n,this.start()}},i._onDragStart=function(){this._updating=!0},i._onDragEnd=function(){this._updating=!1},i._exeHistory=function(t){if(!!Array.isArray(t)){var e=this._updating;this._updating=!0;var n=this._shadow||this._geometry,s=this._geometry;Array.isArray(t[0])?t[0].forEach(function(h){var u=h[0],l=h.slice(1);n[u].apply(n,l),n!==s&&s[u].apply(s,l)}):(n[t[0]].apply(n,t[1]),n!==s&&s[t[0]].apply(s,t[1])),this._updating=e}},a}(oe(Nt));Nh.mergeOptions(Fc);var Gc={startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var a=this._textEditor.innerHTML;a=a.replace(/<p>/ig,"").replace(/<\/p>/ig,"<br/>"),this._textEditor.innerHTML=a;var i=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(i),ut(this._textEditor,"mousedown dblclick",Lt),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var a=this.getMap(),i=this._createEditor();this._textEditor=i,a.on("mousedown",this.endEditText,this);var r=this._getEditorOffset();this._editUIMarker=new Ir(this.getCoordinates(),{animation:null,content:i,dx:r.dx,dy:r.dy}).addTo(a),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var a=this._getInternalSymbol()||{},i=0,r=0,t=a.textHorizontalAlignment;return t==="middle"||C(t)?(i=(a.textDx||0)-2,r=(a.textDy||0)-2):(i=(a.markerDx||0)-2,r=(a.markerDy||0)-2),{dx:i,dy:r}},_createEditor:function(){var a=this.getContent(),i=this.getSize(),r=this._getInternalSymbol()||{},t=i.width,e=r.textFill||"#000000",n=r.textSize||12,s=i.height,h=r.markerLineColor||"#000",u=r.markerFill||"#3398CC",l=r.textLineSpacing||0,f=W("div");return f.contentEditable=!0,f.style.cssText="background:"+u+"; border:1px solid "+h+`;
            color:`+e+";font-size:"+n+"px;width:"+(t-2)+"px;height:"+(s-2)+`px;margin: auto;
            line-height:`+(n+l)+`px;outline: 0; padding:0; margin:0;word-wrap: break-word;
            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;`,f.innerText=a,ct(f,"mousedown dblclick",Lt),f.onkeyup=function(c){var d=f.style.height||0;c.keyCode===13&&(f.style.height=parseInt(d)+n/2+"px")},f},_setCursorToLast:function(a){var i;window.getSelection?(a.focus(),i=window.getSelection(),i.selectAllChildren(a),i.collapseToEnd()):document.selection&&(i=document.selection.createRange(),i.moveToElementText(a),i.collapse(!1),i.select())}};ga.include(Gc);K.include({animate:function(a,i,r){var t=this;this._animPlayer&&this._animPlayer.finish(),nt(i)&&(r=i),i||(i={});var e=this.getMap(),n=this._getProjection(),s=this._prepareAnimationStyles(a),h,u=i.focus;if(delete this._animationStarted,e){var l=e._getRenderer(),f=function(g){l.callInNextFrame(g)};i.framer=f}var c=Pt.animate(s,i,function(d){if(e&&e.isRemoved()){c.finish();return}e&&!t._animationStarted&&u&&e.onMoveStart();var g=d.styles;for(var v in g)if(v!=="symbol"&&v!=="translate"&&g.hasOwnProperty(v)){var m="set"+v[0].toUpperCase()+v.slice(1);t[m](g[v])}var _=g.translate;if(_){var p=_;h&&(p=_.sub(h)),h=_,t.translate(p)}var y=g.symbol;if(y){var x=t.getSymbol()||{};t.setSymbol(Wt(x,y))}if(e&&u){var M=n.project(t.getCenter());e._setPrjCenter(M);var w=e._parseEventFromCoord(n.unproject(M));c.playState!=="running"?e.onMoveEnd(w):e.onMoving(w)}t._fireAnimateEvent(c.playState),r&&r(d)},this);return this._animPlayer=c,this._animPlayer.play()},_prepareAnimationStyles:function(a){var i=this._getInternalSymbol(),r={};for(var t in a)if(a.hasOwnProperty(t)){var e=a[t];if(t!=="translate"&&t!=="symbol"){var n="get"+t[0].toUpperCase()+t.substring(1),s=this[n]();r[t]=[s,e]}else if(t==="symbol"){var h=void 0;if(Array.isArray(a.symbol)){if(!Array.isArray(i))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");h=[];for(var u=a.symbol,l=0;l<u.length;l++){if(!u[l]){h.push(null);continue}var f={};for(var c in u[l])u[l].hasOwnProperty(c)&&(f[c]=[i[l][c],u[l][c]]);h.push(f)}}else{if(Array.isArray(i))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");h={};for(var d in e)e.hasOwnProperty(d)&&(h[d]=[i[d],e[d]])}r.symbol=h}else t==="translate"&&(r.translate=new k(e))}return r},_fireAnimateEvent:function(a){a==="finished"?(delete this._animationStarted,this._fireEvent("animateend")):a==="running"&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var Mn=Si+"_drag_stage",Uo=q.touch?"touchstart mousedown":"mousedown",Nc=function(o){z(a,o);function a(r){return o.call(this,r)||this}var i=a.prototype;return i.addHooks=function(){this.target.on(Uo,this._startDrag,this)},i.removeHooks=function(){this._endDrag(),this.target.off(Uo,this._startDrag,this),delete this.container},i._prepareDragHandler=function(){this._dragHandler=new qe(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},i._prepareShadow=function(){var t=this,e=this.target,n=e.getLayer().options.renderer==="canvas";if(!!n){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var s=this._shadow=e.copy();if(s.getGeometries){var h=s.getGeometries(),u=e.getGeometries();h.forEach(function(l,f){t._updateShadowSymbol(l,u[f])})}else this._updateShadowSymbol(s,e);s.setId(null),this._prepareShadowConnectors()}},i._updateShadowSymbol=function(t,e){if(t.setSymbol(e._getInternalSymbol()),e.options.dragShadow){var n=gr(t._getInternalSymbol(),.5);t.setSymbol(n)}},i._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,n=this._dragStageLayer._getRenderer().resources,s=[];if(Cr._hasConnectors(t))for(var h=Cr._getConnectors(t),u=0,l=h.length;u<l;u++){var f=h[u],c=f.config(),d=f._getInternalSymbol();c.symbol=gr(d,.5);var g=void 0;f.getConnectSource()===t?g=new f.constructor(e,f.getConnectTarget(),c):g=new f.constructor(f.getConnectSource(),e,c),s.push(g),f.getLayer()&&f.getLayer()._getRenderer()&&n.merge(f.getLayer()._getRenderer().resources)}this._shadowConnectors=s,s.push(e),this._dragStageLayer.bringToFront().addGeometry(s)},i._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},i._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer(Mn),this._dragStageLayer||(this._dragStageLayer=new $t(Mn,{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var n=new Oe;n.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=n},i._startDrag=function(t){var e=this.target.getMap();if(!!e){var n=this.target._getParent();if(!n&&!this.isDragging()){var s=t.domEvent;s.touches&&s.touches.length>1||s.button===2||(this.container=e._panels.mapWrapper||e._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),ct(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}}},i._dragging=function(t){var e=this.target,n=e.getMap(),s=n._parseEvent(t.domEvent),h=s.domEvent;if(!(h.touches&&h.touches.length>1)){var u=n._getVisualHeight(n.options.maxVisualPitch);if(!(s.containerPoint.y<n.height-u)){if(!this._moved){this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",s)),this.target._fireEvent("dragstart",this._startParam||s),delete this._startParam;return}var l=this._shadow||e,f=l.options.dragOnAxis,c=l.options.dragOnScreenAxis,d=s.containerPoint,g=s.coordinate;this._lastPoint=this._lastPoint||d,this._lastCoord=this._lastCoord||g,c?(f==="x"?d.y=this._lastPoint.y:f==="y"&&(d.x=this._lastPoint.x),g=n.containerPointToCoord(d)):g=this._correctCoord(g);var v=d.sub(this._lastPoint),m=g.sub(this._lastCoord);c||(f==="x"?v.y=m.y=0:f==="y"&&(v.x=m.x=0)),this._lastPoint=d,this._lastCoord=g,l.translate(m),l!==e&&!e.options.dragShadow&&e.translate(m),s.coordOffset=m,s.pointOffset=v,l._fireEvent("dragging",s),l!==e&&e._fireEvent("dragging",s)}}},i._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&ut(this.container,"mouseleave",this._endDrag),!!this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var n=e.getMap();if(this.enabled()&&n){var s=n._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(s),this._moved&&e._fireEvent("dragend",s)}}},i.isDragging=function(){return!!this._isDragging},i._updateTargetAndRemoveShadow=function(t){if(!!this._shadow){var e=this.target,n=e.getMap();e.options.dragShadow||e.show();var s=this._shadow;if(s){if(e.options.dragShadow)if(e.getGeometries){var h=s.getGeometries(),u=e.getGeometries();h.forEach(function(l,f){u[f].setCoordinates(h[f].getCoordinates())})}else e.setCoordinates(s.getCoordinates());s._fireEvent("dragend",t),s.remove(),delete this._shadow}this._shadowConnectors&&(n.getLayer(Mn).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new Oe,this._dragStageLayer.remove())}},i._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var n=this.target;if(!n.getMinAltitude())return t;var s=(n.getMinAltitude()+n.getMaxAltitude())/2;return e.locateByPoint(t,0,-s)},a}(Ut);K.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1});K.addInitHook("addHandler","draggable",Nc);K.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():this.draggable?this.draggable.isDragging():!1}});K.include({startEdit:function(a){return!this.getMap()||!this.options.editable?this:(this.endEdit(),this._editor=new Nh(this,a),this._editor.start(),this._getParent()||this.fire("editstart"),this)},endEdit:function(){return this._editor&&(this._editor.stop(),delete this._editor,this._getParent()||this.fire("editend")),this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return this._editor?this._editor.isEditing():!1}});K.include({_onEvent:function(a,i){var r=this.getMap();if(!!r){var t=i||this._getEventTypeToFire(a);t==="contextmenu"&&this.listens("contextmenu")&&(Lt(a),It(a));var e=r._getEventParams(a);N(this._pickGeometryIndex)&&(e.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(t,e)}},_getEventTypeToFire:function(a){return a.type}});K.include({setInfoWindow:function(a){return this.removeInfoWindow(),a instanceof Mr?(this._infoWindow=a,this._infoWinOptions=H({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=H({},a),this._infoWindow?this._infoWindow.setOptions(a):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(a){return this.getMap()?(a||(a=this.getCenter()),this._infoWindow?this._infoWindow.show(a):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(a)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var a=this._infoWinOptions;return a?(this._infoWindow=new Mr(a),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var Zc=new S(0,0),Bc=new S(0,0),Jo=new S(0,0),Yo=new S(0,0),Wc=[],Vc=function(o){z(a,o);function a(){return o.call(this,oa)||this}var i=a.prototype;return i.checkUrl=function(t){return!t||!$(t)?t:Nn(t)},i.fetchImage=function(t,e,n,s){t=this.checkUrl(t);var h={url:t,fetchOptions:s};this.send(h,Wc,n,e)},a}(aa),Uc=new Image,zr=function(o){z(a,o);function a(r){var t;return t=o.call(this,r)||this,t.tilesInView={},t.tilesLoading={},t._parentTiles=[],t._childTiles=[],t._tileQueue=[],t.tileCache=new Hs(r.options.maxCacheSize,t.deleteTile.bind(xt(xt(t)))),q.decodeImageInWorker&&t.layer.options.decodeImageInWorker&&(r.options.renderer==="gl"||!q.safari)&&(t._tileImageWorkerConn=new Vc),t._compareTiles=Yc.bind(xt(xt(t))),t}var i=a.prototype;return i.getCurrentTileZoom=function(){return this._tileZoom},i.draw=function(t,e){var n=this.getMap();if(!!this.isDrawable()){var s=this.prepareCanvas();if(s&&!s.intersects(this.canvasExtent2D)){this.completeRender();return}this._renderTimestamp!==t&&(this._consumeTileQueue(),this._renderTimestamp=t);var h,u=!1,l=this._frameTiles;if(l&&t===l.timestamp){if(l.empty)return;h=l}else{if(h=this._getTilesInCurrentFrame(),!h){this._frameTiles={empty:!0,timestamp:t},this.completeRender();return}u=!0,this._frameTiles=h,this._frameTiles.timestamp=t,h.loadingCount&&this.loadTileQueue(h.tileQueue)}var f=h,c=f.tiles,d=f.childTiles,g=f.parentTiles,v=f.placeholders,m=f.loading,_=f.loadingCount;this._drawTiles(c,g,d,v,e),_||m||(!n.isAnimating()&&(this._parentTiles.length||this._childTiles.length)&&(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),u&&this._retireTiles()}},i.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},i._getTilesInCurrentFrame=function(){var t=this.getMap(),e=this.layer,n=e.getTiles();if(this._frameTileGrids=n,n=n.tileGrids,!n||!n.length)return null;var s=n.reduce(function(J,ot){return J+(ot&&ot.tiles&&ot.tiles.length||0)},0);s>=this.tileCache.max/2&&this.tileCache.setMaxSize(s*2+1);var h=0,u=!1,l={},f=[],c=[],d={},g=[],v={},m=[],_={},p={},y=this._markTiles(),x=this._getLoadLimit(),M=n.length;this._tileZoom=n[0].zoom;for(var w=0;w<M;w++){var b=n[w],T=b.tiles,P=void 0;T.length&&(P=this._generatePlaceHolder(T[0].res));for(var O=0,I=T.length;O<I;O++){var E=T[O],D=E.id,R=!1;if(this._isLoadingTile(D))R=u=!0,this.tilesLoading[D].current=!0;else{var A=this._getCachedTile(D);if(A)A.image&&this.getTileOpacity(A.image)<1&&(R=u=!0,this.setToRedraw()),f.push(A);else{R=u=!0;var G=x&&h+y[0]>x;if(!G&&(!t.isInteracting()||t.isMoving()||t.isRotating())){h++;var F=D;p[F]=E}}}if(!!R&&!l[D]){l[D]=1,P&&!_[D]&&(E.cache=!1,m.push({image:P,info:E}),_[D]=1);var j=this._findParentTile(E);if(j){var Z=j.info.id;d[Z]===void 0&&(d[Z]=c.length,c.push(j))}else if(!c.length){var V=this._findChildTiles(E);V.length&&V.forEach(function(J){v[J.info.id]||(g.push(J),v[J.info.id]=1)})}}}}return c.length&&(g.length=0,this._childTiles.length=0),{childTiles:g,parentTiles:c,tiles:f,placeholders:m,loading:u,loadingCount:h,tileQueue:p}},i.isTileCachedOrLoading=function(t){return this.tileCache.get(t)||this.tilesInView[t]||this.tilesLoading[t]},i._drawTiles=function(t,e,n,s,h){var u=this;e.length&&(e.sort(function(d,g){return Math.abs(g.info.z-u._tileZoom)-Math.abs(d.info.z-u._tileZoom)}),this._parentTiles=e),n.length&&(this._childTiles=n);var l={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:h};this.onDrawTileStart(l,h),this.layer.options.opacity===1&&(this._childTiles.forEach(function(d){return u._drawTile(d.info,d.image,h)}),this._parentTiles.forEach(function(d){return u._drawTile(d.info,d.image,h)})),t.sort(this._compareTiles);for(var f=0,c=t.length;f<c;f++)this._drawTileAndCache(t[f],h);this.layer.options.opacity<1&&(this._childTiles.forEach(function(d){return u._drawTile(d.info,d.image,h)}),this._parentTiles.forEach(function(d){return u._drawTile(d.info,d.image,h)})),s.forEach(function(d){return u._drawTile(d.info,d.image,h)}),this.onDrawTileEnd(l,h)},i.onDrawTileStart=function(){},i.onDrawTileEnd=function(){},i._drawTile=function(t,e,n){e&&this.drawTile(t,e,n)},i._drawTileAndCache=function(t,e){t.current=!0,this.tilesInView[t.info.id]=t,this._drawTile(t.info,t.image,e),this.tileCache.add(t.info.id,t)},i.drawOnInteracting=function(t,e,n){this.draw(e,n)},i.needToRedraw=function(){var t=this.getMap();return this._tileQueue.length?!0:t.getPitch()?o.prototype.needToRedraw.call(this):t.isRotating()||t.isZooming()?!0:t.isMoving()?!!this.layer.options.forceRenderOnMoving:o.prototype.needToRedraw.call(this)},i.hitDetect=function(){return!1},i._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:0},i.isDrawable=function(){return this.getMap().getPitch()?(this.clear(),!1):!0},i.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],o.prototype.clear.call(this)},i._isLoadingTile=function(t){return!!this.tilesLoading[t]},i.clipCanvas=function(t){return o.prototype.clipCanvas.call(this,t)},i._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch||!this.layer.options.clipByPitch)return!1;var n=e.getContainerExtent(),s=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(n.ymin)*s,Math.ceil(n.getWidth())*s,Math.ceil(n.getHeight())*s),t.stroke(),t.clip(),!0},i.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e],s=this.loadTile(n);s.loadTime===void 0&&(this.tilesLoading[n.id]={image:s,current:!0,info:n})}},i.loadTile=function(t){var e;if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)e={},this._fetchImage(e,t);else{var n=this.layer.getTileSize(t.layer);e=new Image,e.width=n.width,e.height=n.height,e.onload=this.onTileLoad.bind(this,e,t),e.onerror=this.onTileError.bind(this,e,t),this.loadTileImage(e,t.url)}return e},i._fetchImage=function(t,e){var n=this;if(t instanceof Image)t.src=e.url;else{var s=e.x,h=e.y,u=Math.abs(s+h)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(e.url,u,function(l,f){l?n.onTileError(t,e,l):Gn(f,function(c){n.onTileLoad(c,e)})},this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},i.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;return C(n)||(t.crossOrigin=n),Pi(t,[e])},i.abortTileLoading=function(t){!t||(t.onload=Xo,t.onerror=Xo,t.src=Hn)},i.onTileLoad=function(t,e){this._tileQueue.push({tileInfo:e,tileData:t})},i._consumeTileQueue=function(){for(var t=0,e=this.layer.options.tileLimitPerFrame,n=this._tileQueue;n.length&&(e<=0||t<e);){var s=n.shift(),h=s.tileData,u=s.tileInfo;!this.checkTileInQueue(h,u)||(this.consumeTile(h,u),t++)}},i.checkTileInQueue=function(){return!0},i.consumeTile=function(t,e){if(!!this.layer){var n=e.id;if(!!this.tilesInView){var s={tile:e,tileImage:t};this.layer.fire("tileload",s),t=s.tileImage,t.loadTime=lt(),delete this.tilesLoading[n],this._addTileToCache(e,t),this.setToRedraw()}}},i.onTileError=function(t,e){if(!!this.layer){t.onerrorTick=t.onerrorTick||0;var n=this.layer.options.tileRetryCount;if(n>t.onerrorTick){t.onerrorTick++,this._fetchImage(t,e);return}var s=this.layer.options.errorUrl;if(s)if(t instanceof Image&&t.src!==s){t.src=s;return}else t=new Image,t.src=s;t=t instanceof Image?t:Uc,this.abortTileLoading(t,e),t.loadTime=0,delete this.tilesLoading[e.id],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}},i.drawTile=function(t,e){if(!(!e||!this.getMap())){var n=t.extent2d,s=t.offset,h=Zc.set(n.xmin-s[0],n.ymax-s[1]),u=t.z,l=t.id,f=this.getMap(),c=f.getZoom(),d=this.context,g=f._pointAtResToContainerPoint(h,t.res,0,Bc),v=f.getBearing(),m=v||c!==u,_=this.getTileOpacity(e),p=d.globalAlpha;_<1&&(d.globalAlpha=_,this.setToRedraw()),m||g._round();var y=g.x,x=g.y,M=t.extent2d.xmax-t.extent2d.xmin,w=t.extent2d.ymax-t.extent2d.ymin;if(m){d.save(),d.translate(y,x),v&&(d.rotate(-v*Math.PI/180),M+=.1,w+=.1);var b=f._getResolution();if(b!==t.res){var T=t.res/b;d.scale(T,T)}y=x=0}if(L.image(d,e,y,x,M,w),this.layer.options.debug){var P=this.layer.options.debugOutline;d.save(),d.strokeStyle=P,d.fillStyle=P,d.strokeWidth=10,d.font="20px monospace";var O=new S(y,x);L.rectangle(d,O,{width:M,height:w},1,0),L.fillText(d,this.getDebugInfo(l),O._add(32,w-14),P),L.drawCross(d,y+M/2,x+w/2,2,P),d.restore()}m&&d.restore(),d.globalAlpha!==p&&(d.globalAlpha=p),this.setCanvasUpdated()}},i.getDebugInfo=function(t){var e=t.split("_"),n=e.length;return"x:"+e[n-2]+", y:"+e[n-3]+", z:"+e[n-1]},i._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer);if(!e||!e.options.background)return[];for(var n=this.getMap(),s=[],h=t.res,u=t.extent2d.getMin(),l=t.extent2d.getMax(),f=e._project(n._pointToPrjAtRes(u,h,Jo),Jo),c=e._project(n._pointToPrjAtRes(l,h,Yo),Yo),d=3,g=1;g<d;g++)this._findChildTilesAt(s,f,c,e,t.z+g);return s},i._findChildTilesAt=function(t,e,n,s,h){var u=s.options.zoomOffset,l=s.getId(),f=s.getSpatialReference().getResolution(h+u);if(!!f)for(var c=s._getTileConfig().getTileIndex(e,f),d=s._getTileConfig().getTileIndex(n,f),g=Math.min(c.idx,d.idx),v=Math.max(c.idx,d.idx),m=Math.min(c.idy,d.idy),_=Math.max(c.idy,d.idy),p,y,x=g;x<v;x++)for(var M=m;M<_;M++)p=s._getTileId(x,M,h+u,l),this.tileCache.has(p)&&(y=this.tileCache.getAndRemove(p),t.push(y),this.tileCache.add(p,y))},i._findParentTile=function(t){var e=this.getMap(),n=this._getLayerOfTile(t.layer);if(!n||!n.options.background)return null;for(var s=n.getSpatialReference(),h=s.getZoomDirection(),u=n.options.zoomOffset,l=n.options.backgroundZoomDiff,f=t.res,c=t.extent2d.getCenter(),d=n._project(e._pointToPrjAtRes(c,f)),g=1;g<=l;g++){var v=t.z-h*g,m=s.getResolution(v+u);if(!!m){var _=n._getTileConfig().getTileIndex(d,m),p=n._getTileId(_.x,_.y,v+u,t.layer);if(this.tileCache.has(p)){var y=this.tileCache.getAndRemove(p);return this.tileCache.add(p,y),y}}}return null},i._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},i._getCachedTile=function(t){var e=this.tilesInView,n=this.tileCache.getAndRemove(t);if(n){e[t]=n;var s=this.tilesLoading;if(s&&s[t]){s[t].current=!1;var h=s[t],u=h.image,l=h.info;this.abortTileLoading(u,l),delete s[t]}}else n=e[t];return n},i._addTileToCache=function(t,e){this.tilesInView[t.id]={image:e,current:!0,info:t}},i.getTileOpacity=function(t){return!this.layer.options.fadeAnimation||!t.loadTime?1:Math.min(1,(lt()-t.loadTime)/(1e3/60*10))},i.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,o.prototype.onRemove.call(this)},i._markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var n in this.tilesLoading)this.tilesLoading[n].current=!1,t++;if(this.tilesInView)for(var s in this.tilesInView)this.tilesInView[s].current=!1,e++;return[t,e]},i._retireTiles=function(t){for(var e in this.tilesLoading){var n=this.tilesLoading[e];(t||!n.current)&&(n.image&&this.abortTileLoading(n.image,n.info),this.deleteTile(n),delete this.tilesLoading[e])}for(var s in this.tilesInView){var h=this.tilesInView[s];h.current||(delete this.tilesInView[s],this.tileCache.has(s)||this.deleteTile(h))}},i.deleteTile=function(t){!t||!t.image||(t.image.close&&t.image.close(),t.image.onload=null,t.image.onerror=null)},i._generatePlaceHolder=function(t){var e=this.getMap(),n=this.layer.options.placeholder;if(!n||e.getPitch())return null;var s=this.layer.getTileSize(),h=t/e._getResolution(),u=this._tilePlaceHolder=this._tilePlaceHolder||L.createCanvas(1,1,e.CanvasClass);return u.width=s.width*h,u.height=s.height*h,nt(n)?n(u):Jc(u),u},a}(Qe);Vt.registerRenderer("canvas",zr);function Xo(){return!1}function Jc(o){var a=o.getContext("2d"),i=o.width,r=o.height,t=i/16,e=r/16;a.beginPath();for(var n=0;n<16;n++)a.moveTo(0,n*e),a.lineTo(i,n*e),a.moveTo(n*t,0),a.lineTo(n*t,r);a.strokeStyle="rgba(180, 180, 180, 0.1)",a.lineWidth=1,a.stroke(),a.beginPath();for(var s=[[0,0],[i,0],[0,r],[i,r],[0,0],[0,r],[i,0],[i,r],[0,r/2],[i,r/2],[i/2,0],[i/2,r]],h=1;h<s.length;h+=2)a.moveTo(s[h-1][0],s[h-1][1]),a.lineTo(s[h][0],s[h][1]);a.lineWidth=1*4,a.stroke()}function Yc(o,a){return Math.abs(this._tileZoom-o.info.z)-Math.abs(this._tileZoom-a.info.z)}var Xc=new S(0,0),qc={properties:{}},Aa=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.isDrawable=function(){return!0},i.needToRedraw=function(){var t=this.getMap();return this._gl()&&!t.getPitch()&&t.isZooming()&&!t.isMoving()&&!t.isRotating()?!0:o.prototype.needToRedraw.call(this)},i.onDrawTileStart=function(t,e){var n=this.gl;if(n.stencilOp(n.KEEP,n.KEEP,n.REPLACE),e&&e.renderTarget){var s=e.renderTarget.fbo;if(s){var h=e.renderTarget.getFramebuffer(s);n.bindFramebuffer(n.FRAMEBUFFER,h)}}},i.onDrawTileEnd=function(t,e){var n=this.gl;if(e&&e.renderTarget){var s=e.renderTarget.fbo;s&&n.bindFramebuffer(n.FRAMEBUFFER,null)}},i.drawTile=function(t,e,n){if(!(n&&n.sceneFilter&&!n.sceneFilter(qc))){var s=this.getMap();if(!(!t||!s||!e)){var h=t._glScale=t._glScale||t.res/s.getGLRes(),u=t.extent2d.xmax-t.extent2d.xmin,l=t.extent2d.ymax-t.extent2d.ymin;if(t.cache!==!1&&this._bindGLBuffer(e,u,l),!this._gl()){o.prototype.drawTile.call(this,t,e);return}var f=t.extent2d,c=t.offset,d=Xc.set(f.xmin-c[0],t.extent2d.ymax-c[1]),g=d.x*h,v=d.y*h,m=this.getTileOpacity(e),_=null;this.layer.options.debug&&(_=this.getDebugInfo(t.id));var p=this.gl;p.stencilFunc(p.LEQUAL,Math.abs(this.getCurrentTileZoom()-t.z),255),this.drawGLImage(e,g,v,u,l,h,m,_),m<1?this.setToRedraw():this.setCanvasUpdated()}}},i._bindGLBuffer=function(t,e,n){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,n))},i.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;t.crossOrigin=n!==null?n:"",t.src=e},i.onCanvasCreate=function(){(!this.canvas.gl||!this.canvas.gl.wrap)&&this.createCanvas2()},i.createContext=function(){o.prototype.createContext.call(this),this.createGLContext()},i.resizeCanvas=function(t){!this.canvas||(o.prototype.resizeCanvas.call(this,t),this.resizeGLCanvas())},i.clearCanvas=function(){!this.canvas||(o.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.getCanvasImage=function(){if(!this._gl()||!this.canvas2)return o.prototype.getCanvasImage.call(this);var t=o.prototype.getCanvasImage.call(this);return t&&(t.image=this.canvas2),t},i._gl=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},i.deleteTile=function(t){o.prototype.deleteTile.call(this,t),t&&t.image&&this.disposeImage(t.image),delete t.image},i.onRemove=function(){o.prototype.onRemove.call(this),this.removeGLCanvas()},a}(Ta(zr));Vt.registerRenderer("gl",Aa);function Zh(o){var a=this.layer.getTileSize(),i=this.canvas.constructor,r=this.getMap(),t=r.getDevicePixelRatio(),e=L.createCanvas(a.width*t,a.height*t,i);e.layer=this.layer;var n=this,s=new S(o.extent2d.xmin,o.extent2d.ymax),h=new st(r.pointToCoordinate(s),r.pointToCoordinate(s.add(a.width,a.height)),r.getProjection());return this.layer.drawTile(e,{url:o.url,point:s,center:r.pointToCoordinate(s.add(a.width/2,a.height/2)),extent:h,z:o.z,x:o.x,y:o.y},function(u){if(u){n.onTileError(e,o);return}n.onTileLoad(e,o)}),e}var Bh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.loadTile=function(){return Zh.apply(this,arguments)},a}(zr),Wh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.loadTile=function(){return Zh.apply(this,arguments)},a}(Aa);Ma.registerRenderer("canvas",Bh);Ma.registerRenderer("gl",Wh);var $c=typeof Int8Array<"u"?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[],Qc=`
    attribute vec3 a_position;
    uniform mat4 transform;

    void main()
    {
        gl_Position = transform * vec4(a_position, 1.0);
    }
`,Kc=`
    precision mediump float;
    uniform vec3 color;
    void main()
    {
        gl_FragColor = vec4(color, 1.0);
    }
`,td=function(){function o(i,r,t){this.gl=i,this.quadVertices=r||$c,this.attributes=["a_position",3,ed(r)],this.debug=t}var a=o.prototype;return a.start=function(){var r=this.gl;r.enable(r.STENCIL_TEST),r.stencilMask(255),r.stencilOp(r.KEEP,r.REPLACE,r.REPLACE),r.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),r.useProgram(this.program),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),Hh(r,this.program,this.attributes),this.transformLoc||(this.transformLoc=r.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=r.getUniformLocation(this.program,"color")),!this.debug&&r.colorMask(!1,!1,!1,!1)},a.end=function(){var r=this.gl;r.depthMask(!0),this._restore(),!this.debug&&r.colorMask(!0,!0,!0,!0)},a.draw=function(r){var t=this.gl;t.uniformMatrix4fv(this.transformLoc,!1,r),t.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),t.drawArrays(t.TRIANGLE_STRIP,0,4)},a.remove=function(){var r=this.gl;return this.buffer&&r.deleteBuffer(this.buffer),this.program&&(r.deleteShader(this.program.fragmentShader),r.deleteShader(this.program.vertexShader),r.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},a.stencilMask=function(r){return this.gl.stencilMask(r),this},a.stencilFunc=function(r,t,e){return this.ref=t,this.gl.stencilFunc(r,t,e),this},a.stencilOp=function(r,t,e){return this.gl.stencilOp(r,t,e),this},a.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},a._save=function(){var r=this.gl;this._savedProgram=r.program},a._restore=function(){var r=this.gl;r.program=this._savedProgram,r.program&&r.useProgram(r.program)},a._createBuffer=function(){var r=this.gl;if(this.buffer=r.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferData(r.ARRAY_BUFFER,this.quadVertices,r.STATIC_DRAW)},a._createProgram=function(){var r=jh(this.gl,Qc,Kc),t=r.program,e=r.vertexShader,n=r.fragmentShader;t.vertexShader=e,t.fragmentShader=n,this.program=t},o}();function ed(o){return o instanceof Float32Array?"FLOAT":o instanceof Int16Array?"SHORT":o instanceof Uint16Array?"UNSIGNED_SHORT":o instanceof Int8Array?"BYTE":o instanceof Uint8Array||o instanceof Uint8ClampedArray?"UNSIGNED_BYTE":"FLOAT"}var Vh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.checkResources=function(){var t=this._geosToCheck;if(!this._resourceChecked&&!t&&(t=this.layer._geoList),!rt(t))return[];for(var e=[],n={},s=t.length-1;s>=0;s--){var h=t[s],u=h._getExternalResources();if(!!u.length)if(!this.resources)e.push.apply(e,u);else for(var l=0;l<u.length;l++){var f=u[l][0];!this.resources.isResourceLoaded(u[l])&&!n[f]&&(e.push(u[l]),n[f]=1)}}return this._resourceChecked=!0,delete this._geosToCheck,e},i.render=function(){return this.layer._sortGeometries(),o.prototype.render.apply(this,arguments)},i._addGeoToCheckRes=function(t){!t||(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),ke(this._geosToCheck,t))},i.onGeometryAdd=function(t){this._addGeoToCheckRes(t),ee(this)},i.onGeometryRemove=function(){ee(this)},i.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),ee(this)},i.onGeometryShapeChange=function(){ee(this)},i.onGeometryPositionChange=function(){ee(this)},i.onGeometryZIndexChange=function(){ee(this)},i.onGeometryShow=function(){ee(this)},i.onGeometryHide=function(){ee(this)},i.onGeometryPropertiesChange=function(){ee(this)},a}(Qe);function ee(o){o.layer.options.drawImmediate&&o.render(),o.setToRedraw()}var id=new Y,Ki=[],Tn=new Y,rd="center",Uh=function(o){z(a,o);function a(){return o.apply(this,arguments)||this}var i=a.prototype;return i.getImageData=function(){if(!this.layer.options.geometryEvents||!this._lastRenderTime||lt()-this._lastRenderTime<32||!this.context||!this.context.canvas)return null;if(!this._imageData){var t=this.context.canvas,e=t.width,n=t.height;try{this._imageData=this.context.getImageData(0,0,e,n)}catch{}}return this._imageData},i.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=lt()},i.checkResources=function(){var t=this,e=o.prototype.checkResources.apply(this,arguments),n=this.layer.getStyle();return n&&(Array.isArray(n)||(n=[n]),n.forEach(function(s){for(var h=bi(s.symbol,!0),u=0,l=h.length;u<l;u++)t.resources.isResourceLoaded(h[u])||e.push(h[u])})),e},i.needToRedraw=function(){var t=this.getMap();return t.isInteracting()&&this.layer.options.enableAltitude?!0:t.isZooming()&&!t.isRotating()&&!t.getPitch()&&!this._hasPoint&&this.layer.constructor===$t?!1:o.prototype.needToRedraw.call(this)},i.draw=function(){if(!!this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty()){this.clearCanvas(),this.completeRender();return}this.prepareCanvas(),this.drawGeos(),this.completeRender()}},i.isBlank=function(){return this.context?!this.context.canvas._drawn:!1},i.drawOnInteracting=function(){if(!!this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount(),n=this.mapStateCache.resolution;(t.isZooming()&&t.options.seamlessZoom&&this._drawnRes!==void 0&&n>this._drawnRes*1.5&&this._geosToDraw.length<e||t.isMoving()||t.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._drawnRes=n),this._sortByDistanceToCamera(t.cameraPosition);for(var s=0,h=this._geosToDraw.length;s<h;s++){var u=this._geosToDraw[s];if(!u._isCheck&&!u.isVisible()){delete u._cPoint,delete u._inCurrentView;continue}u._paint(this._displayExtent),this._geosToDraw[s]._cPoint=void 0,this._geosToDraw[s]._inCurrentView=void 0}this.clearImageData()}},i.show=function(){this.layer.forEach(function(t){t._repaint()}),o.prototype.show.apply(this,arguments)},i.forEachGeo=function(t,e){this.layer.forEach(t,e)},i.drawGeos=function(){this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._sortByDistanceToCamera(this.getMap().cameraPosition);for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(),this._geosToDraw[t]._cPoint=void 0,this._geosToDraw[t]._inCurrentView=void 0;this.clearImageData()},i.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},i.checkGeo=function(t){if(t.type==="Point"&&this._onlyHasPoint!==void 0){t._inCurrentView&&(this._hasPoint=!0,t._isCheck=!0,this._geosToDraw.push(t));return}if(t._isCheck=!1,!(!t||!t.isVisible()||!t.getMap()||!t.getLayer()||!t.getLayer().isCanvasRender())){var e=t._getPainter(),n=!0;if(t._inCurrentView)n=!0;else if(t._inCurrentView===!1)n=!1;else{var s=e.get2DExtent(this.resources,id);(!s||!s.intersects(this._displayExtent))&&(n=!1)}!n||(e.hasPoint()&&(this._hasPoint=!0),t._isCheck=!0,this._geosToDraw.push(t))}},i.onZoomEnd=function(){delete this.canvasExtent2D,o.prototype.onZoomEnd.apply(this,arguments)},i.onRemove=function(){this.forEachGeo(function(t){t.onHide()}),delete this._geosToDraw},i.onGeometryPropertiesChange=function(t){t&&this.layer._styleGeometry(t.target),o.prototype.onGeometryPropertiesChange.call(this,t)},i._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t)){this.completeRender();return}t=t.intersection(this._maskExtent)}this._displayExtent=t},i.identifyAtPoint=function(t,e){e===void 0&&(e={});var n=this._geosToDraw;return n?this.layer._hitGeos(n,t,e):[]},i._updateMapStateCache=function(){var t=this.getMap(),e=t._pointToContainerPoint(this.southWest)._add(0,-t.height),n=t.getResolution(),s=t.getPitch(),h=t.getBearing(),u=t.getGLScale(),l=t.getGLRes(),f=t.getContainerExtent(),c=t._get2DExtent(),d=t._get2DExtentAtRes(l);return this.mapStateCache={resolution:n,pitch:s,bearing:h,glScale:u,glRes:l,_2DExtent:c,glExtent:d,containerExtent:f,offset:e},this},i._batchConversionMarkers=function(t){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var e=[],n=[],s=[],h={},u=this.layer,l=u.options,f=u.getAltitude?u.getAltitude():0,c=u.isCanvasRender();this._onlyHasPoint=!0;for(var d=0,g=0,v=this.layer._geoList.length;g<v;g++){var m=this.layer._geoList[g],_=m.getType();if(_==="Point"){var p=m._painter;p||(p=m._getPainter());var y=p.getRenderPoints(rd)[0][0],x=l.enableAltitude?m.getAltitude():f;h[x]===void 0&&(h[x]=p.getAltitude()),e[d]=y,s[d]=h[x],n[d]=m,d++}else this._onlyHasPoint=!1}if(d===0)return[];var M=this.getMap(),w=Mi(e,"_pt");w=M._pointsAtResToContainerPoints(e,t,s,w);for(var b=M.getContainerExtent(),T=b.xmax,P=b.ymax,O=b.xmin,I=b.ymin,E={},D=0,R=n.length;D<R;D++){var A=n[D];if(A._cPoint=w[D],!A._cPoint){A._inCurrentView=!1;continue}var G=w[D],F=G.x,j=G.y;if(A._inCurrentView=F>=O&&j>=I&&F<=T&&j<=P,!A._inCurrentView){var Z=A.getSymbolHash(),V=void 0;Z?V=E[Z]=E[Z]||A._painter.getFixedExtent():V=A._painter.getFixedExtent(),Tn.set(V.xmin,V.ymin,V.xmax,V.ymax),Tn._add(w[D]),A._inCurrentView=Tn.intersects(b)}A._inCurrentView&&((!A.isVisible()||!c)&&(A._inCurrentView=!1),this._onlyHasPoint&&A._inCurrentView&&(this._hasPoint=!0,A._isCheck=!0,this._geosToDraw.push(A)))}return w},i._sortByDistanceToCamera=function(t){if(!!this.layer.options.sortByDistanceToCamera&&!!this._geosToDraw.length){var e=this.getMap(),n=e.distanceToPoint(1e3,0,e.getGLScale()).x,s=n/1e3,h="center";this._geosToDraw.sort(function(u,l){var f=u.getType(),c=l.getType();if(f!=="Point"||c!=="Point")return 0;var d=u._painter,g=l._painter;if(!d||!g)return 0;var v=d.getRenderPoints(h)[0][0],m=g.getRenderPoints(h)[0][0],_=d.getAltitude()*s,p=g.getAltitude()*s;Ft(Ki,v.x,v.y,_);var y=Pr(Ki,t);Ft(Ki,m.x,m.y,p);var x=Pr(Ki,t);return x-y})}},i._constructorIsThis=function(){return this.constructor===a},a}(Vh);$t.registerRenderer("canvas",Uh);var Jh=function(o){z(a,o);function a(r){var t;return t=o.call(this)||this,t.map=r,t._handlerQueue=[],t}var i=a.prototype;return i.callInNextFrame=function(t){this._handlerQueue.push(t)},i.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]()},i.offsetPlatform=function(t,e){if(!this.map._panels.front)return this;if(!e&&t.x===0&&t.y===0)return this;var n=this.map._panels,s=this._frontCount=n.back.layerDOM.childElementCount,h=this._backCount=n.front.layerDOM.childElementCount,u=this._uiCount=n.front.uiDOM.childElementCount;if(s||h||u){var l=this.map.offsetPlatform();t?l=l.add(t)._round():l=l.round(),h&&pi(n.back,l),(s||u)&&pi(n.front,l)}return this},i.domChanged=function(){var t=this.map._panels;if(!t.front)return!1;var e=t.back.layerDOM.childElementCount;if(this._frontCount===void 0||this._frontCount!==e)return!0;var n=t.front.layerDOM.childElementCount;if(this._backCount===void 0||this._backCount!==n)return!0;var s=t.front.uiDOM.childElementCount;return this._uiCount===void 0||this._uiCount!==s},i.resetContainer=function(){if(!!this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new S(0,0);pi(this.map._panels.back,t),pi(this.map._panels.front,t)}},i.onZoomEnd=function(){this.resetContainer()},i.onLoad=function(){this._frameLoop()},a}(Nt),Yh=function(o){z(a,o);function a(r){var t;return t=o.call(this,r)||this,t._containerIsCanvas=!!r._containerDOM.getContext,t._thisVisibilitychange=t._onVisibilitychange.bind(xt(xt(t))),t._registerEvents(),t._loopTime=0,t}var i=a.prototype;return i.load=function(){this.initContainer()},i.renderFrame=function(t){var e=this.map;if(!e||!e.options.renderable)return!1;if(e.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(t),delete this._isViewChanged,e._fireEvent("framestart"),this.updateMapDOM(),e.clearCollisionIndex();var n=this._getAllLayerToRender();this.drawLayers(n,t);var s=this.drawLayerCanvas(n);return s&&(this.drawTops(),this._drawCenterCross()),e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,!0},i.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t._getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},i.drawLayers=function(t,e){for(var n=this.map,s=n.isInteracting(),h=[],u=[],l=n.options.fpsOnInteracting||0,f=l===0?0:1e3/l,c=this.map.options.layerCanvasLimitOnInteracting,d=t.length,g=n.getBaseLayer(),v=0,m=0;m<d;m++){var _=t[m];if(!!_.isVisible()){var p=_.isCanvasRender();p&&h.push(_.getId());var y=_._getRenderer();if(!!y){var x=this._checkLayerRedraw(_);p&&y.isCanvasUpdated()&&(x||u.push(_.getId()),this.setLayerCanvasUpdated());var M=y.__zoomTransformMatrix;if(delete y.__zoomTransformMatrix,!x){p&&s&&(n.isZooming()&&!n.getPitch()?(y.prepareRender(),y.__zoomTransformMatrix=this._zoomMatrix):(n.getPitch()||n.isRotating())&&y.clearCanvas());continue}if(s&&p){if(c>0&&d-1-m>c&&_!==g){_._getRenderer().clearCanvas();continue}v+=this._drawCanvasLayerOnInteracting(_,v,f,e)}else s&&y.drawOnInteracting?(y.prepareRender&&y.prepareRender(),y.checkAndDraw?y.checkAndDraw(y.drawOnInteracting,this._eventParam,e):y.drawOnInteracting(this._eventParam,e)):(y.render(e),p&&M&&y.isLoadingResource()&&(y.__zoomTransformMatrix=M));p&&(u.push(_.getId()),this.setLayerCanvasUpdated())}}}var w=this._canvasIds||[],b=this._updatedIds||[];if(this._canvasIds=h,this._updatedIds=u,!this.isLayerCanvasUpdated()){var T="---";(w.join(T)!==h.join(T)||b.join(T)!==u.join(T))&&this.setLayerCanvasUpdated()}},i._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,n=t._getRenderer();return t.isCanvasRender()?n.testIfNeedRedraw():n.needToRedraw&&n.needToRedraw()?!0:e.isInteracting()||this.isViewChanged()},i._drawCanvasLayerOnInteracting=function(t,e,n,s){var h=this.map,u=t._getRenderer(),l=u.getDrawTime(),f=n===0||n>0&&e+l<=n;if(u.mustRenderOnInteracting&&u.mustRenderOnInteracting())u.render(s);else{if(u.drawOnInteracting&&(t===h.getBaseLayer()||f||h.isZooming()&&t.options.forceRenderOnZooming||h.isMoving()&&t.options.forceRenderOnMoving||h.isRotating()&&t.options.forceRenderOnRotating))return u.prepareRender(),u.prepareCanvas(),u.checkAndDraw?u.checkAndDraw(u.drawOnInteracting,this._eventParam,s):u.drawOnInteracting(this._eventParam,s),l;h.isZooming()&&!h.getPitch()&&!h.isRotating()?(u.prepareRender(),u.__zoomTransformMatrix=this._zoomMatrix):(h.getPitch()||h.isRotating())&&u.clearCanvas()}return u.drawOnInteracting&&!f&&u.onSkipDrawOnInteracting(this._eventParam,s),0},i._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach(function(e){var n=t.getLayer(e);if(!!n){var s=n._getRenderer();!s||!s.isRenderComplete()||n.fire("layerload")}})}},i.isLayerCanvasUpdated=function(){return this._canvasUpdated},i.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},i.drawLayerCanvas=function(t){var e=this.map;if(!e||!this.isLayerCanvasUpdated()&&!this.isViewChanged())return!1;this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var n=e.isInteracting(),s=e.options.layerCanvasLimitOnInteracting,h=t.length,u,l=[],f=0;f<h;f++)if(!(!t[f].isVisible()||!t[f].isCanvasRender())){var c=t[f]._getRenderer();if(!!c){var d=this._getLayerImage(t[f]);d&&d.image&&(t[f]===e.getBaseLayer()?u=[t[f],d]:l.push([t[f],d]))}}var g=this.canvas.width,v=this.canvas.height;u&&(this._drawLayerCanvasImage(u[0],u[1],g,v),this._drawFog()),h=l.length;for(var m=n&&s>=0&&h>s?h-s:0,_=m;_<h;_++)this._drawLayerCanvasImage(l[_][0],l[_][1],g,v);return e._fireEvent("renderend",{context:this.context}),!0},i.setToRedraw=function(){for(var t=this._getAllLayerToRender(),e=0,n=t.length;e<n;e++){var s=t[e].getRenderer();s&&s.canvas&&s.setToRedraw&&s.setToRedraw()}},i.updateMapSize=function(t){if(!(!t||this._containerIsCanvas)){var e=t.width+"px",n=t.height+"px",s=this.map._panels;s.mapWrapper.style.width=e,s.mapWrapper.style.height=n,this._updateCanvasSize()}},i.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},i.toDataURL=function(t,e){return this.canvas?this.canvas.toDataURL(t,e):null},i.remove=function(){q.webgl&&typeof document<"u"&&Pe(document,"visibilitychange",this._thisVisibilitychange),this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},i.hitDetect=function(t){var e=this.map;if(!(!e||!e.options.hitDetect||e.isInteracting())){var n=e._getLayers(),s="default",h=e.options.hitDetectLimit||0,u=0;t&&t._round&&t._round();for(var l=n.length-1;l>=0;l--){var f=n[l];if(!(!f.options.hitDetect||f.isEmpty&&f.isEmpty())){var c=f._getRenderer();if(!(!c||!c.hitDetect)&&!(c.isBlank&&c.isBlank())){if(f.options.cursor!=="default"&&c.hitDetect(t)){s=f.options.cursor||"pointer";break}if(u++,h>0&&u>h)break}}}e._trySetCursor(s)}},i._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},i.initContainer=function(){var t=this.map._panels;function e(x,M,w,b){var T=W("div",M);return w&&(T.style.cssText=w),t[x]=T,b||As(T),T}var n=this.map._containerDOM;if(!this._containerIsCanvas){n.innerHTML="";var s="position:absolute;top:0px;left:0px;",h=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),u=e("allLayers","maptalks-all-layers",s+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),l=e("backStatic","maptalks-back-static",s+"z-index:0;",!0),f=e("back","maptalks-back",s+"z-index:1;"),c=e("backLayer","maptalks-back-layer",s),d=e("canvasContainer","maptalks-canvas-layer",s+"border:none;z-index:2;"),g=e("frontStatic","maptalks-front-static",s+"z-index:3;",!0),v=e("front","maptalks-front",s+"z-index:4;",!0),m=e("frontLayer","maptalks-front-layer",s+"z-index:0;"),_=e("ui","maptalks-ui",s+"border:none;z-index:1;",!0),p=e("control","maptalks-control","z-index:1",!0);n.appendChild(h),u.appendChild(l),f.appendChild(c),f.layerDOM=c,u.appendChild(f),u.appendChild(d),v.appendChild(m),v.layerDOM=m,v.uiDOM=_,u.appendChild(g),u.appendChild(v),v.appendChild(_),h.appendChild(u),h.appendChild(p),this.createCanvas(),this.resetContainer();var y=this.map._getContainerDomSize();this.updateMapSize(y)}},i.isViewChanged=function(){if(this._isViewChanged!==void 0)return this._isViewChanged;var t=this._mapview,e=this._getMapView();return this._isViewChanged=!t||!ur(t,e),this._isViewChanged},i._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||ur(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},i.isSpatialReferenceChanged=function(){return this._spatialRefChanged},i._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},i._frameLoop=function(t){var e=this;if(!this.map){this._cancelFrameLoop();return}t=t||0,this._frameTimestamp=t,this._resizeCount=0,this.renderFrame(t),this._animationFrame=Xt(function(n){e._frameLoop(n)})},i._cancelFrameLoop=function(){this._animationFrame&&Ci(this._animationFrame)},i._drawLayerCanvasImage=function(t,e,n,s){var h=this.context,u=e.point.round(),l=this.map.getDevicePixelRatio();l!==1&&u._multi(l);var f=e.image,c=f.width,d=f.height;if(!(u.x+c<=0||u.y+d<=0)){var g=t.options.opacity;if(N(g)||(g=1),!(g<=0)){var v=e.opacity;if(N(v)||(v=1),!(v<=0)){var m=h.globalAlpha;g<1&&(h.globalAlpha*=g),v<1&&(h.globalAlpha*=v),t.options.cssFilter&&(h.filter=t.options.cssFilter);var _=t.getRenderer(),p=_.__zoomTransformMatrix,y=_.clipCanvas(this.context);p&&(h.save(),h.setTransform.apply(h,p)),h.drawImage(f,0,0,c,d,u.x,u.y,n,s),p&&h.restore(),y&&h.restore(),h.filter!=="none"&&(h.filter="none"),h.globalAlpha=m}}}},i._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,n=new S(this.canvas.width/2,this.canvas.height/2);nt(t)?t(e,n):L.drawCross(this.context,n.x,n.y,2,"#f00")}},i._drawContainerExtent=function(){var t=this.map.options.cascadePitches,e=this.map.height-this.map._getVisualHeight(t[0]),n=this.map.height-this.map._getVisualHeight(t[1]),s=this.map.getContainerExtent(),h=this.context;h.beginPath(),h.moveTo(0,s.ymin),h.lineTo(s.xmax,s.ymin),h.stroke(),h.beginPath(),h.moveTo(0,e),h.lineTo(s.xmax,e),h.stroke(),h.beginPath(),h.moveTo(0,n),h.lineTo(s.xmax,n),h.stroke()},i._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch||!t.options.fog)){var e=30,n=t.getDevicePixelRatio(),s=this.context,h=t.getContainerExtent(),u=(t.height-t._getVisualHeight(75))*n;u<0&&(u=0);var l=h.ymin*n,f=Math.ceil(l-u),c=t.options.fogColor.join(),d=s.createLinearGradient(0,u,0,l+e),g=1-e/(f+e);d.addColorStop(0,"rgba("+c+", 0)"),d.addColorStop(.3,"rgba("+c+", 0.3)"),d.addColorStop(g,"rgba("+c+", 1)"),d.addColorStop(1,"rgba("+c+", 0)"),s.beginPath(),s.fillStyle=d,s.fillRect(0,u,Math.ceil(h.getWidth())*n,Math.ceil(f+e))}},i._getAllLayerToRender=function(){return this.map._getLayers()},i.clearCanvas=function(){!this.canvas||L.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),n=this.canvas,s=t.getDevicePixelRatio(),h=Zn(e,s),u=h.width,l=h.height,f=h.cssWidth,c=h.cssHeight;return n.style&&(n.style.width!==f||n.style.height!==c)&&(n.style.width=f,n.style.height=c),u===n.width&&l===n.height?!1:(n.height=l,n.width=u,this.topLayer.width=n.width,this.topLayer.height=n.height,!0)},i.createCanvas=function(){this.topLayer=W("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=W("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},i._updateDomPosition=function(t){this._checkPositionTime===void 0&&(this._checkPositionTime=-1/0);var e=Math.abs(t-this._checkPositionTime);return e>=500&&(Ri(this.map._containerDOM),this._checkPositionTime=Math.min(t,this._checkPositionTime)),this},i._checkSize=function(){!this.map||this.map.checkSize()},i._setCheckSizeInterval=function(t){var e=this;q.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver(function(n){!e.map||e.map.isRemoved()?e._resizeObserver.disconnect():n.length&&(e.map._containerDomContentRect=n[0].contentRect,e._checkSize(n[0].contentRect),e._resizeCount=e._resizeCount||0,e.renderFrame((e._frameTimestamp||0)+ ++e._resizeCount/100))}),this._resizeObserver.observe(this.map._containerDOM))):(clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval(function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()},this._checkSizeInterval))},i._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!pt&&typeof window<"u"&&this._setCheckSizeInterval(e.options.checkSizeInterval),q.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",function(n){t._eventParam=n}),e.on("_zooming",function(n){e.getPitch()||(t._zoomMatrix=n.matrix.container),t._eventParam=n}),e.on("_zoomend",function(n){t._eventParam=n,delete t._zoomMatrix}),e.on("_spatialreferencechange",function(){t._spatialRefChanged=!0}),q.webgl&&typeof document<"u"&&re(document,"visibilitychange",this._thisVisibilitychange,this),q.addDPRListening&&q.addDPRListening(this.map)},i._onMapMouseMove=function(t){var e=this,n=this.map;n.isInteracting()||!n.options.hitDetect||(this._hitDetectFrame&&Ci(this._hitDetectFrame),this._hitDetectFrame=Xt(function(){e.hitDetect(t.containerPoint)}))},i._getCanvasLayers=function(){return this.map._getLayers(function(t){return t.isCanvasRender()})},i._onVisibilitychange=function(){document.visibilityState==="visible"&&this.setToRedraw()},i.addTopElement=function(t){this._tops||(this._tops=[]),this._tops.push(t)},i.removeTopElement=function(t){if(!!this._tops){var e=this._tops.indexOf(t);e>=0&&this._tops.splice(e,1)}},i.getTopElements=function(){return this._tops||[]},i.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var t=this.getTopElements(),e=!1,n=0;n<t.length;n++)t[n].render(this.topCtx)&&(e=!0);e&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},i._containerIsOffscreen=function(){var t=this.map.getContainer();if(!t||!t.style||t.style.display==="none")return!0;var e=Math.min(t.clientWidth,t.clientHeight);return e<=0},a}(Jh);U.registerRenderer("canvas",Yh);U.mergeOptions({fog:!1,fogColor:[233,233,233]});var pd=Object.freeze({ResourceCache:Oe,CanvasRenderer:Qe,ImageGLRenderable:Ta,MapRenderer:Jh,MapCanvasRenderer:Yh,Renderable:na,ImageLayerCanvasRenderer:ba,ImageLayerGLRenderer:Fh,TileLayerCanvasRenderer:zr,TileLayerGLRenderer:Aa,CanvasTileLayerCanvasRenderer:Bh,CanvasTileLayerGLRenderer:Wh,QuadStencil:td,OverlayLayerCanvasRenderer:Vh,VectorLayerCanvasRenderer:Uh,CanvasLayerRenderer:Ea}),jr={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};gt.include(jr);ae.include(jr);qt.include(jr);ti.include(jr);Ue.include({_getRenderPoints:function(a){var i=this.getMap(),r=i.getGLRes();if(a==="vertex"){for(var t=this._trimRing(this.getShell()),e=[],n=0,s=t.length;n<s;n++)e.push(i.coordToPointAtRes(t[n],r));return[e,null]}else{var h=i.coordToPointAtRes(this.getCenter(),r);return[[h],null]}}});var Xh={_getRenderPoints:function(a){var i=this.getMap(),r=i.getGLRes(),t,e=null;if(a==="point")t=this._getPath2DPoints(this._getPrjCoordinates(),!1,r),t&&t.length>0&&Array.isArray(t[0])&&(t=t[0].concat(t[1]));else if(a==="vertex")if(t=this._getPath2DPoints(this._getPrjCoordinates(),!1,r),e=[],t&&t.length>0&&Array.isArray(t[0])){for(var n=0,s=t.length;n<s;n++)for(var h=0,u=t[n].length;h<u;h++)h===0?e.push([t[n][h],t[n][h+1]]):e.push([t[n][h-1],t[n][h]]);t=t[0].concat(t[1])}else for(var l=0,f=t.length;l<f;l++)l===0?e.push([t[l],t[l+1]]):e.push([t[l-1],t[l]]);else if(a==="line"){t=[],e=[];var c=this._getPath2DPoints(this._getPrjCoordinates(),!1,r),d=c.length>0&&Array.isArray(c[0]);if(d)for(var g,v=1,m=c.length;v<m;v++){g=c[v],this instanceof mt&&g.length>0&&!g[0].equals(g[g.length-1])&&g.push(g[0]);for(var _=1,p=g.length;_<p;_++)t.push(g[_].add(g[_-1])._multi(.5)),e.push([g[_-1],g[_]])}else{this instanceof mt&&c.length>0&&!c[0].equals(c[c.length-1])&&c.push(c[0]);for(var y=1,x=c.length;y<x;y++)t.push(c[y].add(c[y-1])._multi(.5)),e.push([c[y-1],c[y]])}}else if(a==="vertex-first"){var M=this._getPrjCoordinates(),w=M.length,b=w?i._prjToPointAtRes(M[0],r):null;t=w?[b]:[],e=w?[[b,M[1]?i._prjToPointAtRes(M[1],r):b]]:[]}else if(a==="vertex-last"){var T=this._getPrjCoordinates(),P=T.length,O=P?i._prjToPointAtRes(T[P-1],r):null;t=P?[O]:[];var I=P>1?P-2:P-1;e=P?[[T[I]?i._prjToPointAtRes(T[I],r):O,O]]:[]}else{var E=this.getCenter();if(!E)t=[];else{var D=this._getProjection().project(E);t=[i._prjToPointAtRes(D,r)]}}return[t,e]}};dt.include(Xh);mt.include(Xh);var Fe={within:!1,center:[0,0]};function qh(o){if(!o||!o._containerBbox)Fe.within=!1;else{Fe.within=!1;var a=o._containerBbox,i=a.minx,r=a.miny,t=a.maxx,e=a.maxy,n=Math.abs(t-i),s=Math.abs(e-r);n<=1&&s<=1&&(Fe.within=!0,Fe.center[0]=(i+t)/2,Fe.center[1]=(r+e)/2),delete o._containerBbox}return Fe}K.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}});var Oa={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof ae||this instanceof ti},_paintAsPath:function(){var a=this.getMap(),i=this.getAltitude();return i>0||a.getPitch()||this instanceof ae&&a.getBearing()},_getPaintParams:function(){var a=this.getMap();if(this._paintAsPath())return mt.prototype._getPaintParams.call(this,!0);var i=this._getPrjCoordinates(),r=a._prjToPointAtRes(i,a.getGLRes()),t=this._getRenderSize(r);return[r].concat(t)},_paintOn:function(){return this._paintAsPath()?L.polygon.apply(L,arguments):L.ellipse.apply(L,arguments)},_getRenderSize:function(a){var i=this.getMap(),r=i.getGLRes(),t=this._getPrjExtent(),e=i._prjToPointAtRes(t.getMin(),r),n=i._prjToPointAtRes(t.getMax(),r);return[Math.abs(n.x-e.x)/2,Math.abs(n.y-a.y),Math.abs(a.y-e.y)]}};ae.include(Oa);qt.include(Oa);Ue.include({_getPaintParams:function(){var a=this.getMap(),i=this._getPrjShell(),r=this._getPath2DPoints(i,!1,a.getGLRes());return[r]},_paintOn:L.polygon});ti.include(Oa,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return mt.prototype._getPaintParams.call(this,!0);var a=this.getMap(),i=a._prjToPointAtRes(this._getPrjCoordinates(),a.getGLRes()),r=this._getRenderSize(i);return[i,r[0],[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return L.polygon.apply(L,arguments);var a=this.getMap().getBearing(),i=arguments;return a&&(i[3]=i[3].slice(0),i[3][0]+=a,i[3][1]+=a),L.sector.apply(L,i)}});Dr.include({_paintAsPath:function(){return!0}});dt.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(a,i,r,t,e){if(!a||!i||a.equals(i))return null;e||(e=0);var n=r*t[0],s=r*t[1]+e,h=n/2+e,u;i.nextCtrlPoint||i.prevCtrlPoint?i.prevCtrlPoint?u=i.sub(new S(i.prevCtrlPoint)):u=i.sub(new S(i.nextCtrlPoint)):u=i.sub(a),u._unit();var l=i.sub(u.multi(s));u._perp();var f=l.add(u.multi(h));u._multi(-1);var c=l.add(u.multi(h));return[f,i,c,f]},_getPaintParams:function(){var a=this._getPrjCoordinates(),i=this._getPath2DPoints(a,!1,this.getMap().getGLRes());return[i]},_paintOn:function(a,i,r,t,e){var n=qh(this._painter);n.within?L.pixelRect(a,n.center,r,t):this.options.smoothness?L.paintSmoothLine(a,i,r,this.options.smoothness,!1,this._animIdx,this._animTailRatio):L.path(a,i,r,null,e),this._paintArrow(a,i,r)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var a=this.options.arrowStyle;return a?Array.isArray(a)?a:this.arrowStyles[a]:null},_getArrows:function(a,i,r){var t=this._getArrowStyle();if(!t||a.length<2)return[];for(var e=a.length>0&&Array.isArray(a[0]),n=e?a:[a],s=this._getArrowPlacement(),h=[],u=this.getMap(),l=u.coordToContainerPoint(this.getFirstCoordinate()),f=u.coordToContainerPoint(this.getLastCoordinate()),c=n.length-1;c>=0;c--){if(s==="vertex-first"||s==="vertex-firstlast"&&n[c][0].closeTo(l,.01)){var d=this._getArrowShape(n[c][1],n[c][0],i,t,r);d&&h.push(d)}if(s==="vertex-last"||s==="vertex-firstlast"&&n[c][n[c].length-1].closeTo(f,.01)){var g=this._getArrowShape(n[c][n[c].length-2],n[c][n[c].length-1],i,t,r);g&&h.push(g)}else s==="point"&&this._getArrowPoints(h,n[c],i,t,r)}return h},_getArrowPoints:function(a,i,r,t,e){for(var n=0,s=i.length-1;n<s;n++){var h=this._getArrowShape(i[n],i[n+1],r,t,e);h&&a.push(h)}},_paintArrow:function(a,i,r){var t=this._getInternalSymbol().lineWidth;(!N(t)||t<3)&&(t=3);var e=this._getArrows(i,t);if(!!e.length){a.setLineDash&&a.setLineDash([]);for(var n=e.length-1;n>=0;n--)a.fillStyle=a.strokeStyle,L.polygon(a,e[n],r,r)}}});mt.include({_getPaintParams:function(a){var i=this.getMap().getGLRes(),r=this._getPrjShell(),t=this._getPath2DPoints(r,a,i),e=t.length>0&&Array.isArray(t[0]);e&&(t=[[t[0]],[t[1]]]);var n=this._getPrjHoles(),s=[];if(n&&n.length>0){for(var h=this._simplified,u=0;u<n.length;u++){var l=this._getPath2DPoints(n[u],a,i);Array.isArray(l)&&e?Array.isArray(l[0])?(t[0].push(l[0]),t[1].push(l[1])):t[0].push(l):s.push(l)}h&&(this._simplified=h)}return e||(t=[t],ke(t,s)),[t]},_paintOn:function(a,i,r,t,e){var n=qh(this._painter);n.within?L.pixelRect(a,n.center,r,t):L.polygon(a,i,r,t,e,this.options.smoothness)}});U.VERSION=cu;var yd={Actor:aa};const ge={assert(o,a){if(!o)throw new Error(`[GIS] ${a}`)},mixin(o,a){for(var i in o)o.hasOwnProperty(i)&&(a[i]=o[i])},uuid(o=32,a=16){let i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[],t;if(a=a||i.length,o)for(t=0;t<o;t++)r[t]=i[0|Math.random()*a];else{let e;for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",t=0;t<36;t++)r[t]||(e=0|Math.random()*16,r[t]=i[t===19?e&3|8:e])}return r.join("")},meter2degree(o){return o*.001*.008993220292999999},degree2meter(o){return o*1e3/.008993220292999999},convertTableArr2objects(o){if(!o)return null;var a=[];for(let i=0;i<o.length;i++){let r=this.convertTable2objects(o[i]);a=a.concat(r||[])}return a},convertTable2objects(o){if(!o)return null;var a=[];for(let r=0;r<o.Values.length;r++){var i=this.convertRow2object(o,r);a.push(i)}return a},convertRow2object(o,a){for(var i={},r=0;r<o.Columns.length;r++){var t=o.Values[a][r];(o.ColumnsType[r]==="number"||o.ColumnsType[r]==="double")&&(t===""?t=0:t=parseFloat(t)),i[o.Columns[r]]=t}return i},extendTable(o){o.objects=[];for(var a=0;a<o.Values.length;a++){for(var i=o.Values[a],r={},t=0;t<o.Columns.length;t++){var e=o.Columns[t];r[e]=i[t]}o.objects.push(r)}return o},trim(o){return(""+o).replace(/(^[\s\n\t]+|[\s\n\t]+$)/g,"")},renderTemplate(o,a){let i=/(\\)?\{([^\{\}\\]+)(\\)?\}/g;return o.replace(i,function(r,t,e,n){if(t||n)return r.replace("\\","");let s=e.replace(/\s/g,"").split("."),h=a,u,l,f;for(u=0,l=s.length;u<l;++u)if(f=s[u],h=h[f],h==null)return"";return h})},isType(o,a){return Object.prototype.toString.call(o)==="[object "+a+"]"}},nd={prop:{showMousePosition:{type:Boolean,default:!0}},computed:{...eu({configLoaded:"MapModule/configLoaded",mapConfig:"MapModule/mapConfig",map:"MapModule/map"})},watch:{configLoaded(){this.configLoaded&&this.initMap()}},mounted(){this.$nextTick(()=>{this.configLoaded&&this.initMap()})},beforeDestroy(){},methods:{initMap(){this.map&&this.map.getInstance().remove(),this.mapConfig.showMousePosition=this.showMousePosition;const o=this.mapConfig;let a=[],i=[];o.baseLayers.forEach(m=>{i.push(new Vt(m.name,m))}),a=new Pa("base-map",i);const r={center:[0,0],zoom:5,minZoom:1,maxZoom:19,zoomInCenter:!0,attribution:!1,spatialReference:null,zoomControl:!1,scaleControl:!1},{center:t,zoom:e,minZoom:n,maxZoom:s,zoomInCenter:h,attribution:u,spatialReference:l,zoomControl:f,layerSwitcherControl:c,scaleControl:d}={...r,...o.mapOptions};let g=new U("map",{center:t,zoom:e,minZoom:n,maxZoom:s,zoomInCenter:h,attribution:u,spatialReference:l,zoomControl:{...f},layerSwitcherControl:{...c},scaleControl:{...d},baseLayer:a}),v=ad(g);Ye={getInstance(){return g},getBaseLayers(){return a},clearLayerById(m){let _=g.getLayer(m);_&&_.clear()},removeLayerById(m){let _=g.getLayer(m);_&&_.remove()},getOrCreateLayerById(m,_={}){let p=g.getLayer(m);return!p&&(p=new $t(m,_).addTo(g)),p},setLayerVisuableById(m,_){let p=g.getLayer(m);p&&p.config("visible",_)},addPoints(m,_,p){const{id:y,x,y:M,symbol:w,cursor:b,fitExtent:T}={id:"id",x:"x",y:"y",cursor:"pointer",fitExtent:!1,...p};let P=this.getOrCreateLayerById(m),O=sd(_,{id:y,x,y:M,symbol:w,cursor:b});P.addGeometry(O,T),P.config("cursor","default")},addLines(m,_,{id:p,x:y,y:x,symbol:M,cursor:w,fitExtent:b}){let T=this.getOrCreateLayerById(m),P=hd(_,{id:p,x:y,y:x,symbol:M,cursor:w});T.addGeometry(P,!!b),T.config("cursor","default")},getInfoWindow(){return v},hideInfoWindow(){v.hide()},setMapLinstener(m){if(typeof m=="function"){let _={id:ge.uuid(),type:"click",run:m};ce.push(_)}else m instanceof Object&&typeof m.run=="function"?(m.type=m.type||"click",ce.push(m)):alert("not support event linstener")},getMapLinstener(m){return ce},removeMapLinstener(m){ce.forEach((_,p)=>{(typeof m=="function"&&_.run===m||typeof m=="string"&&_.id===m||typeof m=="object"&&(!m.type&&_.id===m.id&&_.run===m.run||_.id===m.id&&_.type===m.type&&_.run===m.run))&&ce.splice(p,1)})},forEachFeatureAtCoordinate(m,_){return _ instanceof Array||(_=[_]),new Promise(p=>{g.identify({coordinate:m,layers:_},function(y){p(y)})})},showInfoWindow({x:m,y:_,dx:p,dy:y,title:x,content:M,lnglat:w,offset:b,data:T,methods:P}){v.config("dy",y||0),v.config("dx",p||0),v.setTitle(x);const O=`pop_${ge.uuid(8)}`;v.setContent(`<div id="${O}"></div>`),this._renderTemplate(O,M,T,P),v.show({x:m,y:_})},clear(){this.hideInfoWindow(),this.getInstance().getLayers(m=>(m.getJSONType()!=="TileLayer"&&m.getId()!=="boundary_layer"&&m.getId()!=="label_area"&&m.remove(),m.getJSONType()!=="TileLayer"))},flyTo(m){g.panTo(m)},_renderTemplate(m,_="",p={},y={}){!m||!ge.isType(m,"String")||!ge.isType(_,"String")||!ge.isType(p,"Object")||!ge.isType(y,"Object")||setTimeout(()=>{if(!document.getElementById(m)){this._renderTemplate(m,_,p,y);return}try{new iu({template:`<div class="maptalks-vue-render">${_}</div>`,data(){return{...p}},methods:{...y}}).$mount(`#${m}`)}catch{alert("\u6A21\u677F\u6E32\u67D3\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u6A21\u677F\u662F\u5426\u542B\u6709\u975Ehtml\u5143\u7D20\u3002")}},100)}},this.$store.commit("MapModule/setMap",Ye),this.$store.commit("MapModule/setMapLoaded",!0),od()}}};let Ye=null,ce=[];function ad(o){let a={dy:-38,autoPan:!1,autoOpenOn:null,title:"\u8BE6\u60C5",content:'<div class="msgBox-content"></div>'},i=new ac.InfoWindow(a);return i.addTo(o),i}function od(o){Ye.getInstance().on("click zoomend mousemove rotate",i=>{switch(i.type){case"click":qo(i);break;case"zoomend":break;case"mousemove":let r=document.getElementById("mouse-position1");r&&(r.innerHTML=i.coordinate.toFixed(5).toArray()[0]+"<br/>"+i.coordinate.toFixed(5).toArray()[1]),qo(i);break;case"rotate":let t=0;i.from===0&&(t=0),i.from<0?t=-i.from:i.from<=179.9999999999999&&i.from>0&&(t=360-i.from);let e=document.getElementById("compass");e&&(e.style.transform="rotate("+t+"deg)");break}})}function qo(o){o.type==="click"&&Ye.hideInfoWindow(),ce.forEach(a=>{if(a.type.split(",").indexOf(o.type)>=0){let i=a.layerIds,r=[];i instanceof Array&&i.length>0?(i.forEach(t=>{r.push(Ye.getOrCreateLayerById(t))}),Ye.forEachFeatureAtCoordinate(o.coordinate,r).then(t=>{t.length&&a.run({...o,geos:t})})):a.run(o)}})}function $h(o,a){let i=parseFloat(o),r=parseFloat(a);return[i,r]}function sd(o,a){if(!o||!(o instanceof Array))return[];const{id:i,x:r,y:t,symbol:e,cursor:n}={id:"id",x:"x",y:"y",cursor:"pointer",...a};let s=[],h=e;return typeof e!="function"&&(h=function(){return e}),o.forEach(u=>{if(!u)return;let[l,f]=$h(u[r],u[t]);if(isNaN(l)||isNaN(f))return;u._uuid=u[i]||ge.uuid();let c={feature:{type:"Feature",id:u._uuid,geometry:{type:"Point",coordinates:[l,f]},properties:u},options:{draggable:!1},symbol:h(u)},d=K.fromJSON(c);d.config("cursor",n),s.push(d)}),s}function hd(o,a){const{id:i,x:r,y:t,symbol:e,cursor:n}={id:"id",x:"x",y:"y",cursor:"pointer",...a};if(!(o instanceof Array)||o.length<2)return;let s=[],h=e;typeof e!="function"&&(h=function(){return e});let u=o[0][i]||ge.uuid();o.forEach(c=>{if(!c)return;let[d,g]=$h(c[r],c[t]);isNaN(d)||isNaN(g)||s.push([d,g])});let l={feature:{type:"Feature",id:u,geometry:{type:"LineString",coordinates:s},properties:o},options:{visible:!0,arrowStyle:null,draggable:!1,editable:!1},symbol:h(o[0])},f=K.fromJSON(l);return f.config("cursor",n),f}var ud=function(){var a=this,i=a._self._c;return i("div",{staticClass:"map-container",attrs:{id:"map"}})},ld=[],fd=ru(nd,ud,ld,!1,null,null,null,null);const xd=fd.exports;export{Wf as A,q as B,k as C,Th as D,oe as E,dt as L,_h as M,mt as P,Vt as T,xd as _,ac as a,md as b,xr as c,Dt as d,st as e,S as f,pd as g,Ra as h,gd as i,vd as j,Mt as k,_d as l,gl as r,yd as w};
